{"version":3,"sources":["../../src/protocol/validatorPrimitives.ts"],"names":["ValidationError","Error","tNumber","arg","path","Number","valueOf","tBoolean","Boolean","tString","String","tBinary","tUndefined","Object","is","undefined","tAny","tOptional","v","tArray","Array","isArray","map","x","index","tObject","s","result","key","entries","value","startsWith","tEnum","e","includes","join"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isUnderTest } from '../utils/utils';\n\nexport class ValidationError extends Error {}\nexport type Validator = (arg: any, path: string) => any;\n\nexport const tNumber: Validator = (arg: any, path: string) => {\n  if (arg instanceof Number)\n    return arg.valueOf();\n  if (typeof arg === 'number')\n    return arg;\n  throw new ValidationError(`${path}: expected number, got ${typeof arg}`);\n};\nexport const tBoolean: Validator = (arg: any, path: string) => {\n  if (arg instanceof Boolean)\n    return arg.valueOf();\n  if (typeof arg === 'boolean')\n    return arg;\n  throw new ValidationError(`${path}: expected boolean, got ${typeof arg}`);\n};\nexport const tString: Validator = (arg: any, path: string) => {\n  if (arg instanceof String)\n    return arg.valueOf();\n  if (typeof arg === 'string')\n    return arg;\n  throw new ValidationError(`${path}: expected string, got ${typeof arg}`);\n};\nexport const tBinary: Validator = (arg: any, path: string) => {\n  if (arg instanceof String)\n    return arg.valueOf();\n  if (typeof arg === 'string')\n    return arg;\n  throw new ValidationError(`${path}: expected base64-encoded buffer, got ${typeof arg}`);\n};\nexport const tUndefined: Validator = (arg: any, path: string) => {\n  if (Object.is(arg, undefined))\n    return arg;\n  throw new ValidationError(`${path}: expected undefined, got ${typeof arg}`);\n};\nexport const tAny: Validator = (arg: any, path: string) => {\n  return arg;\n};\nexport const tOptional = (v: Validator): Validator => {\n  return (arg: any, path: string) => {\n    if (Object.is(arg, undefined))\n      return arg;\n    return v(arg, path);\n  };\n};\nexport const tArray = (v: Validator): Validator => {\n  return (arg: any, path: string) => {\n    if (!Array.isArray(arg))\n      throw new ValidationError(`${path}: expected array, got ${typeof arg}`);\n    return arg.map((x, index) => v(x, path + '[' + index + ']'));\n  };\n};\nexport const tObject = (s: { [key: string]: Validator }): Validator => {\n  return (arg: any, path: string) => {\n    if (Object.is(arg, null))\n      throw new ValidationError(`${path}: expected object, got null`);\n    if (typeof arg !== 'object')\n      throw new ValidationError(`${path}: expected object, got ${typeof arg}`);\n    const result: any = {};\n    for (const [key, v] of Object.entries(s)) {\n      const value = v(arg[key], path ? path + '.' + key : key);\n      if (!Object.is(value, undefined))\n        result[key] = value;\n    }\n    if (isUnderTest()) {\n      for (const [key, value] of Object.entries(arg)) {\n        if (key.startsWith('__testHook'))\n          result[key] = value;\n      }\n    }\n    return result;\n  };\n};\nexport const tEnum = (e: string[]): Validator => {\n  return (arg: any, path: string) => {\n    if (!e.includes(arg))\n      throw new ValidationError(`${path}: expected one of (${e.join('|')})`);\n    return arg;\n  };\n};\n"],"file":"validatorPrimitives.js"}