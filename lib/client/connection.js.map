{"version":3,"sources":["../../src/client/connection.ts"],"names":["Root","ChannelOwner","constructor","connection","initialize","Playwright","from","_channel","language","playwright","Connection","EventEmitter","onClose","_objects","Map","_waitingForObject","onmessage","message","_lastId","_callbacks","_rootObject","_disconnectedErrorMessage","_onClose","initializePlaywright","pendingProtocolCalls","Array","values","map","callback","metadata","getObjectWithKnownName","guid","get","sendMessageToServer","object","method","params","stackTrace","_guid","frames","apiName","frameTexts","id","converted","debugLogger","log","stack","Error","Promise","resolve","reject","set","_debugScopeState","dispatch","result","error","delete","_replaceGuidsWithChannels","_createRemoteObject","type","initializer","_dispose","emit","close","didDisconnect","errorMessage","clear","isDisconnected","payload","isArray","p","has","key","Object","keys","parentGuid","parent","Android","AndroidSocket","AndroidDevice","Artifact","BindingCall","Browser","BrowserContext","BrowserType","CDPSession","ConsoleMessage","Dialog","Electron","ElectronApplication","ElementHandle","Frame","JSHandle","Page","Request","Response","Route","Stream","SelectorsOwner","WebSocket","Worker","SocksSocket"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Browser } from './browser';\nimport { BrowserContext } from './browserContext';\nimport { BrowserType } from './browserType';\nimport { ChannelOwner } from './channelOwner';\nimport { ElementHandle } from './elementHandle';\nimport { Frame } from './frame';\nimport { JSHandle } from './jsHandle';\nimport { Request, Response, Route, WebSocket } from './network';\nimport { Page, BindingCall } from './page';\nimport { Worker } from './worker';\nimport { ConsoleMessage } from './consoleMessage';\nimport { Dialog } from './dialog';\nimport { parseError } from '../protocol/serializers';\nimport { CDPSession } from './cdpSession';\nimport { Playwright } from './playwright';\nimport { Electron, ElectronApplication } from './electron';\nimport * as channels from '../protocol/channels';\nimport { Stream } from './stream';\nimport { debugLogger } from '../utils/debugLogger';\nimport { SelectorsOwner } from './selectors';\nimport { Android, AndroidSocket, AndroidDevice } from './android';\nimport { SocksSocket } from './socksSocket';\nimport { ParsedStackTrace } from '../utils/stackTrace';\nimport { Artifact } from './artifact';\nimport { EventEmitter } from 'events';\n\nclass Root extends ChannelOwner<channels.RootChannel, {}> {\n  constructor(connection: Connection) {\n    super(connection, 'Root', '', {});\n  }\n\n  async initialize(): Promise<Playwright> {\n    return Playwright.from((await this._channel.initialize({\n      language: 'javascript',\n    })).playwright);\n  }\n}\n\nexport class Connection extends EventEmitter {\n  readonly _objects = new Map<string, ChannelOwner>();\n  private _waitingForObject = new Map<string, any>();\n  onmessage = (message: object): void => {};\n  private _lastId = 0;\n  private _callbacks = new Map<number, { resolve: (a: any) => void, reject: (a: Error) => void, metadata: channels.Metadata }>();\n  private _rootObject: Root;\n  private _disconnectedErrorMessage: string | undefined;\n  private _onClose?: () => void;\n\n  constructor(onClose?: () => void) {\n    super();\n    this._rootObject = new Root(this);\n    this._onClose = onClose;\n  }\n\n  async initializePlaywright(): Promise<Playwright> {\n    return await this._rootObject.initialize();\n  }\n\n  pendingProtocolCalls(): channels.Metadata[] {\n    return Array.from(this._callbacks.values()).map(callback => callback.metadata);\n  }\n\n  getObjectWithKnownName(guid: string): any {\n    return this._objects.get(guid)!;\n  }\n\n  async sendMessageToServer(object: ChannelOwner, method: string, params: any, stackTrace: ParsedStackTrace | null): Promise<any> {\n    const guid = object._guid;\n    const { frames, apiName }: ParsedStackTrace = stackTrace || { frameTexts: [], frames: [], apiName: '' };\n\n    const id = ++this._lastId;\n    const converted = { id, guid, method, params };\n    // Do not include metadata in debug logs to avoid noise.\n    debugLogger.log('channel:command', converted);\n    const metadata: channels.Metadata = { stack: frames, apiName };\n    this.onmessage({ ...converted, metadata });\n\n    if (this._disconnectedErrorMessage)\n      throw new Error(this._disconnectedErrorMessage);\n    return await new Promise((resolve, reject) => this._callbacks.set(id, { resolve, reject, metadata }));\n  }\n\n  _debugScopeState(): any {\n    return this._rootObject._debugScopeState();\n  }\n\n  dispatch(message: object) {\n    const { id, guid, method, params, result, error } = message as any;\n    if (id) {\n      debugLogger.log('channel:response', message);\n      const callback = this._callbacks.get(id);\n      if (!callback)\n        throw new Error(`Cannot find command to respond: ${id}`);\n      this._callbacks.delete(id);\n      if (error)\n        callback.reject(parseError(error));\n      else\n        callback.resolve(this._replaceGuidsWithChannels(result));\n      return;\n    }\n\n    debugLogger.log('channel:event', message);\n    if (method === '__create__') {\n      this._createRemoteObject(guid, params.type, params.guid, params.initializer);\n      return;\n    }\n    if (method === '__dispose__') {\n      const object = this._objects.get(guid);\n      if (!object)\n        throw new Error(`Cannot find object to dispose: ${guid}`);\n      object._dispose();\n      return;\n    }\n    const object = this._objects.get(guid);\n    if (!object)\n      throw new Error(`Cannot find object to emit \"${method}\": ${guid}`);\n    object._channel.emit(method, this._replaceGuidsWithChannels(params));\n  }\n\n  close() {\n    if (this._onClose)\n      this._onClose();\n  }\n\n  didDisconnect(errorMessage: string) {\n    this._disconnectedErrorMessage = errorMessage;\n    for (const callback of this._callbacks.values())\n      callback.reject(new Error(errorMessage));\n    this._callbacks.clear();\n    this.emit('disconnect');\n  }\n\n  isDisconnected() {\n    return !!this._disconnectedErrorMessage;\n  }\n\n  private _replaceGuidsWithChannels(payload: any): any {\n    if (!payload)\n      return payload;\n    if (Array.isArray(payload))\n      return payload.map(p => this._replaceGuidsWithChannels(p));\n    if (payload.guid && this._objects.has(payload.guid))\n      return this._objects.get(payload.guid)!._channel;\n    if (typeof payload === 'object') {\n      const result: any = {};\n      for (const key of Object.keys(payload))\n        result[key] = this._replaceGuidsWithChannels(payload[key]);\n      return result;\n    }\n    return payload;\n  }\n\n  private _createRemoteObject(parentGuid: string, type: string, guid: string, initializer: any): any {\n    const parent = this._objects.get(parentGuid);\n    if (!parent)\n      throw new Error(`Cannot find parent object ${parentGuid} to create ${guid}`);\n    let result: ChannelOwner<any, any>;\n    initializer = this._replaceGuidsWithChannels(initializer);\n    switch (type) {\n      case 'Android':\n        result = new Android(parent, type, guid, initializer);\n        break;\n      case 'AndroidSocket':\n        result = new AndroidSocket(parent, type, guid, initializer);\n        break;\n      case 'AndroidDevice':\n        result = new AndroidDevice(parent, type, guid, initializer);\n        break;\n      case 'Artifact':\n        result = new Artifact(parent, type, guid, initializer);\n        break;\n      case 'BindingCall':\n        result = new BindingCall(parent, type, guid, initializer);\n        break;\n      case 'Browser':\n        result = new Browser(parent, type, guid, initializer);\n        break;\n      case 'BrowserContext':\n        result = new BrowserContext(parent, type, guid, initializer);\n        break;\n      case 'BrowserType':\n        result = new BrowserType(parent, type, guid, initializer);\n        break;\n      case 'CDPSession':\n        result = new CDPSession(parent, type, guid, initializer);\n        break;\n      case 'ConsoleMessage':\n        result = new ConsoleMessage(parent, type, guid, initializer);\n        break;\n      case 'Dialog':\n        result = new Dialog(parent, type, guid, initializer);\n        break;\n      case 'Electron':\n        result = new Electron(parent, type, guid, initializer);\n        break;\n      case 'ElectronApplication':\n        result = new ElectronApplication(parent, type, guid, initializer);\n        break;\n      case 'ElementHandle':\n        result = new ElementHandle(parent, type, guid, initializer);\n        break;\n      case 'Frame':\n        result = new Frame(parent, type, guid, initializer);\n        break;\n      case 'JSHandle':\n        result = new JSHandle(parent, type, guid, initializer);\n        break;\n      case 'Page':\n        result = new Page(parent, type, guid, initializer);\n        break;\n      case 'Playwright':\n        result = new Playwright(parent, type, guid, initializer);\n        break;\n      case 'Request':\n        result = new Request(parent, type, guid, initializer);\n        break;\n      case 'Response':\n        result = new Response(parent, type, guid, initializer);\n        break;\n      case 'Route':\n        result = new Route(parent, type, guid, initializer);\n        break;\n      case 'Stream':\n        result = new Stream(parent, type, guid, initializer);\n        break;\n      case 'Selectors':\n        result = new SelectorsOwner(parent, type, guid, initializer);\n        break;\n      case 'WebSocket':\n        result = new WebSocket(parent, type, guid, initializer);\n        break;\n      case 'Worker':\n        result = new Worker(parent, type, guid, initializer);\n        break;\n      case 'SocksSocket':\n        result = new SocksSocket(parent, type, guid, initializer);\n        break;\n      default:\n        throw new Error('Missing type ' + type);\n    }\n    const callback = this._waitingForObject.get(guid);\n    if (callback) {\n      callback(result);\n      this._waitingForObject.delete(guid);\n    }\n    return result;\n  }\n}\n"],"file":"connection.js"}