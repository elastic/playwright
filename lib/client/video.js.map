{"version":3,"sources":["../../src/client/video.ts"],"names":["Video","constructor","page","_artifact","_artifactCallback","artifact","_isRemote","browser","context","_browser","_remoteType","Promise","race","f","_closedOrCrashedPromise","then","_artifactReady","path","Error","_initializer","absolutePath","saveAs","delete"],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAMO,MAAMA,KAAN,CAAiC;AAKtCC,EAAAA,WAAW,CAACC,IAAD,EAAa;AAAA,SAJhBC,SAIgB,GAJ6B,IAI7B;;AAAA,SAHhBC,iBAGgB,GAHKC,QAAD,IAAwB,CAAE,CAG9B;;AAAA,SAFhBC,SAEgB,GAFJ,KAEI;;AACtB,UAAMC,OAAO,GAAGL,IAAI,CAACM,OAAL,GAAeC,QAA/B;;AACA,SAAKH,SAAL,GAAiB,CAAC,CAACC,OAAF,IAAa,CAAC,CAACA,OAAO,CAACG,WAAxC;AACA,SAAKP,SAAL,GAAiBQ,OAAO,CAACC,IAAR,CAAa,CAC5B,IAAID,OAAJ,CAAsBE,CAAC,IAAI,KAAKT,iBAAL,GAAyBS,CAApD,CAD4B,EAE5BX,IAAI,CAACY,uBAAL,CAA6BC,IAA7B,CAAkC,MAAM,IAAxC,CAF4B,CAAb,CAAjB;AAID;;AAEDC,EAAAA,cAAc,CAACX,QAAD,EAAqB;AACjCA,IAAAA,QAAQ,CAACC,SAAT,GAAqB,KAAKA,SAA1B;;AACA,SAAKF,iBAAL,CAAuBC,QAAvB;AACD;;AAES,QAAJY,IAAI,GAAoB;AAC5B,QAAI,KAAKX,SAAT,EACE,MAAM,IAAIY,KAAJ,CAAW,4FAAX,CAAN;AACF,UAAMb,QAAQ,GAAG,MAAM,KAAKF,SAA5B;AACA,QAAI,CAACE,QAAL,EACE,MAAM,IAAIa,KAAJ,CAAU,uCAAV,CAAN;AACF,WAAOb,QAAQ,CAACc,YAAT,CAAsBC,YAA7B;AACD;;AAEW,QAANC,MAAM,CAACJ,IAAD,EAA8B;AACxC,UAAMZ,QAAQ,GAAG,MAAM,KAAKF,SAA5B;AACA,QAAI,CAACE,QAAL,EACE,MAAM,IAAIa,KAAJ,CAAU,uCAAV,CAAN;AACF,WAAOb,QAAQ,CAACgB,MAAT,CAAgBJ,IAAhB,CAAP;AACD;;AAEW,QAANK,MAAM,GAAkB;AAC5B,UAAMjB,QAAQ,GAAG,MAAM,KAAKF,SAA5B;AACA,QAAIE,QAAJ,EACE,MAAMA,QAAQ,CAACiB,MAAT,EAAN;AACH;;AAvCqC","sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Page } from './page';\nimport * as api from '../../types/types';\nimport { Artifact } from './artifact';\n\nexport class Video implements api.Video {\n  private _artifact: Promise<Artifact | null> | null = null;\n  private _artifactCallback = (artifact: Artifact) => {};\n  private _isRemote = false;\n\n  constructor(page: Page) {\n    const browser = page.context()._browser;\n    this._isRemote = !!browser && !!browser._remoteType;\n    this._artifact = Promise.race([\n      new Promise<Artifact>(f => this._artifactCallback = f),\n      page._closedOrCrashedPromise.then(() => null),\n    ]);\n  }\n\n  _artifactReady(artifact: Artifact) {\n    artifact._isRemote = this._isRemote;\n    this._artifactCallback(artifact);\n  }\n\n  async path(): Promise<string> {\n    if (this._isRemote)\n      throw new Error(`Path is not available when using browserType.connect(). Use saveAs() to save a local copy.`);\n    const artifact = await this._artifact;\n    if (!artifact)\n      throw new Error('Page did not produce any video frames');\n    return artifact._initializer.absolutePath;\n  }\n\n  async saveAs(path: string): Promise<void> {\n    const artifact = await this._artifact;\n    if (!artifact)\n      throw new Error('Page did not produce any video frames');\n    return artifact.saveAs(path);\n  }\n\n  async delete(): Promise<void> {\n    const artifact = await this._artifact;\n    if (artifact)\n      await artifact.delete();\n  }\n}\n"],"file":"video.js"}