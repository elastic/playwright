{"version":3,"sources":["../../src/server/helper.ts"],"names":["Helper","completeUserURL","urlString","startsWith","enclosingIntRect","rect","x","Math","floor","y","x2","ceil","width","y2","height","enclosingIntSize","size","getViewportSizeFromWindowFeatures","features","widthString","find","f","heightString","parseInt","substring","NaN","Number","isNaN","waitForEvent","progress","emitter","event","predicate","listeners","promise","Promise","resolve","reject","push","eventsHelper","addEventListener","eventArg","removeEventListeners","e","dispose","cleanupWhenAborted","secondsToRoundishMillis","value","millisToRoundishMillis","debugProtocolLogger","protocolLogger","direction","message","debugLogger","isEnabled","log","JSON","stringify","formatBrowserLogs","logs","length","repeat","join","helper"],"mappings":"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","sourcesContent":["/**\n * Copyright 2017 Google Inc. All rights reserved.\n * Modifications copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { EventEmitter } from 'events';\nimport * as types from './types';\nimport { Progress } from './progress';\nimport { debugLogger } from '../utils/debugLogger';\nimport { eventsHelper, RegisteredListener } from '../utils/eventsHelper';\n\nclass Helper {\n  static completeUserURL(urlString: string): string {\n    if (urlString.startsWith('localhost') || urlString.startsWith('127.0.0.1'))\n      urlString = 'http://' + urlString;\n    return urlString;\n  }\n\n  static enclosingIntRect(rect: types.Rect): types.Rect {\n    const x = Math.floor(rect.x + 1e-3);\n    const y = Math.floor(rect.y + 1e-3);\n    const x2 = Math.ceil(rect.x + rect.width - 1e-3);\n    const y2 = Math.ceil(rect.y + rect.height - 1e-3);\n    return { x, y, width: x2 - x, height: y2 - y };\n  }\n\n  static enclosingIntSize(size: types.Size): types.Size {\n    return { width: Math.floor(size.width + 1e-3), height: Math.floor(size.height + 1e-3) };\n  }\n\n  static getViewportSizeFromWindowFeatures(features: string[]): types.Size | null {\n    const widthString = features.find(f => f.startsWith('width='));\n    const heightString = features.find(f => f.startsWith('height='));\n    const width = widthString ? parseInt(widthString.substring(6), 10) : NaN;\n    const height = heightString ? parseInt(heightString.substring(7), 10) : NaN;\n    if (!Number.isNaN(width) && !Number.isNaN(height))\n      return { width, height };\n    return null;\n  }\n\n  static waitForEvent(progress: Progress | null, emitter: EventEmitter, event: string | symbol, predicate?: Function): { promise: Promise<any>, dispose: () => void } {\n    const listeners: RegisteredListener[] = [];\n    const promise = new Promise((resolve, reject) => {\n      listeners.push(eventsHelper.addEventListener(emitter, event, eventArg => {\n        try {\n          if (predicate && !predicate(eventArg))\n            return;\n          eventsHelper.removeEventListeners(listeners);\n          resolve(eventArg);\n        } catch (e) {\n          eventsHelper.removeEventListeners(listeners);\n          reject(e);\n        }\n      }));\n    });\n    const dispose = () => eventsHelper.removeEventListeners(listeners);\n    if (progress)\n      progress.cleanupWhenAborted(dispose);\n    return { promise, dispose };\n  }\n\n  static secondsToRoundishMillis(value: number): number {\n    return ((value * 1000000) | 0) / 1000;\n  }\n\n  static millisToRoundishMillis(value: number): number {\n    return ((value * 1000) | 0) / 1000;\n  }\n\n  static debugProtocolLogger(protocolLogger?: types.ProtocolLogger): types.ProtocolLogger {\n    return (direction: 'send' | 'receive', message: object) => {\n      if (protocolLogger)\n        protocolLogger(direction, message);\n      if (debugLogger.isEnabled('protocol'))\n        debugLogger.log('protocol', (direction === 'send' ? 'SEND ► ' : '◀ RECV ') + JSON.stringify(message));\n    };\n  }\n\n  static formatBrowserLogs(logs: string[]) {\n    if (!logs.length)\n      return '';\n    return '\\n' + '='.repeat(20) + ' Browser output: ' + '='.repeat(20) + '\\n' + logs.join('\\n');\n  }\n}\n\nexport const helper = Helper;\n"],"file":"helper.js"}