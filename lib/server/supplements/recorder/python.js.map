{"version":3,"sources":["../../../../src/server/supplements/recorder/python.ts"],"names":["PythonLanguageGenerator","constructor","isAsync","id","fileName","highlighter","_awaitPrefix","_asyncPrefix","_isAsync","generateAction","actionInContext","action","pageAlias","formatter","PythonFormatter","newLine","add","name","url","quote","format","subject","isMainFrame","frameName","formatOptions","frameUrl","signals","dialog","actionCall","_generateActionCall","code","popup","popupAlias","download","waitForNavigation","assertNavigation","Error","method","clickCount","modifiers","options","button","length","optionsString","selector","text","formatValue","files","shortcut","key","join","generateHeader","browserName","launchOptions","formatContextOptions","contextOptions","deviceName","generateFooter","saveStorage","storageStateLine","value","undefined","Array","isArray","map","String","toSnakeCase","toSnakeCaseRegex","replace","toLowerCase","hasArguments","keys","Object","device","deviceDescriptors","offset","_baseIndent","_baseOffset","_lines","repeat","prepend","trim","split","line","concat","push","spaces","lines","forEach","substring","endsWith","trimEnd","char"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { BrowserContextOptions } from '../../../..';\nimport { LanguageGenerator, LanguageGeneratorOptions, sanitizeDeviceOptions, toSignalMap } from './language';\nimport { ActionInContext } from './codeGenerator';\nimport { actionTitle, Action } from './recorderActions';\nimport { MouseClickOptions, toModifiers } from './utils';\nimport deviceDescriptors from '../../deviceDescriptors';\n\nexport class PythonLanguageGenerator implements LanguageGenerator {\n  id = 'python';\n  fileName = 'Python';\n  highlighter = 'python';\n\n  private _awaitPrefix: '' | 'await ';\n  private _asyncPrefix: '' | 'async ';\n  private _isAsync: boolean;\n\n  constructor(isAsync: boolean) {\n    this.id = isAsync ? 'python-async' : 'python';\n    this.fileName = isAsync ? 'Python Async' : 'Python';\n    this._isAsync = isAsync;\n    this._awaitPrefix = isAsync ? 'await ' : '';\n    this._asyncPrefix = isAsync ? 'async ' : '';\n  }\n\n  generateAction(actionInContext: ActionInContext): string {\n    const { action, pageAlias } = actionInContext;\n    const formatter = new PythonFormatter(4);\n    formatter.newLine();\n    formatter.add('# ' + actionTitle(action));\n\n    if (action.name === 'openPage') {\n      formatter.add(`${pageAlias} = ${this._awaitPrefix}context.new_page()`);\n      if (action.url && action.url !== 'about:blank' && action.url !== 'chrome://newtab/')\n        formatter.add(`${this._awaitPrefix}${pageAlias}.goto(${quote(action.url)})`);\n      return formatter.format();\n    }\n\n    const subject = actionInContext.isMainFrame ? pageAlias :\n      (actionInContext.frameName ?\n        `${pageAlias}.frame(${formatOptions({ name: actionInContext.frameName }, false)})` :\n        `${pageAlias}.frame(${formatOptions({ url: actionInContext.frameUrl }, false)})`);\n\n    const signals = toSignalMap(action);\n\n    if (signals.dialog)\n      formatter.add(`  ${pageAlias}.once(\"dialog\", lambda dialog: dialog.dismiss())`);\n\n    const actionCall = this._generateActionCall(action);\n    let code = `${this._awaitPrefix}${subject}.${actionCall}`;\n\n    if (signals.popup) {\n      code = `${this._asyncPrefix}with ${pageAlias}.expect_popup() as popup_info {\n        ${code}\n      }\n      ${signals.popup.popupAlias} = ${this._awaitPrefix}popup_info.value`;\n    }\n\n    if (signals.download) {\n      code = `${this._asyncPrefix}with ${pageAlias}.expect_download() as download_info {\n        ${code}\n      }\n      download = ${this._awaitPrefix}download_info.value`;\n    }\n\n    if (signals.waitForNavigation) {\n      code = `\n      # ${this._asyncPrefix}with ${pageAlias}.expect_navigation(url=${quote(signals.waitForNavigation.url)}):\n      ${this._asyncPrefix}with ${pageAlias}.expect_navigation() {\n        ${code}\n      }`;\n    }\n\n    formatter.add(code);\n\n    if (signals.assertNavigation)\n      formatter.add(`  # assert ${pageAlias}.url == ${quote(signals.assertNavigation.url)}`);\n    return formatter.format();\n  }\n\n  private _generateActionCall(action: Action): string {\n    switch (action.name) {\n      case 'openPage':\n        throw Error('Not reached');\n      case 'closePage':\n        return 'close()';\n      case 'click': {\n        let method = 'click';\n        if (action.clickCount === 2)\n          method = 'dblclick';\n        const modifiers = toModifiers(action.modifiers);\n        const options: MouseClickOptions = {};\n        if (action.button !== 'left')\n          options.button = action.button;\n        if (modifiers.length)\n          options.modifiers = modifiers;\n        if (action.clickCount > 2)\n          options.clickCount = action.clickCount;\n        const optionsString = formatOptions(options, true);\n        return `${method}(${quote(action.selector)}${optionsString})`;\n      }\n      case 'check':\n        return `check(${quote(action.selector)})`;\n      case 'uncheck':\n        return `uncheck(${quote(action.selector)})`;\n      case 'fill':\n        return `fill(${quote(action.selector)}, ${quote(action.text)})`;\n      case 'setInputFiles':\n        return `set_input_files(${quote(action.selector)}, ${formatValue(action.files.length === 1 ? action.files[0] : action.files)})`;\n      case 'press': {\n        const modifiers = toModifiers(action.modifiers);\n        const shortcut = [...modifiers, action.key].join('+');\n        return `press(${quote(action.selector)}, ${quote(shortcut)})`;\n      }\n      case 'navigate':\n        return `goto(${quote(action.url)})`;\n      case 'select':\n        return `select_option(${quote(action.selector)}, ${formatValue(action.options.length === 1 ? action.options[0] : action.options)})`;\n    }\n  }\n\n  generateHeader(options: LanguageGeneratorOptions): string {\n    const formatter = new PythonFormatter();\n    if (this._isAsync) {\n      formatter.add(`\nimport asyncio\n\nfrom playwright.async_api import Playwright, async_playwright\n\n\nasync def run(playwright: Playwright) -> None {\n    browser = await playwright.${options.browserName}.launch(${formatOptions(options.launchOptions, false)})\n    context = await browser.new_context(${formatContextOptions(options.contextOptions, options.deviceName)})`);\n    } else {\n      formatter.add(`\nfrom playwright.sync_api import Playwright, sync_playwright\n\n\ndef run(playwright: Playwright) -> None {\n    browser = playwright.${options.browserName}.launch(${formatOptions(options.launchOptions, false)})\n    context = browser.new_context(${formatContextOptions(options.contextOptions, options.deviceName)})`);\n    }\n    return formatter.format();\n  }\n\n  generateFooter(saveStorage: string | undefined): string {\n    if (this._isAsync) {\n      const storageStateLine = saveStorage ? `\\n    await context.storage_state(path=\"${saveStorage}\")` : '';\n      return `\\n    # ---------------------${storageStateLine}\n    await context.close()\n    await browser.close()\n\n\nasync def main() -> None:\n    async with async_playwright() as playwright:\n        await run(playwright)\n\n\nasyncio.run(main())\n`;\n    } else {\n      const storageStateLine = saveStorage ? `\\n    context.storage_state(path=\"${saveStorage}\")` : '';\n      return `\\n    # ---------------------${storageStateLine}\n    context.close()\n    browser.close()\n\n\nwith sync_playwright() as playwright:\n    run(playwright)\n`;\n    }\n  }\n}\n\nfunction formatValue(value: any): string {\n  if (value === false)\n    return 'False';\n  if (value === true)\n    return 'True';\n  if (value === undefined)\n    return 'None';\n  if (Array.isArray(value))\n    return `[${value.map(formatValue).join(', ')}]`;\n  if (typeof value === 'string')\n    return quote(value);\n  return String(value);\n}\n\nfunction toSnakeCase(name: string): string {\n  const toSnakeCaseRegex = /((?<=[a-z0-9])[A-Z]|(?!^)[A-Z](?=[a-z]))/g;\n  return name.replace(toSnakeCaseRegex, `_$1`).toLowerCase();\n}\n\nfunction formatOptions(value: any, hasArguments: boolean): string {\n  const keys = Object.keys(value);\n  if (!keys.length)\n    return '';\n  return (hasArguments ? ', ' : '') + keys.map(key => `${toSnakeCase(key)}=${formatValue(value[key])}`).join(', ');\n}\n\nfunction formatContextOptions(options: BrowserContextOptions, deviceName: string | undefined): string {\n  const device = deviceName && deviceDescriptors[deviceName];\n  if (!device)\n    return formatOptions(options, false);\n  return `**playwright.devices[\"${deviceName}\"]` + formatOptions(sanitizeDeviceOptions(device, options), true);\n}\n\nclass PythonFormatter {\n  private _baseIndent: string;\n  private _baseOffset: string;\n  private _lines: string[] = [];\n\n  constructor(offset = 0) {\n    this._baseIndent = ' '.repeat(4);\n    this._baseOffset = ' '.repeat(offset);\n  }\n\n  prepend(text: string) {\n    this._lines = text.trim().split('\\n').map(line => line.trim()).concat(this._lines);\n  }\n\n  add(text: string) {\n    this._lines.push(...text.trim().split('\\n').map(line => line.trim()));\n  }\n\n  newLine() {\n    this._lines.push('');\n  }\n\n  format(): string {\n    let spaces = '';\n    const lines: string[] = [];\n    this._lines.forEach((line: string) => {\n      if (line === '')\n        return lines.push(line);\n      if (line === '}') {\n        spaces = spaces.substring(this._baseIndent.length);\n        return;\n      }\n\n      line = spaces  + line;\n      if (line.endsWith('{')) {\n        spaces += this._baseIndent;\n        line = line.substring(0, line.length - 1).trimEnd() + ':';\n      }\n      return lines.push(this._baseOffset + line);\n    });\n    return lines.join('\\n');\n  }\n}\n\nfunction quote(text: string, char: string = '\\\"') {\n  if (char === '\\'')\n    return char + text.replace(/[']/g, '\\\\\\'') + char;\n  if (char === '\"')\n    return char + text.replace(/[\"]/g, '\\\\\"') + char;\n  if (char === '`')\n    return char + text.replace(/[`]/g, '\\\\`') + char;\n  throw new Error('Invalid escape char');\n}\n"],"file":"python.js"}