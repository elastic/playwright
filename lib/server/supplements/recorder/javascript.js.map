{"version":3,"sources":["../../../../src/server/supplements/recorder/javascript.ts"],"names":["JavaScriptLanguageGenerator","constructor","isTest","id","fileName","highlighter","_isTest","generateAction","actionInContext","action","pageAlias","formatter","JavaScriptFormatter","newLine","add","name","url","quote","format","subject","isMainFrame","frameName","formatObject","frameUrl","signals","dialog","emitPromiseAll","waitForNavigation","popup","download","leftHandSide","popupAlias","prefix","actionCall","_generateActionCall","suffix","assertNavigation","Error","method","clickCount","modifiers","options","button","length","optionsString","formatOptions","selector","text","files","shortcut","key","join","generateHeader","generateTestHeader","generateStandaloneHeader","generateFooter","saveStorage","generateTestFooter","generateStandaloneFooter","useText","formatContextOptions","contextOptions","deviceName","browserName","formatObjectOrVoid","launchOptions","storageStateLine","value","keys","Object","indent","Array","isArray","map","o","tokens","push","String","result","device","deviceDescriptors","serializedObject","lines","split","splice","offset","_baseIndent","_baseOffset","_lines","repeat","prepend","trim","line","concat","spaces","previousLine","startsWith","substring","extraSpaces","test","callCarryOver","endsWith","char","replace"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { BrowserContextOptions } from '../../../..';\nimport { LanguageGenerator, LanguageGeneratorOptions, sanitizeDeviceOptions, toSignalMap } from './language';\nimport { ActionInContext } from './codeGenerator';\nimport { Action, actionTitle } from './recorderActions';\nimport { MouseClickOptions, toModifiers } from './utils';\nimport deviceDescriptors from '../../deviceDescriptors';\n\nexport class JavaScriptLanguageGenerator implements LanguageGenerator {\n  id: string;\n  fileName: string;\n  highlighter = 'javascript';\n  private _isTest: boolean;\n\n  constructor(isTest: boolean) {\n    this.id = isTest ? 'test' : 'javascript';\n    this.fileName = isTest ? 'Playwright Test' : 'JavaScript';\n    this._isTest = isTest;\n  }\n\n  generateAction(actionInContext: ActionInContext): string {\n    const { action, pageAlias } = actionInContext;\n    const formatter = new JavaScriptFormatter(2);\n    formatter.newLine();\n    formatter.add('// ' + actionTitle(action));\n\n    if (action.name === 'openPage') {\n      if (this._isTest)\n        return '';\n      formatter.add(`const ${pageAlias} = await context.newPage();`);\n      if (action.url && action.url !== 'about:blank' && action.url !== 'chrome://newtab/')\n        formatter.add(`await ${pageAlias}.goto(${quote(action.url)});`);\n      return formatter.format();\n    }\n\n    const subject = actionInContext.isMainFrame ? pageAlias :\n      (actionInContext.frameName ?\n        `${pageAlias}.frame(${formatObject({ name: actionInContext.frameName })})` :\n        `${pageAlias}.frame(${formatObject({ url: actionInContext.frameUrl })})`);\n\n    const signals = toSignalMap(action);\n\n    if (signals.dialog) {\n      formatter.add(`  ${pageAlias}.once('dialog', dialog => {\n    console.log(\\`Dialog message: $\\{dialog.message()}\\`);\n    dialog.dismiss().catch(() => {});\n  });`);\n    }\n\n    const emitPromiseAll = signals.waitForNavigation || signals.popup || signals.download;\n    if (emitPromiseAll) {\n      // Generate either await Promise.all([]) or\n      // const [popup1] = await Promise.all([]).\n      let leftHandSide = '';\n      if (signals.popup)\n        leftHandSide = `const [${signals.popup.popupAlias}] = `;\n      else if (signals.download)\n        leftHandSide = `const [download] = `;\n      formatter.add(`${leftHandSide}await Promise.all([`);\n    }\n\n    // Popup signals.\n    if (signals.popup)\n      formatter.add(`${pageAlias}.waitForEvent('popup'),`);\n\n    // Navigation signal.\n    if (signals.waitForNavigation)\n      formatter.add(`${pageAlias}.waitForNavigation(/*{ url: ${quote(signals.waitForNavigation.url)} }*/),`);\n\n    // Download signals.\n    if (signals.download)\n      formatter.add(`${pageAlias}.waitForEvent('download'),`);\n\n    const prefix = (signals.popup || signals.waitForNavigation || signals.download) ? '' : 'await ';\n    const actionCall = this._generateActionCall(action);\n    const suffix = (signals.waitForNavigation || emitPromiseAll) ? '' : ';';\n    formatter.add(`${prefix}${subject}.${actionCall}${suffix}`);\n\n    if (emitPromiseAll) {\n      formatter.add(`]);`);\n    } else if (signals.assertNavigation) {\n      if (this._isTest)\n        formatter.add(`  expect(${pageAlias}.url()).toBe(${quote(signals.assertNavigation.url)});`);\n      else\n        formatter.add(`  // assert.equal(${pageAlias}.url(), ${quote(signals.assertNavigation.url)});`);\n    }\n    return formatter.format();\n  }\n\n  private _generateActionCall(action: Action): string {\n    switch (action.name) {\n      case 'openPage':\n        throw Error('Not reached');\n      case 'closePage':\n        return 'close()';\n      case 'click': {\n        let method = 'click';\n        if (action.clickCount === 2)\n          method = 'dblclick';\n        const modifiers = toModifiers(action.modifiers);\n        const options: MouseClickOptions = {};\n        if (action.button !== 'left')\n          options.button = action.button;\n        if (modifiers.length)\n          options.modifiers = modifiers;\n        if (action.clickCount > 2)\n          options.clickCount = action.clickCount;\n        const optionsString = formatOptions(options);\n        return `${method}(${quote(action.selector)}${optionsString})`;\n      }\n      case 'check':\n        return `check(${quote(action.selector)})`;\n      case 'uncheck':\n        return `uncheck(${quote(action.selector)})`;\n      case 'fill':\n        return `fill(${quote(action.selector)}, ${quote(action.text)})`;\n      case 'setInputFiles':\n        return `setInputFiles(${quote(action.selector)}, ${formatObject(action.files.length === 1 ? action.files[0] : action.files)})`;\n      case 'press': {\n        const modifiers = toModifiers(action.modifiers);\n        const shortcut = [...modifiers, action.key].join('+');\n        return `press(${quote(action.selector)}, ${quote(shortcut)})`;\n      }\n      case 'navigate':\n        return `goto(${quote(action.url)})`;\n      case 'select':\n        return `selectOption(${quote(action.selector)}, ${formatObject(action.options.length > 1 ? action.options : action.options[0])})`;\n    }\n  }\n\n  generateHeader(options: LanguageGeneratorOptions): string {\n    if (this._isTest)\n      return this.generateTestHeader(options);\n    return this.generateStandaloneHeader(options);\n  }\n\n  generateFooter(saveStorage: string | undefined): string {\n    if (this._isTest)\n      return this.generateTestFooter(saveStorage);\n    return this.generateStandaloneFooter(saveStorage);\n  }\n\n  generateTestHeader(options: LanguageGeneratorOptions): string {\n    const formatter = new JavaScriptFormatter();\n    const useText = formatContextOptions(options.contextOptions, options.deviceName);\n    formatter.add(`\n      const { test, expect${options.deviceName ? ', devices' : ''} } = require('@playwright/test');\n${useText ? '\\ntest.use(' + useText + ');\\n' : ''}\n      test('test', async ({ page }) => {`);\n    return formatter.format();\n  }\n\n  generateTestFooter(saveStorage: string | undefined): string {\n    return `\\n});`;\n  }\n\n  generateStandaloneHeader(options: LanguageGeneratorOptions): string {\n    const formatter = new JavaScriptFormatter();\n    formatter.add(`\n      const { ${options.browserName}${options.deviceName ? ', devices' : ''} } = require('playwright');\n\n      (async () => {\n        const browser = await ${options.browserName}.launch(${formatObjectOrVoid(options.launchOptions)});\n        const context = await browser.newContext(${formatContextOptions(options.contextOptions, options.deviceName)});`);\n    return formatter.format();\n  }\n\n  generateStandaloneFooter(saveStorage: string | undefined): string {\n    const storageStateLine = saveStorage ? `\\n  await context.storageState({ path: '${saveStorage}' });` : '';\n    return `\\n  // ---------------------${storageStateLine}\n  await context.close();\n  await browser.close();\n})();`;\n  }\n}\n\nfunction formatOptions(value: any): string {\n  const keys = Object.keys(value);\n  if (!keys.length)\n    return '';\n  return ', ' + formatObject(value);\n}\n\nfunction formatObject(value: any, indent = '  '): string {\n  if (typeof value === 'string')\n    return quote(value);\n  if (Array.isArray(value))\n    return `[${value.map(o => formatObject(o)).join(', ')}]`;\n  if (typeof value === 'object') {\n    const keys = Object.keys(value);\n    if (!keys.length)\n      return '{}';\n    const tokens: string[] = [];\n    for (const key of keys)\n      tokens.push(`${key}: ${formatObject(value[key])}`);\n    return `{\\n${indent}${tokens.join(`,\\n${indent}`)}\\n}`;\n  }\n  return String(value);\n}\n\nfunction formatObjectOrVoid(value: any, indent = '  '): string {\n  const result = formatObject(value, indent);\n  return result === '{}' ? '' : result;\n}\n\nfunction formatContextOptions(options: BrowserContextOptions, deviceName: string | undefined): string {\n  const device = deviceName && deviceDescriptors[deviceName];\n  if (!device)\n    return formatObjectOrVoid(options);\n  // Filter out all the properties from the device descriptor.\n  let serializedObject = formatObjectOrVoid(sanitizeDeviceOptions(device, options));\n  // When there are no additional context options, we still want to spread the device inside.\n  if (!serializedObject)\n    serializedObject = '{\\n}';\n  const lines = serializedObject.split('\\n');\n  lines.splice(1, 0, `...devices['${deviceName}'],`);\n  return lines.join('\\n');\n}\n\nexport class JavaScriptFormatter {\n  private _baseIndent: string;\n  private _baseOffset: string;\n  private _lines: string[] = [];\n\n  constructor(offset = 0) {\n    this._baseIndent = ' '.repeat(2);\n    this._baseOffset = ' '.repeat(offset);\n  }\n\n  prepend(text: string) {\n    this._lines = text.trim().split('\\n').map(line => line.trim()).concat(this._lines);\n  }\n\n  add(text: string) {\n    this._lines.push(...text.trim().split('\\n').map(line => line.trim()));\n  }\n\n  newLine() {\n    this._lines.push('');\n  }\n\n  format(): string {\n    let spaces = '';\n    let previousLine = '';\n    return this._lines.map((line: string) => {\n      if (line === '')\n        return line;\n      if (line.startsWith('}') || line.startsWith(']'))\n        spaces = spaces.substring(this._baseIndent.length);\n\n      const extraSpaces = /^(for|while|if|try).*\\(.*\\)$/.test(previousLine) ? this._baseIndent : '';\n      previousLine = line;\n\n      const callCarryOver = line.startsWith('.set');\n      line = spaces + extraSpaces + (callCarryOver ? this._baseIndent : '') + line;\n      if (line.endsWith('{') || line.endsWith('['))\n        spaces += this._baseIndent;\n      return this._baseOffset + line;\n    }).join('\\n');\n  }\n}\n\nfunction quote(text: string, char: string = '\\'') {\n  if (char === '\\'')\n    return char + text.replace(/[']/g, '\\\\\\'') + char;\n  if (char === '\"')\n    return char + text.replace(/[\"]/g, '\\\\\"') + char;\n  if (char === '`')\n    return char + text.replace(/[`]/g, '\\\\`') + char;\n  throw new Error('Invalid escape char');\n}\n"],"file":"javascript.js"}