{"version":3,"sources":["../../../../src/server/supplements/recorder/language.ts"],"names":["sanitizeDeviceOptions","device","options","cleanedOptions","property","JSON","stringify","toSignalMap","action","waitForNavigation","assertNavigation","popup","download","dialog","signal","signals","name","isAsync"],"mappings":";;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA0BO,SAASA,qBAAT,CAA+BC,MAA/B,EAA4CC,OAA5C,EAAmG;AACxG;AACA,QAAMC,cAAmC,GAAG,EAA5C;;AACA,OAAK,MAAMC,QAAX,IAAuBF,OAAvB,EAAgC;AAC9B,QAAIG,IAAI,CAACC,SAAL,CAAeL,MAAM,CAACG,QAAD,CAArB,MAAqCC,IAAI,CAACC,SAAL,CAAgBJ,OAAD,CAAiBE,QAAjB,CAAf,CAAzC,EACED,cAAc,CAACC,QAAD,CAAd,GAA4BF,OAAD,CAAiBE,QAAjB,CAA3B;AACH;;AACD,SAAOD,cAAP;AACD;;AAEM,SAASI,WAAT,CAAqBC,MAArB,EAAqC;AAC1C,MAAIC,iBAAJ;AACA,MAAIC,gBAAJ;AACA,MAAIC,KAAJ;AACA,MAAIC,QAAJ;AACA,MAAIC,MAAJ;;AACA,OAAK,MAAMC,MAAX,IAAqBN,MAAM,CAACO,OAA5B,EAAqC;AACnC,QAAID,MAAM,CAACE,IAAP,KAAgB,YAAhB,IAAgCF,MAAM,CAACG,OAA3C,EACER,iBAAiB,GAAGK,MAApB,CADF,KAEK,IAAIA,MAAM,CAACE,IAAP,KAAgB,YAAhB,IAAgC,CAACF,MAAM,CAACG,OAA5C,EACHP,gBAAgB,GAAGI,MAAnB,CADG,KAEA,IAAIA,MAAM,CAACE,IAAP,KAAgB,OAApB,EACHL,KAAK,GAAGG,MAAR,CADG,KAEA,IAAIA,MAAM,CAACE,IAAP,KAAgB,UAApB,EACHJ,QAAQ,GAAGE,MAAX,CADG,KAEA,IAAIA,MAAM,CAACE,IAAP,KAAgB,QAApB,EACHH,MAAM,GAAGC,MAAT;AACH;;AACD,SAAO;AACLL,IAAAA,iBADK;AAELC,IAAAA,gBAFK;AAGLC,IAAAA,KAHK;AAILC,IAAAA,QAJK;AAKLC,IAAAA;AALK,GAAP;AAOD","sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { EventEmitter } from 'stream';\nimport type { BrowserContextOptions, LaunchOptions } from '../../../..';\nimport { ActionInContext } from './codeGenerator';\nimport { Action, DialogSignal, DownloadSignal, NavigationSignal, PopupSignal } from './recorderActions';\n\nexport type LanguageGeneratorOptions = {\n  browserName: string;\n  generateHeaders: boolean;\n  launchOptions: LaunchOptions;\n  contextOptions: BrowserContextOptions;\n  deviceName?: string;\n  saveStorage?: string;\n  actionListener?: EventEmitter;\n};\n\nexport interface LanguageGenerator {\n  id: string;\n  fileName: string;\n  highlighter: string;\n  generateHeader(options: LanguageGeneratorOptions): string;\n  generateAction(actionInContext: ActionInContext): string;\n  generateFooter(saveStorage: string | undefined): string;\n}\n\nexport function sanitizeDeviceOptions(device: any, options: BrowserContextOptions): BrowserContextOptions {\n  // Filter out all the properties from the device descriptor.\n  const cleanedOptions: Record<string, any> = {};\n  for (const property in options) {\n    if (JSON.stringify(device[property]) !== JSON.stringify((options as any)[property]))\n      cleanedOptions[property] = (options as any)[property];\n  }\n  return cleanedOptions;\n}\n\nexport function toSignalMap(action: Action) {\n  let waitForNavigation: NavigationSignal | undefined;\n  let assertNavigation: NavigationSignal | undefined;\n  let popup: PopupSignal | undefined;\n  let download: DownloadSignal | undefined;\n  let dialog: DialogSignal | undefined;\n  for (const signal of action.signals) {\n    if (signal.name === 'navigation' && signal.isAsync)\n      waitForNavigation = signal;\n    else if (signal.name === 'navigation' && !signal.isAsync)\n      assertNavigation = signal;\n    else if (signal.name === 'popup')\n      popup = signal;\n    else if (signal.name === 'download')\n      download = signal;\n    else if (signal.name === 'dialog')\n      dialog = signal;\n  }\n  return {\n    waitForNavigation,\n    assertNavigation,\n    popup,\n    download,\n    dialog,\n  };\n}\n"],"file":"language.js"}