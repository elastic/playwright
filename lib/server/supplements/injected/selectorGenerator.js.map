{"version":3,"sources":["../../../../src/server/supplements/injected/selectorGenerator.ts"],"names":["cacheAllowText","Map","cacheDisallowText","querySelector","injectedScript","selector","ownerDocument","parsedSelector","parseSelector","elements","querySelectorAll","e","generateSelector","targetElement","_evaluator","begin","closest","targetTokens","generateSelectorFor","bestTokens","cssFallback","joinTokens","clear","end","filterRegexTokens","textCandidates","filter","c","documentElement","engine","score","calculate","element","allowText","allowNthMatch","buildTextCandidates","map","token","noTextCandidates","buildCandidates","result","chooseFirstSelector","checkWithText","textCandidatesToUse","allowParentText","length","candidates","combineScores","bestPossibleInParent","parent","parentElementOrShadowHost","parentTokens","calculateCached","combined","cache","value","get","undefined","set","attribute","hasAttribute","push","quoteString","getAttribute","nodeName","input","placeholder","includes","toLowerCase","toLocaleLowerCase","idAttr","isGuidLike","makeSelectorForId","allowHasText","text","full","trim","replace","substring","escaped","escapeForRegex","prefix","parentElement","parentNode","nodeType","Node","DOCUMENT_FRAGMENT_NODE","host","id","test","kFallbackScore","root","tokens","uniqueCSSSelector","path","slice","unshift","join","node","bestTokenForLevel","classes","classList","i","sameClassSiblings","siblings","children","sameTagSiblings","sibling","indexOf","parts","lastEngine","startsWith","scope","selectors","joined","sort","a","b","bestWithIndex","index","allCss","endsWith","lastCharacterType","transitionCount","characterType"],"mappings":";;;;;;;;AAiBA;;AAjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAWA,MAAMA,cAAc,GAAG,IAAIC,GAAJ,EAAvB;AACA,MAAMC,iBAAiB,GAAG,IAAID,GAAJ,EAA1B;;AAEO,SAASE,aAAT,CAAuBC,cAAvB,EAAuDC,QAAvD,EAAyEC,aAAzE,EAA6I;AAClJ,MAAI;AACF,UAAMC,cAAc,GAAGH,cAAc,CAACI,aAAf,CAA6BH,QAA7B,CAAvB;AACA,WAAO;AACLA,MAAAA,QADK;AAELI,MAAAA,QAAQ,EAAEL,cAAc,CAACM,gBAAf,CAAgCH,cAAhC,EAAgDD,aAAhD;AAFL,KAAP;AAID,GAND,CAME,OAAOK,CAAP,EAAU;AACV,WAAO;AACLN,MAAAA,QADK;AAELI,MAAAA,QAAQ,EAAE;AAFL,KAAP;AAID;AACF;;AAEM,SAASG,gBAAT,CAA0BR,cAA1B,EAA0DS,aAA1D,EAA6H;AAClIT,EAAAA,cAAc,CAACU,UAAf,CAA0BC,KAA1B;;AACA,MAAI;AACFF,IAAAA,aAAa,GAAGA,aAAa,CAACG,OAAd,CAAsB,gEAAtB,KAA2FH,aAA3G;AACA,UAAMI,YAAY,GAAGC,mBAAmB,CAACd,cAAD,EAAiBS,aAAjB,CAAxC;AACA,UAAMM,UAAU,GAAGF,YAAY,IAAI,CAACG,WAAW,CAAChB,cAAD,EAAiBS,aAAjB,CAAZ,CAAnC;AACA,UAAMR,QAAQ,GAAGgB,UAAU,CAACF,UAAD,CAA3B;AACA,UAAMZ,cAAc,GAAGH,cAAc,CAACI,aAAf,CAA6BH,QAA7B,CAAvB;AACA,WAAO;AACLA,MAAAA,QADK;AAELI,MAAAA,QAAQ,EAAEL,cAAc,CAACM,gBAAf,CAAgCH,cAAhC,EAAgDM,aAAa,CAACP,aAA9D;AAFL,KAAP;AAID,GAVD,SAUU;AACRN,IAAAA,cAAc,CAACsB,KAAf;AACApB,IAAAA,iBAAiB,CAACoB,KAAlB;;AACAlB,IAAAA,cAAc,CAACU,UAAf,CAA0BS,GAA1B;AACD;AACF;;AAED,SAASC,iBAAT,CAA2BC,cAA3B,EAAiF;AAC/E;AACA,SAAOA,cAAc,CAACC,MAAf,CAAsBC,CAAC,IAAIA,CAAC,CAAC,CAAD,CAAD,CAAKtB,QAAL,CAAc,CAAd,MAAqB,GAAhD,CAAP;AACD;;AAED,SAASa,mBAAT,CAA6Bd,cAA7B,EAA6DS,aAA7D,EAA6G;AAC3G,MAAIA,aAAa,CAACP,aAAd,CAA4BsB,eAA5B,KAAgDf,aAApD,EACE,OAAO,CAAC;AAAEgB,IAAAA,MAAM,EAAE,KAAV;AAAiBxB,IAAAA,QAAQ,EAAE,MAA3B;AAAmCyB,IAAAA,KAAK,EAAE;AAA1C,GAAD,CAAP;;AAEF,QAAMC,SAAS,GAAG,CAACC,OAAD,EAAmBC,SAAnB,KAAkE;AAClF,UAAMC,aAAa,GAAGF,OAAO,KAAKnB,aAAlC;AAEA,QAAIY,cAAc,GAAGQ,SAAS,GAAGE,mBAAmB,CAAC/B,cAAD,EAAiB4B,OAAjB,EAA0BA,OAAO,KAAKnB,aAAtC,CAAnB,CAAwEuB,GAAxE,CAA4EC,KAAK,IAAI,CAACA,KAAD,CAArF,CAAH,GAAmG,EAAjI;;AACA,QAAIL,OAAO,KAAKnB,aAAhB,EAA+B;AAC7B;AACAY,MAAAA,cAAc,GAAGD,iBAAiB,CAACC,cAAD,CAAlC;AACD;;AACD,UAAMa,gBAAgB,GAAGC,eAAe,CAACnC,cAAD,EAAiB4B,OAAjB,CAAf,CAAyCI,GAAzC,CAA6CC,KAAK,IAAI,CAACA,KAAD,CAAtD,CAAzB,CARkF,CAUlF;;AACA,QAAIG,MAAM,GAAGC,mBAAmB,CAACrC,cAAD,EAAiBS,aAAa,CAACP,aAA/B,EAA8C0B,OAA9C,EAAuD,CAAC,GAAGP,cAAJ,EAAoB,GAAGa,gBAAvB,CAAvD,EAAiGJ,aAAjG,CAAhC,CAXkF,CAalF;;AACAT,IAAAA,cAAc,GAAGD,iBAAiB,CAACC,cAAD,CAAlC;;AAEA,UAAMiB,aAAa,GAAIC,mBAAD,IAA4C;AAChE;AACA,YAAMC,eAAe,GAAGX,SAAS,IAAI,CAACU,mBAAmB,CAACE,MAA1D;AAEA,YAAMC,UAAU,GAAG,CAAC,GAAGH,mBAAJ,EAAyB,GAAGL,gBAA5B,EAA8CZ,MAA9C,CAAqDC,CAAC,IAAI;AAC3E,YAAI,CAACa,MAAL,EACE,OAAO,IAAP;AACF,eAAOO,aAAa,CAACpB,CAAD,CAAb,GAAmBoB,aAAa,CAACP,MAAD,CAAvC;AACD,OAJkB,CAAnB,CAJgE,CAUhE;AACA;AACA;;AACA,UAAIQ,oBAA4C,GAAGF,UAAU,CAAC,CAAD,CAA7D;AACA,UAAI,CAACE,oBAAL,EACE;;AAEF,WAAK,IAAIC,MAAM,GAAGC,yBAAyB,CAAClB,OAAD,CAA3C,EAAsDiB,MAAtD,EAA8DA,MAAM,GAAGC,yBAAyB,CAACD,MAAD,CAAhG,EAA0G;AACxG,cAAME,YAAY,GAAGC,eAAe,CAACH,MAAD,EAASL,eAAT,CAApC;AACA,YAAI,CAACO,YAAL,EACE,SAHsG,CAIxG;;AACA,YAAIX,MAAM,IAAIO,aAAa,CAAC,CAAC,GAAGI,YAAJ,EAAkB,GAAGH,oBAArB,CAAD,CAAb,IAA6DD,aAAa,CAACP,MAAD,CAAxF,EACE,SANsG,CAOxG;;AACAQ,QAAAA,oBAAoB,GAAGP,mBAAmB,CAACrC,cAAD,EAAiB6C,MAAjB,EAAyBjB,OAAzB,EAAkCc,UAAlC,EAA8CZ,aAA9C,CAA1C;AACA,YAAI,CAACc,oBAAL,EACE;AACF,cAAMK,QAAQ,GAAG,CAAC,GAAGF,YAAJ,EAAkB,GAAGH,oBAArB,CAAjB;AACA,YAAI,CAACR,MAAD,IAAWO,aAAa,CAACM,QAAD,CAAb,GAA0BN,aAAa,CAACP,MAAD,CAAtD,EACEA,MAAM,GAAGa,QAAT;AACH;AACF,KAhCD;;AAkCAX,IAAAA,aAAa,CAACjB,cAAD,CAAb,CAlDkF,CAmDlF;;AACA,QAAIO,OAAO,KAAKnB,aAAZ,IAA6BY,cAAc,CAACoB,MAAhD,EACEH,aAAa,CAAC,EAAD,CAAb;AAEF,WAAOF,MAAP;AACD,GAxDD;;AA0DA,QAAMY,eAAe,GAAG,CAACpB,OAAD,EAAmBC,SAAnB,KAAkE;AACxF,UAAMqB,KAAK,GAAGrB,SAAS,GAAGjC,cAAH,GAAoBE,iBAA3C;AACA,QAAIqD,KAAK,GAAGD,KAAK,CAACE,GAAN,CAAUxB,OAAV,CAAZ;;AACA,QAAIuB,KAAK,KAAKE,SAAd,EAAyB;AACvBF,MAAAA,KAAK,GAAGxB,SAAS,CAACC,OAAD,EAAUC,SAAV,CAAjB;AACAqB,MAAAA,KAAK,CAACI,GAAN,CAAU1B,OAAV,EAAmBuB,KAAnB;AACD;;AACD,WAAOA,KAAP;AACD,GARD;;AAUA,SAAOH,eAAe,CAACvC,aAAD,EAAgB,IAAhB,CAAtB;AACD;;AAED,SAAS0B,eAAT,CAAyBnC,cAAzB,EAAyD4B,OAAzD,EAA4F;AAC1F,QAAMc,UAA2B,GAAG,EAApC;;AACA,OAAK,MAAMa,SAAX,IAAwB,CAAC,aAAD,EAAgB,cAAhB,EAAgC,WAAhC,CAAxB,EAAsE;AACpE,QAAI3B,OAAO,CAAC4B,YAAR,CAAqBD,SAArB,CAAJ,EACEb,UAAU,CAACe,IAAX,CAAgB;AAAEhC,MAAAA,MAAM,EAAE,KAAV;AAAiBxB,MAAAA,QAAQ,EAAG,IAAGsD,SAAU,IAAGG,WAAW,CAAC9B,OAAO,CAAC+B,YAAR,CAAqBJ,SAArB,CAAD,CAAmC,GAA1F;AAA8F7B,MAAAA,KAAK,EAAE;AAArG,KAAhB;AACH;;AAED,MAAIE,OAAO,CAACgC,QAAR,KAAqB,OAAzB,EAAkC;AAChC,UAAMC,KAAK,GAAGjC,OAAd;AACA,QAAIiC,KAAK,CAACC,WAAV,EACEpB,UAAU,CAACe,IAAX,CAAgB;AAAEhC,MAAAA,MAAM,EAAE,KAAV;AAAiBxB,MAAAA,QAAQ,EAAG,gBAAeyD,WAAW,CAACG,KAAK,CAACC,WAAP,CAAoB,GAA1E;AAA8EpC,MAAAA,KAAK,EAAE;AAArF,KAAhB;AACH;;AACD,MAAIE,OAAO,CAAC4B,YAAR,CAAqB,YAArB,CAAJ,EACEd,UAAU,CAACe,IAAX,CAAgB;AAAEhC,IAAAA,MAAM,EAAE,KAAV;AAAiBxB,IAAAA,QAAQ,EAAG,eAAcyD,WAAW,CAAC9B,OAAO,CAAC+B,YAAR,CAAqB,YAArB,CAAD,CAAsC,GAA3F;AAA+FjC,IAAAA,KAAK,EAAE;AAAtG,GAAhB;AACF,MAAIE,OAAO,CAAC+B,YAAR,CAAqB,KAArB,KAA+B,CAAC,QAAD,EAAW,MAAX,EAAmB,KAAnB,EAA0B,OAA1B,EAAmCI,QAAnC,CAA4CnC,OAAO,CAACgC,QAApD,CAAnC,EACElB,UAAU,CAACe,IAAX,CAAgB;AAAEhC,IAAAA,MAAM,EAAE,KAAV;AAAiBxB,IAAAA,QAAQ,EAAG,GAAE2B,OAAO,CAACgC,QAAR,CAAiBI,WAAjB,EAA+B,QAAON,WAAW,CAAC9B,OAAO,CAAC+B,YAAR,CAAqB,KAArB,CAAD,CAA+B,GAA9G;AAAkHjC,IAAAA,KAAK,EAAE;AAAzH,GAAhB;AAEF,MAAIE,OAAO,CAAC4B,YAAR,CAAqB,MAArB,CAAJ,EACEd,UAAU,CAACe,IAAX,CAAgB;AAAEhC,IAAAA,MAAM,EAAE,KAAV;AAAiBxB,IAAAA,QAAQ,EAAG,GAAE2B,OAAO,CAACgC,QAAR,CAAiBK,iBAAjB,EAAqC,SAAQP,WAAW,CAAC9B,OAAO,CAAC+B,YAAR,CAAqB,MAArB,CAAD,CAAgC,GAAtH;AAA2HjC,IAAAA,KAAK,EAAE;AAAlI,GAAhB;AAEF,MAAIE,OAAO,CAAC+B,YAAR,CAAqB,MAArB,KAAgC,CAAC,QAAD,EAAW,MAAX,EAAmB,UAAnB,EAA+B,QAA/B,EAAyC,OAAzC,EAAkD,QAAlD,EAA4D,QAA5D,EAAsE,QAAtE,EAAgF,QAAhF,EAA0F,UAA1F,EAAsG,KAAtG,EAA6G,MAA7G,EAAqH,OAArH,EAA8HI,QAA9H,CAAuInC,OAAO,CAACgC,QAA/I,CAApC,EACElB,UAAU,CAACe,IAAX,CAAgB;AAAEhC,IAAAA,MAAM,EAAE,KAAV;AAAiBxB,IAAAA,QAAQ,EAAG,GAAE2B,OAAO,CAACgC,QAAR,CAAiBI,WAAjB,EAA+B,SAAQN,WAAW,CAAC9B,OAAO,CAAC+B,YAAR,CAAqB,MAArB,CAAD,CAAgC,GAAhH;AAAoHjC,IAAAA,KAAK,EAAE;AAA3H,GAAhB;;AACF,MAAI,CAAC,OAAD,EAAU,UAAV,EAAsBqC,QAAtB,CAA+BnC,OAAO,CAACgC,QAAvC,KAAoDhC,OAAO,CAAC+B,YAAR,CAAqB,MAArB,MAAiC,QAAzF,EAAmG;AACjG,QAAI/B,OAAO,CAAC+B,YAAR,CAAqB,MAArB,CAAJ,EACEjB,UAAU,CAACe,IAAX,CAAgB;AAAEhC,MAAAA,MAAM,EAAE,KAAV;AAAiBxB,MAAAA,QAAQ,EAAG,GAAE2B,OAAO,CAACgC,QAAR,CAAiBI,WAAjB,EAA+B,SAAQN,WAAW,CAAC9B,OAAO,CAAC+B,YAAR,CAAqB,MAArB,CAAD,CAAgC,GAAhH;AAAoHjC,MAAAA,KAAK,EAAE;AAA3H,KAAhB;AACH;;AACD,MAAI,CAAC,OAAD,EAAU,UAAV,EAAsB,QAAtB,EAAgCqC,QAAhC,CAAyCnC,OAAO,CAACgC,QAAjD,CAAJ,EACElB,UAAU,CAACe,IAAX,CAAgB;AAAEhC,IAAAA,MAAM,EAAE,KAAV;AAAiBxB,IAAAA,QAAQ,EAAE2B,OAAO,CAACgC,QAAR,CAAiBI,WAAjB,EAA3B;AAA2DtC,IAAAA,KAAK,EAAE;AAAlE,GAAhB;AAEF,QAAMwC,MAAM,GAAGtC,OAAO,CAAC+B,YAAR,CAAqB,IAArB,CAAf;AACA,MAAIO,MAAM,IAAI,CAACC,UAAU,CAACD,MAAD,CAAzB,EACExB,UAAU,CAACe,IAAX,CAAgB;AAAEhC,IAAAA,MAAM,EAAE,KAAV;AAAiBxB,IAAAA,QAAQ,EAAEmE,iBAAiB,CAACF,MAAD,CAA5C;AAAsDxC,IAAAA,KAAK,EAAE;AAA7D,GAAhB;AAGFgB,EAAAA,UAAU,CAACe,IAAX,CAAgB;AAAEhC,IAAAA,MAAM,EAAE,KAAV;AAAiBxB,IAAAA,QAAQ,EAAE2B,OAAO,CAACgC,QAAR,CAAiBK,iBAAjB,EAA3B;AAAiEvC,IAAAA,KAAK,EAAE;AAAxE,GAAhB;AACA,SAAOgB,UAAP;AACD;;AAED,SAASX,mBAAT,CAA6B/B,cAA7B,EAA6D4B,OAA7D,EAA+EyC,YAA/E,EAAuH;AACrH,MAAIzC,OAAO,CAACgC,QAAR,KAAqB,QAAzB,EACE,OAAO,EAAP;AACF,QAAMU,IAAI,GAAG,oCAAYtE,cAAc,CAACU,UAA3B,EAAuCkB,OAAvC,EAAgD2C,IAAhD,CAAqDC,IAArD,GAA4DC,OAA5D,CAAoE,MAApE,EAA4E,GAA5E,EAAiFC,SAAjF,CAA2F,CAA3F,EAA8F,EAA9F,CAAb;AACA,MAAI,CAACJ,IAAL,EACE,OAAO,EAAP;AACF,QAAM5B,UAA2B,GAAG,EAApC;AAEA,MAAIiC,OAAO,GAAGL,IAAd;AACA,MAAIA,IAAI,CAACP,QAAL,CAAc,GAAd,KAAsBO,IAAI,CAACP,QAAL,CAAc,IAAd,CAAtB,IAA6CO,IAAI,CAAC,CAAD,CAAJ,KAAY,GAA7D,EACEK,OAAO,GAAI,MAAKC,cAAc,CAACN,IAAD,CAAO,KAArC;AAEF5B,EAAAA,UAAU,CAACe,IAAX,CAAgB;AAAEhC,IAAAA,MAAM,EAAE,MAAV;AAAkBxB,IAAAA,QAAQ,EAAE0E,OAA5B;AAAqCjD,IAAAA,KAAK,EAAE;AAA5C,GAAhB;;AACA,MAAI2C,YAAY,IAAIM,OAAO,KAAKL,IAAhC,EAAsC;AACpC,QAAIO,MAAM,GAAGjD,OAAO,CAACgC,QAAR,CAAiBK,iBAAjB,EAAb;AACA,QAAIrC,OAAO,CAAC4B,YAAR,CAAqB,MAArB,CAAJ,EACEqB,MAAM,IAAK,SAAQnB,WAAW,CAAC9B,OAAO,CAAC+B,YAAR,CAAqB,MAArB,CAAD,CAAgC,GAA9D;AACFjB,IAAAA,UAAU,CAACe,IAAX,CAAgB;AAAEhC,MAAAA,MAAM,EAAE,KAAV;AAAiBxB,MAAAA,QAAQ,EAAG,GAAE4E,MAAO,cAAaP,IAAK,IAAvD;AAA4D5C,MAAAA,KAAK,EAAE;AAAnE,KAAhB;AACD;;AACD,SAAOgB,UAAP;AACD;;AAED,SAASI,yBAAT,CAAmClB,OAAnC,EAAqE;AACnE,MAAIA,OAAO,CAACkD,aAAZ,EACE,OAAOlD,OAAO,CAACkD,aAAf;AACF,MAAI,CAAClD,OAAO,CAACmD,UAAb,EACE,OAAO,IAAP;AACF,MAAInD,OAAO,CAACmD,UAAR,CAAmBC,QAAnB,KAAgCC,IAAI,CAACC,sBAArC,IAAgEtD,OAAO,CAACmD,UAAT,CAAmCI,IAAtG,EACE,OAAQvD,OAAO,CAACmD,UAAT,CAAmCI,IAA1C;AACF,SAAO,IAAP;AACD;;AAED,SAASf,iBAAT,CAA2BgB,EAA3B,EAAuC;AACrC,SAAO,6BAA6BC,IAA7B,CAAkCD,EAAlC,IAAwC,MAAMA,EAA9C,GAAoD,QAAOA,EAAG,IAArE;AACD;;AAED,SAASpE,WAAT,CAAqBhB,cAArB,EAAqDS,aAArD,EAA4F;AAC1F,QAAM6E,cAAc,GAAG,QAAvB;AACA,QAAMC,IAAU,GAAG9E,aAAa,CAACP,aAAjC;AACA,QAAMsF,MAAgB,GAAG,EAAzB;;AAEA,WAASC,iBAAT,CAA2BZ,MAA3B,EAAgE;AAC9D,UAAMa,IAAI,GAAGF,MAAM,CAACG,KAAP,EAAb;AACA,QAAId,MAAJ,EACEa,IAAI,CAACE,OAAL,CAAaf,MAAb;AACF,UAAM5E,QAAQ,GAAGyF,IAAI,CAACG,IAAL,CAAU,GAAV,CAAjB;AACA,UAAM1F,cAAc,GAAGH,cAAc,CAACI,aAAf,CAA6BH,QAA7B,CAAvB;AACA,UAAM6F,IAAI,GAAG9F,cAAc,CAACD,aAAf,CAA6BI,cAA7B,EAA6CM,aAAa,CAACP,aAA3D,EAA0E,KAA1E,CAAb;AACA,WAAO4F,IAAI,KAAKrF,aAAT,GAAyBR,QAAzB,GAAoCoD,SAA3C;AACD;;AAED,OAAK,IAAIzB,OAAuB,GAAGnB,aAAnC,EAAkDmB,OAAO,IAAIA,OAAO,KAAK2D,IAAzE,EAA+E3D,OAAO,GAAGkB,yBAAyB,CAAClB,OAAD,CAAlH,EAA6H;AAC3H,UAAMgC,QAAQ,GAAGhC,OAAO,CAACgC,QAAR,CAAiBI,WAAjB,EAAjB,CAD2H,CAG3H;;AACA,QAAI+B,iBAAyB,GAAG,EAAhC;;AACA,QAAInE,OAAO,CAACwD,EAAZ,EAAgB;AACd,YAAMnD,KAAK,GAAGmC,iBAAiB,CAACxC,OAAO,CAACwD,EAAT,CAA/B;AACA,YAAMnF,QAAQ,GAAGwF,iBAAiB,CAACxD,KAAD,CAAlC;AACA,UAAIhC,QAAJ,EACE,OAAO;AAAEwB,QAAAA,MAAM,EAAE,KAAV;AAAiBxB,QAAAA,QAAjB;AAA2ByB,QAAAA,KAAK,EAAE4D;AAAlC,OAAP;AACFS,MAAAA,iBAAiB,GAAG9D,KAApB;AACD;;AAED,UAAMY,MAAM,GAAGjB,OAAO,CAACmD,UAAvB,CAb2H,CAe3H;;AACA,UAAMiB,OAAO,GAAG,CAAC,GAAGpE,OAAO,CAACqE,SAAZ,CAAhB;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,OAAO,CAACvD,MAA5B,EAAoC,EAAEyD,CAAtC,EAAyC;AACvC,YAAMjE,KAAK,GAAG,MAAM+D,OAAO,CAACL,KAAR,CAAc,CAAd,EAAiBO,CAAC,GAAG,CAArB,EAAwBL,IAAxB,CAA6B,GAA7B,CAApB;AACA,YAAM5F,QAAQ,GAAGwF,iBAAiB,CAACxD,KAAD,CAAlC;AACA,UAAIhC,QAAJ,EACE,OAAO;AAAEwB,QAAAA,MAAM,EAAE,KAAV;AAAiBxB,QAAAA,QAAjB;AAA2ByB,QAAAA,KAAK,EAAE4D;AAAlC,OAAP,CAJqC,CAKvC;;AACA,UAAI,CAACS,iBAAD,IAAsBlD,MAA1B,EAAkC;AAChC,cAAMsD,iBAAiB,GAAGtD,MAAM,CAACvC,gBAAP,CAAwB2B,KAAxB,CAA1B;AACA,YAAIkE,iBAAiB,CAAC1D,MAAlB,KAA6B,CAAjC,EACEsD,iBAAiB,GAAG9D,KAApB;AACH;AACF,KA5B0H,CA8B3H;;;AACA,QAAIY,MAAJ,EAAY;AACV,YAAMuD,QAAQ,GAAG,CAAC,GAAGvD,MAAM,CAACwD,QAAX,CAAjB;AACA,YAAMC,eAAe,GAAGF,QAAQ,CAAC9E,MAAT,CAAgBiF,OAAO,IAAKA,OAAD,CAAU3C,QAAV,CAAmBI,WAAnB,OAAqCJ,QAAhE,CAAxB;AACA,YAAM3B,KAAK,GAAGqE,eAAe,CAACE,OAAhB,CAAwB5E,OAAxB,MAAqC,CAArC,GAAyCgC,QAAzC,GAAqD,GAAEA,QAAS,cAAa,IAAIwC,QAAQ,CAACI,OAAT,CAAiB5E,OAAjB,CAA0B,GAAzH;AACA,YAAM3B,QAAQ,GAAGwF,iBAAiB,CAACxD,KAAD,CAAlC;AACA,UAAIhC,QAAJ,EACE,OAAO;AAAEwB,QAAAA,MAAM,EAAE,KAAV;AAAiBxB,QAAAA,QAAjB;AAA2ByB,QAAAA,KAAK,EAAE4D;AAAlC,OAAP;AACF,UAAI,CAACS,iBAAL,EACEA,iBAAiB,GAAG9D,KAApB;AACH,KATD,MASO,IAAI,CAAC8D,iBAAL,EAAwB;AAC7BA,MAAAA,iBAAiB,GAAGnC,QAApB;AACD;;AACD4B,IAAAA,MAAM,CAACI,OAAP,CAAeG,iBAAf;AACD;;AACD,SAAO;AAAEtE,IAAAA,MAAM,EAAE,KAAV;AAAiBxB,IAAAA,QAAQ,EAAEwF,iBAAiB,EAA5C;AAAiD/D,IAAAA,KAAK,EAAE4D;AAAxD,GAAP;AACD;;AAED,SAASV,cAAT,CAAwBN,IAAxB,EAA8C;AAC5C,SAAOA,IAAI,CAACG,OAAL,CAAa,sBAAb,EAAqC,MAArC,CAAP;AACD;;AAED,SAASf,WAAT,CAAqBY,IAArB,EAA2C;AACzC,SAAQ,IAAGA,IAAI,CAACG,OAAL,CAAa,IAAb,EAAmB,KAAnB,EAA0BA,OAA1B,CAAkC,KAAlC,EAAyC,KAAzC,CAAgD,GAA3D;AACD;;AAED,SAASxD,UAAT,CAAoBuE,MAApB,EAAqD;AACnD,QAAMiB,KAAK,GAAG,EAAd;AACA,MAAIC,UAAU,GAAG,EAAjB;;AACA,OAAK,MAAM;AAAEjF,IAAAA,MAAF;AAAUxB,IAAAA;AAAV,GAAX,IAAmCuF,MAAnC,EAA2C;AACzC,QAAIiB,KAAK,CAAChE,MAAN,KAAkBiE,UAAU,KAAK,KAAf,IAAwBjF,MAAM,KAAK,KAAnC,IAA4CxB,QAAQ,CAAC0G,UAAT,CAAoB,aAApB,CAA9D,CAAJ,EACEF,KAAK,CAAChD,IAAN,CAAW,IAAX;AACFiD,IAAAA,UAAU,GAAGjF,MAAb;AACA,QAAIA,MAAM,KAAK,KAAf,EACEgF,KAAK,CAAChD,IAAN,CAAWxD,QAAX,EADF,KAGEwG,KAAK,CAAChD,IAAN,CAAY,GAAEhC,MAAO,IAAGxB,QAAS,EAAjC;AACH;;AACD,SAAOwG,KAAK,CAACZ,IAAN,CAAW,GAAX,CAAP;AACD;;AAED,SAASlD,aAAT,CAAuB6C,MAAvB,EAAwD;AACtD,MAAI9D,KAAK,GAAG,CAAZ;;AACA,OAAK,IAAIwE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGV,MAAM,CAAC/C,MAA3B,EAAmCyD,CAAC,EAApC,EACExE,KAAK,IAAI8D,MAAM,CAACU,CAAD,CAAN,CAAUxE,KAAV,IAAmB8D,MAAM,CAAC/C,MAAP,GAAgByD,CAAnC,CAAT;;AACF,SAAOxE,KAAP;AACD;;AAED,SAASW,mBAAT,CAA6BrC,cAA7B,EAA6D4G,KAA7D,EAAwFnG,aAAxF,EAAgHoG,SAAhH,EAA8I/E,aAA9I,EAA8L;AAC5L,QAAMgF,MAAM,GAAGD,SAAS,CAAC7E,GAAV,CAAcwD,MAAM,KAAK;AAAEA,IAAAA,MAAF;AAAU9D,IAAAA,KAAK,EAAEiB,aAAa,CAAC6C,MAAD;AAA9B,GAAL,CAApB,CAAf;AACAsB,EAAAA,MAAM,CAACC,IAAP,CAAY,CAACC,CAAD,EAAIC,CAAJ,KAAUD,CAAC,CAACtF,KAAF,GAAUuF,CAAC,CAACvF,KAAlC;AAEA,MAAIwF,aAAqC,GAAG,IAA5C;;AACA,OAAK,MAAM;AAAE1B,IAAAA;AAAF,GAAX,IAAyBsB,MAAzB,EAAiC;AAC/B,UAAM3G,cAAc,GAAGH,cAAc,CAACI,aAAf,CAA6Ba,UAAU,CAACuE,MAAD,CAAvC,CAAvB;AACA,UAAMpD,MAAM,GAAGpC,cAAc,CAACM,gBAAf,CAAgCH,cAAhC,EAAgDyG,KAAhD,CAAf;AACA,UAAMO,KAAK,GAAG/E,MAAM,CAACoE,OAAP,CAAe/F,aAAf,CAAd;;AACA,QAAI0G,KAAK,KAAK,CAAd,EAAiB;AACf;AACA,aAAO3B,MAAP;AACD,KAP8B,CAS/B;;;AACA,QAAI,CAAC1D,aAAD,IAAkBoF,aAAlB,IAAmCC,KAAK,KAAK,CAAC,CAA9C,IAAmD/E,MAAM,CAACK,MAAP,GAAgB,CAAvE,EACE,SAX6B,CAa/B;;AACA,UAAM2E,MAAM,GAAG5B,MAAM,CAACxD,GAAP,CAAWC,KAAK,IAAI;AACjC,UAAIA,KAAK,CAACR,MAAN,KAAiB,MAArB,EACE,OAAOQ,KAAP;AACF,UAAIA,KAAK,CAAChC,QAAN,CAAe0G,UAAf,CAA0B,GAA1B,KAAkC1E,KAAK,CAAChC,QAAN,CAAeoH,QAAf,CAAwB,GAAxB,CAAtC,EACE,OAAO;AAAE5F,QAAAA,MAAM,EAAE,KAAV;AAAiBxB,QAAAA,QAAQ,EAAG,kBAAiBgC,KAAK,CAAChC,QAAN,CAAeyE,SAAf,CAAyB,CAAzB,EAA4BzC,KAAK,CAAChC,QAAN,CAAewC,MAAf,GAAwB,CAApD,CAAuD,IAApG;AAAyGf,QAAAA,KAAK,EAAEO,KAAK,CAACP;AAAtH,OAAP;AACF,aAAO;AAAED,QAAAA,MAAM,EAAE,KAAV;AAAiBxB,QAAAA,QAAQ,EAAG,UAASgC,KAAK,CAAChC,QAAS,IAApD;AAAyDyB,QAAAA,KAAK,EAAEO,KAAK,CAACP;AAAtE,OAAP;AACD,KANc,CAAf;AAOA,UAAMuB,QAAQ,GAAGhC,UAAU,CAACmG,MAAD,CAA3B;AACAF,IAAAA,aAAa,GAAG,CAAC;AAAEzF,MAAAA,MAAM,EAAE,KAAV;AAAiBxB,MAAAA,QAAQ,EAAG,cAAagD,QAAS,KAAIkE,KAAK,GAAG,CAAE,GAAhE;AAAoEzF,MAAAA,KAAK,EAAEiB,aAAa,CAACyE,MAAD,CAAb,GAAwB;AAAnG,KAAD,CAAhB;AACD;;AACD,SAAOF,aAAP;AACD;;AAED,SAAS/C,UAAT,CAAoBiB,EAApB,EAAyC;AACvC,MAAIkC,iBAAJ;AACA,MAAIC,eAAe,GAAG,CAAtB;;AACA,OAAK,IAAIrB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGd,EAAE,CAAC3C,MAAvB,EAA+B,EAAEyD,CAAjC,EAAoC;AAClC,UAAM3E,CAAC,GAAG6D,EAAE,CAACc,CAAD,CAAZ;AACA,QAAIsB,aAAJ;AACA,QAAIjG,CAAC,KAAK,GAAN,IAAaA,CAAC,KAAK,GAAvB,EACE;AACF,QAAIA,CAAC,IAAI,GAAL,IAAYA,CAAC,IAAI,GAArB,EACEiG,aAAa,GAAG,OAAhB,CADF,KAEK,IAAIjG,CAAC,IAAI,GAAL,IAAYA,CAAC,IAAI,GAArB,EACHiG,aAAa,GAAG,OAAhB,CADG,KAEA,IAAIjG,CAAC,IAAI,GAAL,IAAYA,CAAC,IAAI,GAArB,EACHiG,aAAa,GAAG,OAAhB,CADG,KAGHA,aAAa,GAAG,OAAhB;;AAEF,QAAIA,aAAa,KAAK,OAAlB,IAA6BF,iBAAiB,KAAK,OAAvD,EAAgE;AAC9DA,MAAAA,iBAAiB,GAAGE,aAApB;AACA;AACD;;AAED,QAAIF,iBAAiB,IAAIA,iBAAiB,KAAKE,aAA/C,EACE,EAAED,eAAF;AACFD,IAAAA,iBAAiB,GAAGE,aAApB;AACD;;AACD,SAAOD,eAAe,IAAInC,EAAE,CAAC3C,MAAH,GAAY,CAAtC;AACD","sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type InjectedScript from '../../injected/injectedScript';\nimport { elementText } from '../../injected/selectorEvaluator';\n\ntype SelectorToken = {\n  engine: string;\n  selector: string;\n  score: number;  // Lower is better.\n};\n\nconst cacheAllowText = new Map<Element, SelectorToken[] | null>();\nconst cacheDisallowText = new Map<Element, SelectorToken[] | null>();\n\nexport function querySelector(injectedScript: InjectedScript, selector: string, ownerDocument: Document): { selector: string, elements: Element[] } {\n  try {\n    const parsedSelector = injectedScript.parseSelector(selector);\n    return {\n      selector,\n      elements: injectedScript.querySelectorAll(parsedSelector, ownerDocument)\n    };\n  } catch (e) {\n    return {\n      selector,\n      elements: [],\n    };\n  }\n}\n\nexport function generateSelector(injectedScript: InjectedScript, targetElement: Element): { selector: string, elements: Element[] } {\n  injectedScript._evaluator.begin();\n  try {\n    targetElement = targetElement.closest('button,select,input,[role=button],[role=checkbox],[role=radio]') || targetElement;\n    const targetTokens = generateSelectorFor(injectedScript, targetElement);\n    const bestTokens = targetTokens || [cssFallback(injectedScript, targetElement)];\n    const selector = joinTokens(bestTokens);\n    const parsedSelector = injectedScript.parseSelector(selector);\n    return {\n      selector,\n      elements: injectedScript.querySelectorAll(parsedSelector, targetElement.ownerDocument)\n    };\n  } finally {\n    cacheAllowText.clear();\n    cacheDisallowText.clear();\n    injectedScript._evaluator.end();\n  }\n}\n\nfunction filterRegexTokens(textCandidates: SelectorToken[][]): SelectorToken[][] {\n  // Filter out regex-based selectors for better performance.\n  return textCandidates.filter(c => c[0].selector[0] !== '/');\n}\n\nfunction generateSelectorFor(injectedScript: InjectedScript, targetElement: Element): SelectorToken[] | null {\n  if (targetElement.ownerDocument.documentElement === targetElement)\n    return [{ engine: 'css', selector: 'html', score: 1 }];\n\n  const calculate = (element: Element, allowText: boolean): SelectorToken[] | null => {\n    const allowNthMatch = element === targetElement;\n\n    let textCandidates = allowText ? buildTextCandidates(injectedScript, element, element === targetElement).map(token => [token]) : [];\n    if (element !== targetElement) {\n      // Do not use regex for parent elements (for performance).\n      textCandidates = filterRegexTokens(textCandidates);\n    }\n    const noTextCandidates = buildCandidates(injectedScript, element).map(token => [token]);\n\n    // First check all text and non-text candidates for the element.\n    let result = chooseFirstSelector(injectedScript, targetElement.ownerDocument, element, [...textCandidates, ...noTextCandidates], allowNthMatch);\n\n    // Do not use regex for chained selectors (for performance).\n    textCandidates = filterRegexTokens(textCandidates);\n\n    const checkWithText = (textCandidatesToUse: SelectorToken[][]) => {\n      // Use the deepest possible text selector - works pretty good and saves on compute time.\n      const allowParentText = allowText && !textCandidatesToUse.length;\n\n      const candidates = [...textCandidatesToUse, ...noTextCandidates].filter(c => {\n        if (!result)\n          return true;\n        return combineScores(c) < combineScores(result);\n      });\n\n      // This is best theoretically possible candidate from the current parent.\n      // We use the fact that widening the scope to grand-parent makes any selector\n      // even less likely to match.\n      let bestPossibleInParent: SelectorToken[] | null = candidates[0];\n      if (!bestPossibleInParent)\n        return;\n\n      for (let parent = parentElementOrShadowHost(element); parent; parent = parentElementOrShadowHost(parent)) {\n        const parentTokens = calculateCached(parent, allowParentText);\n        if (!parentTokens)\n          continue;\n        // Even the best selector won't be too good - skip this parent.\n        if (result && combineScores([...parentTokens, ...bestPossibleInParent]) >= combineScores(result))\n          continue;\n        // Update the best candidate that finds \"element\" in the \"parent\".\n        bestPossibleInParent = chooseFirstSelector(injectedScript, parent, element, candidates, allowNthMatch);\n        if (!bestPossibleInParent)\n          return;\n        const combined = [...parentTokens, ...bestPossibleInParent];\n        if (!result || combineScores(combined) < combineScores(result))\n          result = combined;\n      }\n    };\n\n    checkWithText(textCandidates);\n    // Allow skipping text on the target element, and using text on one of the parents.\n    if (element === targetElement && textCandidates.length)\n      checkWithText([]);\n\n    return result;\n  };\n\n  const calculateCached = (element: Element, allowText: boolean): SelectorToken[] | null => {\n    const cache = allowText ? cacheAllowText : cacheDisallowText;\n    let value = cache.get(element);\n    if (value === undefined) {\n      value = calculate(element, allowText);\n      cache.set(element, value);\n    }\n    return value;\n  };\n\n  return calculateCached(targetElement, true);\n}\n\nfunction buildCandidates(injectedScript: InjectedScript, element: Element): SelectorToken[] {\n  const candidates: SelectorToken[] = [];\n  for (const attribute of ['data-testid', 'data-test-id', 'data-test']) {\n    if (element.hasAttribute(attribute))\n      candidates.push({ engine: 'css', selector: `[${attribute}=${quoteString(element.getAttribute(attribute)!)}]`, score: 1 });\n  }\n\n  if (element.nodeName === 'INPUT') {\n    const input = element as HTMLInputElement;\n    if (input.placeholder)\n      candidates.push({ engine: 'css', selector: `[placeholder=${quoteString(input.placeholder)}]`, score: 10 });\n  }\n  if (element.hasAttribute('aria-label'))\n    candidates.push({ engine: 'css', selector: `[aria-label=${quoteString(element.getAttribute('aria-label')!)}]`, score: 10 });\n  if (element.getAttribute('alt') && ['APPLET', 'AREA', 'IMG', 'INPUT'].includes(element.nodeName))\n    candidates.push({ engine: 'css', selector: `${element.nodeName.toLowerCase()}[alt=${quoteString(element.getAttribute('alt')!)}]`, score: 10 });\n\n  if (element.hasAttribute('role'))\n    candidates.push({ engine: 'css', selector: `${element.nodeName.toLocaleLowerCase()}[role=${quoteString(element.getAttribute('role')!)}]` , score: 50 });\n\n  if (element.getAttribute('name') && ['BUTTON', 'FORM', 'FIELDSET', 'IFRAME', 'INPUT', 'KEYGEN', 'OBJECT', 'OUTPUT', 'SELECT', 'TEXTAREA', 'MAP', 'META', 'PARAM'].includes(element.nodeName))\n    candidates.push({ engine: 'css', selector: `${element.nodeName.toLowerCase()}[name=${quoteString(element.getAttribute('name')!)}]`, score: 50 });\n  if (['INPUT', 'TEXTAREA'].includes(element.nodeName) && element.getAttribute('type') !== 'hidden') {\n    if (element.getAttribute('type'))\n      candidates.push({ engine: 'css', selector: `${element.nodeName.toLowerCase()}[type=${quoteString(element.getAttribute('type')!)}]`, score: 50 });\n  }\n  if (['INPUT', 'TEXTAREA', 'SELECT'].includes(element.nodeName))\n    candidates.push({ engine: 'css', selector: element.nodeName.toLowerCase(), score: 50 });\n\n  const idAttr = element.getAttribute('id');\n  if (idAttr && !isGuidLike(idAttr))\n    candidates.push({ engine: 'css', selector: makeSelectorForId(idAttr), score: 100 });\n\n\n  candidates.push({ engine: 'css', selector: element.nodeName.toLocaleLowerCase(), score: 200 });\n  return candidates;\n}\n\nfunction buildTextCandidates(injectedScript: InjectedScript, element: Element, allowHasText: boolean): SelectorToken[] {\n  if (element.nodeName === 'SELECT')\n    return [];\n  const text = elementText(injectedScript._evaluator, element).full.trim().replace(/\\s+/g, ' ').substring(0, 80);\n  if (!text)\n    return [];\n  const candidates: SelectorToken[] = [];\n\n  let escaped = text;\n  if (text.includes('\"') || text.includes('>>') || text[0] === '/')\n    escaped = `/.*${escapeForRegex(text)}.*/`;\n\n  candidates.push({ engine: 'text', selector: escaped, score: 10 });\n  if (allowHasText && escaped === text) {\n    let prefix = element.nodeName.toLocaleLowerCase();\n    if (element.hasAttribute('role'))\n      prefix += `[role=${quoteString(element.getAttribute('role')!)}]`;\n    candidates.push({ engine: 'css', selector: `${prefix}:has-text(\"${text}\")`, score: 30 });\n  }\n  return candidates;\n}\n\nfunction parentElementOrShadowHost(element: Element): Element | null {\n  if (element.parentElement)\n    return element.parentElement;\n  if (!element.parentNode)\n    return null;\n  if (element.parentNode.nodeType === Node.DOCUMENT_FRAGMENT_NODE && (element.parentNode as ShadowRoot).host)\n    return (element.parentNode as ShadowRoot).host;\n  return null;\n}\n\nfunction makeSelectorForId(id: string) {\n  return /^[a-zA-Z][a-zA-Z0-9\\-\\_]+$/.test(id) ? '#' + id : `[id=\"${id}\"]`;\n}\n\nfunction cssFallback(injectedScript: InjectedScript, targetElement: Element): SelectorToken {\n  const kFallbackScore = 10000000;\n  const root: Node = targetElement.ownerDocument;\n  const tokens: string[] = [];\n\n  function uniqueCSSSelector(prefix?: string): string | undefined {\n    const path = tokens.slice();\n    if (prefix)\n      path.unshift(prefix);\n    const selector = path.join(' ');\n    const parsedSelector = injectedScript.parseSelector(selector);\n    const node = injectedScript.querySelector(parsedSelector, targetElement.ownerDocument, false);\n    return node === targetElement ? selector : undefined;\n  }\n\n  for (let element: Element | null = targetElement; element && element !== root; element = parentElementOrShadowHost(element)) {\n    const nodeName = element.nodeName.toLowerCase();\n\n    // Element ID is the strongest signal, use it.\n    let bestTokenForLevel: string = '';\n    if (element.id) {\n      const token = makeSelectorForId(element.id);\n      const selector = uniqueCSSSelector(token);\n      if (selector)\n        return { engine: 'css', selector, score: kFallbackScore };\n      bestTokenForLevel = token;\n    }\n\n    const parent = element.parentNode as (Element | ShadowRoot);\n\n    // Combine class names until unique.\n    const classes = [...element.classList];\n    for (let i = 0; i < classes.length; ++i) {\n      const token = '.' + classes.slice(0, i + 1).join('.');\n      const selector = uniqueCSSSelector(token);\n      if (selector)\n        return { engine: 'css', selector, score: kFallbackScore };\n      // Even if not unique, does this subset of classes uniquely identify node as a child?\n      if (!bestTokenForLevel && parent) {\n        const sameClassSiblings = parent.querySelectorAll(token);\n        if (sameClassSiblings.length === 1)\n          bestTokenForLevel = token;\n      }\n    }\n\n    // Ordinal is the weakest signal.\n    if (parent) {\n      const siblings = [...parent.children];\n      const sameTagSiblings = siblings.filter(sibling => (sibling).nodeName.toLowerCase() === nodeName);\n      const token = sameTagSiblings.indexOf(element) === 0 ? nodeName : `${nodeName}:nth-child(${1 + siblings.indexOf(element)})`;\n      const selector = uniqueCSSSelector(token);\n      if (selector)\n        return { engine: 'css', selector, score: kFallbackScore };\n      if (!bestTokenForLevel)\n        bestTokenForLevel = token;\n    } else if (!bestTokenForLevel) {\n      bestTokenForLevel = nodeName;\n    }\n    tokens.unshift(bestTokenForLevel);\n  }\n  return { engine: 'css', selector: uniqueCSSSelector()!, score: kFallbackScore };\n}\n\nfunction escapeForRegex(text: string): string {\n  return text.replace(/[.*+?^>${}()|[\\]\\\\]/g, '\\\\$&');\n}\n\nfunction quoteString(text: string): string {\n  return `\"${text.replace(/\"/g, '\\\\\"').replace(/\\n/g, '\\\\n')}\"`;\n}\n\nfunction joinTokens(tokens: SelectorToken[]): string {\n  const parts = [];\n  let lastEngine = '';\n  for (const { engine, selector } of tokens) {\n    if (parts.length  && (lastEngine !== 'css' || engine !== 'css' || selector.startsWith(':nth-match(')))\n      parts.push('>>');\n    lastEngine = engine;\n    if (engine === 'css')\n      parts.push(selector);\n    else\n      parts.push(`${engine}=${selector}`);\n  }\n  return parts.join(' ');\n}\n\nfunction combineScores(tokens: SelectorToken[]): number {\n  let score = 0;\n  for (let i = 0; i < tokens.length; i++)\n    score += tokens[i].score * (tokens.length - i);\n  return score;\n}\n\nfunction chooseFirstSelector(injectedScript: InjectedScript, scope: Element | Document, targetElement: Element, selectors: SelectorToken[][], allowNthMatch: boolean): SelectorToken[] | null {\n  const joined = selectors.map(tokens => ({ tokens, score: combineScores(tokens) }));\n  joined.sort((a, b) => a.score - b.score);\n\n  let bestWithIndex: SelectorToken[] | null = null;\n  for (const { tokens } of joined) {\n    const parsedSelector = injectedScript.parseSelector(joinTokens(tokens));\n    const result = injectedScript.querySelectorAll(parsedSelector, scope);\n    const index = result.indexOf(targetElement);\n    if (index === 0) {\n      // We are the first match - found the best selector.\n      return tokens;\n    }\n\n    // Otherwise, perhaps we can get nth-match?\n    if (!allowNthMatch || bestWithIndex || index === -1 || result.length > 5)\n      continue;\n\n    // To use nth-match, we must convert everything to css.\n    const allCss = tokens.map(token => {\n      if (token.engine !== 'text')\n        return token;\n      if (token.selector.startsWith('/') && token.selector.endsWith('/'))\n        return { engine: 'css', selector: `:text-matches(\"${token.selector.substring(1, token.selector.length - 1)}\")`, score: token.score };\n      return { engine: 'css', selector: `:text(\"${token.selector}\")`, score: token.score };\n    });\n    const combined = joinTokens(allCss);\n    bestWithIndex = [{ engine: 'css', selector: `:nth-match(${combined}, ${index + 1})`, score: combineScores(allCss) + 1000 }];\n  }\n  return bestWithIndex;\n}\n\nfunction isGuidLike(id: string): boolean {\n  let lastCharacterType: 'lower' | 'upper' | 'digit' | 'other' | undefined;\n  let transitionCount = 0;\n  for (let i = 0; i < id.length; ++i) {\n    const c = id[i];\n    let characterType: 'lower' | 'upper' | 'digit' | 'other';\n    if (c === '-' || c === '_')\n      continue;\n    if (c >= 'a' && c <= 'z')\n      characterType = 'lower';\n    else if (c >= 'A' && c <= 'Z')\n      characterType = 'upper';\n    else if (c >= '0' && c <= '9')\n      characterType = 'digit';\n    else\n      characterType = 'other';\n\n    if (characterType === 'lower' && lastCharacterType === 'upper') {\n      lastCharacterType = characterType;\n      continue;\n    }\n\n    if (lastCharacterType && lastCharacterType !== characterType)\n      ++transitionCount;\n    lastCharacterType = characterType;\n  }\n  return transitionCount >= id.length / 4;\n}\n"],"file":"selectorGenerator.js"}