{"version":3,"sources":["../../../../src/server/supplements/injected/recorder.ts"],"names":["scriptSymbol","Symbol","Recorder","constructor","injectedScript","params","_injectedScript","_performingAction","_outerGlassPaneElement","_glassPaneShadow","_innerGlassPaneElement","_highlightElements","_tooltipElement","_listeners","_hoveredModel","_hoveredElement","_activeModel","_expectProgrammaticKeyUp","_pollRecorderModeTimer","_mode","_actionPointElement","_actionPoint","_actionSelector","_params","document","createElement","style","position","top","right","bottom","left","zIndex","pointerEvents","display","setAttribute","flex","appendChild","attachShadow","mode","isUnderTest","styleElement","textContent","_refreshListenersIfNeeded","setInterval","_reportedReadyForTest","console","error","globalThis","_playwrightRefreshOverlay","_pollRecorderMode","catch","e","log","documentElement","removeEventListeners","addEventListener","event","_onClick","_onInput","_onKeyDown","_onKeyUp","_onMouseDown","_onMouseUp","_onMouseMove","_onMouseLeave","_onFocus","hidden","_updateHighlight","pollPeriod","clearTimeout","state","_playwrightRecorderState","setTimeout","actionPoint","actionSelector","_clearHighlight","x","y","elements","length","undefined","_actionInProgress","consumeEvent","_consumedDueToNoModel","model","_consumedDueWrongTarget","_deepEventTarget","_playwrightRecorderSetSelector","selector","_shouldIgnoreMouseEvent","checkbox","asCheckbox","_performAction","name","checked","signals","button","buttonForEvent","modifiers","modifiersForEvent","clickCount","detail","target","nodeName","includes","type","_updateModelForHoveredElement","nodeType","Node","DOCUMENT_NODE","activeElement","_deepActiveElement","result","hoveredElement","boxes","map","getBoundingClientRect","tooltipWidth","offsetWidth","tooltipHeight","offsetHeight","totalWidth","totalHeight","primaryBox","anchorLeft","anchorTop","pool","box","highlightElement","shift","_createHighlightElement","color","backgroundColor","width","height","push","boxSizing","inputElement","elementType","toLowerCase","_playwrightRecorderRecordAction","files","file","text","value","selectElement","options","selectedOptions","option","_shouldGenerateKeyPressFor","key","code","navigator","platform","metaKey","ctrlKey","shiftKey","hasModifier","altKey","action","_playwrightRecorderPerformAction","JSON","stringify","hovered","active","composedPath","shadowRoot","which","preventDefault","stopPropagation","stopImmediatePropagation","node","eventName","listener","useCapture","remove","removeEventListener","listeners","splice"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type * as actions from '../recorder/recorderActions';\nimport type InjectedScript from '../../injected/injectedScript';\nimport { generateSelector, querySelector } from './selectorGenerator';\nimport type { Point } from '../../../common/types';\nimport type { UIState } from '../recorder/recorderTypes';\n\n\ndeclare module globalThis {\n  let _playwrightRecorderPerformAction: (action: actions.Action) => Promise<void>;\n  let _playwrightRecorderRecordAction: (action: actions.Action) => Promise<void>;\n  let _playwrightRecorderState: () => Promise<UIState>;\n  let _playwrightRecorderSetSelector: (selector: string) => Promise<void>;\n  let _playwrightRefreshOverlay: () => void;\n}\n\nconst scriptSymbol = Symbol('scriptSymbol');\n\nexport class Recorder {\n  private _injectedScript: InjectedScript;\n  private _performingAction = false;\n  private _outerGlassPaneElement: HTMLElement;\n  private _glassPaneShadow: ShadowRoot;\n  private _innerGlassPaneElement: HTMLElement;\n  private _highlightElements: HTMLElement[] = [];\n  private _tooltipElement: HTMLElement;\n  private _listeners: (() => void)[] = [];\n  private _hoveredModel: HighlightModel | null = null;\n  private _hoveredElement: HTMLElement | null = null;\n  private _activeModel: HighlightModel | null = null;\n  private _expectProgrammaticKeyUp = false;\n  private _pollRecorderModeTimer: NodeJS.Timeout | undefined;\n  private _mode: 'none' | 'inspecting' | 'recording' = 'none';\n  private _actionPointElement: HTMLElement;\n  private _actionPoint: Point | undefined;\n  private _actionSelector: string | undefined;\n  private _params: { isUnderTest: boolean; };\n\n  constructor(injectedScript: InjectedScript, params: { isUnderTest: boolean }) {\n    this._params = params;\n    this._injectedScript = injectedScript;\n    this._outerGlassPaneElement = document.createElement('x-pw-glass');\n    this._outerGlassPaneElement.style.position = 'fixed';\n    this._outerGlassPaneElement.style.top = '0';\n    this._outerGlassPaneElement.style.right = '0';\n    this._outerGlassPaneElement.style.bottom = '0';\n    this._outerGlassPaneElement.style.left = '0';\n    this._outerGlassPaneElement.style.zIndex = '2147483647';\n    this._outerGlassPaneElement.style.pointerEvents = 'none';\n    this._outerGlassPaneElement.style.display = 'flex';\n\n    this._tooltipElement = document.createElement('x-pw-tooltip');\n    this._actionPointElement = document.createElement('x-pw-action-point');\n    this._actionPointElement.setAttribute('hidden', 'true');\n\n    this._innerGlassPaneElement = document.createElement('x-pw-glass-inner');\n    this._innerGlassPaneElement.style.flex = 'auto';\n    this._innerGlassPaneElement.appendChild(this._tooltipElement);\n\n    // Use a closed shadow root to prevent selectors matching our internal previews.\n    this._glassPaneShadow = this._outerGlassPaneElement.attachShadow({ mode: this._params.isUnderTest ? 'open' : 'closed' });\n    this._glassPaneShadow.appendChild(this._innerGlassPaneElement);\n    this._glassPaneShadow.appendChild(this._actionPointElement);\n    const styleElement = document.createElement('style');\n    styleElement.textContent = `\n        x-pw-tooltip {\n          align-items: center;\n          backdrop-filter: blur(5px);\n          background-color: rgba(0, 0, 0, 0.7);\n          border-radius: 2px;\n          box-shadow: rgba(0, 0, 0, 0.1) 0px 3.6px 3.7px,\n                      rgba(0, 0, 0, 0.15) 0px 12.1px 12.3px,\n                      rgba(0, 0, 0, 0.1) 0px -2px 4px,\n                      rgba(0, 0, 0, 0.15) 0px -12.1px 24px,\n                      rgba(0, 0, 0, 0.25) 0px 54px 55px;\n          color: rgb(204, 204, 204);\n          display: none;\n          font-family: 'Dank Mono', 'Operator Mono', Inconsolata, 'Fira Mono',\n                       'SF Mono', Monaco, 'Droid Sans Mono', 'Source Code Pro', monospace;\n          font-size: 12.8px;\n          font-weight: normal;\n          left: 0;\n          line-height: 1.5;\n          max-width: 600px;\n          padding: 3.2px 5.12px 3.2px;\n          position: absolute;\n          top: 0;\n        }\n        x-pw-action-point {\n          position: absolute;\n          width: 20px;\n          height: 20px;\n          background: red;\n          border-radius: 10px;\n          pointer-events: none;\n          margin: -10px 0 0 -10px;\n          z-index: 2;\n        }\n        *[hidden] {\n          display: none !important;\n        }\n    `;\n    this._glassPaneShadow.appendChild(styleElement);\n\n    this._refreshListenersIfNeeded();\n    setInterval(() => {\n      this._refreshListenersIfNeeded();\n      if (params.isUnderTest && !(this as any)._reportedReadyForTest) {\n        (this as any)._reportedReadyForTest = true;\n        console.error('Recorder script ready for test');\n      }\n    }, 500);\n    globalThis._playwrightRefreshOverlay = () => {\n      this._pollRecorderMode().catch(e => console.log(e)); // eslint-disable-line no-console\n    };\n    globalThis._playwrightRefreshOverlay();\n  }\n\n  private _refreshListenersIfNeeded() {\n    if ((document.documentElement as any)[scriptSymbol])\n      return;\n    (document.documentElement as any)[scriptSymbol] = true;\n    removeEventListeners(this._listeners);\n    this._listeners = [\n      addEventListener(document, 'click', event => this._onClick(event as MouseEvent), true),\n      addEventListener(document, 'auxclick', event => this._onClick(event as MouseEvent), true),\n      addEventListener(document, 'input', event => this._onInput(event), true),\n      addEventListener(document, 'keydown', event => this._onKeyDown(event as KeyboardEvent), true),\n      addEventListener(document, 'keyup', event => this._onKeyUp(event as KeyboardEvent), true),\n      addEventListener(document, 'mousedown', event => this._onMouseDown(event as MouseEvent), true),\n      addEventListener(document, 'mouseup', event => this._onMouseUp(event as MouseEvent), true),\n      addEventListener(document, 'mousemove', event => this._onMouseMove(event as MouseEvent), true),\n      addEventListener(document, 'mouseleave', event => this._onMouseLeave(event as MouseEvent), true),\n      addEventListener(document, 'focus', () => this._onFocus(), true),\n      addEventListener(document, 'scroll', () => {\n        this._hoveredModel = null;\n        this._actionPointElement.hidden = true;\n        this._updateHighlight();\n      }, true),\n    ];\n    document.documentElement.appendChild(this._outerGlassPaneElement);\n  }\n\n  private async _pollRecorderMode() {\n    const pollPeriod = 1000;\n    if (this._pollRecorderModeTimer)\n      clearTimeout(this._pollRecorderModeTimer);\n    const state = await globalThis._playwrightRecorderState().catch(e => null);\n    if (!state) {\n      this._pollRecorderModeTimer = setTimeout(() => this._pollRecorderMode(), pollPeriod);\n      return;\n    }\n\n    const { mode, actionPoint, actionSelector } = state;\n    if (mode !== this._mode) {\n      this._mode = mode;\n      this._clearHighlight();\n    }\n    if (actionPoint && this._actionPoint && actionPoint.x === this._actionPoint.x && actionPoint.y === this._actionPoint.y) {\n      // All good.\n    } else if (!actionPoint && !this._actionPoint) {\n      // All good.\n    } else {\n      if (actionPoint) {\n        this._actionPointElement.style.top = actionPoint.y + 'px';\n        this._actionPointElement.style.left = actionPoint.x + 'px';\n        this._actionPointElement.hidden = false;\n      } else {\n        this._actionPointElement.hidden = true;\n      }\n      this._actionPoint = actionPoint;\n    }\n\n    // Race or scroll.\n    if (this._actionSelector && !this._hoveredModel?.elements.length)\n      this._actionSelector = undefined;\n\n    if (actionSelector !== this._actionSelector) {\n      this._hoveredModel = actionSelector ? querySelector(this._injectedScript, actionSelector, document) : null;\n      this._updateHighlight();\n      this._actionSelector = actionSelector;\n    }\n    this._pollRecorderModeTimer = setTimeout(() => this._pollRecorderMode(), pollPeriod);\n  }\n\n  private _clearHighlight() {\n    this._hoveredModel = null;\n    this._activeModel = null;\n    this._updateHighlight();\n  }\n\n  private _actionInProgress(event: Event): boolean {\n    // If Playwright is performing action for us, bail.\n    if (this._performingAction)\n      return true;\n    // Consume as the first thing.\n    consumeEvent(event);\n    return false;\n  }\n\n  private _consumedDueToNoModel(event: Event, model: HighlightModel | null): boolean {\n    if (model)\n      return false;\n    consumeEvent(event);\n    return true;\n  }\n\n  private _consumedDueWrongTarget(event: Event): boolean {\n    if (this._activeModel && this._activeModel.elements[0] === this._deepEventTarget(event))\n      return false;\n    consumeEvent(event);\n    return true;\n  }\n\n  private _onClick(event: MouseEvent) {\n    if (this._mode === 'inspecting')\n      globalThis._playwrightRecorderSetSelector(this._hoveredModel ? this._hoveredModel.selector : '');\n    if (this._shouldIgnoreMouseEvent(event))\n      return;\n    if (this._actionInProgress(event))\n      return;\n    if (this._consumedDueToNoModel(event, this._hoveredModel))\n      return;\n\n    const checkbox = asCheckbox(this._deepEventTarget(event));\n    if (checkbox) {\n      // Interestingly, inputElement.checked is reversed inside this event handler.\n      this._performAction({\n        name: checkbox.checked ? 'check' : 'uncheck',\n        selector: this._hoveredModel!.selector,\n        signals: [],\n      });\n      return;\n    }\n\n    this._performAction({\n      name: 'click',\n      selector: this._hoveredModel!.selector,\n      signals: [],\n      button: buttonForEvent(event),\n      modifiers: modifiersForEvent(event),\n      clickCount: event.detail\n    });\n  }\n\n  private _shouldIgnoreMouseEvent(event: MouseEvent): boolean {\n    const target = this._deepEventTarget(event);\n    if (this._mode === 'none')\n      return true;\n    if (this._mode === 'inspecting') {\n      consumeEvent(event);\n      return true;\n    }\n    const nodeName = target.nodeName;\n    if (nodeName === 'SELECT')\n      return true;\n    if (nodeName === 'INPUT' && ['date'].includes((target as HTMLInputElement).type))\n      return true;\n    return false;\n  }\n\n  private _onMouseDown(event: MouseEvent) {\n    if (this._shouldIgnoreMouseEvent(event))\n      return;\n    if (!this._performingAction)\n      consumeEvent(event);\n    this._activeModel = this._hoveredModel;\n  }\n\n  private _onMouseUp(event: MouseEvent) {\n    if (this._shouldIgnoreMouseEvent(event))\n      return;\n    if (!this._performingAction)\n      consumeEvent(event);\n  }\n\n  private _onMouseMove(event: MouseEvent) {\n    if (this._mode === 'none')\n      return;\n    const target = this._deepEventTarget(event);\n    if (this._hoveredElement === target)\n      return;\n    this._hoveredElement = target;\n    this._updateModelForHoveredElement();\n  }\n\n  private _onMouseLeave(event: MouseEvent) {\n    // Leaving iframe.\n    if (this._deepEventTarget(event).nodeType === Node.DOCUMENT_NODE) {\n      this._hoveredElement = null;\n      this._updateModelForHoveredElement();\n    }\n  }\n\n  private _onFocus() {\n    const activeElement = this._deepActiveElement(document);\n    const result = activeElement ? generateSelector(this._injectedScript, activeElement) : null;\n    this._activeModel = result && result.selector ? result : null;\n    if (this._params.isUnderTest)\n      console.error('Highlight updated for test: ' + (result ? result.selector : null));\n  }\n\n  private _updateModelForHoveredElement() {\n    if (!this._hoveredElement) {\n      this._hoveredModel = null;\n      this._updateHighlight();\n      return;\n    }\n    const hoveredElement = this._hoveredElement;\n    const { selector, elements } = generateSelector(this._injectedScript, hoveredElement);\n    if ((this._hoveredModel && this._hoveredModel.selector === selector) || this._hoveredElement !== hoveredElement)\n      return;\n    this._hoveredModel = selector ? { selector, elements } : null;\n    this._updateHighlight();\n    if (this._params.isUnderTest)\n      console.error('Highlight updated for test: ' + selector);\n  }\n\n  private _updateHighlight() {\n    const elements = this._hoveredModel ? this._hoveredModel.elements : [];\n\n    // Code below should trigger one layout and leave with the\n    // destroyed layout.\n\n    // Destroy the layout\n    this._tooltipElement.textContent = this._hoveredModel ? this._hoveredModel.selector : '';\n    this._tooltipElement.style.top = '0';\n    this._tooltipElement.style.left = '0';\n    this._tooltipElement.style.display = 'flex';\n\n    // Trigger layout.\n    const boxes = elements.map(e => e.getBoundingClientRect());\n    const tooltipWidth = this._tooltipElement.offsetWidth;\n    const tooltipHeight = this._tooltipElement.offsetHeight;\n    const totalWidth = this._innerGlassPaneElement.offsetWidth;\n    const totalHeight = this._innerGlassPaneElement.offsetHeight;\n\n    // Destroy the layout again.\n    if (boxes.length) {\n      const primaryBox = boxes[0];\n      let anchorLeft = primaryBox.left;\n      if (anchorLeft + tooltipWidth > totalWidth - 5)\n        anchorLeft = totalWidth - tooltipWidth - 5;\n      let anchorTop = primaryBox.bottom + 5;\n      if (anchorTop + tooltipHeight > totalHeight - 5) {\n        // If can't fit below, either position above...\n        if (primaryBox.top > tooltipHeight + 5) {\n          anchorTop = primaryBox.top - tooltipHeight - 5;\n        } else {\n          // Or on top in case of large element\n          anchorTop = totalHeight - 5 - tooltipHeight;\n        }\n      }\n      this._tooltipElement.style.top = anchorTop + 'px';\n      this._tooltipElement.style.left = anchorLeft + 'px';\n    } else {\n      this._tooltipElement.style.display = 'none';\n    }\n\n    const pool = this._highlightElements;\n    this._highlightElements = [];\n    for (const box of boxes) {\n      const highlightElement = pool.length ? pool.shift()! : this._createHighlightElement();\n      const color = this._mode === 'recording' ? '#dc6f6f7f' : '#6fa8dc7f';\n      highlightElement.style.backgroundColor = this._highlightElements.length ? '#f6b26b7f' : color;\n      highlightElement.style.left = box.x + 'px';\n      highlightElement.style.top = box.y + 'px';\n      highlightElement.style.width = box.width + 'px';\n      highlightElement.style.height = box.height + 'px';\n      highlightElement.style.display = 'block';\n      this._highlightElements.push(highlightElement);\n    }\n\n    for (const highlightElement of pool) {\n      highlightElement.style.display = 'none';\n      this._highlightElements.push(highlightElement);\n    }\n  }\n\n  private _createHighlightElement(): HTMLElement {\n    const highlightElement = document.createElement('x-pw-highlight');\n    highlightElement.style.position = 'absolute';\n    highlightElement.style.top = '0';\n    highlightElement.style.left = '0';\n    highlightElement.style.width = '0';\n    highlightElement.style.height = '0';\n    highlightElement.style.boxSizing = 'border-box';\n    this._glassPaneShadow.appendChild(highlightElement);\n    return highlightElement;\n  }\n\n  private _onInput(event: Event) {\n    if (this._mode !== 'recording')\n      return true;\n    const target = this._deepEventTarget(event);\n    if (['INPUT', 'TEXTAREA'].includes(target.nodeName)) {\n      const inputElement = target as HTMLInputElement;\n      const elementType = (inputElement.type || '').toLowerCase();\n      if (elementType === 'checkbox') {\n        // Checkbox is handled in click, we can't let input trigger on checkbox - that would mean we dispatched click events while recording.\n        return;\n      }\n\n      if (elementType === 'file') {\n        globalThis._playwrightRecorderRecordAction({\n          name: 'setInputFiles',\n          selector: this._activeModel!.selector,\n          signals: [],\n          files: [...(inputElement.files || [])].map(file => file.name),\n        });\n        return;\n      }\n\n      // Non-navigating actions are simply recorded by Playwright.\n      if (this._consumedDueWrongTarget(event))\n        return;\n      globalThis._playwrightRecorderRecordAction({\n        name: 'fill',\n        selector: this._activeModel!.selector,\n        signals: [],\n        text: inputElement.value,\n      });\n    }\n\n    if (target.nodeName === 'SELECT') {\n      const selectElement = target as HTMLSelectElement;\n      if (this._actionInProgress(event))\n        return;\n      this._performAction({\n        name: 'select',\n        selector: this._hoveredModel!.selector,\n        options: [...selectElement.selectedOptions].map(option => option.value),\n        signals: []\n      });\n    }\n  }\n\n  private _shouldGenerateKeyPressFor(event: KeyboardEvent): boolean {\n    // Backspace, Delete, AltGraph are changing input, will handle it there.\n    if (['Backspace', 'Delete', 'AltGraph'].includes(event.key))\n      return false;\n    // Ignore the QWERTZ shortcut for creating a at sign on MacOS\n    if (event.key === '@' && event.code === 'KeyL')\n      return false;\n    // Allow and ignore common used shortcut for pasting.\n    if (navigator.platform.includes('Mac')) {\n      if (event.key === 'v' && event.metaKey)\n        return false;\n    } else {\n      if (event.key === 'v' && event.ctrlKey)\n        return false;\n      if (event.key === 'Insert' && event.shiftKey)\n        return false;\n    }\n    if (['Shift', 'Control', 'Meta', 'Alt'].includes(event.key))\n      return false;\n    const hasModifier = event.ctrlKey || event.altKey || event.metaKey;\n    if (event.key.length === 1 && !hasModifier)\n      return !!asCheckbox(this._deepEventTarget(event));\n    return true;\n  }\n\n  private _onKeyDown(event: KeyboardEvent) {\n    if (this._mode === 'inspecting') {\n      consumeEvent(event);\n      return;\n    }\n    if (this._mode !== 'recording')\n      return true;\n    if (!this._shouldGenerateKeyPressFor(event))\n      return;\n    if (this._actionInProgress(event)) {\n      this._expectProgrammaticKeyUp = true;\n      return;\n    }\n    if (this._consumedDueWrongTarget(event))\n      return;\n    // Similarly to click, trigger checkbox on key event, not input.\n    if (event.key === ' ') {\n      const checkbox = asCheckbox(this._deepEventTarget(event));\n      if (checkbox) {\n        this._performAction({\n          name: checkbox.checked ? 'uncheck' : 'check',\n          selector: this._activeModel!.selector,\n          signals: [],\n        });\n        return;\n      }\n    }\n\n    this._performAction({\n      name: 'press',\n      selector: this._activeModel!.selector,\n      signals: [],\n      key: event.key,\n      modifiers: modifiersForEvent(event),\n    });\n  }\n\n  private _onKeyUp(event: KeyboardEvent) {\n    if (!this._shouldGenerateKeyPressFor(event))\n      return;\n\n    // Only allow programmatic keyups, ignore user input.\n    if (!this._expectProgrammaticKeyUp) {\n      consumeEvent(event);\n      return;\n    }\n    this._expectProgrammaticKeyUp = false;\n  }\n\n  private async _performAction(action: actions.Action) {\n    this._performingAction = true;\n    await globalThis._playwrightRecorderPerformAction(action).catch(() => {});\n    this._performingAction = false;\n\n    // Action could have changed DOM, update hovered model selectors.\n    this._updateModelForHoveredElement();\n    // If that was a keyboard action, it similarly requires new selectors for active model.\n    this._onFocus();\n\n    if (this._params.isUnderTest) {\n      // Serialize all to string as we cannot attribute console message to isolated world\n      // in Firefox.\n      console.error('Action performed for test: ' + JSON.stringify({\n        hovered: this._hoveredModel ? this._hoveredModel.selector : null,\n        active: this._activeModel ? this._activeModel.selector : null,\n      }));\n    }\n  }\n\n  private _deepEventTarget(event: Event): HTMLElement {\n    return event.composedPath()[0] as HTMLElement;\n  }\n\n  private _deepActiveElement(document: Document): Element | null {\n    let activeElement = document.activeElement;\n    while (activeElement && activeElement.shadowRoot && activeElement.shadowRoot.activeElement)\n      activeElement = activeElement.shadowRoot.activeElement;\n    return activeElement;\n  }\n}\n\nfunction modifiersForEvent(event: MouseEvent | KeyboardEvent): number {\n  return (event.altKey ? 1 : 0) | (event.ctrlKey ? 2 : 0) | (event.metaKey ? 4 : 0) | (event.shiftKey ? 8 : 0);\n}\n\nfunction buttonForEvent(event: MouseEvent): 'left' | 'middle' | 'right' {\n  switch (event.which) {\n    case 1: return 'left';\n    case 2: return 'middle';\n    case 3: return 'right';\n  }\n  return 'left';\n}\n\nfunction consumeEvent(e: Event) {\n  e.preventDefault();\n  e.stopPropagation();\n  e.stopImmediatePropagation();\n}\n\ntype HighlightModel = {\n  selector: string;\n  elements: Element[];\n};\n\nfunction asCheckbox(node: Node | null): HTMLInputElement | null {\n  if (!node || node.nodeName !== 'INPUT')\n    return null;\n  const inputElement = node as HTMLInputElement;\n  return inputElement.type === 'checkbox' ? inputElement : null;\n}\n\nfunction addEventListener(target: EventTarget, eventName: string, listener: EventListener, useCapture?: boolean): () => void {\n  target.addEventListener(eventName, listener, useCapture);\n  const remove = () => {\n    target.removeEventListener(eventName, listener, useCapture);\n  };\n  return remove;\n}\n\nfunction removeEventListeners(listeners: (() => void)[]) {\n  for (const listener of listeners)\n    listener();\n  listeners.splice(0, listeners.length);\n}\n\nexport default Recorder;\n"],"file":"recorder.js"}