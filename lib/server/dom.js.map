{"version":3,"sources":["../../src/server/dom.ts"],"names":["FrameExecutionContext","js","ExecutionContext","constructor","delegate","frame","world","_injectedScriptPromise","waitForSignalsCreatedBy","action","_page","_frameManager","adoptIfNeeded","handle","ElementHandle","_context","_delegate","adoptElementHandle","evaluate","pageFunction","arg","evaluateHandle","evaluateExpression","expression","isFunction","evaluateAndWaitForSignals","evaluateExpressionAndWaitForSignals","evaluateExpressionHandleAndWaitForSignals","createHandle","remoteObject","isElementHandle","objectId","injectedScript","custom","name","source","selectors","_engines","push","injectedScriptSource","rafCountForStablePosition","process","env","PWTEST_USE_TIMEOUT_FOR_RAF","join","rawEvaluateHandle","then","JSHandle","undefined","doSlowMo","_doSlowMo","context","_initializePreview","catch","e","utility","_setPreview","injected","previewNode","asElement","_evaluateInMainAndWaitForSignals","main","_mainContext","evaluateInUtility","_utilityContext","evaluateHandleInUtility","ownerFrame","frameId","getOwnerFrame","page","_browserContext","pages","contentFrame","isFrameElement","node","nodeName","getContentFrame","getAttribute","throwFatalDOMError","injeced","nodeType","Node","ELEMENT_NODE","element","value","inputValue","textContent","innerText","namespaceURI","innerHTML","dispatchEvent","type","eventInit","_scrollRectIntoViewIfNeeded","rect","scrollRectIntoViewIfNeeded","_waitAndScrollIntoViewIfNeeded","progress","isRunning","assertDone","throwRetargetableDOMError","_waitForDisplayedAtStablePosition","throwIfAborted","result","scrollIntoViewIfNeeded","metadata","options","controller","ProgressController","run","_timeoutSettings","timeout","_clickablePoint","intersectQuadWithViewport","quad","map","point","x","Math","min","max","metrics","width","y","height","computeQuadArea","area","i","length","p1","p2","abs","quads","Promise","all","getContentQuads","mainFrame","innerWidth","innerHeight","filtered","filter","compensateHalfIntegerRoundingError","_offsetPoint","offset","box","border","boundingBox","getElementBorderWidth","left","top","_retryPointerAction","actionName","waitForEnabled","retry","waitTime","scrollOptions","block","inline","log","trial","f","setTimeout","forceScrollOptions","_performPointerAction","force","Error","hitTargetDescription","position","__testHookBeforeStable","__testHookAfterStable","scrollIntoView","scrolled","maybePoint","roundPoint","__testHookBeforeHitTarget","hitTargetResult","_checkHitTargetAt","beforeInputAction","noWaitAfter","__testHookBeforePointerAction","restoreModifiers","modifiers","keyboard","_ensureModifiers","__testHookAfterPointerAction","hover","_hover","mouse","move","click","_click","dblclick","_dblclick","tap","_tap","touchscreen","selectOption","elements","values","_selectOption","optionsToSelect","poll","waitForElementStatesAndPerformAction","selectOptions","bind","pollHandler","InjectedScriptPollHandler","finish","fill","_fill","filled","insertText","press","selectText","setInputFiles","files","_setInputFiles","payload","mimeType","mime","getType","retargeted","multiple","retarget","tagName","_objectId","rawValue","focus","_focus","resetSelectionIfNotFocused","focusNode","text","_type","key","_press","check","_setChecked","uncheck","state","isChecked","checkElementState","getBoundingBox","screenshot","_screenshotter","screenshotElement","querySelector","selector","query","querySelectorAll","_queryAll","evalOnSelectorAndWaitForSignals","strict","dispose","evalOnSelectorAllAndWaitForSignals","arrayHandle","_queryArray","isVisible","isHidden","isEnabled","isDisabled","isEditable","waitForElementState","waitForSelector","includes","info","parseSelector","task","waitForSelectorTask","finishHandle","_adoptTo","adopted","parentFrame","frameElement","checkHitTargetAt","_progress","_poll","cleanupWhenAborted","cancel","_streamLogs","messages","takeNextLogs","message","_finishInternal","takeLastLogs","copy","p","remainderX","floor","remainderY","root","parsed","lastElement","pollRaf","continuePolling","document","visible","dispatchEventTask","textContentTask","innerTextTask","innerHTMLTask","getAttributeTask","inputValueTask","elementStateTask","kUnableToAdoptErrorMessage"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as channels from '../protocol/channels';\nimport * as frames from './frames';\nimport type { ElementStateWithoutStable, InjectedScript, InjectedScriptPoll } from './injected/injectedScript';\nimport * as injectedScriptSource from '../generated/injectedScriptSource';\nimport * as js from './javascript';\nimport * as mime from 'mime';\nimport { Page } from './page';\nimport { SelectorInfo } from './selectors';\nimport * as types from './types';\nimport { Progress, ProgressController } from './progress';\nimport { FatalDOMError, RetargetableDOMError } from './common/domErrors';\nimport { CallMetadata } from './instrumentation';\n\ntype SetInputFilesFiles = channels.ElementHandleSetInputFilesParams['files'];\n\nexport class FrameExecutionContext extends js.ExecutionContext {\n  readonly frame: frames.Frame;\n  private _injectedScriptPromise?: Promise<js.JSHandle>;\n  readonly world: types.World | null;\n\n  constructor(delegate: js.ExecutionContextDelegate, frame: frames.Frame, world: types.World|null) {\n    super(frame, delegate);\n    this.frame = frame;\n    this.world = world;\n  }\n\n  async waitForSignalsCreatedBy<T>(action: () => Promise<T>): Promise<T> {\n    return this.frame._page._frameManager.waitForSignalsCreatedBy(null, false, action);\n  }\n\n  adoptIfNeeded(handle: js.JSHandle): Promise<js.JSHandle> | null {\n    if (handle instanceof ElementHandle && handle._context !== this)\n      return this.frame._page._delegate.adoptElementHandle(handle, this);\n    return null;\n  }\n\n  async evaluate<Arg, R>(pageFunction: js.Func1<Arg, R>, arg?: Arg): Promise<R> {\n    return js.evaluate(this, true /* returnByValue */, pageFunction, arg);\n  }\n\n  async evaluateHandle<Arg, R>(pageFunction: js.Func1<Arg, R>, arg?: Arg): Promise<js.SmartHandle<R>> {\n    return js.evaluate(this, false /* returnByValue */, pageFunction, arg);\n  }\n\n  async evaluateExpression(expression: string, isFunction: boolean | undefined, arg?: any): Promise<any> {\n    return js.evaluateExpression(this, true /* returnByValue */, expression, isFunction, arg);\n  }\n\n  async evaluateAndWaitForSignals<Arg, R>(pageFunction: js.Func1<Arg, R>, arg?: Arg): Promise<R> {\n    return await this.frame._page._frameManager.waitForSignalsCreatedBy(null, false /* noWaitFor */, async () => {\n      return this.evaluate(pageFunction, arg);\n    });\n  }\n\n  async evaluateExpressionAndWaitForSignals(expression: string, isFunction: boolean | undefined, arg?: any): Promise<any> {\n    return await this.frame._page._frameManager.waitForSignalsCreatedBy(null, false /* noWaitFor */, async () => {\n      return this.evaluateExpression(expression, isFunction, arg);\n    });\n  }\n\n  async evaluateExpressionHandleAndWaitForSignals(expression: string, isFunction: boolean | undefined, arg: any): Promise<any> {\n    return await this.frame._page._frameManager.waitForSignalsCreatedBy(null, false /* noWaitFor */, async () => {\n      return js.evaluateExpression(this, false /* returnByValue */, expression, isFunction, arg);\n    });\n  }\n\n  createHandle(remoteObject: js.RemoteObject): js.JSHandle {\n    if (this.frame._page._delegate.isElementHandle(remoteObject))\n      return new ElementHandle(this, remoteObject.objectId!);\n    return super.createHandle(remoteObject);\n  }\n\n  injectedScript(): Promise<js.JSHandle<InjectedScript>> {\n    if (!this._injectedScriptPromise) {\n      const custom: string[] = [];\n      for (const [name, { source }] of this.frame._page.selectors._engines)\n        custom.push(`{ name: '${name}', engine: (${source}) }`);\n      const source = `\n        (() => {\n        ${injectedScriptSource.source}\n        return new pwExport(\n          ${this.frame._page._delegate.rafCountForStablePosition()},\n          ${!!process.env.PWTEST_USE_TIMEOUT_FOR_RAF},\n          [${custom.join(',\\n')}]\n        );\n        })();\n      `;\n      this._injectedScriptPromise = this._delegate.rawEvaluateHandle(source).then(objectId => new js.JSHandle(this, 'object', undefined, objectId));\n    }\n    return this._injectedScriptPromise;\n  }\n\n  async doSlowMo() {\n    return this.frame._page._doSlowMo();\n  }\n}\n\nexport class ElementHandle<T extends Node = Node> extends js.JSHandle<T> {\n  declare readonly _context: FrameExecutionContext;\n  readonly _page: Page;\n  declare readonly _objectId: string;\n\n  constructor(context: FrameExecutionContext, objectId: string) {\n    super(context, 'node', undefined, objectId);\n    this._page = context.frame._page;\n    this._initializePreview().catch(e => {});\n  }\n\n  async _initializePreview() {\n    const utility = await this._context.injectedScript();\n    this._setPreview(await utility.evaluate((injected, e) => 'JSHandle@' + injected.previewNode(e), this));\n  }\n\n  asElement(): ElementHandle<T> | null {\n    return this;\n  }\n\n  private async _evaluateInMainAndWaitForSignals<R, Arg>(pageFunction: js.Func1<[js.JSHandle<InjectedScript>, ElementHandle<T>, Arg], R>, arg: Arg): Promise<R> {\n    const main = await this._context.frame._mainContext();\n    return main.evaluateAndWaitForSignals(pageFunction, [await main.injectedScript(), this, arg]);\n  }\n\n  async evaluateInUtility<R, Arg>(pageFunction: js.Func1<[js.JSHandle<InjectedScript>, ElementHandle<T>, Arg], R>, arg: Arg): Promise<R> {\n    const utility = await this._context.frame._utilityContext();\n    return utility.evaluate(pageFunction, [await utility.injectedScript(), this, arg]);\n  }\n\n  async evaluateHandleInUtility<R, Arg>(pageFunction: js.Func1<[js.JSHandle<InjectedScript>, ElementHandle<T>, Arg], R>, arg: Arg): Promise<js.JSHandle<R>> {\n    const utility = await this._context.frame._utilityContext();\n    return utility.evaluateHandle(pageFunction, [await utility.injectedScript(), this, arg]);\n  }\n\n  async ownerFrame(): Promise<frames.Frame | null> {\n    const frameId = await this._page._delegate.getOwnerFrame(this);\n    if (!frameId)\n      return null;\n    const frame = this._page._frameManager.frame(frameId);\n    if (frame)\n      return frame;\n    for (const page of this._page._browserContext.pages()) {\n      const frame = page._frameManager.frame(frameId);\n      if (frame)\n        return frame;\n    }\n    return null;\n  }\n\n  async contentFrame(): Promise<frames.Frame | null> {\n    const isFrameElement = await this.evaluateInUtility(([injected, node]) => node && (node.nodeName === 'IFRAME' || node.nodeName === 'FRAME'), {});\n    if (!isFrameElement)\n      return null;\n    return this._page._delegate.getContentFrame(this);\n  }\n\n  async getAttribute(name: string): Promise<string | null> {\n    return throwFatalDOMError(await this.evaluateInUtility(([injeced, node, name]) => {\n      if (node.nodeType !== Node.ELEMENT_NODE)\n        return 'error:notelement';\n      const element = node as unknown as Element;\n      return { value: element.getAttribute(name) };\n    }, name)).value;\n  }\n\n  async inputValue(): Promise<string> {\n    return throwFatalDOMError(await this.evaluateInUtility(([injeced, node]) => {\n      if (node.nodeType !== Node.ELEMENT_NODE || (node.nodeName !== 'INPUT' && node.nodeName !== 'TEXTAREA' && node.nodeName !== 'SELECT'))\n        return 'error:hasnovalue';\n      const element = node as unknown as (HTMLInputElement | HTMLTextAreaElement);\n      return { value: element.value };\n    }, undefined)).value;\n  }\n\n  async textContent(): Promise<string | null> {\n    return this.evaluateInUtility(([injected, node]) => node.textContent, {});\n  }\n\n  async innerText(): Promise<string> {\n    return throwFatalDOMError(await this.evaluateInUtility(([injected, node]) => {\n      if (node.nodeType !== Node.ELEMENT_NODE)\n        return 'error:notelement';\n      if (node.namespaceURI !== 'http://www.w3.org/1999/xhtml')\n        return 'error:nothtmlelement';\n      const element = node as unknown as HTMLElement;\n      return { value: element.innerText };\n    }, {})).value;\n  }\n\n  async innerHTML(): Promise<string> {\n    return throwFatalDOMError(await this.evaluateInUtility(([injected, node]) => {\n      if (node.nodeType !== Node.ELEMENT_NODE)\n        return 'error:notelement';\n      const element = node as unknown as Element;\n      return { value: element.innerHTML };\n    }, {})).value;\n  }\n\n  async dispatchEvent(type: string, eventInit: Object = {}) {\n    await this._evaluateInMainAndWaitForSignals(([injected, node, { type, eventInit }]) =>\n      injected.dispatchEvent(node, type, eventInit), { type, eventInit });\n    await this._page._doSlowMo();\n  }\n\n  async _scrollRectIntoViewIfNeeded(rect?: types.Rect): Promise<'error:notvisible' | 'error:notconnected' | 'done'> {\n    return await this._page._delegate.scrollRectIntoViewIfNeeded(this, rect);\n  }\n\n  async _waitAndScrollIntoViewIfNeeded(progress: Progress): Promise<void> {\n    while (progress.isRunning()) {\n      assertDone(throwRetargetableDOMError(await this._waitForDisplayedAtStablePosition(progress, false /* force */, false /* waitForEnabled */)));\n\n      progress.throwIfAborted();  // Avoid action that has side-effects.\n      const result = throwRetargetableDOMError(await this._scrollRectIntoViewIfNeeded());\n      if (result === 'error:notvisible')\n        continue;\n      assertDone(result);\n      return;\n    }\n  }\n\n  async scrollIntoViewIfNeeded(metadata: CallMetadata, options: types.TimeoutOptions = {}) {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(\n        progress => this._waitAndScrollIntoViewIfNeeded(progress),\n        this._page._timeoutSettings.timeout(options));\n  }\n\n  private async _clickablePoint(): Promise<types.Point | 'error:notvisible' | 'error:notinviewport'> {\n    const intersectQuadWithViewport = (quad: types.Quad): types.Quad => {\n      return quad.map(point => ({\n        x: Math.min(Math.max(point.x, 0), metrics.width),\n        y: Math.min(Math.max(point.y, 0), metrics.height),\n      })) as types.Quad;\n    };\n\n    const computeQuadArea = (quad: types.Quad) => {\n      // Compute sum of all directed areas of adjacent triangles\n      // https://en.wikipedia.org/wiki/Polygon#Simple_polygons\n      let area = 0;\n      for (let i = 0; i < quad.length; ++i) {\n        const p1 = quad[i];\n        const p2 = quad[(i + 1) % quad.length];\n        area += (p1.x * p2.y - p2.x * p1.y) / 2;\n      }\n      return Math.abs(area);\n    };\n\n    const [quads, metrics] = await Promise.all([\n      this._page._delegate.getContentQuads(this),\n      this._page.mainFrame()._utilityContext().then(utility => utility.evaluate(() => ({width: innerWidth, height: innerHeight}))),\n    ] as const);\n    if (!quads || !quads.length)\n      return 'error:notvisible';\n\n    // Allow 1x1 elements. Compensate for rounding errors by comparing with 0.99 instead.\n    const filtered = quads.map(quad => intersectQuadWithViewport(quad)).filter(quad => computeQuadArea(quad) > 0.99);\n    if (!filtered.length)\n      return 'error:notinviewport';\n    // Return the middle point of the first quad.\n    const result = { x: 0, y: 0 };\n    for (const point of filtered[0]) {\n      result.x += point.x / 4;\n      result.y += point.y / 4;\n    }\n    compensateHalfIntegerRoundingError(result);\n    return result;\n  }\n\n  private async _offsetPoint(offset: types.Point): Promise<types.Point | 'error:notvisible'> {\n    const [box, border] = await Promise.all([\n      this.boundingBox(),\n      this.evaluateInUtility(([injected, node]) => injected.getElementBorderWidth(node), {}).catch(e => {}),\n    ]);\n    if (!box || !border)\n      return 'error:notvisible';\n    // Make point relative to the padding box to align with offsetX/offsetY.\n    return {\n      x: box.x + border.left + offset.x,\n      y: box.y + border.top + offset.y,\n    };\n  }\n\n  async _retryPointerAction(progress: Progress, actionName: string, waitForEnabled: boolean, action: (point: types.Point) => Promise<void>,\n    options: types.PointerActionOptions & types.PointerActionWaitOptions & types.NavigatingActionWaitOptions): Promise<'error:notconnected' | 'done'> {\n    let retry = 0;\n    // We progressively wait longer between retries, up to 500ms.\n    const waitTime = [0, 20, 100, 100, 500];\n\n    // By default, we scroll with protocol method to reveal the action point.\n    // However, that might not work to scroll from under position:sticky elements\n    // that overlay the target element. To fight this, we cycle through different\n    // scroll alignments. This works in most scenarios.\n    const scrollOptions: (ScrollIntoViewOptions | undefined)[] = [\n      undefined,\n      { block: 'end', inline: 'end' },\n      { block: 'center', inline: 'center' },\n      { block: 'start', inline: 'start' },\n    ];\n\n    while (progress.isRunning()) {\n      if (retry) {\n        progress.log(`retrying ${actionName} action${options.trial ? ' (trial run)' : ''}, attempt #${retry}`);\n        const timeout = waitTime[Math.min(retry - 1, waitTime.length - 1)];\n        if (timeout) {\n          progress.log(`  waiting ${timeout}ms`);\n          await this.evaluateInUtility(([injected, node, timeout]) => new Promise(f => setTimeout(f, timeout)), timeout);\n        }\n      } else {\n        progress.log(`attempting ${actionName} action${options.trial ? ' (trial run)' : ''}`);\n      }\n      const forceScrollOptions = scrollOptions[retry % scrollOptions.length];\n      const result = await this._performPointerAction(progress, actionName, waitForEnabled, action, forceScrollOptions, options);\n      ++retry;\n      if (result === 'error:notvisible') {\n        if (options.force)\n          throw new Error('Element is not visible');\n        progress.log('  element is not visible');\n        continue;\n      }\n      if (result === 'error:notinviewport') {\n        if (options.force)\n          throw new Error('Element is outside of the viewport');\n        progress.log('  element is outside of the viewport');\n        continue;\n      }\n      if (typeof result === 'object' && 'hitTargetDescription' in result) {\n        if (options.force)\n          throw new Error(`Element does not receive pointer events, ${result.hitTargetDescription} intercepts them`);\n        progress.log(`  ${result.hitTargetDescription} intercepts pointer events`);\n        continue;\n      }\n      return result;\n    }\n    return 'done';\n  }\n\n  async _performPointerAction(progress: Progress, actionName: string, waitForEnabled: boolean, action: (point: types.Point) => Promise<void>, forceScrollOptions: ScrollIntoViewOptions | undefined, options: types.PointerActionOptions & types.PointerActionWaitOptions & types.NavigatingActionWaitOptions): Promise<'error:notvisible' | 'error:notconnected' | 'error:notinviewport' | { hitTargetDescription: string } | 'done'> {\n    const { force = false, position } = options;\n    if ((options as any).__testHookBeforeStable)\n      await (options as any).__testHookBeforeStable();\n    const result = await this._waitForDisplayedAtStablePosition(progress, force, waitForEnabled);\n    if (result !== 'done')\n      return result;\n    if ((options as any).__testHookAfterStable)\n      await (options as any).__testHookAfterStable();\n\n    progress.log('  scrolling into view if needed');\n    progress.throwIfAborted();  // Avoid action that has side-effects.\n    if (forceScrollOptions) {\n      await this.evaluateInUtility(([injected, node, options]) => {\n        if (node.nodeType === 1 /* Node.ELEMENT_NODE */)\n          (node as Node as Element).scrollIntoView(options);\n      }, forceScrollOptions);\n    } else {\n      const scrolled = await this._scrollRectIntoViewIfNeeded(position ? { x: position.x, y: position.y, width: 0, height: 0 } : undefined);\n      if (scrolled !== 'done')\n        return scrolled;\n    }\n    progress.log('  done scrolling');\n\n    const maybePoint = position ? await this._offsetPoint(position) : await this._clickablePoint();\n    if (typeof maybePoint === 'string')\n      return maybePoint;\n    const point = roundPoint(maybePoint);\n\n    if (!force) {\n      if ((options as any).__testHookBeforeHitTarget)\n        await (options as any).__testHookBeforeHitTarget();\n      progress.log(`  checking that element receives pointer events at (${point.x},${point.y})`);\n      const hitTargetResult = await this._checkHitTargetAt(point);\n      if (hitTargetResult !== 'done')\n        return hitTargetResult;\n      progress.log(`  element does receive pointer events`);\n    }\n\n    progress.metadata.point = point;\n    if (options.trial)  {\n      progress.log(`  trial ${actionName} has finished`);\n      return 'done';\n    }\n\n    await progress.beforeInputAction(this);\n    await this._page._frameManager.waitForSignalsCreatedBy(progress, options.noWaitAfter, async () => {\n      if ((options as any).__testHookBeforePointerAction)\n        await (options as any).__testHookBeforePointerAction();\n      progress.throwIfAborted();  // Avoid action that has side-effects.\n      let restoreModifiers: types.KeyboardModifier[] | undefined;\n      if (options && options.modifiers)\n        restoreModifiers = await this._page.keyboard._ensureModifiers(options.modifiers);\n      progress.log(`  performing ${actionName} action`);\n      await action(point);\n      progress.log(`  ${actionName} action done`);\n      progress.log('  waiting for scheduled navigations to finish');\n      if ((options as any).__testHookAfterPointerAction)\n        await (options as any).__testHookAfterPointerAction();\n      if (restoreModifiers)\n        await this._page.keyboard._ensureModifiers(restoreModifiers);\n    }, 'input');\n    progress.log('  navigations have finished');\n\n    return 'done';\n  }\n\n  async hover(metadata: CallMetadata, options: types.PointerActionOptions & types.PointerActionWaitOptions): Promise<void> {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      const result = await this._hover(progress, options);\n      return assertDone(throwRetargetableDOMError(result));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  _hover(progress: Progress, options: types.PointerActionOptions & types.PointerActionWaitOptions): Promise<'error:notconnected' | 'done'> {\n    return this._retryPointerAction(progress, 'hover', false /* waitForEnabled */, point => this._page.mouse.move(point.x, point.y), options);\n  }\n\n  async click(metadata: CallMetadata, options: types.MouseClickOptions & types.PointerActionWaitOptions & types.NavigatingActionWaitOptions = {}): Promise<void> {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      const result = await this._click(progress, options);\n      return assertDone(throwRetargetableDOMError(result));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  _click(progress: Progress, options: types.MouseClickOptions & types.PointerActionWaitOptions & types.NavigatingActionWaitOptions): Promise<'error:notconnected' | 'done'> {\n    return this._retryPointerAction(progress, 'click', true /* waitForEnabled */, point => this._page.mouse.click(point.x, point.y, options), options);\n  }\n\n  async dblclick(metadata: CallMetadata, options: types.MouseMultiClickOptions & types.PointerActionWaitOptions & types.NavigatingActionWaitOptions): Promise<void> {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      const result = await this._dblclick(progress, options);\n      return assertDone(throwRetargetableDOMError(result));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  _dblclick(progress: Progress, options: types.MouseMultiClickOptions & types.PointerActionWaitOptions & types.NavigatingActionWaitOptions): Promise<'error:notconnected' | 'done'> {\n    return this._retryPointerAction(progress, 'dblclick', true /* waitForEnabled */, point => this._page.mouse.dblclick(point.x, point.y, options), options);\n  }\n\n  async tap(metadata: CallMetadata, options: types.PointerActionWaitOptions & types.NavigatingActionWaitOptions = {}): Promise<void> {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      const result = await this._tap(progress, options);\n      return assertDone(throwRetargetableDOMError(result));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  _tap(progress: Progress, options: types.PointerActionWaitOptions & types.NavigatingActionWaitOptions): Promise<'error:notconnected' | 'done'> {\n    return this._retryPointerAction(progress, 'tap', true /* waitForEnabled */, point => this._page.touchscreen.tap(point.x, point.y), options);\n  }\n\n  async selectOption(metadata: CallMetadata, elements: ElementHandle[], values: types.SelectOption[], options: types.NavigatingActionWaitOptions & types.ForceOptions): Promise<string[]> {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      const result = await this._selectOption(progress, elements, values, options);\n      return throwRetargetableDOMError(result);\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async _selectOption(progress: Progress, elements: ElementHandle[], values: types.SelectOption[], options: types.NavigatingActionWaitOptions & types.ForceOptions): Promise<string[] | 'error:notconnected'> {\n    const optionsToSelect = [...elements, ...values];\n    await progress.beforeInputAction(this);\n    return this._page._frameManager.waitForSignalsCreatedBy(progress, options.noWaitAfter, async () => {\n      progress.throwIfAborted();  // Avoid action that has side-effects.\n      progress.log('  selecting specified option(s)');\n      const poll = await this.evaluateHandleInUtility(([injected, node, { optionsToSelect, force }]) => {\n        return injected.waitForElementStatesAndPerformAction(node, ['visible', 'enabled'], force, injected.selectOptions.bind(injected, optionsToSelect));\n      }, { optionsToSelect, force: options.force });\n      const pollHandler = new InjectedScriptPollHandler(progress, poll);\n      const result = throwFatalDOMError(await pollHandler.finish());\n      await this._page._doSlowMo();\n      return result;\n    });\n  }\n\n  async fill(metadata: CallMetadata, value: string, options: types.NavigatingActionWaitOptions & types.ForceOptions = {}): Promise<void> {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      const result = await this._fill(progress, value, options);\n      assertDone(throwRetargetableDOMError(result));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async _fill(progress: Progress, value: string, options: types.NavigatingActionWaitOptions & types.ForceOptions): Promise<'error:notconnected' | 'done'> {\n    progress.log(`elementHandle.fill(\"${value}\")`);\n    await progress.beforeInputAction(this);\n    return this._page._frameManager.waitForSignalsCreatedBy(progress, options.noWaitAfter, async () => {\n      progress.log('  waiting for element to be visible, enabled and editable');\n      const poll = await this.evaluateHandleInUtility(([injected, node, { value, force }]) => {\n        return injected.waitForElementStatesAndPerformAction(node, ['visible', 'enabled', 'editable'], force, injected.fill.bind(injected, value));\n      }, { value, force: options.force });\n      const pollHandler = new InjectedScriptPollHandler(progress, poll);\n      const filled = throwFatalDOMError(await pollHandler.finish());\n      progress.throwIfAborted();  // Avoid action that has side-effects.\n      if (filled === 'error:notconnected')\n        return filled;\n      progress.log('  element is visible, enabled and editable');\n      if (filled === 'needsinput') {\n        progress.throwIfAborted();  // Avoid action that has side-effects.\n        if (value)\n          await this._page.keyboard.insertText(value);\n        else\n          await this._page.keyboard.press('Delete');\n      } else {\n        assertDone(filled);\n      }\n      return 'done';\n    }, 'input');\n  }\n\n  async selectText(metadata: CallMetadata, options: types.TimeoutOptions & types.ForceOptions = {}): Promise<void> {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      progress.throwIfAborted();  // Avoid action that has side-effects.\n      const poll = await this.evaluateHandleInUtility(([injected, node, force]) => {\n        return injected.waitForElementStatesAndPerformAction(node, ['visible'], force, injected.selectText.bind(injected));\n      }, options.force);\n      const pollHandler = new InjectedScriptPollHandler(progress, poll);\n      const result = throwFatalDOMError(await pollHandler.finish());\n      assertDone(throwRetargetableDOMError(result));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async setInputFiles(metadata: CallMetadata, files: SetInputFilesFiles, options: types.NavigatingActionWaitOptions) {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      const result = await this._setInputFiles(progress, files, options);\n      return assertDone(throwRetargetableDOMError(result));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async _setInputFiles(progress: Progress, files: SetInputFilesFiles, options: types.NavigatingActionWaitOptions): Promise<'error:notconnected' | 'done'> {\n    for (const payload of files) {\n      if (!payload.mimeType)\n        payload.mimeType = mime.getType(payload.name) || 'application/octet-stream';\n    }\n    const retargeted = await this.evaluateHandleInUtility(([injected, node, multiple]): FatalDOMError | 'error:notconnected' | Element => {\n      const element = injected.retarget(node, 'follow-label');\n      if (!element)\n        return 'error:notconnected';\n      if (element.tagName !== 'INPUT')\n        return 'error:notinput';\n      if (multiple && !(element as HTMLInputElement).multiple)\n        return 'error:notmultiplefileinput';\n      return element;\n    }, files.length > 1);\n    if (!retargeted._objectId)\n      return throwFatalDOMError(retargeted.rawValue() as FatalDOMError | 'error:notconnected');\n    await progress.beforeInputAction(this);\n    await this._page._frameManager.waitForSignalsCreatedBy(progress, options.noWaitAfter, async () => {\n      progress.throwIfAborted();  // Avoid action that has side-effects.\n      await this._page._delegate.setInputFiles(retargeted as ElementHandle<HTMLInputElement>, files as types.FilePayload[]);\n    });\n    await this._page._doSlowMo();\n    return 'done';\n  }\n\n  async focus(metadata: CallMetadata): Promise<void> {\n    const controller = new ProgressController(metadata, this);\n    await controller.run(async progress => {\n      const result = await this._focus(progress);\n      await this._page._doSlowMo();\n      return assertDone(throwRetargetableDOMError(result));\n    }, 0);\n  }\n\n  async _focus(progress: Progress, resetSelectionIfNotFocused?: boolean): Promise<'error:notconnected' | 'done'> {\n    progress.throwIfAborted();  // Avoid action that has side-effects.\n    const result = await this.evaluateInUtility(([injected, node, resetSelectionIfNotFocused]) => injected.focusNode(node, resetSelectionIfNotFocused), resetSelectionIfNotFocused);\n    return throwFatalDOMError(result);\n  }\n\n  async type(metadata: CallMetadata, text: string, options: { delay?: number } & types.NavigatingActionWaitOptions): Promise<void> {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      const result = await this._type(progress, text, options);\n      return assertDone(throwRetargetableDOMError(result));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async _type(progress: Progress, text: string, options: { delay?: number } & types.NavigatingActionWaitOptions): Promise<'error:notconnected' | 'done'> {\n    progress.log(`elementHandle.type(\"${text}\")`);\n    await progress.beforeInputAction(this);\n    return this._page._frameManager.waitForSignalsCreatedBy(progress, options.noWaitAfter, async () => {\n      const result = await this._focus(progress, true /* resetSelectionIfNotFocused */);\n      if (result !== 'done')\n        return result;\n      progress.throwIfAborted();  // Avoid action that has side-effects.\n      await this._page.keyboard.type(text, options);\n      return 'done';\n    }, 'input');\n  }\n\n  async press(metadata: CallMetadata, key: string, options: { delay?: number } & types.NavigatingActionWaitOptions): Promise<void> {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      const result = await this._press(progress, key, options);\n      return assertDone(throwRetargetableDOMError(result));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async _press(progress: Progress, key: string, options: { delay?: number } & types.NavigatingActionWaitOptions): Promise<'error:notconnected' | 'done'> {\n    progress.log(`elementHandle.press(\"${key}\")`);\n    await progress.beforeInputAction(this);\n    return this._page._frameManager.waitForSignalsCreatedBy(progress, options.noWaitAfter, async () => {\n      const result = await this._focus(progress, true /* resetSelectionIfNotFocused */);\n      if (result !== 'done')\n        return result;\n      progress.throwIfAborted();  // Avoid action that has side-effects.\n      await this._page.keyboard.press(key, options);\n      return 'done';\n    }, 'input');\n  }\n\n  async check(metadata: CallMetadata, options: { position?: types.Point } & types.PointerActionWaitOptions & types.NavigatingActionWaitOptions) {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      const result = await this._setChecked(progress, true, options);\n      return assertDone(throwRetargetableDOMError(result));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async uncheck(metadata: CallMetadata, options: { position?: types.Point } & types.PointerActionWaitOptions & types.NavigatingActionWaitOptions) {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      const result = await this._setChecked(progress, false, options);\n      return assertDone(throwRetargetableDOMError(result));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async _setChecked(progress: Progress, state: boolean, options: { position?: types.Point } & types.PointerActionWaitOptions & types.NavigatingActionWaitOptions): Promise<'error:notconnected' | 'done'> {\n    const isChecked = async () => {\n      const result = await this.evaluateInUtility(([injected, node]) => injected.checkElementState(node, 'checked'), {});\n      return throwRetargetableDOMError(throwFatalDOMError(result));\n    };\n    if (await isChecked() === state)\n      return 'done';\n    const result = await this._click(progress, options);\n    if (result !== 'done')\n      return result;\n    if (options.trial)\n      return 'done';\n    if (await isChecked() !== state)\n      throw new Error('Clicking the checkbox did not change its state');\n    return 'done';\n  }\n\n  async boundingBox(): Promise<types.Rect | null> {\n    return this._page._delegate.getBoundingBox(this);\n  }\n\n  async screenshot(metadata: CallMetadata, options: types.ElementScreenshotOptions = {}): Promise<Buffer> {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(\n        progress => this._page._screenshotter.screenshotElement(progress, this, options),\n        this._page._timeoutSettings.timeout(options));\n  }\n\n  async querySelector(selector: string, options: types.StrictOptions): Promise<ElementHandle | null> {\n    return this._page.selectors.query(this._context.frame, selector, options, this);\n  }\n\n  async querySelectorAll(selector: string): Promise<ElementHandle<Element>[]> {\n    return this._page.selectors._queryAll(this._context.frame, selector, this, true /* adoptToMain */);\n  }\n\n  async evalOnSelectorAndWaitForSignals(selector: string, strict: boolean, expression: string, isFunction: boolean | undefined, arg: any): Promise<any> {\n    const handle = await this._page.selectors.query(this._context.frame, selector, { strict }, this);\n    if (!handle)\n      throw new Error(`Error: failed to find element matching selector \"${selector}\"`);\n    const result = await handle.evaluateExpressionAndWaitForSignals(expression, isFunction, true, arg);\n    handle.dispose();\n    return result;\n  }\n\n  async evalOnSelectorAllAndWaitForSignals(selector: string, expression: string, isFunction: boolean | undefined, arg: any): Promise<any> {\n    const arrayHandle = await this._page.selectors._queryArray(this._context.frame, selector, this);\n    const result = await arrayHandle.evaluateExpressionAndWaitForSignals(expression, isFunction, true, arg);\n    arrayHandle.dispose();\n    return result;\n  }\n\n  async isVisible(): Promise<boolean> {\n    const result = await this.evaluateInUtility(([injected, node]) => injected.checkElementState(node, 'visible'), {});\n    if (result === 'error:notconnected')\n      return false;\n    return throwFatalDOMError(result);\n  }\n\n  async isHidden(): Promise<boolean> {\n    const result = await this.evaluateInUtility(([injected, node]) => injected.checkElementState(node, 'hidden'), {});\n    return throwRetargetableDOMError(throwFatalDOMError(result));\n  }\n\n  async isEnabled(): Promise<boolean> {\n    const result = await this.evaluateInUtility(([injected, node]) => injected.checkElementState(node, 'enabled'), {});\n    return throwRetargetableDOMError(throwFatalDOMError(result));\n  }\n\n  async isDisabled(): Promise<boolean> {\n    const result = await this.evaluateInUtility(([injected, node]) => injected.checkElementState(node, 'disabled'), {});\n    return throwRetargetableDOMError(throwFatalDOMError(result));\n  }\n\n  async isEditable(): Promise<boolean> {\n    const result = await this.evaluateInUtility(([injected, node]) => injected.checkElementState(node, 'editable'), {});\n    return throwRetargetableDOMError(throwFatalDOMError(result));\n  }\n\n  async isChecked(): Promise<boolean> {\n    const result = await this.evaluateInUtility(([injected, node]) => injected.checkElementState(node, 'checked'), {});\n    return throwRetargetableDOMError(throwFatalDOMError(result));\n  }\n\n  async waitForElementState(metadata: CallMetadata, state: 'visible' | 'hidden' | 'stable' | 'enabled' | 'disabled' | 'editable', options: types.TimeoutOptions = {}): Promise<void> {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      progress.log(`  waiting for element to be ${state}`);\n      const poll = await this.evaluateHandleInUtility(([injected, node, state]) => {\n        return injected.waitForElementStatesAndPerformAction(node, [state], false, () => 'done' as const);\n      }, state);\n      const pollHandler = new InjectedScriptPollHandler(progress, poll);\n      assertDone(throwRetargetableDOMError(throwFatalDOMError(await pollHandler.finish())));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async waitForSelector(metadata: CallMetadata, selector: string, options: types.WaitForElementOptions = {}): Promise<ElementHandle<Element> | null> {\n    const { state = 'visible' } = options;\n    if (!['attached', 'detached', 'visible', 'hidden'].includes(state))\n      throw new Error(`state: expected one of (attached|detached|visible|hidden)`);\n    const info = this._page.parseSelector(selector, options);\n    const task = waitForSelectorTask(info, state, this);\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      progress.log(`waiting for selector \"${selector}\"${state === 'attached' ? '' : ' to be ' + state}`);\n      const context = await this._context.frame._context(info.world);\n      const injected = await context.injectedScript();\n      const pollHandler = new InjectedScriptPollHandler(progress, await task(injected));\n      const result = await pollHandler.finishHandle();\n      if (!result.asElement()) {\n        result.dispose();\n        return null;\n      }\n      const handle = result.asElement() as ElementHandle<Element>;\n      return handle._adoptTo(await this._context.frame._mainContext());\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async _adoptTo(context: FrameExecutionContext): Promise<ElementHandle<T>> {\n    if (this._context !== context) {\n      const adopted = await this._page._delegate.adoptElementHandle(this, context);\n      this.dispose();\n      return adopted;\n    }\n    return this;\n  }\n\n  async _waitForDisplayedAtStablePosition(progress: Progress, force: boolean, waitForEnabled: boolean): Promise<'error:notconnected' | 'done'> {\n    if (waitForEnabled)\n      progress.log(`  waiting for element to be visible, enabled and stable`);\n    else\n      progress.log(`  waiting for element to be visible and stable`);\n    const poll = this.evaluateHandleInUtility(([injected, node, { waitForEnabled, force }]) => {\n      return injected.waitForElementStatesAndPerformAction(node,\n          waitForEnabled ? ['visible', 'stable', 'enabled'] : ['visible', 'stable'], force, () => 'done' as const);\n    }, { waitForEnabled, force });\n    const pollHandler = new InjectedScriptPollHandler(progress, await poll);\n    const result = await pollHandler.finish();\n    if (waitForEnabled)\n      progress.log('  element is visible, enabled and stable');\n    else\n      progress.log('  element is visible and stable');\n    return throwFatalDOMError(result);\n  }\n\n  async _checkHitTargetAt(point: types.Point): Promise<'error:notconnected' | { hitTargetDescription: string } | 'done'> {\n    const frame = await this.ownerFrame();\n    if (frame && frame.parentFrame()) {\n      const element = await frame.frameElement();\n      const box = await element.boundingBox();\n      if (!box)\n        return 'error:notconnected';\n      // Translate from viewport coordinates to frame coordinates.\n      point = { x: point.x - box.x, y: point.y - box.y };\n    }\n    return this.evaluateInUtility(([injected, node, point]) => injected.checkHitTargetAt(node, point), point);\n  }\n}\n\n// Handles an InjectedScriptPoll running in injected script:\n// - streams logs into progress;\n// - cancels the poll when progress cancels.\nexport class InjectedScriptPollHandler<T> {\n  private _progress: Progress;\n  private _poll: js.JSHandle<InjectedScriptPoll<T>> | null;\n\n  constructor(progress: Progress, poll: js.JSHandle<InjectedScriptPoll<T>>) {\n    this._progress = progress;\n    this._poll = poll;\n    // Ensure we cancel the poll before progress aborts and returns:\n    //   - no unnecessary work in the page;\n    //   - no possible side effects after progress promsie rejects.\n    this._progress.cleanupWhenAborted(() => this.cancel());\n    this._streamLogs();\n  }\n\n  private async _streamLogs() {\n    while (this._poll && this._progress.isRunning()) {\n      const messages = await this._poll.evaluate(poll => poll.takeNextLogs()).catch(e => [] as string[]);\n      if (!this._poll || !this._progress.isRunning())\n        return;\n      for (const message of messages)\n        this._progress.log(message);\n    }\n  }\n\n  async finishHandle(): Promise<js.SmartHandle<T>> {\n    try {\n      const result = await this._poll!.evaluateHandle(poll => poll.run());\n      await this._finishInternal();\n      return result;\n    } finally {\n      await this.cancel();\n    }\n  }\n\n  async finish(): Promise<T> {\n    try {\n      const result = await this._poll!.evaluate(poll => poll.run());\n      await this._finishInternal();\n      return result;\n    } finally {\n      await this.cancel();\n    }\n  }\n\n  private async _finishInternal() {\n    if (!this._poll)\n      return;\n    // Retrieve all the logs before continuing.\n    const messages = await this._poll.evaluate(poll => poll.takeLastLogs()).catch(e => [] as string[]);\n    for (const message of messages)\n      this._progress.log(message);\n  }\n\n  async cancel() {\n    if (!this._poll)\n      return;\n    const copy = this._poll;\n    this._poll = null;\n    await copy.evaluate(p => p.cancel()).catch(e => {});\n    copy.dispose();\n  }\n}\n\nexport function throwFatalDOMError<T>(result: T | FatalDOMError): T {\n  if (result === 'error:notelement')\n    throw new Error('Node is not an element');\n  if (result === 'error:nothtmlelement')\n    throw new Error('Not an HTMLElement');\n  if (result === 'error:notfillableelement')\n    throw new Error('Element is not an <input>, <textarea> or [contenteditable] element');\n  if (result === 'error:notfillableinputtype')\n    throw new Error('Input of this type cannot be filled');\n  if (result === 'error:notfillablenumberinput')\n    throw new Error('Cannot type text into input[type=number]');\n  if (result === 'error:notvaliddate')\n    throw new Error(`Malformed value`);\n  if (result === 'error:notinput')\n    throw new Error('Node is not an HTMLInputElement');\n  if (result === 'error:hasnovalue')\n    throw new Error('Node is not an HTMLInputElement or HTMLTextAreaElement or HTMLSelectElement');\n  if (result === 'error:notselect')\n    throw new Error('Element is not a <select> element.');\n  if (result === 'error:notcheckbox')\n    throw new Error('Not a checkbox or radio button');\n  if (result === 'error:notmultiplefileinput')\n    throw new Error('Non-multiple file input can only accept single file');\n  return result;\n}\n\nexport function throwRetargetableDOMError<T>(result: T | RetargetableDOMError): T {\n  if (result === 'error:notconnected')\n    throw new Error('Element is not attached to the DOM');\n  return result;\n}\n\nexport function assertDone(result: 'done'): void {\n  // This function converts 'done' to void and ensures typescript catches unhandled errors.\n}\n\nfunction roundPoint(point: types.Point): types.Point {\n  return {\n    x: (point.x * 100 | 0) / 100,\n    y: (point.y * 100 | 0) / 100,\n  };\n}\n\nfunction compensateHalfIntegerRoundingError(point: types.Point) {\n  // Firefox internally uses integer coordinates, so 8.5 is converted to 9 when clicking.\n  //\n  // This does not work nicely for small elements. For example, 1x1 square with corners\n  // (8;8) and (9;9) is targeted when clicking at (8;8) but not when clicking at (9;9).\n  // So, clicking at (8.5;8.5) will effectively click at (9;9) and miss the target.\n  //\n  // Therefore, we skew half-integer values from the interval (8.49, 8.51) towards\n  // (8.47, 8.49) that is rounded towards 8. This means clicking at (8.5;8.5) will\n  // be replaced with (8.48;8.48) and will effectively click at (8;8).\n  //\n  // Other browsers use float coordinates, so this change should not matter.\n  const remainderX = point.x - Math.floor(point.x);\n  if (remainderX > 0.49 && remainderX < 0.51)\n    point.x -= 0.02;\n  const remainderY = point.y - Math.floor(point.y);\n  if (remainderY > 0.49 && remainderY < 0.51)\n    point.y -= 0.02;\n}\n\nexport type SchedulableTask<T> = (injectedScript: js.JSHandle<InjectedScript>) => Promise<js.JSHandle<InjectedScriptPoll<T>>>;\n\nexport function waitForSelectorTask(selector: SelectorInfo, state: 'attached' | 'detached' | 'visible' | 'hidden', root?: ElementHandle): SchedulableTask<Element | undefined> {\n  return injectedScript => injectedScript.evaluateHandle((injected, { parsed, strict, state, root }) => {\n    let lastElement: Element | undefined;\n\n    return injected.pollRaf((progress, continuePolling) => {\n      const elements = injected.querySelectorAll(parsed, root || document);\n      const element = elements[0];\n      const visible = element ? injected.isVisible(element) : false;\n\n      if (lastElement !== element) {\n        lastElement = element;\n        if (!element) {\n          progress.log(`  selector did not resolve to any element`);\n        } else {\n          if (elements.length > 1) {\n            if (strict)\n              throw new Error(`strict mode violation: selector resolved to ${elements.length} elements.`);\n            progress.log(`  selector resolved to ${elements.length} elements. Proceeding with the first one.`);\n          }\n          progress.log(`  selector resolved to ${visible ? 'visible' : 'hidden'} ${injected.previewNode(element)}`);\n        }\n      }\n\n      switch (state) {\n        case 'attached':\n          return element ? element : continuePolling;\n        case 'detached':\n          return !element ? undefined : continuePolling;\n        case 'visible':\n          return visible ? element : continuePolling;\n        case 'hidden':\n          return !visible ? undefined : continuePolling;\n      }\n    });\n  }, { parsed: selector.parsed, strict: selector.strict, state, root });\n}\n\nexport function dispatchEventTask(selector: SelectorInfo, type: string, eventInit: Object): SchedulableTask<undefined> {\n  return injectedScript => injectedScript.evaluateHandle((injected, { parsed, strict, type, eventInit }) => {\n    return injected.pollRaf<undefined>((progress, continuePolling) => {\n      const element = injected.querySelector(parsed, document, strict);\n      if (!element)\n        return continuePolling;\n      progress.log(`  selector resolved to ${injected.previewNode(element)}`);\n      injected.dispatchEvent(element, type, eventInit);\n    });\n  }, { parsed: selector.parsed, strict: selector.strict, type, eventInit });\n}\n\nexport function textContentTask(selector: SelectorInfo): SchedulableTask<string | null> {\n  return injectedScript => injectedScript.evaluateHandle((injected, { parsed, strict }) => {\n    return injected.pollRaf((progress, continuePolling) => {\n      const element = injected.querySelector(parsed, document, strict);\n      if (!element)\n        return continuePolling;\n      progress.log(`  selector resolved to ${injected.previewNode(element)}`);\n      return element.textContent;\n    });\n  }, { parsed: selector.parsed, strict: selector.strict });\n}\n\nexport function innerTextTask(selector: SelectorInfo): SchedulableTask<'error:nothtmlelement' | { innerText: string }> {\n  return injectedScript => injectedScript.evaluateHandle((injected, { parsed, strict }) => {\n    return injected.pollRaf((progress, continuePolling) => {\n      const element = injected.querySelector(parsed, document, strict);\n      if (!element)\n        return continuePolling;\n      progress.log(`  selector resolved to ${injected.previewNode(element)}`);\n      if (element.namespaceURI !== 'http://www.w3.org/1999/xhtml')\n        return 'error:nothtmlelement';\n      return { innerText: (element as HTMLElement).innerText };\n    });\n  }, { parsed: selector.parsed, strict: selector.strict });\n}\n\nexport function innerHTMLTask(selector: SelectorInfo): SchedulableTask<string> {\n  return injectedScript => injectedScript.evaluateHandle((injected, { parsed, strict }) => {\n    return injected.pollRaf((progress, continuePolling) => {\n      const element = injected.querySelector(parsed, document, strict);\n      if (!element)\n        return continuePolling;\n      progress.log(`  selector resolved to ${injected.previewNode(element)}`);\n      return element.innerHTML;\n    });\n  }, { parsed: selector.parsed, strict: selector.strict });\n}\n\nexport function getAttributeTask(selector: SelectorInfo, name: string): SchedulableTask<string | null> {\n  return injectedScript => injectedScript.evaluateHandle((injected, { parsed, strict, name }) => {\n    return injected.pollRaf((progress, continuePolling) => {\n      const element = injected.querySelector(parsed, document, strict);\n      if (!element)\n        return continuePolling;\n      progress.log(`  selector resolved to ${injected.previewNode(element)}`);\n      return element.getAttribute(name);\n    });\n  }, { parsed: selector.parsed, strict: selector.strict, name });\n}\n\nexport function inputValueTask(selector: SelectorInfo): SchedulableTask<string> {\n  return injectedScript => injectedScript.evaluateHandle((injected, { parsed, strict }) => {\n    return injected.pollRaf((progress, continuePolling) => {\n      const element = injected.querySelector(parsed, document, strict);\n      if (!element)\n        return continuePolling;\n      progress.log(`  selector resolved to ${injected.previewNode(element)}`);\n      if (element.nodeName !== 'INPUT' && element.nodeName !== 'TEXTAREA' && element.nodeName !== 'SELECT')\n        return 'error:hasnovalue';\n      return (element as any).value;\n    });\n  }, { parsed: selector.parsed, strict: selector.strict,  });\n}\n\nexport function elementStateTask(selector: SelectorInfo, state: ElementStateWithoutStable): SchedulableTask<boolean | 'error:notconnected' | FatalDOMError> {\n  return injectedScript => injectedScript.evaluateHandle((injected, { parsed, strict, state }) => {\n    return injected.pollRaf((progress, continuePolling) => {\n      const element = injected.querySelector(parsed, document, strict);\n      if (!element)\n        return continuePolling;\n      progress.log(`  selector resolved to ${injected.previewNode(element)}`);\n      return injected.checkElementState(element, state);\n    });\n  }, { parsed: selector.parsed, strict: selector.strict, state });\n}\n\nexport const kUnableToAdoptErrorMessage = 'Unable to adopt element handle from a different document';\n"],"file":"dom.js"}