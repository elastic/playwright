{"version":3,"sources":["../../src/server/frames.ts"],"names":["FrameManager","constructor","page","_page","_frames","Map","_mainFrame","_consoleMessageTags","_signalBarriers","Set","_webSockets","_responses","undefined","dispose","frame","values","_stopNetworkIdleTimer","mainFrame","frames","collect","push","subframe","childFrames","frameId","get","frameAttached","parentFrameId","parentFrame","delete","_id","has","Frame","set","emit","Page","Events","FrameAttached","waitForSignalsCreatedBy","progress","noWaitAfter","action","source","barrier","SignalBarrier","add","cleanupWhenAborted","result","_delegate","inputActionEpilogue","waitFor","Promise","frameWillPotentiallyRequestNavigation","retain","frameDidPotentiallyRequestNavigation","release","frameRequestedNavigation","documentId","addFrameNavigation","pendingDocument","setPendingDocument","request","frameCommittedNewDocumentNavigation","url","name","initial","removeChildFramesRecursively","clearWebSockets","_url","_name","keepPending","_currentDocument","_onClearLifecycle","navigationEvent","newDocument","Navigation","length","debugLogger","log","frameNavigatedToNewDocument","frameCommittedSameDocumentNavigation","frameAbortedNavigation","errorText","error","Error","frameDetached","_removeFramesRecursively","frameStoppedLoading","frameLifecycleEvent","event","_onLifecycleEvent","requestStarted","route","_inflightRequestStarted","_documentId","_isFavicon","continue","_browserContext","BrowserContext","Request","_requestStarted","requestReceivedResponse","response","Response","requestFinished","_inflightRequestFinished","RequestFinished","requestFailed","canceled","failure","RequestFailed","child","_onDetached","isClosed","FrameDetached","_inflightRequests","size","_startNetworkIdleTimer","interceptConsoleMessage","message","type","tag","text","handler","clear","onWebSocketCreated","requestId","ws","network","WebSocket","onWebSocketRequest","onWebSocketResponse","status","statusText","onWebSocketFrameSent","opcode","data","frameSent","webSocketFrameReceived","frameReceived","webSocketClosed","closed","webSocketError","errorMessage","SdkObject","id","_firedLifecycleEvents","_subtreeLifecycleEvents","_pendingDocument","_parentFrame","_detached","_contextData","_childFrames","_networkIdleTimer","_setContentCounter","_detachedPromise","_detachedCallback","_nonStallingEvaluations","attribution","x","contextPromise","contextResolveCallback","context","rerunnableTasks","_setContext","_recalculateLifecycle","Array","from","filter","documentInfo","_invalidateNonStallingEvaluations","callback","nonStallingRawEvaluateInExistingMainContext","expression","_existingMainContext","frameInvalidated","f","r","race","rawEvaluateJSON","nonStallingEvaluateInExistingContext","isFunction","world","evaluateExpression","events","AddLifecycle","Load","DOMContentLoaded","RemoveLifecycle","raceNavigationAction","_disconnectedPromise","then","_crashedPromise","goto","metadata","options","constructedNavigationURL","_options","baseURL","controller","ProgressController","run","_goto","_timeoutSettings","navigationTimeout","waitUntil","verifyLifecycle","headers","_state","extraHTTPHeaders","refererHeader","find","h","toLowerCase","referer","value","helper","completeUserURL","sameDocument","waitForEvent","e","navigateResult","navigateFrame","newDocumentId","promise","_finalRequest","_doSlowMo","_waitForNavigation","_waitForLoadState","state","frameElement","getFrameElement","_context","_mainContext","_utilityContext","evaluateExpressionHandleAndWaitForSignals","arg","handle","evaluateExpressionAndWaitForSignals","querySelector","selector","selectors","query","waitForSelector","visibility","includes","info","parseSelector","task","dom","waitForSelectorTask","isRunning","_scheduleRerunnableHandleTask","asElement","__testHookBeforeAdoptNode","adopted","_adoptTo","js","isContextDestroyedError","kUnableToAdoptErrorMessage","timeout","dispatchEvent","eventInit","dispatchEventTask","_scheduleRerunnableTask","evalOnSelectorAndWaitForSignals","strict","evalOnSelectorAllAndWaitForSignals","arrayHandle","_queryArray","querySelectorAll","_queryAll","content","evaluate","retVal","document","doctype","XMLSerializer","serializeToString","documentElement","outerHTML","setContent","html","lifecyclePromise","resolve","reject","_frameManager","catch","contentPromise","window","stop","open","console","debug","write","close","all","addScriptTag","params","_raceWithCSPError","evaluateHandle","addScriptUrl","addScriptContent","cspErrorsAsynchronousForInlineScipts","script","createElement","src","res","rej","onload","onerror","head","appendChild","addStyleTag","addStyleUrl","addStyleContent","link","rel","href","style","createTextNode","func","listeners","cspMessage","actionPromise","errorPromise","eventsHelper","addEventListener","Console","removeEventListeners","_retryWithProgressIfNotConnected","element","_retryWithSelectorIfNotConnected","click","assertDone","_click","dblclick","_dblclick","dragAndDrop","target","_retryPointerAction","point","mouse","move","y","down","position","sourcePosition","timeUntilDeadline","up","targetPosition","tap","_tap","fill","_fill","focus","_focus","textContent","textContentTask","innerText","innerTextTask","throwFatalDOMError","innerHTML","innerHTMLTask","getAttribute","getAttributeTask","inputValue","inputValueTask","_checkElementState","elementStateTask","throwRetargetableDOMError","isVisible","isHidden","isDisabled","isEnabled","isEditable","isChecked","hover","_hover","selectOption","elements","_selectOption","setInputFiles","files","_setInputFiles","_type","press","key","_press","check","_setChecked","uncheck","_waitForFunctionExpression","pollingInterval","normalizeEvaluationExpression","injectedScript","polling","predicate","self","eval","pollRaf","continuePolling","pollInterval","waitForFunctionValueInUtility","pageFunction","JSON","parse","rawValue","title","rerunnableTask","terminate","RerunnableTask","rerun","call","fulfill","_contextCreated","_contextDestroyed","setTimeout","clearTimeout","extendInjectedScript","injectedScriptHandle","extend","returnByValue","_task","_resolve","_reject","_progress","_returnByValue","pollHandler","InjectedScriptPollHandler","finish","finishHandle","_protectCount","_promise","_promiseCallback","waiter","types","kLifecycleEvents"],"mappings":"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","sourcesContent":["/**\n * Copyright 2017 Google Inc. All rights reserved.\n * Modifications copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as channels from '../protocol/channels';\nimport { ConsoleMessage } from './console';\nimport * as dom from './dom';\nimport { helper } from './helper';\nimport { eventsHelper, RegisteredListener } from '../utils/eventsHelper';\nimport * as js from './javascript';\nimport * as network from './network';\nimport { Page } from './page';\nimport * as types from './types';\nimport { BrowserContext } from './browserContext';\nimport { Progress, ProgressController } from './progress';\nimport { assert, constructURLBasedOnBaseURL, makeWaitForNextTask } from '../utils/utils';\nimport { debugLogger } from '../utils/debugLogger';\nimport { CallMetadata, internalCallMetadata, SdkObject } from './instrumentation';\nimport { ElementStateWithoutStable } from './injected/injectedScript';\n\ntype ContextData = {\n  contextPromise: Promise<dom.FrameExecutionContext>;\n  contextResolveCallback: (c: dom.FrameExecutionContext) => void;\n  context: dom.FrameExecutionContext | null;\n  rerunnableTasks: Set<RerunnableTask>;\n};\n\ntype DocumentInfo = {\n  // Unfortunately, we don't have documentId when we find out about\n  // a pending navigation from things like frameScheduledNavigaiton.\n  documentId: string | undefined,\n  request: network.Request | undefined,\n};\n\nexport type GotoResult = {\n  newDocumentId?: string,\n};\n\ntype ConsoleTagHandler = () => void;\n\nexport type FunctionWithSource = (source: { context: BrowserContext, page: Page, frame: Frame}, ...args: any) => any;\n\nexport type NavigationEvent = {\n  // New frame url after navigation.\n  url: string,\n  // New frame name after navigation.\n  name: string,\n  // Information about the new document for cross-document navigations.\n  // Undefined for same-document navigations.\n  newDocument?: DocumentInfo,\n  // Error for cross-document navigations if any. When error is present,\n  // the navigation did not commit.\n  error?: Error,\n};\n\nexport class FrameManager {\n  private _page: Page;\n  private _frames = new Map<string, Frame>();\n  private _mainFrame: Frame;\n  readonly _consoleMessageTags = new Map<string, ConsoleTagHandler>();\n  readonly _signalBarriers = new Set<SignalBarrier>();\n  private _webSockets = new Map<string, network.WebSocket>();\n  readonly _responses: network.Response[] = [];\n\n  constructor(page: Page) {\n    this._page = page;\n    this._mainFrame = undefined as any as Frame;\n  }\n\n  dispose() {\n    for (const frame of this._frames.values())\n      frame._stopNetworkIdleTimer();\n  }\n\n  mainFrame(): Frame {\n    return this._mainFrame;\n  }\n\n  frames() {\n    const frames: Frame[] = [];\n    collect(this._mainFrame);\n    return frames;\n\n    function collect(frame: Frame) {\n      frames.push(frame);\n      for (const subframe of frame.childFrames())\n        collect(subframe);\n    }\n  }\n\n  frame(frameId: string): Frame | null {\n    return this._frames.get(frameId) || null;\n  }\n\n  frameAttached(frameId: string, parentFrameId: string | null | undefined): Frame {\n    const parentFrame = parentFrameId ? this._frames.get(parentFrameId)! : null;\n    if (!parentFrame) {\n      if (this._mainFrame) {\n        // Update frame id to retain frame identity on cross-process navigation.\n        this._frames.delete(this._mainFrame._id);\n        this._mainFrame._id = frameId;\n      } else {\n        assert(!this._frames.has(frameId));\n        this._mainFrame = new Frame(this._page, frameId, parentFrame);\n      }\n      this._frames.set(frameId, this._mainFrame);\n      return this._mainFrame;\n    } else {\n      assert(!this._frames.has(frameId));\n      const frame = new Frame(this._page, frameId, parentFrame);\n      this._frames.set(frameId, frame);\n      this._page.emit(Page.Events.FrameAttached, frame);\n      return frame;\n    }\n  }\n\n  async waitForSignalsCreatedBy<T>(progress: Progress | null, noWaitAfter: boolean | undefined, action: () => Promise<T>, source?: 'input'): Promise<T> {\n    if (noWaitAfter)\n      return action();\n    const barrier = new SignalBarrier(progress);\n    this._signalBarriers.add(barrier);\n    if (progress)\n      progress.cleanupWhenAborted(() => this._signalBarriers.delete(barrier));\n    const result = await action();\n    if (source === 'input')\n      await this._page._delegate.inputActionEpilogue();\n    await barrier.waitFor();\n    this._signalBarriers.delete(barrier);\n    // Resolve in the next task, after all waitForNavigations.\n    await new Promise<void>(makeWaitForNextTask());\n    return result;\n  }\n\n  frameWillPotentiallyRequestNavigation() {\n    for (const barrier of this._signalBarriers)\n      barrier.retain();\n  }\n\n  frameDidPotentiallyRequestNavigation() {\n    for (const barrier of this._signalBarriers)\n      barrier.release();\n  }\n\n  frameRequestedNavigation(frameId: string, documentId?: string) {\n    const frame = this._frames.get(frameId);\n    if (!frame)\n      return;\n    for (const barrier of this._signalBarriers)\n      barrier.addFrameNavigation(frame);\n    if (frame.pendingDocument() && frame.pendingDocument()!.documentId === documentId) {\n      // Do not override request with undefined.\n      return;\n    }\n    frame.setPendingDocument({ documentId, request: undefined });\n  }\n\n  frameCommittedNewDocumentNavigation(frameId: string, url: string, name: string, documentId: string, initial: boolean) {\n    const frame = this._frames.get(frameId)!;\n    this.removeChildFramesRecursively(frame);\n    this.clearWebSockets(frame);\n    frame._url = url;\n    frame._name = name;\n\n    let keepPending: DocumentInfo | undefined;\n    const pendingDocument = frame.pendingDocument();\n    if (pendingDocument) {\n      if (pendingDocument.documentId === undefined) {\n        // Pending with unknown documentId - assume it is the one being committed.\n        pendingDocument.documentId = documentId;\n      }\n      if (pendingDocument.documentId === documentId) {\n        // Committing a pending document.\n        frame._currentDocument = pendingDocument;\n      } else {\n        // Sometimes, we already have a new pending when the old one commits.\n        // An example would be Chromium error page followed by a new navigation request,\n        // where the error page commit arrives after Network.requestWillBeSent for the\n        // new navigation.\n        // We commit, but keep the pending request since it's not done yet.\n        keepPending = pendingDocument;\n        frame._currentDocument = { documentId, request: undefined };\n      }\n      frame.setPendingDocument(undefined);\n    } else {\n      // No pending - just commit a new document.\n      frame._currentDocument = { documentId, request: undefined };\n    }\n\n    frame._onClearLifecycle();\n    const navigationEvent: NavigationEvent = { url, name, newDocument: frame._currentDocument };\n    frame.emit(Frame.Events.Navigation, navigationEvent);\n    this._responses.length = 0;\n    if (!initial) {\n      debugLogger.log('api', `  navigated to \"${url}\"`);\n      this._page.frameNavigatedToNewDocument(frame);\n    }\n    // Restore pending if any - see comments above about keepPending.\n    frame.setPendingDocument(keepPending);\n  }\n\n  frameCommittedSameDocumentNavigation(frameId: string, url: string) {\n    const frame = this._frames.get(frameId);\n    if (!frame)\n      return;\n    frame._url = url;\n    const navigationEvent: NavigationEvent = { url, name: frame._name };\n    frame.emit(Frame.Events.Navigation, navigationEvent);\n    debugLogger.log('api', `  navigated to \"${url}\"`);\n  }\n\n  frameAbortedNavigation(frameId: string, errorText: string, documentId?: string) {\n    const frame = this._frames.get(frameId);\n    if (!frame || !frame.pendingDocument())\n      return;\n    if (documentId !== undefined && frame.pendingDocument()!.documentId !== documentId)\n      return;\n    const navigationEvent: NavigationEvent = {\n      url: frame._url,\n      name: frame._name,\n      newDocument: frame.pendingDocument(),\n      error: new Error(errorText),\n    };\n    frame.setPendingDocument(undefined);\n    frame.emit(Frame.Events.Navigation, navigationEvent);\n  }\n\n  frameDetached(frameId: string) {\n    const frame = this._frames.get(frameId);\n    if (frame)\n      this._removeFramesRecursively(frame);\n  }\n\n  frameStoppedLoading(frameId: string) {\n    this.frameLifecycleEvent(frameId, 'domcontentloaded');\n    this.frameLifecycleEvent(frameId, 'load');\n  }\n\n  frameLifecycleEvent(frameId: string, event: types.LifecycleEvent) {\n    const frame = this._frames.get(frameId);\n    if (frame)\n      frame._onLifecycleEvent(event);\n  }\n\n  requestStarted(request: network.Request, route?: network.RouteDelegate) {\n    const frame = request.frame();\n    this._inflightRequestStarted(request);\n    if (request._documentId)\n      frame.setPendingDocument({ documentId: request._documentId, request });\n    if (request._isFavicon) {\n      if (route)\n        route.continue(request, {});\n      return;\n    }\n    this._page._browserContext.emit(BrowserContext.Events.Request, request);\n    if (route)\n      this._page._requestStarted(request, route);\n  }\n\n  requestReceivedResponse(response: network.Response) {\n    if (response.request()._isFavicon)\n      return;\n    this._responses.push(response);\n    this._page._browserContext.emit(BrowserContext.Events.Response, response);\n  }\n\n  requestFinished(request: network.Request) {\n    this._inflightRequestFinished(request);\n    if (request._isFavicon)\n      return;\n    this._page._browserContext.emit(BrowserContext.Events.RequestFinished, request);\n  }\n\n  requestFailed(request: network.Request, canceled: boolean) {\n    const frame = request.frame();\n    this._inflightRequestFinished(request);\n    if (frame.pendingDocument() && frame.pendingDocument()!.request === request) {\n      let errorText = request.failure()!.errorText;\n      if (canceled)\n        errorText += '; maybe frame was detached?';\n      this.frameAbortedNavigation(frame._id, errorText, frame.pendingDocument()!.documentId);\n    }\n    if (request._isFavicon)\n      return;\n    this._page._browserContext.emit(BrowserContext.Events.RequestFailed, request);\n  }\n\n  removeChildFramesRecursively(frame: Frame) {\n    for (const child of frame.childFrames())\n      this._removeFramesRecursively(child);\n  }\n\n  private _removeFramesRecursively(frame: Frame) {\n    this.removeChildFramesRecursively(frame);\n    frame._onDetached();\n    this._frames.delete(frame._id);\n    if (!this._page.isClosed())\n      this._page.emit(Page.Events.FrameDetached, frame);\n  }\n\n  private _inflightRequestFinished(request: network.Request) {\n    const frame = request.frame();\n    if (request._isFavicon)\n      return;\n    if (!frame._inflightRequests.has(request))\n      return;\n    frame._inflightRequests.delete(request);\n    if (frame._inflightRequests.size === 0)\n      frame._startNetworkIdleTimer();\n  }\n\n  private _inflightRequestStarted(request: network.Request) {\n    const frame = request.frame();\n    if (request._isFavicon)\n      return;\n    frame._inflightRequests.add(request);\n    if (frame._inflightRequests.size === 1)\n      frame._stopNetworkIdleTimer();\n  }\n\n  interceptConsoleMessage(message: ConsoleMessage): boolean {\n    if (message.type() !== 'debug')\n      return false;\n    const tag = message.text();\n    const handler = this._consoleMessageTags.get(tag);\n    if (!handler)\n      return false;\n    this._consoleMessageTags.delete(tag);\n    handler();\n    return true;\n  }\n\n  clearWebSockets(frame: Frame) {\n    // TODO: attribute sockets to frames.\n    if (frame.parentFrame())\n      return;\n    this._webSockets.clear();\n  }\n\n  onWebSocketCreated(requestId: string, url: string) {\n    const ws = new network.WebSocket(this._page, url);\n    this._webSockets.set(requestId, ws);\n  }\n\n  onWebSocketRequest(requestId: string) {\n    const ws = this._webSockets.get(requestId);\n    if (ws)\n      this._page.emit(Page.Events.WebSocket, ws);\n  }\n\n  onWebSocketResponse(requestId: string, status: number, statusText: string) {\n    const ws = this._webSockets.get(requestId);\n    if (status < 400)\n      return;\n    if (ws)\n      ws.error(`${statusText}: ${status}`);\n  }\n\n  onWebSocketFrameSent(requestId: string, opcode: number, data: string) {\n    const ws = this._webSockets.get(requestId);\n    if (ws)\n      ws.frameSent(opcode, data);\n  }\n\n  webSocketFrameReceived(requestId: string, opcode: number, data: string) {\n    const ws = this._webSockets.get(requestId);\n    if (ws)\n      ws.frameReceived(opcode, data);\n  }\n\n  webSocketClosed(requestId: string) {\n    const ws = this._webSockets.get(requestId);\n    if (ws)\n      ws.closed();\n    this._webSockets.delete(requestId);\n  }\n\n  webSocketError(requestId: string, errorMessage: string): void {\n    const ws = this._webSockets.get(requestId);\n    if (ws)\n      ws.error(errorMessage);\n  }\n}\n\nexport class Frame extends SdkObject {\n  static Events = {\n    Navigation: 'navigation',\n    AddLifecycle: 'addlifecycle',\n    RemoveLifecycle: 'removelifecycle',\n  };\n\n  _id: string;\n  private _firedLifecycleEvents = new Set<types.LifecycleEvent>();\n  _subtreeLifecycleEvents = new Set<types.LifecycleEvent>();\n  _currentDocument: DocumentInfo;\n  private _pendingDocument: DocumentInfo | undefined;\n  readonly _page: Page;\n  private _parentFrame: Frame | null;\n  _url = '';\n  private _detached = false;\n  private _contextData = new Map<types.World, ContextData>();\n  private _childFrames = new Set<Frame>();\n  _name = '';\n  _inflightRequests = new Set<network.Request>();\n  private _networkIdleTimer: NodeJS.Timer | undefined;\n  private _setContentCounter = 0;\n  readonly _detachedPromise: Promise<void>;\n  private _detachedCallback = () => {};\n  private _nonStallingEvaluations = new Set<(error: Error) => void>();\n\n  constructor(page: Page, id: string, parentFrame: Frame | null) {\n    super(page, 'frame');\n    this.attribution.frame = this;\n    this._id = id;\n    this._page = page;\n    this._parentFrame = parentFrame;\n    this._currentDocument = { documentId: undefined, request: undefined };\n\n    this._detachedPromise = new Promise<void>(x => this._detachedCallback = x);\n\n    this._contextData.set('main', { contextPromise: new Promise(() => {}), contextResolveCallback: () => {}, context: null, rerunnableTasks: new Set() });\n    this._contextData.set('utility', { contextPromise: new Promise(() => {}), contextResolveCallback: () => {}, context: null, rerunnableTasks: new Set() });\n    this._setContext('main', null);\n    this._setContext('utility', null);\n\n    if (this._parentFrame)\n      this._parentFrame._childFrames.add(this);\n  }\n\n  _onLifecycleEvent(event: types.LifecycleEvent) {\n    if (this._firedLifecycleEvents.has(event))\n      return;\n    this._firedLifecycleEvents.add(event);\n    // Recalculate subtree lifecycle for the whole tree - it should not be that big.\n    this._page.mainFrame()._recalculateLifecycle();\n  }\n\n  _onClearLifecycle() {\n    this._firedLifecycleEvents.clear();\n    // Recalculate subtree lifecycle for the whole tree - it should not be that big.\n    this._page.mainFrame()._recalculateLifecycle();\n    // Keep the current navigation request if any.\n    this._inflightRequests = new Set(Array.from(this._inflightRequests).filter(request => request === this._currentDocument.request));\n    this._stopNetworkIdleTimer();\n    if (this._inflightRequests.size === 0)\n      this._startNetworkIdleTimer();\n  }\n\n  setPendingDocument(documentInfo: DocumentInfo | undefined) {\n    this._pendingDocument = documentInfo;\n    if (documentInfo)\n      this._invalidateNonStallingEvaluations();\n  }\n\n  pendingDocument(): DocumentInfo | undefined {\n    return this._pendingDocument;\n  }\n\n  private async _invalidateNonStallingEvaluations() {\n    if (!this._nonStallingEvaluations)\n      return;\n    const error = new Error('Navigation interrupted the evaluation');\n    for (const callback of this._nonStallingEvaluations)\n      callback(error);\n  }\n\n  async nonStallingRawEvaluateInExistingMainContext(expression: string): Promise<any> {\n    if (this._pendingDocument)\n      throw new Error('Frame is currently attempting a navigation');\n    const context = this._existingMainContext();\n    if (!context)\n      throw new Error('Frame does not yet have a main execution context');\n\n    let callback = () => {};\n    const frameInvalidated = new Promise<void>((f, r) => callback = r);\n    this._nonStallingEvaluations.add(callback);\n    try {\n      return await Promise.race([\n        context.rawEvaluateJSON(expression),\n        frameInvalidated\n      ]);\n    } finally {\n      this._nonStallingEvaluations.delete(callback);\n    }\n  }\n\n  async nonStallingEvaluateInExistingContext(expression: string, isFunction: boolean|undefined, world: types.World): Promise<any> {\n    if (this._pendingDocument)\n      throw new Error('Frame is currently attempting a navigation');\n    const context = this._contextData.get(world)?.context;\n    if (!context)\n      throw new Error('Frame does not yet have the execution context');\n\n    let callback = () => {};\n    const frameInvalidated = new Promise<void>((f, r) => callback = r);\n    this._nonStallingEvaluations.add(callback);\n    try {\n      return await Promise.race([\n        context.evaluateExpression(expression, isFunction),\n        frameInvalidated\n      ]);\n    } finally {\n      this._nonStallingEvaluations.delete(callback);\n    }\n  }\n\n  private _recalculateLifecycle() {\n    const events = new Set<types.LifecycleEvent>(this._firedLifecycleEvents);\n    for (const child of this._childFrames) {\n      child._recalculateLifecycle();\n      // We require a particular lifecycle event to be fired in the whole\n      // frame subtree, and then consider it done.\n      for (const event of events) {\n        if (!child._subtreeLifecycleEvents.has(event))\n          events.delete(event);\n      }\n    }\n    const mainFrame = this._page.mainFrame();\n    for (const event of events) {\n      // Checking whether we have already notified about this event.\n      if (!this._subtreeLifecycleEvents.has(event)) {\n        this.emit(Frame.Events.AddLifecycle, event);\n        if (this === mainFrame && this._url !== 'about:blank')\n          debugLogger.log('api', `  \"${event}\" event fired`);\n        if (this === mainFrame && event === 'load')\n          this._page.emit(Page.Events.Load);\n        if (this === mainFrame && event === 'domcontentloaded')\n          this._page.emit(Page.Events.DOMContentLoaded);\n      }\n    }\n    for (const event of this._subtreeLifecycleEvents) {\n      if (!events.has(event))\n        this.emit(Frame.Events.RemoveLifecycle, event);\n    }\n    this._subtreeLifecycleEvents = events;\n  }\n\n  async raceNavigationAction<T>(action: () => Promise<T>): Promise<T> {\n    return Promise.race([\n      this._page._disconnectedPromise.then(() => { throw new Error('Navigation failed because page was closed!'); }),\n      this._page._crashedPromise.then(() => { throw new Error('Navigation failed because page crashed!'); }),\n      this._detachedPromise.then(() => { throw new Error('Navigating frame was detached!'); }),\n      action(),\n    ]);\n  }\n\n  async goto(metadata: CallMetadata, url: string, options: types.GotoOptions = {}): Promise<network.Response | null> {\n    const constructedNavigationURL = constructURLBasedOnBaseURL(this._page._browserContext._options.baseURL, url);\n    const controller = new ProgressController(metadata, this);\n    return controller.run(progress => this._goto(progress, constructedNavigationURL, options), this._page._timeoutSettings.navigationTimeout(options));\n  }\n\n  private async _goto(progress: Progress, url: string, options: types.GotoOptions): Promise<network.Response | null> {\n    return this.raceNavigationAction(async () => {\n      const waitUntil = verifyLifecycle('waitUntil', options.waitUntil === undefined ? 'load' : options.waitUntil);\n      progress.log(`navigating to \"${url}\", waiting until \"${waitUntil}\"`);\n      const headers = this._page._state.extraHTTPHeaders || [];\n      const refererHeader = headers.find(h => h.name.toLowerCase() === 'referer');\n      let referer = refererHeader ? refererHeader.value : undefined;\n      if (options.referer !== undefined) {\n        if (referer !== undefined && referer !== options.referer)\n          throw new Error('\"referer\" is already specified as extra HTTP header');\n        referer = options.referer;\n      }\n      url = helper.completeUserURL(url);\n\n      const sameDocument = helper.waitForEvent(progress, this, Frame.Events.Navigation, (e: NavigationEvent) => !e.newDocument);\n      const navigateResult = await this._page._delegate.navigateFrame(this, url, referer);\n\n      let event: NavigationEvent;\n      if (navigateResult.newDocumentId) {\n        sameDocument.dispose();\n        event = await helper.waitForEvent(progress, this, Frame.Events.Navigation, (event: NavigationEvent) => {\n          // We are interested either in this specific document, or any other document that\n          // did commit and replaced the expected document.\n          return event.newDocument && (event.newDocument.documentId === navigateResult.newDocumentId || !event.error);\n        }).promise;\n\n        if (event.newDocument!.documentId !== navigateResult.newDocumentId) {\n          // This is just a sanity check. In practice, new navigation should\n          // cancel the previous one and report \"request cancelled\"-like error.\n          throw new Error('Navigation interrupted by another one');\n        }\n        if (event.error)\n          throw event.error;\n      } else {\n        event = await sameDocument.promise;\n      }\n\n      if (!this._subtreeLifecycleEvents.has(waitUntil))\n        await helper.waitForEvent(progress, this, Frame.Events.AddLifecycle, (e: types.LifecycleEvent) => e === waitUntil).promise;\n\n      const request = event.newDocument ? event.newDocument.request : undefined;\n      const response = request ? request._finalRequest().response() : null;\n      await this._page._doSlowMo();\n      return response;\n    });\n  }\n\n  async _waitForNavigation(progress: Progress, options: types.NavigateOptions): Promise<network.Response | null> {\n    const waitUntil = verifyLifecycle('waitUntil', options.waitUntil === undefined ? 'load' : options.waitUntil);\n    progress.log(`waiting for navigation until \"${waitUntil}\"`);\n\n    const navigationEvent: NavigationEvent = await helper.waitForEvent(progress, this, Frame.Events.Navigation, (event: NavigationEvent) => {\n      // Any failed navigation results in a rejection.\n      if (event.error)\n        return true;\n      progress.log(`  navigated to \"${this._url}\"`);\n      return true;\n    }).promise;\n    if (navigationEvent.error)\n      throw navigationEvent.error;\n\n    if (!this._subtreeLifecycleEvents.has(waitUntil))\n      await helper.waitForEvent(progress, this, Frame.Events.AddLifecycle, (e: types.LifecycleEvent) => e === waitUntil).promise;\n\n    const request = navigationEvent.newDocument ? navigationEvent.newDocument.request : undefined;\n    return request ? request._finalRequest().response() : null;\n  }\n\n  async _waitForLoadState(progress: Progress, state: types.LifecycleEvent): Promise<void> {\n    const waitUntil = verifyLifecycle('state', state);\n    if (!this._subtreeLifecycleEvents.has(waitUntil))\n      await helper.waitForEvent(progress, this, Frame.Events.AddLifecycle, (e: types.LifecycleEvent) => e === waitUntil).promise;\n  }\n\n  async frameElement(): Promise<dom.ElementHandle> {\n    return this._page._delegate.getFrameElement(this);\n  }\n\n  _context(world: types.World): Promise<dom.FrameExecutionContext> {\n    if (this._detached)\n      throw new Error(`Execution Context is not available in detached frame \"${this.url()}\" (are you trying to evaluate?)`);\n    return this._contextData.get(world)!.contextPromise;\n  }\n\n  _mainContext(): Promise<dom.FrameExecutionContext> {\n    return this._context('main');\n  }\n\n  private _existingMainContext(): dom.FrameExecutionContext | null {\n    return this._contextData.get('main')?.context || null;\n  }\n\n  _utilityContext(): Promise<dom.FrameExecutionContext> {\n    return this._context('utility');\n  }\n\n  async evaluateExpressionHandleAndWaitForSignals(expression: string, isFunction: boolean | undefined, arg: any, world: types.World = 'main'): Promise<any> {\n    const context = await this._context(world);\n    const handle = await context.evaluateExpressionHandleAndWaitForSignals(expression, isFunction, arg);\n    if (world === 'main')\n      await this._page._doSlowMo();\n    return handle;\n  }\n\n  async evaluateExpression(expression: string, isFunction: boolean | undefined, arg: any, world: types.World = 'main'): Promise<any> {\n    const context = await this._context(world);\n    const value = await context.evaluateExpression(expression, isFunction, arg);\n    if (world === 'main')\n      await this._page._doSlowMo();\n    return value;\n  }\n\n  async evaluateExpressionAndWaitForSignals(expression: string, isFunction: boolean | undefined, arg: any, world: types.World = 'main'): Promise<any> {\n    const context = await this._context(world);\n    const value = await context.evaluateExpressionAndWaitForSignals(expression, isFunction, arg);\n    if (world === 'main')\n      await this._page._doSlowMo();\n    return value;\n  }\n\n  async querySelector(selector: string, options: types.StrictOptions): Promise<dom.ElementHandle<Element> | null> {\n    debugLogger.log('api', `    finding element using the selector \"${selector}\"`);\n    return this._page.selectors.query(this, selector, options);\n  }\n\n  async waitForSelector(metadata: CallMetadata, selector: string, options: types.WaitForElementOptions = {}): Promise<dom.ElementHandle<Element> | null> {\n    const controller = new ProgressController(metadata, this);\n    if ((options as any).visibility)\n      throw new Error('options.visibility is not supported, did you mean options.state?');\n    if ((options as any).waitFor && (options as any).waitFor !== 'visible')\n      throw new Error('options.waitFor is not supported, did you mean options.state?');\n    const { state = 'visible' } = options;\n    if (!['attached', 'detached', 'visible', 'hidden'].includes(state))\n      throw new Error(`state: expected one of (attached|detached|visible|hidden)`);\n    const info = this._page.parseSelector(selector, options);\n    const task = dom.waitForSelectorTask(info, state);\n    return controller.run(async progress => {\n      progress.log(`waiting for selector \"${selector}\"${state === 'attached' ? '' : ' to be ' + state}`);\n      while (progress.isRunning()) {\n        const result = await this._scheduleRerunnableHandleTask(progress, info.world, task);\n        if (!result.asElement()) {\n          result.dispose();\n          return null;\n        }\n        if ((options as any).__testHookBeforeAdoptNode)\n          await (options as any).__testHookBeforeAdoptNode();\n        try {\n          const handle = result.asElement() as dom.ElementHandle<Element>;\n          const adopted = await handle._adoptTo(await this._mainContext());\n          return adopted;\n        } catch (e) {\n          // Navigated while trying to adopt the node.\n          if (!js.isContextDestroyedError(e) && !e.message.includes(dom.kUnableToAdoptErrorMessage))\n            throw e;\n          result.dispose();\n        }\n      }\n      return null;\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async dispatchEvent(metadata: CallMetadata, selector: string, type: string, eventInit?: Object, options: types.QueryOnSelectorOptions = {}): Promise<void> {\n    const controller = new ProgressController(metadata, this);\n    const info = this._page.parseSelector(selector, options);\n    const task = dom.dispatchEventTask(info, type, eventInit || {});\n    await controller.run(async progress => {\n      progress.log(`Dispatching \"${type}\" event on selector \"${selector}\"...`);\n      // Note: we always dispatch events in the main world.\n      await this._scheduleRerunnableTask(progress, 'main', task);\n    }, this._page._timeoutSettings.timeout(options));\n    await this._page._doSlowMo();\n  }\n\n  async evalOnSelectorAndWaitForSignals(selector: string, strict: boolean, expression: string, isFunction: boolean | undefined, arg: any): Promise<any> {\n    const handle = await this.querySelector(selector, { strict });\n    if (!handle)\n      throw new Error(`Error: failed to find element matching selector \"${selector}\"`);\n    const result = await handle.evaluateExpressionAndWaitForSignals(expression, isFunction, true, arg);\n    handle.dispose();\n    return result;\n  }\n\n  async evalOnSelectorAllAndWaitForSignals(selector: string, expression: string, isFunction: boolean | undefined, arg: any): Promise<any> {\n    const arrayHandle = await this._page.selectors._queryArray(this, selector);\n    const result = await arrayHandle.evaluateExpressionAndWaitForSignals(expression, isFunction, true, arg);\n    arrayHandle.dispose();\n    return result;\n  }\n\n  async querySelectorAll(selector: string): Promise<dom.ElementHandle<Element>[]> {\n    return this._page.selectors._queryAll(this, selector, undefined, true /* adoptToMain */);\n  }\n\n  async content(): Promise<string> {\n    const context = await this._utilityContext();\n    return context.evaluate(() => {\n      let retVal = '';\n      if (document.doctype)\n        retVal = new XMLSerializer().serializeToString(document.doctype);\n      if (document.documentElement)\n        retVal += document.documentElement.outerHTML;\n      return retVal;\n    });\n  }\n\n  async setContent(metadata: CallMetadata, html: string, options: types.NavigateOptions = {}): Promise<void> {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(progress => this.raceNavigationAction(async () => {\n      const waitUntil = options.waitUntil === undefined ? 'load' : options.waitUntil;\n      progress.log(`setting frame content, waiting until \"${waitUntil}\"`);\n      const tag = `--playwright--set--content--${this._id}--${++this._setContentCounter}--`;\n      const context = await this._utilityContext();\n      const lifecyclePromise = new Promise((resolve, reject) => {\n        this._page._frameManager._consoleMessageTags.set(tag, () => {\n          // Clear lifecycle right after document.open() - see 'tag' below.\n          this._onClearLifecycle();\n          this._waitForLoadState(progress, waitUntil).then(resolve).catch(reject);\n        });\n      });\n      const contentPromise = context.evaluate(({ html, tag }) => {\n        window.stop();\n        document.open();\n        console.debug(tag);  // eslint-disable-line no-console\n        document.write(html);\n        document.close();\n      }, { html, tag });\n      await Promise.all([contentPromise, lifecyclePromise]);\n      await this._page._doSlowMo();\n    }), this._page._timeoutSettings.navigationTimeout(options));\n  }\n\n  name(): string {\n    return this._name || '';\n  }\n\n  url(): string {\n    return this._url;\n  }\n\n  parentFrame(): Frame | null {\n    return this._parentFrame;\n  }\n\n  childFrames(): Frame[] {\n    return Array.from(this._childFrames);\n  }\n\n  async addScriptTag(params: {\n      url?: string,\n      content?: string,\n      type?: string,\n    }): Promise<dom.ElementHandle> {\n    const {\n      url = null,\n      content = null,\n      type = ''\n    } = params;\n    if (!url && !content)\n      throw new Error('Provide an object with a `url`, `path` or `content` property');\n\n    const context = await this._mainContext();\n    return this._raceWithCSPError(async () => {\n      if (url !== null)\n        return (await context.evaluateHandle(addScriptUrl, { url, type })).asElement()!;\n      const result = (await context.evaluateHandle(addScriptContent, { content: content!, type })).asElement()!;\n      // Another round trip to the browser to ensure that we receive CSP error messages\n      // (if any) logged asynchronously in a separate task on the content main thread.\n      if (this._page._delegate.cspErrorsAsynchronousForInlineScipts)\n        await context.evaluate(() => true);\n      return result;\n    });\n\n    async function addScriptUrl(params: { url: string, type: string }): Promise<HTMLElement> {\n      const script = document.createElement('script');\n      script.src = params.url;\n      if (params.type)\n        script.type = params.type;\n      const promise = new Promise((res, rej) => {\n        script.onload = res;\n        script.onerror = e => rej(typeof e === 'string' ? new Error(e) : new Error(`Failed to load script at ${script.src}`));\n      });\n      document.head.appendChild(script);\n      await promise;\n      return script;\n    }\n\n    function addScriptContent(params: { content: string, type: string }): HTMLElement {\n      const script = document.createElement('script');\n      script.type = params.type || 'text/javascript';\n      script.text = params.content;\n      let error = null;\n      script.onerror = e => error = e;\n      document.head.appendChild(script);\n      if (error)\n        throw error;\n      return script;\n    }\n  }\n\n  async addStyleTag(params: { url?: string, content?: string }): Promise<dom.ElementHandle> {\n    const {\n      url = null,\n      content = null\n    } = params;\n    if (!url && !content)\n      throw new Error('Provide an object with a `url`, `path` or `content` property');\n\n    const context = await this._mainContext();\n    return this._raceWithCSPError(async () => {\n      if (url !== null)\n        return (await context.evaluateHandle(addStyleUrl, url)).asElement()!;\n      return (await context.evaluateHandle(addStyleContent, content!)).asElement()!;\n    });\n\n    async function addStyleUrl(url: string): Promise<HTMLElement> {\n      const link = document.createElement('link');\n      link.rel = 'stylesheet';\n      link.href = url;\n      const promise = new Promise((res, rej) => {\n        link.onload = res;\n        link.onerror = rej;\n      });\n      document.head.appendChild(link);\n      await promise;\n      return link;\n    }\n\n    async function addStyleContent(content: string): Promise<HTMLElement> {\n      const style = document.createElement('style');\n      style.type = 'text/css';\n      style.appendChild(document.createTextNode(content));\n      const promise = new Promise((res, rej) => {\n        style.onload = res;\n        style.onerror = rej;\n      });\n      document.head.appendChild(style);\n      await promise;\n      return style;\n    }\n  }\n\n  private async _raceWithCSPError(func: () => Promise<dom.ElementHandle>): Promise<dom.ElementHandle> {\n    const listeners: RegisteredListener[] = [];\n    let result: dom.ElementHandle;\n    let error: Error | undefined;\n    let cspMessage: ConsoleMessage | undefined;\n    const actionPromise = new Promise<void>(async resolve => {\n      try {\n        result = await func();\n      } catch (e) {\n        error = e;\n      }\n      resolve();\n    });\n    const errorPromise = new Promise<void>(resolve => {\n      listeners.push(eventsHelper.addEventListener(this._page, Page.Events.Console, (message: ConsoleMessage) => {\n        if (message.type() === 'error' && message.text().includes('Content Security Policy')) {\n          cspMessage = message;\n          resolve();\n        }\n      }));\n    });\n    await Promise.race([actionPromise, errorPromise]);\n    eventsHelper.removeEventListeners(listeners);\n    if (cspMessage)\n      throw new Error(cspMessage.text());\n    if (error)\n      throw error;\n    return result!;\n  }\n\n  private async _retryWithProgressIfNotConnected<R>(\n    progress: Progress,\n    selector: string,\n    strict: boolean,\n    action: (handle: dom.ElementHandle<Element>) => Promise<R | 'error:notconnected'>): Promise<R> {\n    const info = this._page.parseSelector(selector, { strict });\n    while (progress.isRunning()) {\n      progress.log(`waiting for selector \"${selector}\"`);\n      const task = dom.waitForSelectorTask(info, 'attached');\n      const handle = await this._scheduleRerunnableHandleTask(progress, info.world, task);\n      const element = handle.asElement() as dom.ElementHandle<Element>;\n      progress.cleanupWhenAborted(() => {\n        // Do not await here to avoid being blocked, either by stalled\n        // page (e.g. alert) or unresolved navigation in Chromium.\n        element.dispose();\n      });\n      const result = await action(element);\n      element.dispose();\n      if (result === 'error:notconnected') {\n        progress.log('element was detached from the DOM, retrying');\n        continue;\n      }\n      return result;\n    }\n    return undefined as any;\n  }\n\n  private async _retryWithSelectorIfNotConnected<R>(\n    controller: ProgressController,\n    selector: string, options: types.TimeoutOptions & types.StrictOptions,\n    action: (progress: Progress, handle: dom.ElementHandle<Element>) => Promise<R | 'error:notconnected'>): Promise<R> {\n    return controller.run(async progress => {\n      return this._retryWithProgressIfNotConnected(progress, selector, !!options.strict, handle => action(progress, handle));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async click(metadata: CallMetadata, selector: string, options: types.MouseClickOptions & types.PointerActionWaitOptions & types.NavigatingActionWaitOptions) {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      return dom.assertDone(await this._retryWithProgressIfNotConnected(progress, selector, !!options.strict, handle => handle._click(progress, options)));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async dblclick(metadata: CallMetadata, selector: string, options: types.MouseMultiClickOptions & types.PointerActionWaitOptions & types.NavigatingActionWaitOptions = {}) {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      return dom.assertDone(await this._retryWithProgressIfNotConnected(progress, selector, !!options.strict, handle => handle._dblclick(progress, options)));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async dragAndDrop(metadata: CallMetadata, source: string, target: string,  options: types.DragActionOptions & types.PointerActionWaitOptions & types.NavigatingActionWaitOptions = {}) {\n    const controller = new ProgressController(metadata, this);\n    await controller.run(async progress => {\n      await dom.assertDone(await this._retryWithProgressIfNotConnected(progress, source, !!options.strict, async handle => {\n        return handle._retryPointerAction(progress, 'move and down', false, async point => {\n          await this._page.mouse.move(point.x, point.y);\n          await this._page.mouse.down();\n        }, {\n          ...options,\n          position: options.sourcePosition,\n          timeout: progress.timeUntilDeadline(),\n        });\n      }));\n      await dom.assertDone(await this._retryWithProgressIfNotConnected(progress, target, !!options.strict, async handle => {\n        return handle._retryPointerAction(progress, 'move and up', false, async point => {\n          await this._page.mouse.move(point.x, point.y);\n          await this._page.mouse.up();\n        }, {\n          ...options,\n          position: options.targetPosition,\n          timeout: progress.timeUntilDeadline(),\n        });\n      }));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async tap(metadata: CallMetadata, selector: string, options: types.PointerActionWaitOptions & types.NavigatingActionWaitOptions) {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      return dom.assertDone(await this._retryWithProgressIfNotConnected(progress, selector, !!options.strict, handle => handle._tap(progress, options)));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async fill(metadata: CallMetadata, selector: string, value: string, options: types.NavigatingActionWaitOptions & { force?: boolean }) {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      return dom.assertDone(await this._retryWithProgressIfNotConnected(progress, selector, !!options.strict, handle => handle._fill(progress, value, options)));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async focus(metadata: CallMetadata, selector: string, options: types.TimeoutOptions = {}) {\n    const controller = new ProgressController(metadata, this);\n    await this._retryWithSelectorIfNotConnected(controller, selector, options, (progress, handle) => handle._focus(progress));\n    await this._page._doSlowMo();\n  }\n\n  async textContent(metadata: CallMetadata, selector: string, options: types.QueryOnSelectorOptions = {}): Promise<string | null> {\n    const controller = new ProgressController(metadata, this);\n    const info = this._page.parseSelector(selector, options);\n    const task = dom.textContentTask(info);\n    return controller.run(async progress => {\n      progress.log(`  retrieving textContent from \"${selector}\"`);\n      return this._scheduleRerunnableTask(progress, info.world, task);\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async innerText(metadata: CallMetadata, selector: string, options: types.QueryOnSelectorOptions = {}): Promise<string> {\n    const controller = new ProgressController(metadata, this);\n    const info = this._page.parseSelector(selector, options);\n    const task = dom.innerTextTask(info);\n    return controller.run(async progress => {\n      progress.log(`  retrieving innerText from \"${selector}\"`);\n      const result = dom.throwFatalDOMError(await this._scheduleRerunnableTask(progress, info.world, task));\n      return result.innerText;\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async innerHTML(metadata: CallMetadata, selector: string, options: types.QueryOnSelectorOptions = {}): Promise<string> {\n    const controller = new ProgressController(metadata, this);\n    const info = this._page.parseSelector(selector, options);\n    const task = dom.innerHTMLTask(info);\n    return controller.run(async progress => {\n      progress.log(`  retrieving innerHTML from \"${selector}\"`);\n      return this._scheduleRerunnableTask(progress, info.world, task);\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async getAttribute(metadata: CallMetadata, selector: string, name: string, options: types.QueryOnSelectorOptions = {}): Promise<string | null> {\n    const controller = new ProgressController(metadata, this);\n    const info = this._page.parseSelector(selector, options);\n    const task = dom.getAttributeTask(info, name);\n    return controller.run(async progress => {\n      progress.log(`  retrieving attribute \"${name}\" from \"${selector}\"`);\n      return this._scheduleRerunnableTask(progress, info.world, task);\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async inputValue(metadata: CallMetadata, selector: string, options: types.TimeoutOptions & types.StrictOptions = {}): Promise<string> {\n    const controller = new ProgressController(metadata, this);\n    const info = this._page.parseSelector(selector, options);\n    const task = dom.inputValueTask(info);\n    return controller.run(async progress => {\n      progress.log(`  retrieving value from \"${selector}\"`);\n      return dom.throwFatalDOMError(await this._scheduleRerunnableTask(progress, info.world, task));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  private async _checkElementState(metadata: CallMetadata, selector: string, state: ElementStateWithoutStable, options: types.QueryOnSelectorOptions = {}): Promise<boolean> {\n    const controller = new ProgressController(metadata, this);\n    const info = this._page.parseSelector(selector, options);\n    const task = dom.elementStateTask(info, state);\n    const result = await controller.run(async progress => {\n      progress.log(`  checking \"${state}\" state of \"${selector}\"`);\n      return this._scheduleRerunnableTask(progress, info.world, task);\n    }, this._page._timeoutSettings.timeout(options));\n    return dom.throwFatalDOMError(dom.throwRetargetableDOMError(result));\n  }\n\n  async isVisible(metadata: CallMetadata, selector: string, options: types.QueryOnSelectorOptions = {}): Promise<boolean> {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      progress.log(`  checking visibility of \"${selector}\"`);\n      const element = await this.querySelector(selector, options);\n      return element ? await element.isVisible() : false;\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async isHidden(metadata: CallMetadata, selector: string, options: types.QueryOnSelectorOptions = {}): Promise<boolean> {\n    return !(await this.isVisible(metadata, selector, options));\n  }\n\n  async isDisabled(metadata: CallMetadata, selector: string, options: types.QueryOnSelectorOptions = {}): Promise<boolean> {\n    return this._checkElementState(metadata, selector, 'disabled', options);\n  }\n\n  async isEnabled(metadata: CallMetadata, selector: string, options: types.QueryOnSelectorOptions = {}): Promise<boolean> {\n    return this._checkElementState(metadata, selector, 'enabled', options);\n  }\n\n  async isEditable(metadata: CallMetadata, selector: string, options: types.QueryOnSelectorOptions = {}): Promise<boolean> {\n    return this._checkElementState(metadata, selector, 'editable', options);\n  }\n\n  async isChecked(metadata: CallMetadata, selector: string, options: types.QueryOnSelectorOptions = {}): Promise<boolean> {\n    return this._checkElementState(metadata, selector, 'checked', options);\n  }\n\n  async hover(metadata: CallMetadata, selector: string, options: types.PointerActionOptions & types.PointerActionWaitOptions = {}) {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      return dom.assertDone(await this._retryWithProgressIfNotConnected(progress, selector, !!options.strict, handle => handle._hover(progress, options)));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async selectOption(metadata: CallMetadata, selector: string, elements: dom.ElementHandle[], values: types.SelectOption[], options: types.NavigatingActionWaitOptions & types.ForceOptions = {}): Promise<string[]> {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      return await this._retryWithProgressIfNotConnected(progress, selector, !!options.strict, handle => handle._selectOption(progress, elements, values, options));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async setInputFiles(metadata: CallMetadata, selector: string, files: channels.ElementHandleSetInputFilesParams['files'], options: types.NavigatingActionWaitOptions = {}): Promise<void> {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      return dom.assertDone(await this._retryWithProgressIfNotConnected(progress, selector, !!options.strict, handle => handle._setInputFiles(progress, files, options)));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async type(metadata: CallMetadata, selector: string, text: string, options: { delay?: number } & types.NavigatingActionWaitOptions = {}) {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      return dom.assertDone(await this._retryWithProgressIfNotConnected(progress, selector, !!options.strict, handle => handle._type(progress, text, options)));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async press(metadata: CallMetadata, selector: string, key: string, options: { delay?: number } & types.NavigatingActionWaitOptions = {}) {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      return dom.assertDone(await this._retryWithProgressIfNotConnected(progress, selector, !!options.strict, handle => handle._press(progress, key, options)));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async check(metadata: CallMetadata, selector: string, options: types.PointerActionWaitOptions & types.NavigatingActionWaitOptions = {}) {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      return dom.assertDone(await this._retryWithProgressIfNotConnected(progress, selector, !!options.strict, handle => handle._setChecked(progress, true, options)));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async uncheck(metadata: CallMetadata, selector: string, options: types.PointerActionWaitOptions & types.NavigatingActionWaitOptions = {}) {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(async progress => {\n      return dom.assertDone(await this._retryWithProgressIfNotConnected(progress, selector, !!options.strict, handle => handle._setChecked(progress, false, options)));\n    }, this._page._timeoutSettings.timeout(options));\n  }\n\n  async _waitForFunctionExpression<R>(metadata: CallMetadata, expression: string, isFunction: boolean | undefined, arg: any, options: types.WaitForFunctionOptions, world: types.World = 'main'): Promise<js.SmartHandle<R>> {\n    const controller = new ProgressController(metadata, this);\n    if (typeof options.pollingInterval === 'number')\n      assert(options.pollingInterval > 0, 'Cannot poll with non-positive interval: ' + options.pollingInterval);\n    expression = js.normalizeEvaluationExpression(expression, isFunction);\n    const task: dom.SchedulableTask<R> = injectedScript => injectedScript.evaluateHandle((injectedScript, { expression, isFunction, polling, arg }) => {\n      const predicate = (arg: any): R => {\n        let result = self.eval(expression);\n        if (isFunction === true) {\n          result = result(arg);\n        } else if (isFunction === false) {\n          result = result;\n        } else {\n          // auto detect.\n          if (typeof result === 'function')\n            result = result(arg);\n        }\n        return result;\n      };\n      if (typeof polling !== 'number')\n        return injectedScript.pollRaf((progress, continuePolling) => predicate(arg) || continuePolling);\n      return injectedScript.pollInterval(polling, (progress, continuePolling) => predicate(arg) || continuePolling);\n    }, { expression, isFunction, polling: options.pollingInterval, arg });\n    return controller.run(\n        progress => this._scheduleRerunnableHandleTask(progress, world, task),\n        this._page._timeoutSettings.timeout(options));\n  }\n\n  async waitForFunctionValueInUtility<R>(progress: Progress, pageFunction: js.Func1<any, R>) {\n    const expression = `() => {\n      const result = (${pageFunction})();\n      if (!result)\n        return result;\n      return JSON.stringify(result);\n    }`;\n    const handle = await this._waitForFunctionExpression(internalCallMetadata(), expression, true, undefined, { timeout: progress.timeUntilDeadline() }, 'utility');\n    return JSON.parse(handle.rawValue()) as R;\n  }\n\n  async title(): Promise<string> {\n    const context = await this._utilityContext();\n    return context.evaluate(() => document.title);\n  }\n\n  _onDetached() {\n    this._stopNetworkIdleTimer();\n    this._detached = true;\n    this._detachedCallback();\n    for (const data of this._contextData.values()) {\n      for (const rerunnableTask of data.rerunnableTasks)\n        rerunnableTask.terminate(new Error('waitForFunction failed: frame got detached.'));\n    }\n    if (this._parentFrame)\n      this._parentFrame._childFrames.delete(this);\n    this._parentFrame = null;\n  }\n\n  private _scheduleRerunnableTask<T>(progress: Progress, world: types.World, task: dom.SchedulableTask<T>): Promise<T> {\n    const data = this._contextData.get(world)!;\n    const rerunnableTask = new RerunnableTask(data, progress, task, true /* returnByValue */);\n    if (this._detached)\n      rerunnableTask.terminate(new Error('waitForFunction failed: frame got detached.'));\n    if (data.context)\n      rerunnableTask.rerun(data.context);\n    return rerunnableTask.promise;\n  }\n\n  private _scheduleRerunnableHandleTask<T>(progress: Progress, world: types.World, task: dom.SchedulableTask<T>): Promise<js.SmartHandle<T>> {\n    const data = this._contextData.get(world)!;\n    const rerunnableTask = new RerunnableTask(data, progress, task, false /* returnByValue */);\n    if (this._detached)\n      rerunnableTask.terminate(new Error('waitForFunction failed: frame got detached.'));\n    if (data.context)\n      rerunnableTask.rerun(data.context);\n    return rerunnableTask.promise;\n  }\n\n  private _setContext(world: types.World, context: dom.FrameExecutionContext | null) {\n    const data = this._contextData.get(world)!;\n    data.context = context;\n    if (context) {\n      data.contextResolveCallback.call(null, context);\n      for (const rerunnableTask of data.rerunnableTasks)\n        rerunnableTask.rerun(context);\n    } else {\n      data.contextPromise = new Promise(fulfill => {\n        data.contextResolveCallback = fulfill;\n      });\n    }\n  }\n\n  _contextCreated(world: types.World, context: dom.FrameExecutionContext) {\n    const data = this._contextData.get(world)!;\n    // In case of multiple sessions to the same target, there's a race between\n    // connections so we might end up creating multiple isolated worlds.\n    // We can use either.\n    if (data.context)\n      this._setContext(world, null);\n    this._setContext(world, context);\n  }\n\n  _contextDestroyed(context: dom.FrameExecutionContext) {\n    for (const [world, data] of this._contextData) {\n      if (data.context === context)\n        this._setContext(world, null);\n    }\n  }\n\n  _startNetworkIdleTimer() {\n    assert(!this._networkIdleTimer);\n    // We should not start a timer and report networkidle in detached frames.\n    // This happens at least in Firefox for child frames, where we may get requestFinished\n    // after the frame was detached - probably a race in the Firefox itself.\n    if (this._firedLifecycleEvents.has('networkidle') || this._detached)\n      return;\n    this._networkIdleTimer = setTimeout(() => this._onLifecycleEvent('networkidle'), 500);\n  }\n\n  _stopNetworkIdleTimer() {\n    if (this._networkIdleTimer)\n      clearTimeout(this._networkIdleTimer);\n    this._networkIdleTimer = undefined;\n  }\n\n  async extendInjectedScript(world: types.World, source: string, arg?: any): Promise<js.JSHandle> {\n    const context = await this._context(world);\n    const injectedScriptHandle = await context.injectedScript();\n    return injectedScriptHandle.evaluateHandle((injectedScript, {source, arg}) => {\n      return injectedScript.extend(source, arg);\n    }, { source, arg });\n  }\n}\n\nclass RerunnableTask {\n  readonly promise: Promise<any>;\n  private _task: dom.SchedulableTask<any>;\n  private _resolve: (result: any) => void = () => {};\n  private _reject: (reason: Error) => void = () => {};\n  private _progress: Progress;\n  private _returnByValue: boolean;\n  private _contextData: ContextData;\n\n  constructor(data: ContextData, progress: Progress, task: dom.SchedulableTask<any>, returnByValue: boolean) {\n    this._task = task;\n    this._progress = progress;\n    this._returnByValue = returnByValue;\n    this._contextData = data;\n    this._contextData.rerunnableTasks.add(this);\n    this.promise = new Promise<any>((resolve, reject) => {\n      // The task is either resolved with a value, or rejected with a meaningful evaluation error.\n      this._resolve = resolve;\n      this._reject = reject;\n    });\n  }\n\n  terminate(error: Error) {\n    this._reject(error);\n  }\n\n  async rerun(context: dom.FrameExecutionContext) {\n    try {\n      const injectedScript = await context.injectedScript();\n      const pollHandler = new dom.InjectedScriptPollHandler(this._progress, await this._task(injectedScript));\n      const result = this._returnByValue ? await pollHandler.finish() : await pollHandler.finishHandle();\n      this._contextData.rerunnableTasks.delete(this);\n      this._resolve(result);\n    } catch (e) {\n      // We will try again in the new execution context.\n      if (js.isContextDestroyedError(e))\n        return;\n      this._contextData.rerunnableTasks.delete(this);\n      this._reject(e);\n    }\n  }\n}\n\nclass SignalBarrier {\n  private _progress: Progress | null;\n  private _protectCount = 0;\n  private _promise: Promise<void>;\n  private _promiseCallback = () => {};\n\n  constructor(progress: Progress | null) {\n    this._progress = progress;\n    this._promise = new Promise(f => this._promiseCallback = f);\n    this.retain();\n  }\n\n  waitFor(): Promise<void> {\n    this.release();\n    return this._promise;\n  }\n\n  async addFrameNavigation(frame: Frame) {\n    // Auto-wait top-level navigations only.\n    if (frame.parentFrame())\n      return;\n    this.retain();\n    const waiter = helper.waitForEvent(null, frame, Frame.Events.Navigation, (e: NavigationEvent) => {\n      if (!e.error && this._progress)\n        this._progress.log(`  navigated to \"${frame._url}\"`);\n      return true;\n    });\n    await Promise.race([\n      frame._page._disconnectedPromise,\n      frame._page._crashedPromise,\n      frame._detachedPromise,\n      waiter.promise,\n    ]).catch(e => {});\n    waiter.dispose();\n    this.release();\n  }\n\n  retain() {\n    ++this._protectCount;\n  }\n\n  release() {\n    --this._protectCount;\n    if (!this._protectCount)\n      this._promiseCallback();\n  }\n}\n\nfunction verifyLifecycle(name: string, waitUntil: types.LifecycleEvent): types.LifecycleEvent {\n  if (waitUntil as unknown === 'networkidle0')\n    waitUntil = 'networkidle';\n  if (!types.kLifecycleEvents.has(waitUntil))\n    throw new Error(`${name}: expected one of (load|domcontentloaded|networkidle)`);\n  return waitUntil;\n}\n"],"file":"frames.js"}