{"version":3,"sources":["../../src/server/javascript.ts"],"names":["ExecutionContext","SdkObject","constructor","parent","delegate","_delegate","_utilityScriptPromise","waitForSignalsCreatedBy","action","adoptIfNeeded","handle","utilityScript","source","utilityScriptSource","rawEvaluateHandle","then","objectId","JSHandle","undefined","createHandle","remoteObject","rawEvaluateJSON","expression","doSlowMo","context","type","preview","value","_context","_disposed","_objectId","_value","_objectType","_preview","_previewCallback","String","callFunctionNoReply","func","arg","rawCallFunctionNoReply","evaluate","pageFunction","evaluateHandle","evaluateExpressionAndWaitForSignals","isFunction","returnByValue","getProperty","propertyName","objectHandle","object","result","__proto__","properties","getProperties","get","dispose","Map","rawValue","jsonValue","script","evaluateWithArguments","asElement","releaseHandle","catch","e","toString","_setPreviewCallback","callback","_setPreview","args","evaluateExpression","normalizeEvaluationExpression","handles","toDispose","pushHandle","push","length","map","fallThrough","Error","adopted","h","Promise","resolve","utilityScriptObjectIds","all","utilityScriptValues","handlePromise","parseUnserializableValue","unserializableValue","NaN","Infinity","trim","Function","e1","startsWith","substring","e2","test","kSwappedOutErrorMessage","isContextDestroyedError","message","includes"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as dom from './dom';\nimport * as utilityScriptSource from '../generated/utilityScriptSource';\nimport { serializeAsCallArgument } from './common/utilityScriptSerializers';\nimport type UtilityScript from './injected/utilityScript';\nimport { SdkObject } from './instrumentation';\n\nexport type ObjectId = string;\nexport type RemoteObject = {\n  objectId?: ObjectId,\n  value?: any\n};\n\ntype NoHandles<Arg> = Arg extends JSHandle ? never : (Arg extends object ? { [Key in keyof Arg]: NoHandles<Arg[Key]> } : Arg);\ntype Unboxed<Arg> =\n  Arg extends dom.ElementHandle<infer T> ? T :\n  Arg extends JSHandle<infer T> ? T :\n  Arg extends NoHandles<Arg> ? Arg :\n  Arg extends [infer A0] ? [Unboxed<A0>] :\n  Arg extends [infer A0, infer A1] ? [Unboxed<A0>, Unboxed<A1>] :\n  Arg extends [infer A0, infer A1, infer A2] ? [Unboxed<A0>, Unboxed<A1>, Unboxed<A2>] :\n  Arg extends Array<infer T> ? Array<Unboxed<T>> :\n  Arg extends object ? { [Key in keyof Arg]: Unboxed<Arg[Key]> } :\n  Arg;\nexport type Func0<R> = string | (() => R | Promise<R>);\nexport type Func1<Arg, R> = string | ((arg: Unboxed<Arg>) => R | Promise<R>);\nexport type FuncOn<On, Arg2, R> = string | ((on: On, arg2: Unboxed<Arg2>) => R | Promise<R>);\nexport type SmartHandle<T> = T extends Node ? dom.ElementHandle<T> : JSHandle<T>;\n\nexport interface ExecutionContextDelegate {\n  rawEvaluateJSON(expression: string): Promise<any>;\n  rawEvaluateHandle(expression: string): Promise<ObjectId>;\n  rawCallFunctionNoReply(func: Function, ...args: any[]): void;\n  evaluateWithArguments(expression: string, returnByValue: boolean, utilityScript: JSHandle<any>, values: any[], objectIds: ObjectId[]): Promise<any>;\n  getProperties(context: ExecutionContext, objectId: ObjectId): Promise<Map<string, JSHandle>>;\n  createHandle(context: ExecutionContext, remoteObject: RemoteObject): JSHandle;\n  releaseHandle(objectId: ObjectId): Promise<void>;\n}\n\nexport class ExecutionContext extends SdkObject {\n  readonly _delegate: ExecutionContextDelegate;\n  private _utilityScriptPromise: Promise<JSHandle> | undefined;\n\n  constructor(parent: SdkObject, delegate: ExecutionContextDelegate) {\n    super(parent, 'execution-context');\n    this._delegate = delegate;\n  }\n\n  async waitForSignalsCreatedBy<T>(action: () => Promise<T>): Promise<T> {\n    return action();\n  }\n\n  adoptIfNeeded(handle: JSHandle): Promise<JSHandle> | null {\n    return null;\n  }\n\n  utilityScript(): Promise<JSHandle<UtilityScript>> {\n    if (!this._utilityScriptPromise) {\n      const source = `\n      (() => {\n        ${utilityScriptSource.source}\n        return new pwExport();\n      })();`;\n      this._utilityScriptPromise = this._delegate.rawEvaluateHandle(source).then(objectId => new JSHandle(this, 'object', undefined, objectId));\n    }\n    return this._utilityScriptPromise;\n  }\n\n  createHandle(remoteObject: RemoteObject): JSHandle {\n    return this._delegate.createHandle(this, remoteObject);\n  }\n\n  async rawEvaluateJSON(expression: string): Promise<any> {\n    return await this._delegate.rawEvaluateJSON(expression);\n  }\n\n  async doSlowMo() {\n    // overridden in FrameExecutionContext\n  }\n}\n\nexport class JSHandle<T = any> extends SdkObject {\n  readonly _context: ExecutionContext;\n  _disposed = false;\n  readonly _objectId: ObjectId | undefined;\n  readonly _value: any;\n  private _objectType: string;\n  protected _preview: string;\n  private _previewCallback: ((preview: string) => void) | undefined;\n\n  constructor(context: ExecutionContext, type: string, preview: string | undefined, objectId?: ObjectId, value?: any) {\n    super(context, 'handle');\n    this._context = context;\n    this._objectId = objectId;\n    this._value = value;\n    this._objectType = type;\n    this._preview = this._objectId ? preview || `JSHandle@${this._objectType}` : String(value);\n  }\n\n  callFunctionNoReply(func: Function, arg: any) {\n    this._context._delegate.rawCallFunctionNoReply(func, this, arg);\n  }\n\n  async evaluate<R, Arg>(pageFunction: FuncOn<T, Arg, R>, arg?: Arg): Promise<R> {\n    return evaluate(this._context, true /* returnByValue */, pageFunction, this, arg);\n  }\n\n  async evaluateHandle<R, Arg>(pageFunction: FuncOn<T, Arg, R>, arg?: Arg): Promise<SmartHandle<R>> {\n    return evaluate(this._context, false /* returnByValue */, pageFunction, this, arg);\n  }\n\n  async evaluateExpressionAndWaitForSignals(expression: string, isFunction: boolean | undefined, returnByValue: boolean, arg: any) {\n    const value = await evaluateExpressionAndWaitForSignals(this._context, returnByValue, expression, isFunction, this, arg);\n    await this._context.doSlowMo();\n    return value;\n  }\n\n  async getProperty(propertyName: string): Promise<JSHandle> {\n    const objectHandle = await this.evaluateHandle((object: any, propertyName) => {\n      const result: any = {__proto__: null};\n      result[propertyName] = object[propertyName];\n      return result;\n    }, propertyName);\n    const properties = await objectHandle.getProperties();\n    const result = properties.get(propertyName)!;\n    objectHandle.dispose();\n    return result;\n  }\n\n  async getProperties(): Promise<Map<string, JSHandle>> {\n    if (!this._objectId)\n      return new Map();\n    return this._context._delegate.getProperties(this._context, this._objectId);\n  }\n\n  rawValue() {\n    return this._value;\n  }\n\n  async jsonValue(): Promise<T> {\n    if (!this._objectId)\n      return this._value;\n    const utilityScript = await this._context.utilityScript();\n    const script = `(utilityScript, ...args) => utilityScript.jsonValue(...args)`;\n    return this._context._delegate.evaluateWithArguments(script, true, utilityScript, [true], [this._objectId]);\n  }\n\n  asElement(): dom.ElementHandle | null {\n    return null;\n  }\n\n  dispose() {\n    if (this._disposed)\n      return;\n    this._disposed = true;\n    if (this._objectId)\n      this._context._delegate.releaseHandle(this._objectId).catch(e => {});\n  }\n\n  toString(): string {\n    return this._preview;\n  }\n\n  _setPreviewCallback(callback: (preview: string) => void) {\n    this._previewCallback = callback;\n  }\n\n  preview(): string {\n    return this._preview;\n  }\n\n  _setPreview(preview: string) {\n    this._preview = preview;\n    if (this._previewCallback)\n      this._previewCallback(preview);\n  }\n}\n\nexport async function evaluate(context: ExecutionContext, returnByValue: boolean, pageFunction: Function | string, ...args: any[]): Promise<any> {\n  return evaluateExpression(context, returnByValue, String(pageFunction), typeof pageFunction === 'function', ...args);\n}\n\nexport async function evaluateExpression(context: ExecutionContext, returnByValue: boolean, expression: string, isFunction: boolean | undefined, ...args: any[]): Promise<any> {\n  const utilityScript = await context.utilityScript();\n  expression = normalizeEvaluationExpression(expression, isFunction);\n  const handles: (Promise<JSHandle>)[] = [];\n  const toDispose: Promise<JSHandle>[] = [];\n  const pushHandle = (handle: Promise<JSHandle>): number => {\n    handles.push(handle);\n    return handles.length - 1;\n  };\n\n  args = args.map(arg => serializeAsCallArgument(arg, handle => {\n    if (handle instanceof JSHandle) {\n      if (!handle._objectId)\n        return { fallThrough: handle._value };\n      if (handle._disposed)\n        throw new Error('JSHandle is disposed!');\n      const adopted = context.adoptIfNeeded(handle);\n      if (adopted === null)\n        return { h: pushHandle(Promise.resolve(handle)) };\n      toDispose.push(adopted);\n      return { h: pushHandle(adopted) };\n    }\n    return { fallThrough: handle };\n  }));\n\n  const utilityScriptObjectIds: ObjectId[] = [];\n  for (const handle of await Promise.all(handles)) {\n    if (handle._context !== context)\n      throw new Error('JSHandles can be evaluated only in the context they were created!');\n    utilityScriptObjectIds.push(handle._objectId!);\n  }\n\n  // See UtilityScript for arguments.\n  const utilityScriptValues = [isFunction, returnByValue, expression, args.length, ...args];\n\n  const script = `(utilityScript, ...args) => utilityScript.evaluate(...args)`;\n  try {\n    return await context._delegate.evaluateWithArguments(script, returnByValue, utilityScript, utilityScriptValues, utilityScriptObjectIds);\n  } finally {\n    toDispose.map(handlePromise => handlePromise.then(handle => handle.dispose()));\n  }\n}\n\nexport async function evaluateExpressionAndWaitForSignals(context: ExecutionContext, returnByValue: boolean, expression: string, isFunction?: boolean, ...args: any[]): Promise<any> {\n  return await context.waitForSignalsCreatedBy(() => evaluateExpression(context, returnByValue, expression, isFunction, ...args));\n}\n\nexport function parseUnserializableValue(unserializableValue: string): any {\n  if (unserializableValue === 'NaN')\n    return NaN;\n  if (unserializableValue === 'Infinity')\n    return Infinity;\n  if (unserializableValue === '-Infinity')\n    return -Infinity;\n  if (unserializableValue === '-0')\n    return -0;\n}\n\nexport function normalizeEvaluationExpression(expression: string, isFunction: boolean | undefined): string {\n  expression = expression.trim();\n\n  if (isFunction) {\n    try {\n      new Function('(' + expression + ')');\n    } catch (e1) {\n      // This means we might have a function shorthand. Try another\n      // time prefixing 'function '.\n      if (expression.startsWith('async '))\n        expression = 'async function ' + expression.substring('async '.length);\n      else\n        expression = 'function ' + expression;\n      try {\n        new Function('(' + expression  + ')');\n      } catch (e2) {\n        // We tried hard to serialize, but there's a weird beast here.\n        throw new Error('Passed function is not well-serializable!');\n      }\n    }\n  }\n\n  if (/^(async)?\\s*function(\\s|\\()/.test(expression))\n    expression = '(' + expression + ')';\n  return expression;\n}\n\nexport const kSwappedOutErrorMessage = 'Target was swapped out.';\n\nexport function isContextDestroyedError(e: any) {\n  if (!e || typeof e !== 'object' || typeof e.message !== 'string')\n    return false;\n\n  // Evaluating in a context which was already destroyed.\n  if (e.message.includes('Cannot find context with specified id')\n      || e.message.includes('Failed to find execution context with id')\n      || e.message.includes('Missing injected script for given')\n      || e.message.includes('Cannot find object with id'))\n    return true;\n\n  // Evaluation promise is rejected when context is gone.\n  if (e.message.includes('Execution context was destroyed'))\n    return true;\n\n  // WebKit target swap.\n  if (e.message.includes(kSwappedOutErrorMessage))\n    return true;\n\n  return false;\n}\n"],"file":"javascript.js"}