{"version":3,"sources":["../../../src/server/chromium/chromium.ts"],"names":["ARTIFACTS_FOLDER","path","join","os","tmpdir","Chromium","BrowserType","constructor","playwrightOptions","_devtools","_createDevTools","connectOverCDP","metadata","endpointURL","options","timeout","controller","ProgressController","setLogName","browserLogsCollector","RecentLogsCollector","run","progress","headersMap","headers","artifactsDir","fs","promises","mkdtemp","chromeTransport","WebSocketTransport","connect","urlToWSEndpoint","browserProcess","close","closeAndWait","kill","browserOptions","_playwrightOptions","slowMo","name","isChromium","persistent","sdkLanguage","noDefaultViewport","protocolLogger","helper","debugProtocolLogger","downloadsPath","tracesDir","CRBrowser","TimeoutSettings","directory","registry","findExecutable","CRDevTools","undefined","_connectToTransport","transport","devtools","__testHookForDevTools","_rewriteStartupError","error","message","includes","_amendEnvironment","env","userDataDir","executable","browserArguments","_attemptToGracefullyCloseBrowser","method","id","kBrowserCloseMessageId","params","send","_defaultArgs","isPersistent","args","proxy","userDataDirArg","find","arg","startsWith","Error","chromeArguments","DEFAULT_ARGS","push","platform","useWebSocket","headless","chromiumSandbox","proxyURL","URL","server","isSocks","protocol","hostname","proxyBypassRules","loopbackProxyOverride","bypass","split","map","t","trim","length","httpURL","endsWith","json","Promise","resolve","reject","http","get","resp","statusCode","data","on","chunk","JSON","parse","webSocketDebuggerUrl"],"mappings":"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","sourcesContent":["/**\n * Copyright 2017 Google Inc. All rights reserved.\n * Modifications copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport fs from 'fs';\nimport os from 'os';\nimport path from 'path';\nimport { CRBrowser } from './crBrowser';\nimport { Env } from '../../utils/processLauncher';\nimport { kBrowserCloseMessageId } from './crConnection';\nimport { rewriteErrorMessage } from '../../utils/stackTrace';\nimport { BrowserType } from '../browserType';\nimport { ConnectionTransport, ProtocolRequest, WebSocketTransport } from '../transport';\nimport { CRDevTools } from './crDevTools';\nimport { BrowserOptions, BrowserProcess, PlaywrightOptions } from '../browser';\nimport * as types from '../types';\nimport { debugMode, headersArrayToObject, removeFolders } from '../../utils/utils';\nimport { RecentLogsCollector } from '../../utils/debugLogger';\nimport { ProgressController } from '../progress';\nimport { TimeoutSettings } from '../../utils/timeoutSettings';\nimport { helper } from '../helper';\nimport { CallMetadata } from '../instrumentation';\nimport http from 'http';\nimport { registry } from '../../utils/registry';\n\nconst ARTIFACTS_FOLDER = path.join(os.tmpdir(), 'playwright-artifacts-');\n\nexport class Chromium extends BrowserType {\n  private _devtools: CRDevTools | undefined;\n\n  constructor(playwrightOptions: PlaywrightOptions) {\n    super('chromium', playwrightOptions);\n\n    if (debugMode())\n      this._devtools = this._createDevTools();\n  }\n\n  async connectOverCDP(metadata: CallMetadata, endpointURL: string, options: { slowMo?: number, sdkLanguage: string, headers?: types.HeadersArray }, timeout?: number) {\n    const controller = new ProgressController(metadata, this);\n    controller.setLogName('browser');\n    const browserLogsCollector = new RecentLogsCollector();\n    return controller.run(async progress => {\n      let headersMap: { [key: string]: string; } | undefined;\n      if (options.headers)\n        headersMap = headersArrayToObject(options.headers, false);\n\n      const artifactsDir = await fs.promises.mkdtemp(ARTIFACTS_FOLDER);\n\n      const chromeTransport = await WebSocketTransport.connect(progress, await urlToWSEndpoint(endpointURL), headersMap);\n      const browserProcess: BrowserProcess = {\n        close: async () => {\n          await removeFolders([ artifactsDir ]);\n          await chromeTransport.closeAndWait();\n        },\n        kill: async () => {\n          await removeFolders([ artifactsDir ]);\n          await chromeTransport.closeAndWait();\n        }\n      };\n      const browserOptions: BrowserOptions = {\n        ...this._playwrightOptions,\n        slowMo: options.slowMo,\n        name: 'chromium',\n        isChromium: true,\n        persistent: { sdkLanguage: options.sdkLanguage, noDefaultViewport: true },\n        browserProcess,\n        protocolLogger: helper.debugProtocolLogger(),\n        browserLogsCollector,\n        artifactsDir,\n        downloadsPath: artifactsDir,\n        tracesDir: artifactsDir\n      };\n      return await CRBrowser.connect(chromeTransport, browserOptions);\n    }, TimeoutSettings.timeout({timeout}));\n  }\n\n  private _createDevTools() {\n    // TODO: this is totally wrong when using channels.\n    const directory = registry.findExecutable('chromium').directory;\n    return directory ? new CRDevTools(path.join(directory, 'devtools-preferences.json')) : undefined;\n  }\n\n  async _connectToTransport(transport: ConnectionTransport, options: BrowserOptions): Promise<CRBrowser> {\n    let devtools = this._devtools;\n    if ((options as any).__testHookForDevTools) {\n      devtools = this._createDevTools();\n      await (options as any).__testHookForDevTools(devtools);\n    }\n    return CRBrowser.connect(transport, options, devtools);\n  }\n\n  _rewriteStartupError(error: Error): Error {\n    // These error messages are taken from Chromium source code as of July, 2020:\n    // https://github.com/chromium/chromium/blob/70565f67e79f79e17663ad1337dc6e63ee207ce9/content/browser/zygote_host/zygote_host_impl_linux.cc\n    if (!error.message.includes('crbug.com/357670') && !error.message.includes('No usable sandbox!') && !error.message.includes('crbug.com/638180'))\n      return error;\n    return rewriteErrorMessage(error, [\n      `Chromium sandboxing failed!`,\n      `================================`,\n      `To workaround sandboxing issues, do either of the following:`,\n      `  - (preferred): Configure environment to support sandboxing: https://github.com/microsoft/playwright/blob/master/docs/troubleshooting.md`,\n      `  - (alternative): Launch Chromium without sandbox using 'chromiumSandbox: false' option`,\n      `================================`,\n      ``,\n    ].join('\\n'));\n  }\n\n  _amendEnvironment(env: Env, userDataDir: string, executable: string, browserArguments: string[]): Env {\n    return env;\n  }\n\n  _attemptToGracefullyCloseBrowser(transport: ConnectionTransport): void {\n    const message: ProtocolRequest = { method: 'Browser.close', id: kBrowserCloseMessageId, params: {} };\n    transport.send(message);\n  }\n\n  _defaultArgs(options: types.LaunchOptions, isPersistent: boolean, userDataDir: string): string[] {\n    const { args = [], proxy } = options;\n    const userDataDirArg = args.find(arg => arg.startsWith('--user-data-dir'));\n    if (userDataDirArg)\n      throw new Error('Pass userDataDir parameter to `browserType.launchPersistentContext(userDataDir, ...)` instead of specifying --user-data-dir argument');\n    if (args.find(arg => arg.startsWith('--remote-debugging-pipe')))\n      throw new Error('Playwright manages remote debugging connection itself.');\n    if (args.find(arg => !arg.startsWith('-')))\n      throw new Error('Arguments can not specify page to be opened');\n    const chromeArguments = [...DEFAULT_ARGS];\n    chromeArguments.push(`--user-data-dir=${userDataDir}`);\n\n    // See https://github.com/microsoft/playwright/issues/7362\n    if (os.platform() === 'darwin')\n      chromeArguments.push('--enable-use-zoom-for-dsf=false');\n\n    if (options.useWebSocket)\n      chromeArguments.push('--remote-debugging-port=0');\n    else\n      chromeArguments.push('--remote-debugging-pipe');\n    if (options.devtools)\n      chromeArguments.push('--auto-open-devtools-for-tabs');\n    if (options.headless) {\n      chromeArguments.push(\n          '--headless',\n          '--hide-scrollbars',\n          '--mute-audio',\n          '--blink-settings=primaryHoverType=2,availableHoverTypes=2,primaryPointerType=4,availablePointerTypes=4',\n      );\n    }\n    if (options.chromiumSandbox !== true)\n      chromeArguments.push('--no-sandbox');\n    if (proxy) {\n      const proxyURL = new URL(proxy.server);\n      const isSocks = proxyURL.protocol === 'socks5:';\n      // https://www.chromium.org/developers/design-documents/network-settings\n      if (isSocks) {\n        // https://www.chromium.org/developers/design-documents/network-stack/socks-proxy\n        chromeArguments.push(`--host-resolver-rules=\"MAP * ~NOTFOUND , EXCLUDE ${proxyURL.hostname}\"`);\n      }\n      chromeArguments.push(`--proxy-server=${proxy.server}`);\n      const proxyBypassRules = [];\n      // https://source.chromium.org/chromium/chromium/src/+/master:net/docs/proxy.md;l=548;drc=71698e610121078e0d1a811054dcf9fd89b49578\n      if (this._playwrightOptions.loopbackProxyOverride)\n        proxyBypassRules.push('<-loopback>');\n      if (proxy.bypass)\n        proxyBypassRules.push(...proxy.bypass.split(',').map(t => t.trim()).map(t => t.startsWith('.') ? '*' + t : t));\n      if (proxyBypassRules.length > 0)\n        chromeArguments.push(`--proxy-bypass-list=${proxyBypassRules.join(';')}`);\n    }\n    chromeArguments.push(...args);\n    if (isPersistent)\n      chromeArguments.push('about:blank');\n    else\n      chromeArguments.push('--no-startup-window');\n    return chromeArguments;\n  }\n}\n\nconst DEFAULT_ARGS = [\n  '--disable-background-networking',\n  '--enable-features=NetworkService,NetworkServiceInProcess',\n  '--disable-background-timer-throttling',\n  '--disable-backgrounding-occluded-windows',\n  '--disable-breakpad',\n  '--disable-client-side-phishing-detection',\n  '--disable-component-extensions-with-background-pages',\n  '--disable-default-apps',\n  '--disable-dev-shm-usage',\n  '--disable-extensions',\n  '--disable-features=ImprovedCookieControls,LazyFrameLoading,GlobalMediaControls,DestroyProfileOnBrowserClose,MediaRouter',\n  '--allow-pre-commit-input',\n  '--disable-hang-monitor',\n  '--disable-ipc-flooding-protection',\n  '--disable-popup-blocking',\n  '--disable-prompt-on-repost',\n  '--disable-renderer-backgrounding',\n  '--disable-sync',\n  '--force-color-profile=srgb',\n  '--metrics-recording-only',\n  '--no-first-run',\n  '--enable-automation',\n  '--password-store=basic',\n  '--use-mock-keychain',\n  // See https://chromium-review.googlesource.com/c/chromium/src/+/2436773\n  '--no-service-autorun',\n];\n\nasync function urlToWSEndpoint(endpointURL: string) {\n  if (endpointURL.startsWith('ws'))\n    return endpointURL;\n  const httpURL = endpointURL.endsWith('/') ? `${endpointURL}json/version/` : `${endpointURL}/json/version/`;\n  const json = await new Promise<string>((resolve, reject) => {\n    http.get(httpURL, resp => {\n      if (resp.statusCode! < 200 || resp.statusCode! >= 400) {\n        reject(new Error(`Unexpected status ${resp.statusCode} when connecting to ${httpURL}.\\n` +\n        `This does not look like a DevTools server, try connecting via ws://.`));\n      }\n      let data = '';\n      resp.on('data', chunk => data += chunk);\n      resp.on('end', () => resolve(data));\n    }).on('error', reject);\n  });\n  return JSON.parse(json).webSocketDebuggerUrl;\n}\n"],"file":"chromium.js"}