{"version":3,"sources":["../../src/server/page.ts"],"names":["Page","SdkObject","constructor","delegate","browserContext","_closedState","_closedCallback","_closedPromise","_disconnected","_initialized","_disconnectedCallback","_disconnectedPromise","_crashedCallback","_crashedPromise","_browserContext","keyboard","mouse","touchscreen","_timeoutSettings","_delegate","_state","_pageBindings","Map","_evaluateOnNewDocumentSources","_screenshotter","_frameManager","accessibility","_workers","pdf","coverage","_clientRequestInterceptor","_serverRequestInterceptor","_ownedContext","selectors","_pageIsError","_video","_opener","attribution","page","Promise","f","emulatedSize","_options","viewport","screen","mediaType","colorScheme","undefined","reducedMotion","extraHTTPHeaders","Accessibility","getAccessibilityTree","bind","input","Keyboard","rawKeyboard","Mouse","rawMouse","Touchscreen","rawTouchscreen","TimeoutSettings","Screenshotter","frames","FrameManager","initOpener","opener","openerPage","pageOrError","isClosed","reportAsNew","error","isClosingOrClosed","_setIsError","emit","BrowserContext","Events","Close","initializedOrUndefined","_doSlowMo","slowMo","_browser","options","x","setTimeout","_didClose","dispose","_didCrash","Crash","Error","_didDisconnect","_onFileChooserOpened","handle","multiple","evaluate","element","e","listenerCount","FileChooser","fileChooser","context","mainFrame","setDefaultNavigationTimeout","timeout","setDefaultTimeout","exposeBinding","name","needsHandle","playwrightBinding","world","identifier","PageBinding","has","binding","set","setExtraHTTPHeaders","headers","updateExtraHTTPHeaders","_onBindingCalled","payload","dispatch","_addConsoleMessage","type","args","location","text","message","ConsoleMessage","intercepted","interceptConsoleMessage","Console","forEach","arg","reload","metadata","controller","ProgressController","run","progress","raceNavigationAction","response","all","_waitForNavigation","navigationTimeout","goBack","waitPromise","catch","result","goForward","emulateMedia","media","updateEmulateMedia","setViewportSize","viewportSize","setEmulatedSize","bringToFront","_addInitScriptExpression","source","push","evaluateOnNewDocument","_needsRequestInterception","_requestInterceptor","_setClientRequestInterceptor","handler","updateRequestInterception","_setServerRequestInterceptor","_requestStarted","request","routeDelegate","route","network","Route","continue","screenshot","screenshotPage","close","runBeforeUnload","closePage","debugLogger","log","frameAttached","_addWorker","workerId","worker","Worker","_removeWorker","get","delete","_clearWorkers","_setFileChooserIntercepted","enabled","setFileChooserIntercepted","frameNavigatedToNewDocument","frame","InternalFrameNavigatedToNewDocument","url","startsWith","purl","parsedURL","addVisitedOrigin","origin","allBindings","values","getBinding","setScreencastOptions","firePageError","PageError","parseSelector","selector","strict","strictSelectors","Dialog","Download","DOMContentLoaded","FrameAttached","FrameDetached","Load","ScreencastFrame","Video","WebSocket","parent","_url","_executionContextPromise","_executionContextCallback","_existingExecutionContext","_createExecutionContext","js","ExecutionContext","evaluateExpression","expression","isFunction","evaluateExpressionHandle","playwrightFunction","addPageBinding","toString","JSON","stringify","seq","parse","evaluateHandle","takeHandle","deliverResult","deliverError","stack","deliverErrorValue","globalThis","resolve","reject","bindingName","__installed","me","slice","some","length","callbacks","handles","promise"],"mappings":"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","sourcesContent":["/**\n * Copyright 2017 Google Inc. All rights reserved.\n * Modifications copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as dom from './dom';\nimport * as frames from './frames';\nimport * as input from './input';\nimport * as js from './javascript';\nimport * as network from './network';\nimport { Screenshotter } from './screenshotter';\nimport { TimeoutSettings } from '../utils/timeoutSettings';\nimport * as types from './types';\nimport { BrowserContext } from './browserContext';\nimport { ConsoleMessage } from './console';\nimport * as accessibility from './accessibility';\nimport { FileChooser } from './fileChooser';\nimport { Progress, ProgressController } from './progress';\nimport { assert, isError } from '../utils/utils';\nimport { debugLogger } from '../utils/debugLogger';\nimport { SelectorInfo, Selectors } from './selectors';\nimport { CallMetadata, SdkObject } from './instrumentation';\nimport { Artifact } from './artifact';\n\nexport interface PageDelegate {\n  readonly rawMouse: input.RawMouse;\n  readonly rawKeyboard: input.RawKeyboard;\n  readonly rawTouchscreen: input.RawTouchscreen;\n\n  reload(): Promise<void>;\n  goBack(): Promise<boolean>;\n  goForward(): Promise<boolean>;\n  exposeBinding(binding: PageBinding): Promise<void>;\n  evaluateOnNewDocument(source: string): Promise<void>;\n  closePage(runBeforeUnload: boolean): Promise<void>;\n  pageOrError(): Promise<Page | Error>;\n\n  navigateFrame(frame: frames.Frame, url: string, referrer: string | undefined): Promise<frames.GotoResult>;\n\n  updateExtraHTTPHeaders(): Promise<void>;\n  setEmulatedSize(emulatedSize: types.EmulatedSize): Promise<void>;\n  updateEmulateMedia(): Promise<void>;\n  updateRequestInterception(): Promise<void>;\n  setFileChooserIntercepted(enabled: boolean): Promise<void>;\n  bringToFront(): Promise<void>;\n\n  canScreenshotOutsideViewport(): boolean;\n  resetViewport(): Promise<void>; // Only called if canScreenshotOutsideViewport() returns false.\n  setBackgroundColor(color?: { r: number; g: number; b: number; a: number; }): Promise<void>;\n  takeScreenshot(progress: Progress, format: string, documentRect: types.Rect | undefined, viewportRect: types.Rect | undefined, quality: number | undefined): Promise<Buffer>;\n\n  isElementHandle(remoteObject: any): boolean;\n  adoptElementHandle<T extends Node>(handle: dom.ElementHandle<T>, to: dom.FrameExecutionContext): Promise<dom.ElementHandle<T>>;\n  getContentFrame(handle: dom.ElementHandle): Promise<frames.Frame | null>;  // Only called for frame owner elements.\n  getOwnerFrame(handle: dom.ElementHandle): Promise<string | null>; // Returns frameId.\n  getContentQuads(handle: dom.ElementHandle): Promise<types.Quad[] | null>;\n  setInputFiles(handle: dom.ElementHandle<HTMLInputElement>, files: types.FilePayload[]): Promise<void>;\n  getBoundingBox(handle: dom.ElementHandle): Promise<types.Rect | null>;\n  getFrameElement(frame: frames.Frame): Promise<dom.ElementHandle>;\n  scrollRectIntoViewIfNeeded(handle: dom.ElementHandle, rect?: types.Rect): Promise<'error:notvisible' | 'error:notconnected' | 'done'>;\n  setScreencastOptions(options: { width: number, height: number, quality: number } | null): Promise<void>;\n\n  getAccessibilityTree(needle?: dom.ElementHandle): Promise<{tree: accessibility.AXNode, needle: accessibility.AXNode | null}>;\n  pdf?: (options?: types.PDFOptions) => Promise<Buffer>;\n  coverage?: () => any;\n\n  // Work around WebKit's raf issues on Windows.\n  rafCountForStablePosition(): number;\n  // Work around Chrome's non-associated input and protocol.\n  inputActionEpilogue(): Promise<void>;\n  // Work around for asynchronously dispatched CSP errors in Firefox.\n  readonly cspErrorsAsynchronousForInlineScipts?: boolean;\n}\n\ntype PageState = {\n  emulatedSize: { screen: types.Size, viewport: types.Size } | null;\n  mediaType: types.MediaType | null;\n  colorScheme: types.ColorScheme | null;\n  reducedMotion: types.ReducedMotion | null;\n  extraHTTPHeaders: types.HeadersArray | null;\n};\n\nexport class Page extends SdkObject {\n  static Events = {\n    Close: 'close',\n    Crash: 'crash',\n    Console: 'console',\n    Dialog: 'dialog',\n    Download: 'download',\n    FileChooser: 'filechooser',\n    DOMContentLoaded: 'domcontentloaded',\n    // Can't use just 'error' due to node.js special treatment of error events.\n    // @see https://nodejs.org/api/events.html#events_error_events\n    PageError: 'pageerror',\n    FrameAttached: 'frameattached',\n    FrameDetached: 'framedetached',\n    InternalFrameNavigatedToNewDocument: 'internalframenavigatedtonewdocument',\n    Load: 'load',\n    ScreencastFrame: 'screencastframe',\n    Video: 'video',\n    WebSocket: 'websocket',\n    Worker: 'worker',\n  };\n\n  private _closedState: 'open' | 'closing' | 'closed' = 'open';\n  private _closedCallback: () => void;\n  private _closedPromise: Promise<void>;\n  private _disconnected = false;\n  private _initialized = false;\n  private _disconnectedCallback: (e: Error) => void;\n  readonly _disconnectedPromise: Promise<Error>;\n  private _crashedCallback: (e: Error) => void;\n  readonly _crashedPromise: Promise<Error>;\n  readonly _browserContext: BrowserContext;\n  readonly keyboard: input.Keyboard;\n  readonly mouse: input.Mouse;\n  readonly touchscreen: input.Touchscreen;\n  readonly _timeoutSettings: TimeoutSettings;\n  readonly _delegate: PageDelegate;\n  readonly _state: PageState;\n  private readonly _pageBindings = new Map<string, PageBinding>();\n  readonly _evaluateOnNewDocumentSources: string[] = [];\n  readonly _screenshotter: Screenshotter;\n  readonly _frameManager: frames.FrameManager;\n  readonly accessibility: accessibility.Accessibility;\n  private _workers = new Map<string, Worker>();\n  readonly pdf: ((options?: types.PDFOptions) => Promise<Buffer>) | undefined;\n  readonly coverage: any;\n  private _clientRequestInterceptor: network.RouteHandler | undefined;\n  private _serverRequestInterceptor: network.RouteHandler | undefined;\n  _ownedContext: BrowserContext | undefined;\n  readonly selectors: Selectors;\n  _pageIsError: Error | undefined;\n  _video: Artifact | null = null;\n  _opener: Page | undefined;\n\n  constructor(delegate: PageDelegate, browserContext: BrowserContext) {\n    super(browserContext, 'page');\n    this.attribution.page = this;\n    this._delegate = delegate;\n    this._closedCallback = () => {};\n    this._closedPromise = new Promise(f => this._closedCallback = f);\n    this._disconnectedCallback = () => {};\n    this._disconnectedPromise = new Promise(f => this._disconnectedCallback = f);\n    this._crashedCallback = () => {};\n    this._crashedPromise = new Promise(f => this._crashedCallback = f);\n    this._browserContext = browserContext;\n    this._state = {\n      emulatedSize: browserContext._options.viewport ? { viewport: browserContext._options.viewport, screen: browserContext._options.screen || browserContext._options.viewport } : null,\n      mediaType: null,\n      colorScheme: browserContext._options.colorScheme !== undefined  ? browserContext._options.colorScheme : 'light',\n      reducedMotion: browserContext._options.reducedMotion !== undefined  ? browserContext._options.reducedMotion : 'no-preference',\n      extraHTTPHeaders: null,\n    };\n    this.accessibility = new accessibility.Accessibility(delegate.getAccessibilityTree.bind(delegate));\n    this.keyboard = new input.Keyboard(delegate.rawKeyboard, this);\n    this.mouse = new input.Mouse(delegate.rawMouse, this);\n    this.touchscreen = new input.Touchscreen(delegate.rawTouchscreen, this);\n    this._timeoutSettings = new TimeoutSettings(browserContext._timeoutSettings);\n    this._screenshotter = new Screenshotter(this);\n    this._frameManager = new frames.FrameManager(this);\n    if (delegate.pdf)\n      this.pdf = delegate.pdf.bind(delegate);\n    this.coverage = delegate.coverage ? delegate.coverage() : null;\n    this.selectors = browserContext.selectors();\n  }\n\n  async initOpener(opener: PageDelegate | null) {\n    if (!opener)\n      return;\n    const openerPage = await opener.pageOrError();\n    if (openerPage instanceof Page && !openerPage.isClosed())\n      this._opener = openerPage;\n  }\n\n  reportAsNew(error?: Error) {\n    if (error) {\n      // Initialization error could have happened because of\n      // context/browser closure. Just ignore the page.\n      if (this._browserContext.isClosingOrClosed())\n        return;\n      this._setIsError(error);\n    }\n    this._initialized = true;\n    this._browserContext.emit(BrowserContext.Events.Page, this);\n    // I may happen that page iniatialization finishes after Close event has already been sent,\n    // in that case we fire another Close event to ensure that each reported Page will have\n    // corresponding Close event after it is reported on the context.\n    if (this.isClosed())\n      this.emit(Page.Events.Close);\n  }\n\n  initializedOrUndefined() {\n    return this._initialized ? this : undefined;\n  }\n\n  async _doSlowMo() {\n    const slowMo = this._browserContext._browser.options.slowMo;\n    if (!slowMo)\n      return;\n    await new Promise(x => setTimeout(x, slowMo));\n  }\n\n  _didClose() {\n    this._frameManager.dispose();\n    assert(this._closedState !== 'closed', 'Page closed twice');\n    this._closedState = 'closed';\n    this.emit(Page.Events.Close);\n    this._closedCallback();\n  }\n\n  _didCrash() {\n    this._frameManager.dispose();\n    this.emit(Page.Events.Crash);\n    this._crashedCallback(new Error('Page crashed'));\n  }\n\n  _didDisconnect() {\n    this._frameManager.dispose();\n    assert(!this._disconnected, 'Page disconnected twice');\n    this._disconnected = true;\n    this._disconnectedCallback(new Error('Page closed'));\n  }\n\n  async _onFileChooserOpened(handle: dom.ElementHandle) {\n    let multiple;\n    try {\n      multiple = await handle.evaluate(element => !!(element as HTMLInputElement).multiple);\n    } catch (e) {\n      // Frame/context may be gone during async processing. Do not throw.\n      return;\n    }\n    if (!this.listenerCount(Page.Events.FileChooser)) {\n      handle.dispose();\n      return;\n    }\n    const fileChooser = new FileChooser(this, handle, multiple);\n    this.emit(Page.Events.FileChooser, fileChooser);\n  }\n\n  context(): BrowserContext {\n    return this._browserContext;\n  }\n\n  opener(): Page | undefined {\n    return this._opener;\n  }\n\n  mainFrame(): frames.Frame {\n    return this._frameManager.mainFrame();\n  }\n\n  frames(): frames.Frame[] {\n    return this._frameManager.frames();\n  }\n\n  setDefaultNavigationTimeout(timeout: number) {\n    this._timeoutSettings.setDefaultNavigationTimeout(timeout);\n  }\n\n  setDefaultTimeout(timeout: number) {\n    this._timeoutSettings.setDefaultTimeout(timeout);\n  }\n\n  async exposeBinding(name: string, needsHandle: boolean, playwrightBinding: frames.FunctionWithSource, world: types.World = 'main') {\n    const identifier = PageBinding.identifier(name, world);\n    if (this._pageBindings.has(identifier))\n      throw new Error(`Function \"${name}\" has been already registered`);\n    if (this._browserContext._pageBindings.has(identifier))\n      throw new Error(`Function \"${name}\" has been already registered in the browser context`);\n    const binding = new PageBinding(name, playwrightBinding, needsHandle, world);\n    this._pageBindings.set(identifier, binding);\n    await this._delegate.exposeBinding(binding);\n  }\n\n  setExtraHTTPHeaders(headers: types.HeadersArray) {\n    this._state.extraHTTPHeaders = headers;\n    return this._delegate.updateExtraHTTPHeaders();\n  }\n\n  async _onBindingCalled(payload: string, context: dom.FrameExecutionContext) {\n    if (this._disconnected || this._closedState === 'closed')\n      return;\n    await PageBinding.dispatch(this, payload, context);\n  }\n\n  _addConsoleMessage(type: string, args: js.JSHandle[], location: types.ConsoleMessageLocation, text?: string) {\n    const message = new ConsoleMessage(this, type, text, args, location);\n    const intercepted = this._frameManager.interceptConsoleMessage(message);\n    if (intercepted || !this.listenerCount(Page.Events.Console))\n      args.forEach(arg => arg.dispose());\n    else\n      this.emit(Page.Events.Console, message);\n  }\n\n  async reload(metadata: CallMetadata, options: types.NavigateOptions): Promise<network.Response | null> {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(progress => this.mainFrame().raceNavigationAction(async () => {\n      // Note: waitForNavigation may fail before we get response to reload(),\n      // so we should await it immediately.\n      const [response] = await Promise.all([\n        this.mainFrame()._waitForNavigation(progress, options),\n        this._delegate.reload(),\n      ]);\n      await this._doSlowMo();\n      return response;\n    }), this._timeoutSettings.navigationTimeout(options));\n  }\n\n  async goBack(metadata: CallMetadata, options: types.NavigateOptions): Promise<network.Response | null> {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(progress => this.mainFrame().raceNavigationAction(async () => {\n      // Note: waitForNavigation may fail before we get response to goBack,\n      // so we should catch it immediately.\n      let error: Error | undefined;\n      const waitPromise = this.mainFrame()._waitForNavigation(progress, options).catch(e => {\n        error = e;\n        return null;\n      });\n      const result = await this._delegate.goBack();\n      if (!result)\n        return null;\n      const response = await waitPromise;\n      if (error)\n        throw error;\n      await this._doSlowMo();\n      return response;\n    }), this._timeoutSettings.navigationTimeout(options));\n  }\n\n  async goForward(metadata: CallMetadata, options: types.NavigateOptions): Promise<network.Response | null> {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(progress => this.mainFrame().raceNavigationAction(async () => {\n      // Note: waitForNavigation may fail before we get response to goForward,\n      // so we should catch it immediately.\n      let error: Error | undefined;\n      const waitPromise = this.mainFrame()._waitForNavigation(progress, options).catch(e => {\n        error = e;\n        return null;\n      });\n      const result = await this._delegate.goForward();\n      if (!result)\n        return null;\n      const response = await waitPromise;\n      if (error)\n        throw error;\n      await this._doSlowMo();\n      return response;\n    }), this._timeoutSettings.navigationTimeout(options));\n  }\n\n  async emulateMedia(options: { media?: types.MediaType | null, colorScheme?: types.ColorScheme | null, reducedMotion?: types.ReducedMotion | null }) {\n    if (options.media !== undefined)\n      this._state.mediaType = options.media;\n    if (options.colorScheme !== undefined)\n      this._state.colorScheme = options.colorScheme;\n    if (options.reducedMotion !== undefined)\n      this._state.reducedMotion = options.reducedMotion;\n    await this._delegate.updateEmulateMedia();\n    await this._doSlowMo();\n  }\n\n  async setViewportSize(viewportSize: types.Size) {\n    this._state.emulatedSize = { viewport: { ...viewportSize }, screen: { ...viewportSize } };\n    await this._delegate.setEmulatedSize(this._state.emulatedSize);\n    await this._doSlowMo();\n  }\n\n  viewportSize(): types.Size | null {\n    return this._state.emulatedSize?.viewport || null;\n  }\n\n  async bringToFront(): Promise<void> {\n    await this._delegate.bringToFront();\n  }\n\n  async _addInitScriptExpression(source: string) {\n    this._evaluateOnNewDocumentSources.push(source);\n    await this._delegate.evaluateOnNewDocument(source);\n  }\n\n  _needsRequestInterception(): boolean {\n    return !!this._clientRequestInterceptor || !!this._serverRequestInterceptor || !!this._browserContext._requestInterceptor;\n  }\n\n  async _setClientRequestInterceptor(handler: network.RouteHandler | undefined): Promise<void> {\n    this._clientRequestInterceptor = handler;\n    await this._delegate.updateRequestInterception();\n  }\n\n  async _setServerRequestInterceptor(handler: network.RouteHandler | undefined): Promise<void> {\n    this._serverRequestInterceptor = handler;\n    await this._delegate.updateRequestInterception();\n  }\n\n  _requestStarted(request: network.Request, routeDelegate: network.RouteDelegate) {\n    const route = new network.Route(request, routeDelegate);\n    if (this._serverRequestInterceptor) {\n      this._serverRequestInterceptor(route, request);\n      return;\n    }\n    if (this._clientRequestInterceptor) {\n      this._clientRequestInterceptor(route, request);\n      return;\n    }\n    if (this._browserContext._requestInterceptor) {\n      this._browserContext._requestInterceptor(route, request);\n      return;\n    }\n    route.continue();\n  }\n\n  async screenshot(metadata: CallMetadata, options: types.ScreenshotOptions = {}): Promise<Buffer> {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(\n        progress => this._screenshotter.screenshotPage(progress, options),\n        this._timeoutSettings.timeout(options));\n  }\n\n  async close(metadata: CallMetadata, options?: { runBeforeUnload?: boolean }) {\n    if (this._closedState === 'closed')\n      return;\n    const runBeforeUnload = !!options && !!options.runBeforeUnload;\n    if (this._closedState !== 'closing') {\n      this._closedState = 'closing';\n      assert(!this._disconnected, 'Protocol error: Connection closed. Most likely the page has been closed.');\n      // This might throw if the browser context containing the page closes\n      // while we are trying to close the page.\n      await this._delegate.closePage(runBeforeUnload).catch(e => debugLogger.log('error', e));\n    }\n    if (!runBeforeUnload)\n      await this._closedPromise;\n    if (this._ownedContext)\n      await this._ownedContext.close(metadata);\n  }\n\n  private _setIsError(error: Error) {\n    this._pageIsError = error;\n    if (!this._frameManager.mainFrame())\n      this._frameManager.frameAttached('<dummy>', null);\n  }\n\n  isClosed(): boolean {\n    return this._closedState === 'closed';\n  }\n\n  _addWorker(workerId: string, worker: Worker) {\n    this._workers.set(workerId, worker);\n    this.emit(Page.Events.Worker, worker);\n  }\n\n  _removeWorker(workerId: string) {\n    const worker = this._workers.get(workerId);\n    if (!worker)\n      return;\n    worker.emit(Worker.Events.Close, worker);\n    this._workers.delete(workerId);\n  }\n\n  _clearWorkers() {\n    for (const [workerId, worker] of this._workers) {\n      worker.emit(Worker.Events.Close, worker);\n      this._workers.delete(workerId);\n    }\n  }\n\n  async _setFileChooserIntercepted(enabled: boolean): Promise<void> {\n    await this._delegate.setFileChooserIntercepted(enabled);\n  }\n\n  frameNavigatedToNewDocument(frame: frames.Frame) {\n    this.emit(Page.Events.InternalFrameNavigatedToNewDocument, frame);\n    const url = frame.url();\n    if (!url.startsWith('http'))\n      return;\n    const purl = network.parsedURL(url);\n    if (purl)\n      this._browserContext.addVisitedOrigin(purl.origin);\n  }\n\n  allBindings() {\n    return [...this._browserContext._pageBindings.values(), ...this._pageBindings.values()];\n  }\n\n  getBinding(name: string, world: types.World) {\n    const identifier = PageBinding.identifier(name, world);\n    return this._pageBindings.get(identifier) || this._browserContext._pageBindings.get(identifier);\n  }\n\n  setScreencastOptions(options: { width: number, height: number, quality: number } | null) {\n    this._delegate.setScreencastOptions(options).catch(e => debugLogger.log('error', e));\n  }\n\n  firePageError(error: Error) {\n    this.emit(Page.Events.PageError, error);\n  }\n\n  parseSelector(selector: string, options?: types.StrictOptions): SelectorInfo {\n    const strict = typeof options?.strict === 'boolean' ? options.strict : !!this.context()._options.strictSelectors;\n    return this.selectors.parseSelector(selector, strict);\n  }\n}\n\nexport class Worker extends SdkObject {\n  static Events = {\n    Close: 'close',\n  };\n\n  private _url: string;\n  private _executionContextPromise: Promise<js.ExecutionContext>;\n  private _executionContextCallback: (value: js.ExecutionContext) => void;\n  _existingExecutionContext: js.ExecutionContext | null = null;\n\n  constructor(parent: SdkObject, url: string) {\n    super(parent, 'worker');\n    this._url = url;\n    this._executionContextCallback = () => {};\n    this._executionContextPromise = new Promise(x => this._executionContextCallback = x);\n  }\n\n  _createExecutionContext(delegate: js.ExecutionContextDelegate) {\n    this._existingExecutionContext = new js.ExecutionContext(this, delegate);\n    this._executionContextCallback(this._existingExecutionContext);\n  }\n\n  url(): string {\n    return this._url;\n  }\n\n  async evaluateExpression(expression: string, isFunction: boolean | undefined, arg: any): Promise<any> {\n    return js.evaluateExpression(await this._executionContextPromise, true /* returnByValue */, expression, isFunction, arg);\n  }\n\n  async evaluateExpressionHandle(expression: string, isFunction: boolean | undefined, arg: any): Promise<any> {\n    return js.evaluateExpression(await this._executionContextPromise, false /* returnByValue */, expression, isFunction, arg);\n  }\n}\n\nexport class PageBinding {\n  readonly name: string;\n  readonly playwrightFunction: frames.FunctionWithSource;\n  readonly source: string;\n  readonly needsHandle: boolean;\n  readonly world: types.World;\n\n  constructor(name: string, playwrightFunction: frames.FunctionWithSource, needsHandle: boolean, world: types.World) {\n    this.name = name;\n    this.playwrightFunction = playwrightFunction;\n    this.source = `(${addPageBinding.toString()})(${JSON.stringify(name)}, ${needsHandle})`;\n    this.needsHandle = needsHandle;\n    this.world = world;\n  }\n\n  static identifier(name: string, world: types.World) {\n    return world + ':' + name;\n  }\n\n  static async dispatch(page: Page, payload: string, context: dom.FrameExecutionContext) {\n    const {name, seq, args} = JSON.parse(payload);\n    try {\n      assert(context.world);\n      const binding = page.getBinding(name, context.world)!;\n      let result: any;\n      if (binding.needsHandle) {\n        const handle = await context.evaluateHandle(takeHandle, { name, seq }).catch(e => null);\n        result = await binding.playwrightFunction({ frame: context.frame, page, context: page._browserContext }, handle);\n      } else {\n        result = await binding.playwrightFunction({ frame: context.frame, page, context: page._browserContext }, ...args);\n      }\n      context.evaluate(deliverResult, { name, seq, result }).catch(e => debugLogger.log('error', e));\n    } catch (error) {\n      if (isError(error))\n        context.evaluate(deliverError, { name, seq, message: error.message, stack: error.stack }).catch(e => debugLogger.log('error', e));\n      else\n        context.evaluate(deliverErrorValue, { name, seq, error }).catch(e => debugLogger.log('error', e));\n    }\n\n    function takeHandle(arg: { name: string, seq: number }) {\n      const handle = (globalThis as any)[arg.name]['handles'].get(arg.seq);\n      (globalThis as any)[arg.name]['handles'].delete(arg.seq);\n      return handle;\n    }\n\n    function deliverResult(arg: { name: string, seq: number, result: any }) {\n      (globalThis as any)[arg.name]['callbacks'].get(arg.seq).resolve(arg.result);\n      (globalThis as any)[arg.name]['callbacks'].delete(arg.seq);\n    }\n\n    function deliverError(arg: { name: string, seq: number, message: string, stack: string | undefined }) {\n      const error = new Error(arg.message);\n      error.stack = arg.stack;\n      (globalThis as any)[arg.name]['callbacks'].get(arg.seq).reject(error);\n      (globalThis as any)[arg.name]['callbacks'].delete(arg.seq);\n    }\n\n    function deliverErrorValue(arg: { name: string, seq: number, error: any }) {\n      (globalThis as any)[arg.name]['callbacks'].get(arg.seq).reject(arg.error);\n      (globalThis as any)[arg.name]['callbacks'].delete(arg.seq);\n    }\n  }\n}\n\nfunction addPageBinding(bindingName: string, needsHandle: boolean) {\n  const binding = (globalThis as any)[bindingName];\n  if (binding.__installed)\n    return;\n  (globalThis as any)[bindingName] = (...args: any[]) => {\n    const me = (globalThis as any)[bindingName];\n    if (needsHandle && args.slice(1).some(arg => arg !== undefined))\n      throw new Error(`exposeBindingHandle supports a single argument, ${args.length} received`);\n    let callbacks = me['callbacks'];\n    if (!callbacks) {\n      callbacks = new Map();\n      me['callbacks'] = callbacks;\n    }\n    const seq = (me['lastSeq'] || 0) + 1;\n    me['lastSeq'] = seq;\n    let handles = me['handles'];\n    if (!handles) {\n      handles = new Map();\n      me['handles'] = handles;\n    }\n    const promise = new Promise((resolve, reject) => callbacks.set(seq, {resolve, reject}));\n    if (needsHandle) {\n      handles.set(seq, args[0]);\n      binding(JSON.stringify({name: bindingName, seq}));\n    } else {\n      binding(JSON.stringify({name: bindingName, seq, args}));\n    }\n    return promise;\n  };\n  (globalThis as any)[bindingName].__installed = true;\n}\n"],"file":"page.js"}