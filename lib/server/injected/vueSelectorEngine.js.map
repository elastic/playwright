{"version":3,"sources":["../../../src/server/injected/vueSelectorEngine.ts"],"names":["basename","filename","ext","normalized","replace","result","substring","lastIndexOf","endsWith","length","toUpper","_","c","toUpperCase","classifyRE","classify","str","buildComponentsTreeVue3","instance","getComponentTypeName","options","name","_componentTag","__playwright_guessedName","file","__file","saveComponentName","key","type","getInstanceName","root","parent","components","appContext","isBeingDestroyed","_isBeingDestroyed","isUnmounted","isFragment","subTree","toString","getInternalInstanceChildren","list","component","push","suspense","activeBranch","Array","isArray","children","forEach","childSubTree","filter","child","devtools","hide","getRootElementsFromComponentInstance","getFragmentRootElements","el","vnode","i","l","childVnode","buildComponentsTree","map","rootElements","props","buildComponentsTreeVue2","getComponentName","displayName","$options","fnOptions","$root","$children","$el","_props","filterComponentsTree","treeNode","searchFn","findVueRoot","walker","document","createTreeWalker","nextNode","currentNode","_vnode","version","__vue__","undefined","VueEngine","queryAll","scope","selector","attributes","vueRoot","tree","treeNodes","some","rootElement","contains","attr","allRootElements","Set","add"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { SelectorEngine, SelectorRoot } from './selectorEngine';\nimport { checkComponentAttribute, parseComponentSelector } from '../common/componentUtils';\n\ntype ComponentNode = {\n  name: string,\n  children: ComponentNode[],\n  rootElements: Element[],\n  props: any,\n};\n\ntype VueVNode = {\n  // Vue3\n  type: any,\n  root?: any,\n  parent?: VueVNode,\n  appContext?: any,\n  _isBeingDestroyed?: any,\n  isUnmounted?: any,\n  subTree: any,\n  props: any,\n\n  // Vue2\n  $children?: VueVNode[],\n  fnOptions?: any,\n  $options?: any,\n  $root?: VueVNode,\n  $el?: Element,\n  _props: any,\n};\n\n// @see https://github.com/vuejs/devtools/blob/14085e25313bcf8ffcb55f9092a40bc0fe3ac11c/packages/shared-utils/src/util.ts#L295\nfunction basename(filename: string, ext: string): string {\n  const normalized = filename.replace(/^[a-zA-Z]:/, '').replace(/\\\\/g, '/');\n  let result = normalized.substring(normalized.lastIndexOf('/') + 1);\n  if (ext && result.endsWith(ext))\n    result = result.substring(0, result.length - ext.length);\n  return result;\n}\n\n// @see https://github.com/vuejs/devtools/blob/14085e25313bcf8ffcb55f9092a40bc0fe3ac11c/packages/shared-utils/src/util.ts#L41\nfunction toUpper(_: any, c: string): string {\n  return c ? c.toUpperCase() : '';\n}\n\n// @see https://github.com/vuejs/devtools/blob/14085e25313bcf8ffcb55f9092a40bc0fe3ac11c/packages/shared-utils/src/util.ts#L23\nconst classifyRE = /(?:^|[-_/])(\\w)/g;\nconst classify = (str: string) => {\n  return str && str.replace(classifyRE, toUpper);\n};\n\nfunction buildComponentsTreeVue3(instance: VueVNode): ComponentNode {\n  // @see https://github.com/vuejs/devtools/blob/e7132f3392b975e39e1d9a23cf30456c270099c2/packages/app-backend-vue3/src/components/util.ts#L47\n  function getComponentTypeName(options: any): string|undefined {\n    const name = options.name || options._componentTag || options.__playwright_guessedName;\n    if (name)\n      return name;\n    const file = options.__file; // injected by vue-loader\n    if (file)\n      return classify(basename(file, '.vue'));\n  }\n\n  // @see https://github.com/vuejs/devtools/blob/e7132f3392b975e39e1d9a23cf30456c270099c2/packages/app-backend-vue3/src/components/util.ts#L42\n  function saveComponentName(instance: VueVNode, key: string): string {\n    instance.type.__playwright_guessedName = key;\n    return key;\n  }\n\n  // @see https://github.com/vuejs/devtools/blob/e7132f3392b975e39e1d9a23cf30456c270099c2/packages/app-backend-vue3/src/components/util.ts#L29\n  function getInstanceName(instance: VueVNode): string {\n    const name = getComponentTypeName(instance.type || {});\n    if (name) return name;\n    if (instance.root === instance) return 'Root';\n    for (const key in instance.parent?.type?.components)\n      if (instance.parent?.type.components[key] === instance.type) return saveComponentName(instance, key);\n    for (const key in instance.appContext?.components)\n      if (instance.appContext.components[key] === instance.type) return saveComponentName(instance, key);\n    return 'Anonymous Component';\n  }\n\n  // @see https://github.com/vuejs/devtools/blob/e7132f3392b975e39e1d9a23cf30456c270099c2/packages/app-backend-vue3/src/components/util.ts#L6\n  function isBeingDestroyed(instance: VueVNode): boolean {\n    return instance._isBeingDestroyed || instance.isUnmounted;\n  }\n\n  // @see https://github.com/vuejs/devtools/blob/e7132f3392b975e39e1d9a23cf30456c270099c2/packages/app-backend-vue3/src/components/util.ts#L16\n  function isFragment(instance: VueVNode): boolean {\n    return instance.subTree.type.toString() === 'Symbol(Fragment)';\n  }\n\n  // @see https://github.com/vuejs/devtools/blob/e7132f3392b975e39e1d9a23cf30456c270099c2/packages/app-backend-vue3/src/components/tree.ts#L79\n  function getInternalInstanceChildren(subTree: any): VueVNode[] {\n    const list = [];\n    if (subTree.component)\n      list.push(subTree.component);\n    if (subTree.suspense)\n      list.push(...getInternalInstanceChildren(subTree.suspense.activeBranch));\n    if (Array.isArray(subTree.children)) {\n      subTree.children.forEach((childSubTree: any) => {\n        if (childSubTree.component)\n          list.push(childSubTree.component);\n        else\n          list.push(...getInternalInstanceChildren(childSubTree));\n      });\n    }\n    return list.filter(child => !isBeingDestroyed(child) && !child.type.devtools?.hide);\n  }\n\n  // @see https://github.com/vuejs/devtools/blob/e7132f3392b975e39e1d9a23cf30456c270099c2/packages/app-backend-vue3/src/components/el.ts#L8\n  function getRootElementsFromComponentInstance(instance: VueVNode): Element[] {\n    if (isFragment(instance))\n      return getFragmentRootElements(instance.subTree);\n    return [instance.subTree.el];\n  }\n\n  // @see https://github.com/vuejs/devtools/blob/e7132f3392b975e39e1d9a23cf30456c270099c2/packages/app-backend-vue3/src/components/el.ts#L15\n  function getFragmentRootElements(vnode: any): Element[] {\n    if (!vnode.children) return [];\n\n    const list = [];\n\n    for (let i = 0, l = vnode.children.length; i < l; i++) {\n      const childVnode = vnode.children[i];\n      if (childVnode.component)\n        list.push(...getRootElementsFromComponentInstance(childVnode.component));\n      else if (childVnode.el)\n        list.push(childVnode.el);\n    }\n    return list;\n  }\n\n  function buildComponentsTree(instance: VueVNode): ComponentNode {\n    return {\n      name: getInstanceName(instance),\n      children: getInternalInstanceChildren(instance.subTree).map(buildComponentsTree),\n      rootElements: getRootElementsFromComponentInstance(instance),\n      props: instance.props,\n    };\n  }\n\n  return buildComponentsTree(instance);\n}\n\nfunction buildComponentsTreeVue2(instance: VueVNode): ComponentNode {\n  // @see https://github.com/vuejs/devtools/blob/e7132f3392b975e39e1d9a23cf30456c270099c2/packages/shared-utils/src/util.ts#L302\n  function getComponentName(options: any): string|undefined {\n    const name = options.displayName || options.name || options._componentTag;\n    if (name)\n      return name;\n    const file = options.__file; // injected by vue-loader\n    if (file)\n      return classify(basename(file, '.vue'));\n  }\n\n  // @see https://github.com/vuejs/devtools/blob/e7132f3392b975e39e1d9a23cf30456c270099c2/packages/app-backend-vue2/src/components/util.ts#L10\n  function getInstanceName(instance: VueVNode): string {\n    const name = getComponentName(instance.$options || instance.fnOptions || {});\n    if (name)\n      return name;\n    return instance.$root === instance ? 'Root' : 'Anonymous Component';\n  }\n\n  // @see https://github.com/vuejs/devtools/blob/14085e25313bcf8ffcb55f9092a40bc0fe3ac11c/packages/app-backend-vue2/src/components/tree.ts#L103\n  function getInternalInstanceChildren(instance: VueVNode): VueVNode[] {\n    if (instance.$children)\n      return instance.$children;\n    if (Array.isArray(instance.subTree.children))\n      return instance.subTree.children.filter((vnode: any) => !!vnode.component).map((vnode: any) => vnode.component);\n    return [];\n  }\n\n  function buildComponentsTree(instance: VueVNode): ComponentNode {\n    return {\n      name: getInstanceName(instance),\n      children: getInternalInstanceChildren(instance).map(buildComponentsTree),\n      rootElements: [instance.$el!],\n      props: instance._props,\n    };\n  }\n\n  return buildComponentsTree(instance);\n}\n\nfunction filterComponentsTree(treeNode: ComponentNode, searchFn: (node: ComponentNode) => boolean, result: ComponentNode[] = []): ComponentNode[] {\n  if (searchFn(treeNode))\n    result.push(treeNode);\n  for (const child of treeNode.children)\n    filterComponentsTree(child, searchFn, result);\n  return result;\n}\n\nfunction findVueRoot(): undefined|{version: number, root: VueVNode} {\n  const walker = document.createTreeWalker(document);\n  while (walker.nextNode()) {\n    // Vue3 root\n    if ((walker.currentNode as any)._vnode && (walker.currentNode as any)._vnode.component)\n      return {root: (walker.currentNode as any)._vnode.component, version: 3};\n    // Vue2 root\n    if ((walker.currentNode as any).__vue__)\n      return {root: (walker.currentNode as any).__vue__, version: 2};\n  }\n  return undefined;\n}\n\nexport const VueEngine: SelectorEngine = {\n  queryAll(scope: SelectorRoot, selector: string): Element[] {\n    const {name, attributes} = parseComponentSelector(selector);\n    const vueRoot = findVueRoot();\n    if (!vueRoot)\n      return [];\n    const tree = vueRoot.version === 3 ? buildComponentsTreeVue3(vueRoot.root) : buildComponentsTreeVue2(vueRoot.root);\n    const treeNodes = filterComponentsTree(tree, treeNode => {\n      if (name && treeNode.name !== name)\n        return false;\n      if (treeNode.rootElements.some(rootElement => !scope.contains(rootElement)))\n        return false;\n      for (const attr of attributes) {\n        if (!checkComponentAttribute(treeNode.props, attr))\n          return false;\n      }\n\n      return true;\n    });\n    const allRootElements: Set<Element> = new Set();\n    for (const treeNode of treeNodes) {\n      for (const rootElement of treeNode.rootElements)\n        allRootElements.add(rootElement);\n    }\n    return [...allRootElements];\n  }\n};\n"],"file":"vueSelectorEngine.js"}