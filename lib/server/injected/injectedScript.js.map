{"version":3,"sources":["../../../src/server/injected/injectedScript.ts"],"names":["InjectedScript","constructor","stableRafCount","replaceRafWithTimeout","customEngines","_engines","_evaluator","_stableRafCount","_replaceRafWithTimeout","SelectorEvaluatorImpl","Map","set","XPathEngine","ReactEngine","VueEngine","_createTextEngine","_createAttributeEngine","_createCSSEngine","queryAll","name","engine","parseSelector","selector","result","part","parts","has","Error","querySelector","root","strict","begin","_querySelectorRecursively","element","capture","undefined","length","end","roots","index","queryCache","filtered","body","slice","nth","Set","add","size","visible","Boolean","filter","match","queryResults","get","all","_queryEngineAll","push","querySelectorAll","r","attribute","shadow","toCSS","css","JSON","stringify","simples","functions","combinator","query","scope","pierceShadow","evaluator","queryList","matcher","kind","createTextMatcher","lastDidNotMatchSelf","appendElement","contains","matches","nodeType","Node","ELEMENT_NODE","elements","_queryCSS","extend","source","params","constrFunction","global","eval","isVisible","pollRaf","predicate","_runAbortableTask","progress","fulfill","reject","Promise","f","onRaf","aborted","continuePolling","Symbol","success","requestAnimationFrame","e","log","message","pollInterval","onTimeout","setTimeout","task","unsentLogs","takeNextLogsCallback","taskFinished","logReady","takeNextLogs","lastLog","logRepeating","run","finally","cancel","takeLastLogs","getElementBorderWidth","node","ownerDocument","defaultView","left","top","style","getComputedStyle","parseInt","borderLeftWidth","borderTopWidth","retarget","behavior","parentElement","closest","isContentEditable","nodeName","control","waitForElementStatesAndPerformAction","states","force","callback","lastRect","counter","samePositionCounter","lastTime","state","checkElementState","time","performance","now","clientRect","getBoundingClientRect","rect","x","y","width","height","samePosition","isStable","isStableForLogs","includes","isConnected","disabled","hasAttribute","editable","getAttribute","type","toLowerCase","checked","selectOptions","optionsToSelect","select","options","selectedOptions","remainingOptionsToSelect","option","optionToSelect","value","label","some","multiple","o","forEach","selected","dispatchEvent","Event","map","fill","input","kDateTypes","kTextInputTypes","trim","isNaN","Number","focus","selectText","textarea","selectionStart","selectionEnd","range","createRange","selectNodeContents","selection","getSelection","removeAllRanges","addRange","focusNode","resetSelectionIfNotFocused","wasFocused","getRootNode","activeElement","hasFocus","setSelectionRange","setInputFiles","payloads","files","file","bytes","Uint8Array","from","atob","buffer","c","charCodeAt","File","mimeType","dt","DataTransfer","items","checkHitTargetAt","point","hitElement","deepElementFromPoint","document","hitParents","hitTargetDescription","previewNode","rootHitTargetDescription","indexOf","eventInit","event","bubbles","cancelable","composed","eventType","MouseEvent","KeyboardEvent","TouchEvent","PointerEvent","FocusEvent","DragEvent","container","elementsFromPoint","innerElement","shadowRoot","TEXT_NODE","oneLine","nodeValue","attrs","i","attributes","booleanAttributes","sort","a","b","attrText","join","substring","autoClosingTags","children","childNodes","onlyText","text","textContent","s","replace","unescape","lastIndexOf","lastSlash"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { SelectorEngine, SelectorRoot } from './selectorEngine';\nimport { XPathEngine } from './xpathSelectorEngine';\nimport { ReactEngine } from './reactSelectorEngine';\nimport { VueEngine } from './vueSelectorEngine';\nimport { ParsedSelector, ParsedSelectorPart, parseSelector } from '../common/selectorParser';\nimport { FatalDOMError } from '../common/domErrors';\nimport { SelectorEvaluatorImpl, isVisible, parentElementOrShadowHost, elementMatchesText, TextMatcher, createRegexTextMatcher, createStrictTextMatcher, createLaxTextMatcher } from './selectorEvaluator';\nimport { CSSComplexSelectorList } from '../common/cssParser';\n\ntype Predicate<T> = (progress: InjectedScriptProgress, continuePolling: symbol) => T | symbol;\n\nexport type InjectedScriptProgress = {\n  aborted: boolean,\n  log: (message: string) => void,\n  logRepeating: (message: string) => void,\n};\n\nexport type InjectedScriptPoll<T> = {\n  run: () => Promise<T>,\n  // Takes more logs, waiting until at least one message is available.\n  takeNextLogs: () => Promise<string[]>,\n  // Takes all current logs without waiting.\n  takeLastLogs: () => string[],\n  cancel: () => void,\n};\n\nexport type ElementStateWithoutStable = 'visible' | 'hidden' | 'enabled' | 'disabled' | 'editable' | 'checked';\nexport type ElementState = ElementStateWithoutStable | 'stable';\n\nexport interface SelectorEngineV2 {\n  queryAll(root: SelectorRoot, body: any): Element[];\n}\n\nexport type ElementMatch = {\n  element: Element;\n  capture: Element | undefined;\n};\n\nexport class InjectedScript {\n  private _engines: Map<string, SelectorEngineV2>;\n  _evaluator: SelectorEvaluatorImpl;\n  private _stableRafCount: number;\n  private _replaceRafWithTimeout: boolean;\n\n  constructor(stableRafCount: number, replaceRafWithTimeout: boolean, customEngines: { name: string, engine: SelectorEngine}[]) {\n    this._evaluator = new SelectorEvaluatorImpl(new Map());\n\n    this._engines = new Map();\n    this._engines.set('xpath', XPathEngine);\n    this._engines.set('xpath:light', XPathEngine);\n    this._engines.set('_react', ReactEngine);\n    this._engines.set('_vue', VueEngine);\n    this._engines.set('text', this._createTextEngine(true));\n    this._engines.set('text:light', this._createTextEngine(false));\n    this._engines.set('id', this._createAttributeEngine('id', true));\n    this._engines.set('id:light', this._createAttributeEngine('id', false));\n    this._engines.set('data-testid', this._createAttributeEngine('data-testid', true));\n    this._engines.set('data-testid:light', this._createAttributeEngine('data-testid', false));\n    this._engines.set('data-test-id', this._createAttributeEngine('data-test-id', true));\n    this._engines.set('data-test-id:light', this._createAttributeEngine('data-test-id', false));\n    this._engines.set('data-test', this._createAttributeEngine('data-test', true));\n    this._engines.set('data-test:light', this._createAttributeEngine('data-test', false));\n    this._engines.set('css', this._createCSSEngine());\n    this._engines.set('nth', { queryAll: () => [] });\n    this._engines.set('visible', { queryAll: () => [] });\n\n    for (const { name, engine } of customEngines)\n      this._engines.set(name, engine);\n\n    this._stableRafCount = stableRafCount;\n    this._replaceRafWithTimeout = replaceRafWithTimeout;\n  }\n\n  parseSelector(selector: string): ParsedSelector {\n    const result = parseSelector(selector);\n    for (const part of result.parts) {\n      if (!this._engines.has(part.name))\n        throw new Error(`Unknown engine \"${part.name}\" while parsing selector ${selector}`);\n    }\n    return result;\n  }\n\n  querySelector(selector: ParsedSelector, root: Node, strict: boolean): Element | undefined {\n    if (!(root as any)['querySelector'])\n      throw new Error('Node is not queryable.');\n    this._evaluator.begin();\n    try {\n      const result = this._querySelectorRecursively([{ element: root as Element, capture: undefined }], selector, 0, new Map());\n      if (strict && result.length > 1)\n        throw new Error(`strict mode violation: selector resolved to ${result.length} elements.`);\n      return result[0]?.capture || result[0]?.element;\n    } finally {\n      this._evaluator.end();\n    }\n  }\n\n  private _querySelectorRecursively(roots: ElementMatch[], selector: ParsedSelector, index: number, queryCache: Map<Element, Element[][]>): ElementMatch[] {\n    if (index === selector.parts.length)\n      return roots;\n\n    const part = selector.parts[index];\n    if (part.name === 'nth') {\n      let filtered: ElementMatch[] = [];\n      if (part.body === '0') {\n        filtered = roots.slice(0, 1);\n      } else if (part.body === '-1') {\n        if (roots.length)\n          filtered = roots.slice(roots.length - 1);\n      } else {\n        if (typeof selector.capture === 'number')\n          throw new Error(`Can't query n-th element in a request with the capture.`);\n        const nth = +part.body;\n        const set = new Set<Element>();\n        for (const root of roots) {\n          set.add(root.element);\n          if (nth + 1 === set.size)\n            filtered = [root];\n        }\n      }\n      return this._querySelectorRecursively(filtered, selector, index + 1, queryCache);\n    }\n\n    if (part.name === 'visible') {\n      const visible = Boolean(part.body);\n      return roots.filter(match => visible === isVisible(match.element));\n    }\n\n    const result: ElementMatch[] = [];\n    for (const root of roots) {\n      const capture = index - 1 === selector.capture ? root.element : root.capture;\n\n      // Do not query engine twice for the same element.\n      let queryResults = queryCache.get(root.element);\n      if (!queryResults) {\n        queryResults = [];\n        queryCache.set(root.element, queryResults);\n      }\n      let all = queryResults[index];\n      if (!all) {\n        all = this._queryEngineAll(selector.parts[index], root.element);\n        queryResults[index] = all;\n      }\n\n      for (const element of all)\n        result.push({ element, capture });\n    }\n    return this._querySelectorRecursively(result, selector, index + 1, queryCache);\n  }\n\n  querySelectorAll(selector: ParsedSelector, root: Node): Element[] {\n    if (!(root as any)['querySelectorAll'])\n      throw new Error('Node is not queryable.');\n    this._evaluator.begin();\n    try {\n      const result = this._querySelectorRecursively([{ element: root as Element, capture: undefined }], selector, 0, new Map());\n      const set = new Set<Element>();\n      for (const r of result)\n        set.add(r.capture || r.element);\n      return [...set];\n    } finally {\n      this._evaluator.end();\n    }\n  }\n\n  private _queryEngineAll(part: ParsedSelectorPart, root: SelectorRoot): Element[] {\n    return this._engines.get(part.name)!.queryAll(root, part.body);\n  }\n\n  private _createAttributeEngine(attribute: string, shadow: boolean): SelectorEngine {\n    const toCSS = (selector: string): CSSComplexSelectorList => {\n      const css = `[${attribute}=${JSON.stringify(selector)}]`;\n      return [{ simples: [{ selector: { css, functions: [] }, combinator: '' }] }];\n    };\n    return {\n      queryAll: (root: SelectorRoot, selector: string): Element[] => {\n        return this._evaluator.query({ scope: root as Document | Element, pierceShadow: shadow }, toCSS(selector));\n      }\n    };\n  }\n\n  private _createCSSEngine(): SelectorEngineV2 {\n    const evaluator = this._evaluator;\n    return {\n      queryAll(root: SelectorRoot, body: any) {\n        return evaluator.query({ scope: root as Document | Element, pierceShadow: true }, body);\n      }\n    };\n  }\n\n  private _createTextEngine(shadow: boolean): SelectorEngine {\n    const queryList = (root: SelectorRoot, selector: string): Element[] => {\n      const { matcher, kind } = createTextMatcher(selector);\n      const result: Element[] = [];\n      let lastDidNotMatchSelf: Element | null = null;\n\n      const appendElement = (element: Element) => {\n        // TODO: replace contains() with something shadow-dom-aware?\n        if (kind === 'lax' && lastDidNotMatchSelf && lastDidNotMatchSelf.contains(element))\n          return false;\n        const matches = elementMatchesText(this._evaluator, element, matcher);\n        if (matches === 'none')\n          lastDidNotMatchSelf = element;\n        if (matches === 'self' || (matches === 'selfAndChildren' && kind === 'strict'))\n          result.push(element);\n      };\n\n      if (root.nodeType === Node.ELEMENT_NODE)\n        appendElement(root as Element);\n      const elements = this._evaluator._queryCSS({ scope: root as Document | Element, pierceShadow: shadow }, '*');\n      for (const element of elements)\n        appendElement(element);\n      return result;\n    };\n\n    return {\n      queryAll: (root: SelectorRoot, selector: string): Element[] => {\n        return queryList(root, selector);\n      }\n    };\n  }\n\n  extend(source: string, params: any): any {\n    const constrFunction = global.eval(`\n    (() => {\n      ${source}\n      return pwExport;\n    })()`);\n    return new constrFunction(this, params);\n  }\n\n  isVisible(element: Element): boolean {\n    return isVisible(element);\n  }\n\n  pollRaf<T>(predicate: Predicate<T>): InjectedScriptPoll<T> {\n    return this._runAbortableTask(progress => {\n      let fulfill: (result: T) => void;\n      let reject: (error: Error) => void;\n      const result = new Promise<T>((f, r) => { fulfill = f; reject = r; });\n\n      const onRaf = () => {\n        if (progress.aborted)\n          return;\n        try {\n          const continuePolling = Symbol('continuePolling');\n          const success = predicate(progress, continuePolling);\n          if (success !== continuePolling)\n            fulfill(success as T);\n          else\n            requestAnimationFrame(onRaf);\n        } catch (e) {\n          progress.log('  ' + e.message);\n          reject(e);\n        }\n      };\n\n      onRaf();\n      return result;\n    });\n  }\n\n  pollInterval<T>(pollInterval: number, predicate: Predicate<T>): InjectedScriptPoll<T> {\n    return this._runAbortableTask(progress => {\n      let fulfill: (result: T) => void;\n      let reject: (error: Error) => void;\n      const result = new Promise<T>((f, r) => { fulfill = f; reject = r; });\n\n      const onTimeout = () => {\n        if (progress.aborted)\n          return;\n        try {\n          const continuePolling = Symbol('continuePolling');\n          const success = predicate(progress, continuePolling);\n          if (success !== continuePolling)\n            fulfill(success as T);\n          else\n            setTimeout(onTimeout, pollInterval);\n        } catch (e) {\n          reject(e);\n        }\n      };\n\n      onTimeout();\n      return result;\n    });\n  }\n\n  private _runAbortableTask<T>(task: (progess: InjectedScriptProgress) => Promise<T>): InjectedScriptPoll<T> {\n    let unsentLogs: string[] = [];\n    let takeNextLogsCallback: ((logs: string[]) => void) | undefined;\n    let taskFinished = false;\n    const logReady = () => {\n      if (!takeNextLogsCallback)\n        return;\n      takeNextLogsCallback(unsentLogs);\n      unsentLogs = [];\n      takeNextLogsCallback = undefined;\n    };\n\n    const takeNextLogs = () => new Promise<string[]>(fulfill => {\n      takeNextLogsCallback = fulfill;\n      if (unsentLogs.length || taskFinished)\n        logReady();\n    });\n\n    let lastLog = '';\n    const progress: InjectedScriptProgress = {\n      aborted: false,\n      log: (message: string) => {\n        lastLog = message;\n        unsentLogs.push(message);\n        logReady();\n      },\n      logRepeating: (message: string) => {\n        if (message !== lastLog)\n          progress.log(message);\n      },\n    };\n\n    const run = () => {\n      const result = task(progress);\n\n      // After the task has finished, there should be no more logs.\n      // Release any pending `takeNextLogs` call, and do not block any future ones.\n      // This prevents non-finished protocol evaluation calls and memory leaks.\n      result.finally(() => {\n        taskFinished = true;\n        logReady();\n      });\n\n      return result;\n    };\n\n    return {\n      takeNextLogs,\n      run,\n      cancel: () => { progress.aborted = true; },\n      takeLastLogs: () => unsentLogs,\n    };\n  }\n\n  getElementBorderWidth(node: Node): { left: number; top: number; } {\n    if (node.nodeType !== Node.ELEMENT_NODE || !node.ownerDocument || !node.ownerDocument.defaultView)\n      return { left: 0, top: 0 };\n    const style = node.ownerDocument.defaultView.getComputedStyle(node as Element);\n    return { left: parseInt(style.borderLeftWidth || '', 10), top: parseInt(style.borderTopWidth || '', 10) };\n  }\n\n  retarget(node: Node, behavior: 'follow-label' | 'no-follow-label'): Element | null {\n    let element = node.nodeType === Node.ELEMENT_NODE ? node as Element : node.parentElement;\n    if (!element)\n      return null;\n    if (!element.matches('input, textarea, select'))\n      element = element.closest('button, [role=button], [role=checkbox], [role=radio]') || element;\n    if (behavior === 'follow-label') {\n      if (!element.matches('input, textarea, button, select, [role=button], [role=checkbox], [role=radio]') &&\n          !(element as any).isContentEditable) {\n        // Go up to the label that might be connected to the input/textarea.\n        element = element.closest('label') || element;\n      }\n      if (element.nodeName === 'LABEL')\n        element = (element as HTMLLabelElement).control || element;\n    }\n    return element;\n  }\n\n  waitForElementStatesAndPerformAction<T>(node: Node, states: ElementState[], force: boolean | undefined,\n    callback: (node: Node, progress: InjectedScriptProgress, continuePolling: symbol) => T | symbol): InjectedScriptPoll<T | 'error:notconnected' | FatalDOMError> {\n    let lastRect: { x: number, y: number, width: number, height: number } | undefined;\n    let counter = 0;\n    let samePositionCounter = 0;\n    let lastTime = 0;\n\n    const predicate = (progress: InjectedScriptProgress, continuePolling: symbol) => {\n      if (force) {\n        progress.log(`    forcing action`);\n        return callback(node, progress, continuePolling);\n      }\n\n      for (const state of states) {\n        if (state !== 'stable') {\n          const result = this.checkElementState(node, state);\n          if (typeof result !== 'boolean')\n            return result;\n          if (!result) {\n            progress.logRepeating(`    element is not ${state} - waiting...`);\n            return continuePolling;\n          }\n          continue;\n        }\n\n        const element = this.retarget(node, 'no-follow-label');\n        if (!element)\n          return 'error:notconnected';\n\n        // First raf happens in the same animation frame as evaluation, so it does not produce\n        // any client rect difference compared to synchronous call. We skip the synchronous call\n        // and only force layout during actual rafs as a small optimisation.\n        if (++counter === 1)\n          return continuePolling;\n\n        // Drop frames that are shorter than 16ms - WebKit Win bug.\n        const time = performance.now();\n        if (this._stableRafCount > 1 && time - lastTime < 15)\n          return continuePolling;\n        lastTime = time;\n\n        const clientRect = element.getBoundingClientRect();\n        const rect = { x: clientRect.top, y: clientRect.left, width: clientRect.width, height: clientRect.height };\n        const samePosition = lastRect && rect.x === lastRect.x && rect.y === lastRect.y && rect.width === lastRect.width && rect.height === lastRect.height;\n        if (samePosition)\n          ++samePositionCounter;\n        else\n          samePositionCounter = 0;\n        const isStable = samePositionCounter >= this._stableRafCount;\n        const isStableForLogs = isStable || !lastRect;\n        lastRect = rect;\n        if (!isStableForLogs)\n          progress.logRepeating(`    element is not stable - waiting...`);\n        if (!isStable)\n          return continuePolling;\n      }\n\n      return callback(node, progress, continuePolling);\n    };\n\n    if (this._replaceRafWithTimeout)\n      return this.pollInterval(16, predicate);\n    else\n      return this.pollRaf(predicate);\n  }\n\n  checkElementState(node: Node, state: ElementStateWithoutStable): boolean | 'error:notconnected' | FatalDOMError {\n    const element = this.retarget(node, ['stable', 'visible', 'hidden'].includes(state) ? 'no-follow-label' : 'follow-label');\n    if (!element || !element.isConnected) {\n      if (state === 'hidden')\n        return true;\n      return 'error:notconnected';\n    }\n\n    if (state === 'visible')\n      return this.isVisible(element);\n    if (state === 'hidden')\n      return !this.isVisible(element);\n\n    const disabled = ['BUTTON', 'INPUT', 'SELECT', 'TEXTAREA'].includes(element.nodeName) && element.hasAttribute('disabled');\n    if (state === 'disabled')\n      return disabled;\n    if (state === 'enabled')\n      return !disabled;\n\n    const editable = !(['INPUT', 'TEXTAREA', 'SELECT'].includes(element.nodeName) && element.hasAttribute('readonly'));\n    if (state === 'editable')\n      return !disabled && editable;\n\n    if (state === 'checked') {\n      if (element.getAttribute('role') === 'checkbox')\n        return element.getAttribute('aria-checked') === 'true';\n      if (element.nodeName !== 'INPUT')\n        return 'error:notcheckbox';\n      if (!['radio', 'checkbox'].includes((element as HTMLInputElement).type.toLowerCase()))\n        return 'error:notcheckbox';\n      return (element as HTMLInputElement).checked;\n    }\n    throw new Error(`Unexpected element state \"${state}\"`);\n  }\n\n  selectOptions(optionsToSelect: (Node | { value?: string, label?: string, index?: number })[],\n    node: Node, progress: InjectedScriptProgress, continuePolling: symbol): string[] | 'error:notconnected' | FatalDOMError | symbol {\n    const element = this.retarget(node, 'follow-label');\n    if (!element)\n      return 'error:notconnected';\n    if (element.nodeName.toLowerCase() !== 'select')\n      return 'error:notselect';\n    const select = element as HTMLSelectElement;\n    const options = [...select.options];\n    const selectedOptions = [];\n    let remainingOptionsToSelect = optionsToSelect.slice();\n    for (let index = 0; index < options.length; index++) {\n      const option = options[index];\n      const filter = (optionToSelect: Node | { value?: string, label?: string, index?: number }) => {\n        if (optionToSelect instanceof Node)\n          return option === optionToSelect;\n        let matches = true;\n        if (optionToSelect.value !== undefined)\n          matches = matches && optionToSelect.value === option.value;\n        if (optionToSelect.label !== undefined)\n          matches = matches && optionToSelect.label === option.label;\n        if (optionToSelect.index !== undefined)\n          matches = matches && optionToSelect.index === index;\n        return matches;\n      };\n      if (!remainingOptionsToSelect.some(filter))\n        continue;\n      selectedOptions.push(option);\n      if (select.multiple) {\n        remainingOptionsToSelect = remainingOptionsToSelect.filter(o => !filter(o));\n      } else {\n        remainingOptionsToSelect = [];\n        break;\n      }\n    }\n    if (remainingOptionsToSelect.length) {\n      progress.logRepeating('    did not find some options - waiting... ');\n      return continuePolling;\n    }\n    select.value = undefined as any;\n    selectedOptions.forEach(option => option.selected = true);\n    progress.log('    selected specified option(s)');\n    select.dispatchEvent(new Event('input', { 'bubbles': true }));\n    select.dispatchEvent(new Event('change', { 'bubbles': true }));\n    return selectedOptions.map(option => option.value);\n  }\n\n  fill(value: string, node: Node, progress: InjectedScriptProgress): FatalDOMError | 'error:notconnected' | 'needsinput' | 'done' {\n    const element = this.retarget(node, 'follow-label');\n    if (!element)\n      return 'error:notconnected';\n    if (element.nodeName.toLowerCase() === 'input') {\n      const input = element as HTMLInputElement;\n      const type = input.type.toLowerCase();\n      const kDateTypes = new Set(['date', 'time', 'datetime', 'datetime-local', 'month', 'week']);\n      const kTextInputTypes = new Set(['', 'email', 'number', 'password', 'search', 'tel', 'text', 'url']);\n      if (!kTextInputTypes.has(type) && !kDateTypes.has(type)) {\n        progress.log(`    input of type \"${type}\" cannot be filled`);\n        return 'error:notfillableinputtype';\n      }\n      if (type === 'number') {\n        value = value.trim();\n        if (isNaN(Number(value)))\n          return 'error:notfillablenumberinput';\n      }\n      if (kDateTypes.has(type)) {\n        value = value.trim();\n        input.focus();\n        input.value = value;\n        if (input.value !== value)\n          return 'error:notvaliddate';\n        element.dispatchEvent(new Event('input', { 'bubbles': true }));\n        element.dispatchEvent(new Event('change', { 'bubbles': true }));\n        return 'done';  // We have already changed the value, no need to input it.\n      }\n    } else if (element.nodeName.toLowerCase() === 'textarea') {\n      // Nothing to check here.\n    } else if (!(element as HTMLElement).isContentEditable) {\n      return 'error:notfillableelement';\n    }\n    this.selectText(element);\n    return 'needsinput';  // Still need to input the value.\n  }\n\n  selectText(node: Node): 'error:notconnected' | 'done' {\n    const element = this.retarget(node, 'follow-label');\n    if (!element)\n      return 'error:notconnected';\n    if (element.nodeName.toLowerCase() === 'input') {\n      const input = element as HTMLInputElement;\n      input.select();\n      input.focus();\n      return 'done';\n    }\n    if (element.nodeName.toLowerCase() === 'textarea') {\n      const textarea = element as HTMLTextAreaElement;\n      textarea.selectionStart = 0;\n      textarea.selectionEnd = textarea.value.length;\n      textarea.focus();\n      return 'done';\n    }\n    const range = element.ownerDocument.createRange();\n    range.selectNodeContents(element);\n    const selection = element.ownerDocument.defaultView!.getSelection();\n    if (selection) {\n      selection.removeAllRanges();\n      selection.addRange(range);\n    }\n    (element as HTMLElement | SVGElement).focus();\n    return 'done';\n  }\n\n  focusNode(node: Node, resetSelectionIfNotFocused?: boolean): FatalDOMError | 'error:notconnected' | 'done' {\n    if (!node.isConnected)\n      return 'error:notconnected';\n    if (node.nodeType !== Node.ELEMENT_NODE)\n      return 'error:notelement';\n    const wasFocused = (node.getRootNode() as (Document | ShadowRoot)).activeElement === node && node.ownerDocument && node.ownerDocument.hasFocus();\n    (node as HTMLElement | SVGElement).focus();\n\n    if (resetSelectionIfNotFocused && !wasFocused && node.nodeName.toLowerCase() === 'input') {\n      try {\n        const input = node as HTMLInputElement;\n        input.setSelectionRange(0, 0);\n      } catch (e) {\n        // Some inputs do not allow selection.\n      }\n    }\n    return 'done';\n  }\n\n  setInputFiles(node: Node, payloads: { name: string, mimeType: string, buffer: string }[]) {\n    if (node.nodeType !== Node.ELEMENT_NODE)\n      return 'Node is not of type HTMLElement';\n    const element: Element | undefined = node as Element;\n    if (element.nodeName !== 'INPUT')\n      return 'Not an <input> element';\n    const input = element as HTMLInputElement;\n    const type = (input.getAttribute('type') || '').toLowerCase();\n    if (type !== 'file')\n      return 'Not an input[type=file] element';\n\n    const files = payloads.map(file => {\n      const bytes = Uint8Array.from(atob(file.buffer), c => c.charCodeAt(0));\n      return new File([bytes], file.name, { type: file.mimeType });\n    });\n    const dt = new DataTransfer();\n    for (const file of files)\n      dt.items.add(file);\n    input.files = dt.files;\n    input.dispatchEvent(new Event('input', { 'bubbles': true }));\n    input.dispatchEvent(new Event('change', { 'bubbles': true }));\n  }\n\n  checkHitTargetAt(node: Node, point: { x: number, y: number }): 'error:notconnected' | 'done' | { hitTargetDescription: string } {\n    let element: Element | null | undefined = node.nodeType === Node.ELEMENT_NODE ? (node as Element) : node.parentElement;\n    if (!element || !element.isConnected)\n      return 'error:notconnected';\n    element = element.closest('button, [role=button]') || element;\n    let hitElement = this.deepElementFromPoint(document, point.x, point.y);\n    const hitParents: Element[] = [];\n    while (hitElement && hitElement !== element) {\n      hitParents.push(hitElement);\n      hitElement = parentElementOrShadowHost(hitElement);\n    }\n    if (hitElement === element)\n      return 'done';\n    const hitTargetDescription = this.previewNode(hitParents[0]);\n    // Root is the topmost element in the hitTarget's chain that is not in the\n    // element's chain. For example, it might be a dialog element that overlays\n    // the target.\n    let rootHitTargetDescription: string | undefined;\n    while (element) {\n      const index = hitParents.indexOf(element);\n      if (index !== -1) {\n        if (index > 1)\n          rootHitTargetDescription = this.previewNode(hitParents[index - 1]);\n        break;\n      }\n      element = parentElementOrShadowHost(element);\n    }\n    if (rootHitTargetDescription)\n      return { hitTargetDescription: `${hitTargetDescription} from ${rootHitTargetDescription} subtree` };\n    return { hitTargetDescription };\n  }\n\n  dispatchEvent(node: Node, type: string, eventInit: Object) {\n    let event;\n    eventInit = { bubbles: true, cancelable: true, composed: true, ...eventInit };\n    switch (eventType.get(type)) {\n      case 'mouse': event = new MouseEvent(type, eventInit); break;\n      case 'keyboard': event = new KeyboardEvent(type, eventInit); break;\n      case 'touch': event = new TouchEvent(type, eventInit); break;\n      case 'pointer': event = new PointerEvent(type, eventInit); break;\n      case 'focus': event = new FocusEvent(type, eventInit); break;\n      case 'drag': event = new DragEvent(type, eventInit); break;\n      default: event = new Event(type, eventInit); break;\n    }\n    node.dispatchEvent(event);\n  }\n\n  deepElementFromPoint(document: Document, x: number, y: number): Element | undefined {\n    let container: Document | ShadowRoot | null = document;\n    let element: Element | undefined;\n    while (container) {\n      // elementFromPoint works incorrectly in Chromium (http://crbug.com/1188919),\n      // so we use elementsFromPoint instead.\n      const elements = container.elementsFromPoint(x, y);\n      const innerElement = elements[0] as Element | undefined;\n      if (!innerElement || element === innerElement)\n        break;\n      element = innerElement;\n      container = element.shadowRoot;\n    }\n    return element;\n  }\n\n  previewNode(node: Node): string {\n    if (node.nodeType === Node.TEXT_NODE)\n      return oneLine(`#text=${node.nodeValue || ''}`);\n    if (node.nodeType !== Node.ELEMENT_NODE)\n      return oneLine(`<${node.nodeName.toLowerCase()} />`);\n    const element = node as Element;\n\n    const attrs = [];\n    for (let i = 0; i < element.attributes.length; i++) {\n      const { name, value } = element.attributes[i];\n      if (name === 'style')\n        continue;\n      if (!value && booleanAttributes.has(name))\n        attrs.push(` ${name}`);\n      else\n        attrs.push(` ${name}=\"${value}\"`);\n    }\n    attrs.sort((a, b) => a.length - b.length);\n    let attrText = attrs.join('');\n    if (attrText.length > 50)\n      attrText = attrText.substring(0, 49) + '\\u2026';\n    if (autoClosingTags.has(element.nodeName))\n      return oneLine(`<${element.nodeName.toLowerCase()}${attrText}/>`);\n\n    const children = element.childNodes;\n    let onlyText = false;\n    if (children.length <= 5) {\n      onlyText = true;\n      for (let i = 0; i < children.length; i++)\n        onlyText = onlyText && children[i].nodeType === Node.TEXT_NODE;\n    }\n    let text = onlyText ? (element.textContent || '') : (children.length ? '\\u2026' : '');\n    if (text.length > 50)\n      text = text.substring(0, 49) + '\\u2026';\n    return oneLine(`<${element.nodeName.toLowerCase()}${attrText}>${text}</${element.nodeName.toLowerCase()}>`);\n  }\n}\n\nconst autoClosingTags = new Set(['AREA', 'BASE', 'BR', 'COL', 'COMMAND', 'EMBED', 'HR', 'IMG', 'INPUT', 'KEYGEN', 'LINK', 'MENUITEM', 'META', 'PARAM', 'SOURCE', 'TRACK', 'WBR']);\nconst booleanAttributes = new Set(['checked', 'selected', 'disabled', 'readonly', 'multiple']);\n\nfunction oneLine(s: string): string {\n  return s.replace(/\\n/g, '').replace(/\\t/g, '');\n}\n\nconst eventType = new Map<string, 'mouse'|'keyboard'|'touch'|'pointer'|'focus'|'drag'>([\n  ['auxclick', 'mouse'],\n  ['click', 'mouse'],\n  ['dblclick', 'mouse'],\n  ['mousedown','mouse'],\n  ['mouseeenter', 'mouse'],\n  ['mouseleave', 'mouse'],\n  ['mousemove', 'mouse'],\n  ['mouseout', 'mouse'],\n  ['mouseover', 'mouse'],\n  ['mouseup', 'mouse'],\n  ['mouseleave', 'mouse'],\n  ['mousewheel', 'mouse'],\n\n  ['keydown', 'keyboard'],\n  ['keyup', 'keyboard'],\n  ['keypress', 'keyboard'],\n  ['textInput', 'keyboard'],\n\n  ['touchstart', 'touch'],\n  ['touchmove', 'touch'],\n  ['touchend', 'touch'],\n  ['touchcancel', 'touch'],\n\n  ['pointerover', 'pointer'],\n  ['pointerout', 'pointer'],\n  ['pointerenter', 'pointer'],\n  ['pointerleave', 'pointer'],\n  ['pointerdown', 'pointer'],\n  ['pointerup', 'pointer'],\n  ['pointermove', 'pointer'],\n  ['pointercancel', 'pointer'],\n  ['gotpointercapture', 'pointer'],\n  ['lostpointercapture', 'pointer'],\n\n  ['focus', 'focus'],\n  ['blur', 'focus'],\n\n  ['drag', 'drag'],\n  ['dragstart', 'drag'],\n  ['dragend', 'drag'],\n  ['dragover', 'drag'],\n  ['dragenter', 'drag'],\n  ['dragleave', 'drag'],\n  ['dragexit', 'drag'],\n  ['drop', 'drag'],\n]);\n\nfunction unescape(s: string): string {\n  if (!s.includes('\\\\'))\n    return s;\n  const r: string[] = [];\n  let i = 0;\n  while (i < s.length) {\n    if (s[i] === '\\\\' && i + 1 < s.length)\n      i++;\n    r.push(s[i++]);\n  }\n  return r.join('');\n}\n\nfunction createTextMatcher(selector: string): { matcher: TextMatcher, kind: 'regex' | 'strict' | 'lax' } {\n  if (selector[0] === '/' && selector.lastIndexOf('/') > 0) {\n    const lastSlash = selector.lastIndexOf('/');\n    const matcher: TextMatcher = createRegexTextMatcher(selector.substring(1, lastSlash), selector.substring(lastSlash + 1));\n    return { matcher, kind: 'regex' };\n  }\n  let strict = false;\n  if (selector.length > 1 && selector[0] === '\"' && selector[selector.length - 1] === '\"') {\n    selector = unescape(selector.substring(1, selector.length - 1));\n    strict = true;\n  }\n  if (selector.length > 1 && selector[0] === \"'\" && selector[selector.length - 1] === \"'\") {\n    selector = unescape(selector.substring(1, selector.length - 1));\n    strict = true;\n  }\n  const matcher = strict ? createStrictTextMatcher(selector) : createLaxTextMatcher(selector);\n  return { matcher, kind: strict ? 'strict' : 'lax' };\n}\n\nexport default InjectedScript;\n"],"file":"injectedScript.js"}