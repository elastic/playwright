{"version":3,"sources":["../../src/server/download.ts"],"names":["Download","constructor","page","downloadsPath","uuid","url","suggestedFilename","artifact","_page","_suggestedFilename","unaccessibleErrorMessage","_browserContext","_options","acceptDownloads","undefined","Artifact","path","join","_doCancelDownload","_downloads","add","emit","Page","Events","_filenameSuggested"],"mappings":";;;;;;;AAgBA;;AACA;;AACA;;AACA;;;;AAnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAOO,MAAMA,QAAN,CAAe;AAMpBC,EAAAA,WAAW,CAACC,IAAD,EAAaC,aAAb,EAAoCC,IAApC,EAAkDC,GAAlD,EAA+DC,iBAA/D,EAA2F;AAAA,SAL7FC,QAK6F;AAAA,SAJ7FF,GAI6F;AAAA,SAH9FG,KAG8F;AAAA,SAF9FC,kBAE8F;AACpG,UAAMC,wBAAwB,GAAG,CAACR,IAAI,CAACS,eAAL,CAAqBC,QAArB,CAA8BC,eAA/B,GAAiD,4EAAjD,GAAgIC,SAAjK;AACA,SAAKP,QAAL,GAAgB,IAAIQ,kBAAJ,CAAab,IAAb,EAAmBc,cAAKC,IAAL,CAAUd,aAAV,EAAyBC,IAAzB,CAAnB,EAAmDM,wBAAnD,EAA6E,MAAM;AACjG,aAAO,KAAKF,KAAL,CAAWG,eAAX,CAA2BO,iBAA3B,CAA6Cd,IAA7C,CAAP;AACD,KAFe,CAAhB;AAGA,SAAKI,KAAL,GAAaN,IAAb;AACA,SAAKG,GAAL,GAAWA,GAAX;AACA,SAAKI,kBAAL,GAA0BH,iBAA1B;;AACAJ,IAAAA,IAAI,CAACS,eAAL,CAAqBQ,UAArB,CAAgCC,GAAhC,CAAoC,IAApC;;AACA,QAAId,iBAAiB,KAAKQ,SAA1B,EACE,KAAKN,KAAL,CAAWa,IAAX,CAAgBC,WAAKC,MAAL,CAAYvB,QAA5B,EAAsC,IAAtC;AACH;;AAEDwB,EAAAA,kBAAkB,CAAClB,iBAAD,EAA4B;AAC5C,uBAAO,KAAKG,kBAAL,KAA4BK,SAAnC;AACA,SAAKL,kBAAL,GAA0BH,iBAA1B;;AACA,SAAKE,KAAL,CAAWa,IAAX,CAAgBC,WAAKC,MAAL,CAAYvB,QAA5B,EAAsC,IAAtC;AACD;;AAEDM,EAAAA,iBAAiB,GAAW;AAC1B,WAAO,KAAKG,kBAAZ;AACD;;AA3BmB","sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport path from 'path';\nimport { Page } from './page';\nimport { assert } from '../utils/utils';\nimport { Artifact } from './artifact';\n\nexport class Download {\n  readonly artifact: Artifact;\n  readonly url: string;\n  private _page: Page;\n  private _suggestedFilename: string | undefined;\n\n  constructor(page: Page, downloadsPath: string, uuid: string, url: string, suggestedFilename?: string) {\n    const unaccessibleErrorMessage = !page._browserContext._options.acceptDownloads ? 'Pass { acceptDownloads: true } when you are creating your browser context.' : undefined;\n    this.artifact = new Artifact(page, path.join(downloadsPath, uuid), unaccessibleErrorMessage, () => {\n      return this._page._browserContext._doCancelDownload(uuid);\n    });\n    this._page = page;\n    this.url = url;\n    this._suggestedFilename = suggestedFilename;\n    page._browserContext._downloads.add(this);\n    if (suggestedFilename !== undefined)\n      this._page.emit(Page.Events.Download, this);\n  }\n\n  _filenameSuggested(suggestedFilename: string) {\n    assert(this._suggestedFilename === undefined);\n    this._suggestedFilename = suggestedFilename;\n    this._page.emit(Page.Events.Download, this);\n  }\n\n  suggestedFilename(): string {\n    return this._suggestedFilename!;\n  }\n}\n"],"file":"download.js"}