{"version":3,"sources":["../../src/dispatchers/browserContextDispatcher.ts"],"names":["BrowserContextDispatcher","Dispatcher","constructor","scope","context","isChromium","_browser","options","_context","onVideo","artifact","artifactDispatcher","ArtifactDispatcher","_dispatchEvent","on","BrowserContext","Events","VideoStarted","video","_idToVideo","values","page","pages","PageDispatcher","_scope","Page","Close","_dispose","name","backgroundPages","CRBrowserContext","CREvents","BackgroundPage","serviceWorker","serviceWorkers","worker","WorkerDispatcher","ServiceWorker","Request","request","RequestDispatcher","from","fromNullable","frame","_page","initializedOrUndefined","Response","response","ResponseDispatcher","RequestFailed","failureText","_failureText","responseEndTiming","_responseEndTiming","RequestFinished","setDefaultNavigationTimeoutNoReply","params","setDefaultNavigationTimeout","timeout","setDefaultTimeoutNoReply","setDefaultTimeout","exposeBinding","needsHandle","source","args","binding","BindingCallDispatcher","promise","newPage","metadata","cookies","urls","addCookies","clearCookies","grantPermissions","permissions","origin","clearPermissions","setGeolocation","geolocation","setExtraHTTPHeaders","headers","setOffline","offline","setHTTPCredentials","httpCredentials","addInitScript","_doAddInitScript","setNetworkInterceptionEnabled","enabled","_setRequestInterceptor","undefined","route","RouteDispatcher","storageState","close","recorderSupplementEnable","RecorderSupplement","show","pause","newCDPSession","_object","Error","crBrowserContext","session","CDPSessionDispatcher","tracingStart","tracing","start","tracingStop","stop","tracingExport","export"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { BrowserContext } from '../server/browserContext';\nimport { Dispatcher, DispatcherScope, lookupDispatcher } from './dispatcher';\nimport { PageDispatcher, BindingCallDispatcher, WorkerDispatcher } from './pageDispatcher';\nimport { FrameDispatcher } from './frameDispatcher';\nimport * as channels from '../protocol/channels';\nimport { RouteDispatcher, RequestDispatcher, ResponseDispatcher } from './networkDispatchers';\nimport { CRBrowserContext } from '../server/chromium/crBrowser';\nimport { CDPSessionDispatcher } from './cdpSessionDispatcher';\nimport { RecorderSupplement } from '../server/supplements/recorderSupplement';\nimport { CallMetadata } from '../server/instrumentation';\nimport { ArtifactDispatcher } from './artifactDispatcher';\nimport { Artifact } from '../server/artifact';\nimport { Request, Response } from '../server/network';\n\nexport class BrowserContextDispatcher extends Dispatcher<BrowserContext, channels.BrowserContextInitializer> implements channels.BrowserContextChannel {\n  private _context: BrowserContext;\n\n  constructor(scope: DispatcherScope, context: BrowserContext) {\n    super(scope, context, 'BrowserContext', { isChromium: context._browser.options.isChromium }, true);\n    this._context = context;\n    // Note: when launching persistent context, dispatcher is created very late,\n    // so we can already have pages, videos and everything else.\n\n    const onVideo = (artifact: Artifact) => {\n      // Note: Video must outlive Page and BrowserContext, so that client can saveAs it\n      // after closing the context. We use |scope| for it.\n      const artifactDispatcher = new ArtifactDispatcher(scope, artifact);\n      this._dispatchEvent('video', { artifact: artifactDispatcher });\n    };\n    context.on(BrowserContext.Events.VideoStarted, onVideo);\n    for (const video of context._browser._idToVideo.values()) {\n      if (video.context === context)\n        onVideo(video.artifact);\n    }\n\n    for (const page of context.pages())\n      this._dispatchEvent('page', { page: new PageDispatcher(this._scope, page) });\n    context.on(BrowserContext.Events.Page, page => this._dispatchEvent('page', { page: new PageDispatcher(this._scope, page) }));\n    context.on(BrowserContext.Events.Close, () => {\n      this._dispatchEvent('close');\n      this._dispose();\n    });\n\n    if (context._browser.options.name === 'chromium') {\n      for (const page of (context as CRBrowserContext).backgroundPages())\n        this._dispatchEvent('backgroundPage', { page: new PageDispatcher(this._scope, page) });\n      context.on(CRBrowserContext.CREvents.BackgroundPage, page => this._dispatchEvent('backgroundPage', { page: new PageDispatcher(this._scope, page) }));\n      for (const serviceWorker of (context as CRBrowserContext).serviceWorkers())\n        this._dispatchEvent('serviceWorker', { worker: new WorkerDispatcher(this._scope, serviceWorker)});\n      context.on(CRBrowserContext.CREvents.ServiceWorker, serviceWorker => this._dispatchEvent('serviceWorker', { worker: new WorkerDispatcher(this._scope, serviceWorker) }));\n    }\n    context.on(BrowserContext.Events.Request, (request: Request) =>  {\n      return this._dispatchEvent('request', {\n        request: RequestDispatcher.from(this._scope, request),\n        page: PageDispatcher.fromNullable(this._scope, request.frame()._page.initializedOrUndefined())\n      });\n    });\n    context.on(BrowserContext.Events.Response, (response: Response) => this._dispatchEvent('response', {\n      response: ResponseDispatcher.from(this._scope, response),\n      page: PageDispatcher.fromNullable(this._scope, response.frame()._page.initializedOrUndefined())\n    }));\n    context.on(BrowserContext.Events.RequestFailed, (request: Request) => this._dispatchEvent('requestFailed', {\n      request: RequestDispatcher.from(this._scope, request),\n      failureText: request._failureText,\n      responseEndTiming: request._responseEndTiming,\n      page: PageDispatcher.fromNullable(this._scope, request.frame()._page.initializedOrUndefined())\n    }));\n    context.on(BrowserContext.Events.RequestFinished, (request: Request) => this._dispatchEvent('requestFinished', {\n      request: RequestDispatcher.from(scope, request),\n      responseEndTiming: request._responseEndTiming,\n      page: PageDispatcher.fromNullable(this._scope, request.frame()._page.initializedOrUndefined())\n    }));\n  }\n\n  async setDefaultNavigationTimeoutNoReply(params: channels.BrowserContextSetDefaultNavigationTimeoutNoReplyParams) {\n    this._context.setDefaultNavigationTimeout(params.timeout);\n  }\n\n  async setDefaultTimeoutNoReply(params: channels.BrowserContextSetDefaultTimeoutNoReplyParams) {\n    this._context.setDefaultTimeout(params.timeout);\n  }\n\n  async exposeBinding(params: channels.BrowserContextExposeBindingParams): Promise<void> {\n    await this._context.exposeBinding(params.name, !!params.needsHandle, (source, ...args) => {\n      const binding = new BindingCallDispatcher(this._scope, params.name, !!params.needsHandle, source, args);\n      this._dispatchEvent('bindingCall', { binding });\n      return binding.promise();\n    }, 'main');\n  }\n\n  async newPage(params: channels.BrowserContextNewPageParams, metadata: CallMetadata): Promise<channels.BrowserContextNewPageResult> {\n    return { page: lookupDispatcher<PageDispatcher>(await this._context.newPage(metadata)) };\n  }\n\n  async cookies(params: channels.BrowserContextCookiesParams): Promise<channels.BrowserContextCookiesResult> {\n    return { cookies: await this._context.cookies(params.urls) };\n  }\n\n  async addCookies(params: channels.BrowserContextAddCookiesParams): Promise<void> {\n    await this._context.addCookies(params.cookies);\n  }\n\n  async clearCookies(): Promise<void> {\n    await this._context.clearCookies();\n  }\n\n  async grantPermissions(params: channels.BrowserContextGrantPermissionsParams): Promise<void> {\n    await this._context.grantPermissions(params.permissions, params.origin);\n  }\n\n  async clearPermissions(): Promise<void> {\n    await this._context.clearPermissions();\n  }\n\n  async setGeolocation(params: channels.BrowserContextSetGeolocationParams): Promise<void> {\n    await this._context.setGeolocation(params.geolocation);\n  }\n\n  async setExtraHTTPHeaders(params: channels.BrowserContextSetExtraHTTPHeadersParams): Promise<void> {\n    await this._context.setExtraHTTPHeaders(params.headers);\n  }\n\n  async setOffline(params: channels.BrowserContextSetOfflineParams): Promise<void> {\n    await this._context.setOffline(params.offline);\n  }\n\n  async setHTTPCredentials(params: channels.BrowserContextSetHTTPCredentialsParams): Promise<void> {\n    await this._context.setHTTPCredentials(params.httpCredentials);\n  }\n\n  async addInitScript(params: channels.BrowserContextAddInitScriptParams): Promise<void> {\n    await this._context._doAddInitScript(params.source);\n  }\n\n  async setNetworkInterceptionEnabled(params: channels.BrowserContextSetNetworkInterceptionEnabledParams): Promise<void> {\n    if (!params.enabled) {\n      await this._context._setRequestInterceptor(undefined);\n      return;\n    }\n    await this._context._setRequestInterceptor((route, request) => {\n      this._dispatchEvent('route', { route: RouteDispatcher.from(this._scope, route), request: RequestDispatcher.from(this._scope, request) });\n    });\n  }\n\n  async storageState(params: channels.BrowserContextStorageStateParams, metadata: CallMetadata): Promise<channels.BrowserContextStorageStateResult> {\n    return await this._context.storageState(metadata);\n  }\n\n  async close(params: channels.BrowserContextCloseParams, metadata: CallMetadata): Promise<void> {\n    await this._context.close(metadata);\n  }\n\n  async recorderSupplementEnable(params: channels.BrowserContextRecorderSupplementEnableParams): Promise<void> {\n    await RecorderSupplement.show(this._context, params);\n  }\n\n  async pause(params: channels.BrowserContextPauseParams, metadata: CallMetadata) {\n    // Inspector controller will take care of this.\n  }\n\n  async newCDPSession(params: channels.BrowserContextNewCDPSessionParams): Promise<channels.BrowserContextNewCDPSessionResult> {\n    if (!this._object._browser.options.isChromium)\n      throw new Error(`CDP session is only available in Chromium`);\n    if (!params.page && !params.frame || params.page && params.frame)\n      throw new Error(`CDP session must be initiated with either Page or Frame, not none or both`);\n    const crBrowserContext = this._object as CRBrowserContext;\n    return { session: new CDPSessionDispatcher(this._scope, await crBrowserContext.newCDPSession((params.page ? params.page as PageDispatcher : params.frame as FrameDispatcher)._object)) };\n  }\n\n  async tracingStart(params: channels.BrowserContextTracingStartParams): Promise<channels.BrowserContextTracingStartResult> {\n    await this._context.tracing.start(params);\n  }\n\n  async tracingStop(params: channels.BrowserContextTracingStopParams): Promise<channels.BrowserContextTracingStopResult> {\n    await this._context.tracing.stop();\n  }\n\n  async tracingExport(params: channels.BrowserContextTracingExportParams): Promise<channels.BrowserContextTracingExportResult> {\n    const artifact = await this._context.tracing.export();\n    return { artifact: new ArtifactDispatcher(this._scope, artifact) };\n  }\n}\n"],"file":"browserContextDispatcher.js"}