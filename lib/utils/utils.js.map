{"version":3,"sources":["../../src/utils/utils.ts"],"names":["ProxyAgent","require","existsAsync","path","Promise","resolve","fs","stat","err","httpRequest","url","method","response","options","URL","parse","proxyURL","startsWith","proxy","href","host","hostname","port","parsedProxyURL","secureProxy","protocol","agent","rejectUnauthorized","requestCallback","res","statusCode","headers","location","request","end","fetchData","reject","Error","body","on","chunk","error","downloadFile","destinationPath","progressCallback","log","fulfill","downloadedBytes","totalBytes","promise","x","resume","file","createWriteStream","pipe","parseInt","onData","length","spawnAsync","cmd","args","process","stdout","stderr","data","code","makeWaitForNextTask","versions","electron","callback","setTimeout","node","setImmediate","spinning","callbacks","loop","shift","push","assert","value","message","debugAssert","isUnderTest","isString","obj","String","isRegExp","RegExp","Object","prototype","toString","call","isObject","isError","__proto__","name","debugEnv","getFromENV","debugMode","_isUnderTest","setUnderTest","env","undefined","toLowerCase","getAsBooleanFromENV","mkdirIfNeeded","filePath","promises","mkdir","dirname","recursive","catch","headersObjectToArray","result","is","headersArrayToObject","lowerCase","monotonicTime","seconds","nanoseconds","hrtime","HashStream","stream","Writable","_hash","crypto","createHash","_write","encoding","done","update","digest","calculateFileSha1","filename","hashStream","createReadStream","f","r","calculateSha1","buffer","hash","createGuid","randomBytes","removeFolders","dirs","all","map","dir","maxBusyTries","canAccessFile","accessSync","e","localIpAddresses","isLocalIpAddress","ipAdress","includes","getUserAgent","packageJson","version","os","arch","platform","release","constructURLBasedOnBaseURL","baseURL","givenURL","hostPlatform","ver","split","a","macVersion","LAST_STABLE_MAC_MAJOR_VERSION","Math","min","cpus","some","cpu","model","ubuntuVersion","wrapInASCIIBox","text","padding","lines","maxLength","max","line","repeat","join"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport path from 'path';\nimport fs from 'fs';\nimport stream from 'stream';\nimport removeFolder from 'rimraf';\nimport * as crypto from 'crypto';\nimport os from 'os';\nimport { spawn } from 'child_process';\nimport { getProxyForUrl } from 'proxy-from-env';\nimport * as URL from 'url';\nimport { getUbuntuVersionSync } from './ubuntuVersion';\n\n// `https-proxy-agent` v5 is written in TypeScript and exposes generated types.\n// However, as of June 2020, its types are generated with tsconfig that enables\n// `esModuleInterop` option.\n//\n// As a result, we can't depend on the package unless we enable the option\n// for our codebase. Instead of doing this, we abuse \"require\" to import module\n// without types.\nconst ProxyAgent = require('https-proxy-agent');\n\nexport const existsAsync = (path: string): Promise<boolean> => new Promise(resolve => fs.stat(path, err => resolve(!err)));\n\nfunction httpRequest(url: string, method: string, response: (r: any) => void) {\n  let options: any = URL.parse(url);\n  options.method = method;\n\n  const proxyURL = getProxyForUrl(url);\n  if (proxyURL) {\n    if (url.startsWith('http:')) {\n      const proxy = URL.parse(proxyURL);\n      options = {\n        path: options.href,\n        host: proxy.hostname,\n        port: proxy.port,\n      };\n    } else {\n      const parsedProxyURL: any = URL.parse(proxyURL);\n      parsedProxyURL.secureProxy = parsedProxyURL.protocol === 'https:';\n\n      options.agent = new ProxyAgent(parsedProxyURL);\n      options.rejectUnauthorized = false;\n    }\n  }\n\n  const requestCallback = (res: any) => {\n    if (res.statusCode >= 300 && res.statusCode < 400 && res.headers.location)\n      httpRequest(res.headers.location, method, response);\n    else\n      response(res);\n  };\n  const request = options.protocol === 'https:' ?\n    require('https').request(options, requestCallback) :\n    require('http').request(options, requestCallback);\n  request.end();\n  return request;\n}\n\nexport function fetchData(url: string): Promise<string> {\n  return new Promise((resolve, reject) => {\n    httpRequest(url, 'GET', function(response){\n      if (response.statusCode !== 200) {\n        reject(new Error(`fetch failed: server returned code ${response.statusCode}. URL: ${url}`));\n        return;\n      }\n      let body = '';\n      response.on('data', (chunk: string) => body += chunk);\n      response.on('error', (error: any) => reject(error));\n      response.on('end', () => resolve(body));\n    }).on('error', (error: any) => reject(error));\n  });\n}\n\ntype OnProgressCallback = (downloadedBytes: number, totalBytes: number) => void;\ntype DownloadFileLogger = (message: string) => void;\n\nexport function downloadFile(url: string, destinationPath: string, options: {progressCallback?: OnProgressCallback, log?: DownloadFileLogger} = {}): Promise<{error: any}> {\n  const {\n    progressCallback,\n    log = () => {},\n  } = options;\n  log(`running download:`);\n  log(`-- from url: ${url}`);\n  log(`-- to location: ${destinationPath}`);\n  let fulfill: ({error}: {error: any}) => void = ({error}) => {};\n  let downloadedBytes = 0;\n  let totalBytes = 0;\n\n  const promise: Promise<{error: any}> = new Promise(x => { fulfill = x; });\n\n  const request = httpRequest(url, 'GET', response => {\n    log(`-- response status code: ${response.statusCode}`);\n    if (response.statusCode !== 200) {\n      const error = new Error(`Download failed: server returned code ${response.statusCode}. URL: ${url}`);\n      // consume response data to free up memory\n      response.resume();\n      fulfill({error});\n      return;\n    }\n    const file = fs.createWriteStream(destinationPath);\n    file.on('finish', () => fulfill({error: null}));\n    file.on('error', error => fulfill({error}));\n    response.pipe(file);\n    totalBytes = parseInt(response.headers['content-length'], 10);\n    log(`-- total bytes: ${totalBytes}`);\n    if (progressCallback)\n      response.on('data', onData);\n  });\n  request.on('error', (error: any) => fulfill({error}));\n  return promise;\n\n  function onData(chunk: string) {\n    downloadedBytes += chunk.length;\n    progressCallback!(downloadedBytes, totalBytes);\n  }\n}\n\nexport function spawnAsync(cmd: string, args: string[], options: any): Promise<{stdout: string, stderr: string, code: number, error?: Error}> {\n  const process = spawn(cmd, args, options);\n\n  return new Promise(resolve => {\n    let stdout = '';\n    let stderr = '';\n    if (process.stdout)\n      process.stdout.on('data', data => stdout += data);\n    if (process.stderr)\n      process.stderr.on('data', data => stderr += data);\n    process.on('close', code => resolve({stdout, stderr, code}));\n    process.on('error', error => resolve({stdout, stderr, code: 0, error}));\n  });\n}\n\n// See https://joel.tools/microtasks/\nexport function makeWaitForNextTask() {\n  // As of Mar 2021, Electorn v12 doesn't create new task with `setImmediate` despite\n  // using Node 14 internally, so we fallback to `setTimeout(0)` instead.\n  // @see https://github.com/electron/electron/issues/28261\n  if ((process.versions as any).electron)\n    return (callback: () => void) => setTimeout(callback, 0);\n  if (parseInt(process.versions.node, 10) >= 11)\n    return setImmediate;\n\n  // Unlike Node 11, Node 10 and less have a bug with Task and MicroTask execution order:\n  // - https://github.com/nodejs/node/issues/22257\n  //\n  // So we can't simply run setImmediate to dispatch code in a following task.\n  // However, we can run setImmediate from-inside setImmediate to make sure we're getting\n  // in the following task.\n\n  let spinning = false;\n  const callbacks: (() => void)[] = [];\n  const loop = () => {\n    const callback = callbacks.shift();\n    if (!callback) {\n      spinning = false;\n      return;\n    }\n    setImmediate(loop);\n    // Make sure to call callback() as the last thing since it's\n    // untrusted code that might throw.\n    callback();\n  };\n\n  return (callback: () => void) => {\n    callbacks.push(callback);\n    if (!spinning) {\n      spinning = true;\n      setImmediate(loop);\n    }\n  };\n}\n\nexport function assert(value: any, message?: string): asserts value {\n  if (!value)\n    throw new Error(message || 'Assertion error');\n}\n\nexport function debugAssert(value: any, message?: string): asserts value {\n  if (isUnderTest() && !value)\n    throw new Error(message);\n}\n\nexport function isString(obj: any): obj is string {\n  return typeof obj === 'string' || obj instanceof String;\n}\n\nexport function isRegExp(obj: any): obj is RegExp {\n  return obj instanceof RegExp || Object.prototype.toString.call(obj) === '[object RegExp]';\n}\n\nexport function isObject(obj: any): obj is NonNullable<object> {\n  return typeof obj === 'object' && obj !== null;\n}\n\nexport function isError(obj: any): obj is Error {\n  return obj instanceof Error || (obj && obj.__proto__ && obj.__proto__.name === 'Error');\n}\n\nconst debugEnv = getFromENV('PWDEBUG') || '';\nexport function debugMode() {\n  if (debugEnv === 'console')\n    return 'console';\n  return debugEnv ? 'inspector' : '';\n}\n\nlet _isUnderTest = false;\nexport function setUnderTest() {\n  _isUnderTest = true;\n}\nexport function isUnderTest(): boolean {\n  return _isUnderTest;\n}\n\nexport function getFromENV(name: string): string | undefined {\n  let value = process.env[name];\n  value = value === undefined ? process.env[`npm_config_${name.toLowerCase()}`] : value;\n  value = value === undefined ?  process.env[`npm_package_config_${name.toLowerCase()}`] : value;\n  return value;\n}\n\nexport function getAsBooleanFromENV(name: string): boolean {\n  const value = getFromENV(name);\n  return !!value && value !== 'false' && value !== '0';\n}\n\nexport async function mkdirIfNeeded(filePath: string) {\n  // This will harmlessly throw on windows if the dirname is the root directory.\n  await fs.promises.mkdir(path.dirname(filePath), {recursive: true}).catch(() => {});\n}\n\ntype HeadersArray = { name: string, value: string }[];\ntype HeadersObject = { [key: string]: string };\n\nexport function headersObjectToArray(headers: HeadersObject): HeadersArray {\n  const result: HeadersArray = [];\n  for (const name in headers) {\n    if (!Object.is(headers[name], undefined))\n      result.push({ name, value: headers[name] });\n  }\n  return result;\n}\n\nexport function headersArrayToObject(headers: HeadersArray, lowerCase: boolean): HeadersObject {\n  const result: HeadersObject = {};\n  for (const { name, value } of headers)\n    result[lowerCase ? name.toLowerCase() : name] = value;\n  return result;\n}\n\nexport function monotonicTime(): number {\n  const [seconds, nanoseconds] = process.hrtime();\n  return seconds * 1000 + (nanoseconds / 1000 | 0) / 1000;\n}\n\nclass HashStream extends stream.Writable {\n  private _hash = crypto.createHash('sha1');\n\n  _write(chunk: Buffer, encoding: string, done: () => void) {\n    this._hash.update(chunk);\n    done();\n  }\n\n  digest(): string {\n    return this._hash.digest('hex');\n  }\n}\n\nexport async function calculateFileSha1(filename: string): Promise<string> {\n  const hashStream = new HashStream();\n  const stream = fs.createReadStream(filename);\n  stream.on('open', () => stream.pipe(hashStream));\n  await new Promise((f, r) => {\n    hashStream.on('finish', f);\n    hashStream.on('error', r);\n  });\n  return hashStream.digest();\n}\n\nexport function calculateSha1(buffer: Buffer | string): string {\n  const hash = crypto.createHash('sha1');\n  hash.update(buffer);\n  return hash.digest('hex');\n}\n\nexport function createGuid(): string {\n  return crypto.randomBytes(16).toString('hex');\n}\n\nexport async function removeFolders(dirs: string[]): Promise<Array<Error|undefined>> {\n  return await Promise.all(dirs.map((dir: string) => {\n    return new Promise<Error|undefined>(fulfill => {\n      removeFolder(dir, { maxBusyTries: 10 }, error => {\n        fulfill(error);\n      });\n    });\n  }));\n}\n\nexport function canAccessFile(file: string) {\n  if (!file)\n    return false;\n\n  try {\n    fs.accessSync(file);\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nconst localIpAddresses = [\n  'localhost',\n  '127.0.0.1',\n  '::ffff:127.0.0.1',\n  '::1',\n  '0000:0000:0000:0000:0000:0000:0000:0001', // WebKit (Windows)\n];\n\nexport function isLocalIpAddress(ipAdress: string): boolean {\n  return localIpAddresses.includes(ipAdress);\n}\n\nexport function getUserAgent() {\n  const packageJson = require('./../../package.json');\n  return `Playwright/${packageJson.version} (${os.arch()}/${os.platform()}/${os.release()})`;\n}\n\nexport function constructURLBasedOnBaseURL(baseURL: string | undefined, givenURL: string): string {\n  try {\n    return (new URL.URL(givenURL, baseURL)).toString();\n  } catch (e) {\n    return givenURL;\n  }\n}\n\nexport type HostPlatform = 'win32'|'win64'|'mac10.13'|'mac10.14'|'mac10.15'|'mac11'|'mac11-arm64'|'ubuntu18.04'|'ubuntu20.04';\nexport const hostPlatform = ((): HostPlatform => {\n  const platform = os.platform();\n  if (platform === 'darwin') {\n    const ver = os.release().split('.').map((a: string) => parseInt(a, 10));\n    let macVersion = '';\n    if (ver[0] < 18) {\n      // Everything before 10.14 is considered 10.13.\n      macVersion = 'mac10.13';\n    } else if (ver[0] === 18) {\n      macVersion = 'mac10.14';\n    } else if (ver[0] === 19) {\n      macVersion = 'mac10.15';\n    } else {\n      // ver[0] >= 20\n      const LAST_STABLE_MAC_MAJOR_VERSION = 11;\n      // Best-effort support for MacOS beta versions.\n      macVersion = 'mac' + Math.min(ver[0] - 9, LAST_STABLE_MAC_MAJOR_VERSION);\n      // BigSur is the first version that might run on Apple Silicon.\n      if (os.cpus().some(cpu => cpu.model.includes('Apple')))\n        macVersion += '-arm64';\n    }\n    return macVersion as HostPlatform;\n  }\n  if (platform === 'linux') {\n    const ubuntuVersion = getUbuntuVersionSync();\n    if (parseInt(ubuntuVersion, 10) <= 19)\n      return 'ubuntu18.04';\n    return 'ubuntu20.04';\n  }\n  if (platform === 'win32')\n    return 'win64';\n  return platform as HostPlatform;\n})();\n\nexport function wrapInASCIIBox(text: string, padding = 0): string {\n  const lines = text.split('\\n');\n  const maxLength = Math.max(...lines.map(line => line.length));\n  return [\n    '╔' + '═'.repeat(maxLength + padding * 2) + '╗',\n    ...lines.map(line => '║' + ' '.repeat(padding) + line + ' '.repeat(maxLength - line.length + padding) + '║'),\n    '╚' + '═'.repeat(maxLength + padding * 2) + '╝',\n  ].join('\\n');\n}\n"],"file":"utils.js"}