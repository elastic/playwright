{"version":3,"sources":["../src/inprocess.ts"],"names":["setupInProcess","playwright","clientConnection","Connection","dispatcherConnection","DispatcherConnection","onmessage","message","dispatch","rootScope","Root","PlaywrightDispatcher","playwrightAPI","getObjectWithKnownName","chromium","_serverLauncher","BrowserServerLauncherImpl","firefox","webkit","setImmediate","_toImpl","x","_dispatchers","get","_guid","_object","module","exports"],"mappings":";;AAgBA;;AACA;;AAEA;;AACA;;AACA;;AArBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AASA,SAASA,cAAT,GAAyC;AACvC,QAAMC,UAAU,GAAG,mCAAnB;AAEA,QAAMC,gBAAgB,GAAG,IAAIC,sBAAJ,EAAzB;AACA,QAAMC,oBAAoB,GAAG,IAAIC,gCAAJ,EAA7B,CAJuC,CAMvC;;AACAD,EAAAA,oBAAoB,CAACE,SAArB,GAAiCC,OAAO,IAAIL,gBAAgB,CAACM,QAAjB,CAA0BD,OAA1B,CAA5C;;AACAL,EAAAA,gBAAgB,CAACI,SAAjB,GAA6BC,OAAO,IAAIH,oBAAoB,CAACI,QAArB,CAA8BD,OAA9B,CAAxC;;AAEA,QAAME,SAAS,GAAG,IAAIC,gBAAJ,CAASN,oBAAT,CAAlB,CAVuC,CAYvC;;AACA,MAAIO,0CAAJ,CAAyBF,SAAzB,EAAoCR,UAApC;AACA,QAAMW,aAAa,GAAGV,gBAAgB,CAACW,sBAAjB,CAAwC,YAAxC,CAAtB;AACAD,EAAAA,aAAa,CAACE,QAAd,CAAuBC,eAAvB,GAAyC,IAAIC,4CAAJ,CAA8B,UAA9B,CAAzC;AACAJ,EAAAA,aAAa,CAACK,OAAd,CAAsBF,eAAtB,GAAwC,IAAIC,4CAAJ,CAA8B,SAA9B,CAAxC;AACAJ,EAAAA,aAAa,CAACM,MAAd,CAAqBH,eAArB,GAAuC,IAAIC,4CAAJ,CAA8B,QAA9B,CAAvC,CAjBuC,CAmBvC;;AACAZ,EAAAA,oBAAoB,CAACE,SAArB,GAAiCC,OAAO,IAAIY,YAAY,CAAC,MAAMjB,gBAAgB,CAACM,QAAjB,CAA0BD,OAA1B,CAAP,CAAxD;;AACAL,EAAAA,gBAAgB,CAACI,SAAjB,GAA6BC,OAAO,IAAIY,YAAY,CAAC,MAAMf,oBAAoB,CAACI,QAArB,CAA8BD,OAA9B,CAAP,CAApD;;AAECK,EAAAA,aAAD,CAAuBQ,OAAvB,GAAkCC,CAAD,IAAYjB,oBAAoB,CAACkB,YAArB,CAAkCC,GAAlC,CAAsCF,CAAC,CAACG,KAAxC,EAAgDC,OAA7F;;AACA,SAAOb,aAAP;AACD;;AAEDc,MAAM,CAACC,OAAP,GAAiB3B,cAAc,EAA/B","sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DispatcherConnection, Root } from './dispatchers/dispatcher';\nimport { createPlaywright } from './server/playwright';\nimport type { Playwright as PlaywrightAPI } from './client/playwright';\nimport { PlaywrightDispatcher } from './dispatchers/playwrightDispatcher';\nimport { Connection } from './client/connection';\nimport { BrowserServerLauncherImpl } from './browserServerImpl';\n\nfunction setupInProcess(): PlaywrightAPI {\n  const playwright = createPlaywright();\n\n  const clientConnection = new Connection();\n  const dispatcherConnection = new DispatcherConnection();\n\n  // Dispatch synchronously at first.\n  dispatcherConnection.onmessage = message => clientConnection.dispatch(message);\n  clientConnection.onmessage = message => dispatcherConnection.dispatch(message);\n\n  const rootScope = new Root(dispatcherConnection);\n\n  // Initialize Playwright channel.\n  new PlaywrightDispatcher(rootScope, playwright);\n  const playwrightAPI = clientConnection.getObjectWithKnownName('Playwright') as PlaywrightAPI;\n  playwrightAPI.chromium._serverLauncher = new BrowserServerLauncherImpl('chromium');\n  playwrightAPI.firefox._serverLauncher = new BrowserServerLauncherImpl('firefox');\n  playwrightAPI.webkit._serverLauncher = new BrowserServerLauncherImpl('webkit');\n\n  // Switch to async dispatch after we got Playwright object.\n  dispatcherConnection.onmessage = message => setImmediate(() => clientConnection.dispatch(message));\n  clientConnection.onmessage = message => setImmediate(() => dispatcherConnection.dispatch(message));\n\n  (playwrightAPI as any)._toImpl = (x: any) => dispatcherConnection._dispatchers.get(x._guid)!._object;\n  return playwrightAPI;\n}\n\nmodule.exports = setupInProcess();\n"],"file":"inprocess.js"}