{"version":3,"sources":["../../src/cli/cli.ts"],"names":["packageJSON","require","program","version","name","process","env","PW_CLI_NAME","commandWithOpenOptions","action","url","command","open","language","catch","logErrorAndExit","on","console","log","codegen","target","output","description","app","args","PWDEBUG","stdio","suggestedBrowsersToInstall","registry","executables","filter","e","installType","type","map","join","checkBrowsersToInstall","faultyArguments","arg","executable","findExecutable","push","length","exit","option","opts","withDeps","installDeps","install","browsers","alias","browser","filename","screenshot","pdf","trace","PW_CLI_TARGET_LANG","playwrightTestPackagePath","isLocal","PWTEST_CLI_ALLOW_TEST_COMMAND","resolve","paths","__dirname","cwd","addTestCommand","allowUnknownOption","error","argv","undefined","parse","launchContext","options","headless","executablePath","validateOptions","browserType","lookupBrowserType","launchOptions","channel","contextOptions","device","playwright","devices","deviceScaleFactor","os","platform","hasTouch","isMobile","acceptDownloads","proxyServer","proxy","server","launch","viewportSize","width","height","split","n","parseInt","viewport","geolocation","latitude","longitude","parseFloat","trim","permissions","userAgent","lang","locale","colorScheme","timezone","timezoneId","loadStorage","storageState","ignoreHttpsErrors","ignoreHTTPSErrors","context","newContext","closingBrowser","closeBrowser","saveTrace","tracing","stop","path","saveStorage","close","page","hasPage","contexts","some","pages","timeout","setDefaultTimeout","setDefaultNavigationTimeout","start","screenshots","snapshots","browserName","openPage","newPage","fs","existsSync","startsWith","goto","PWTEST_CLI_HEADLESS","PWTEST_CLI_EXECUTABLE_PATH","_enableRecorder","PWTEST_CLI_EXIT","Promise","all","p","outputFile","startRecording","waitForPage","captureOptions","waitForSelector","waitForTimeout","fullPage","defaultBrowserType","chromium","webkit","firefox","help","includes","result","slice"],"mappings":"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","sourcesContent":["#!/usr/bin/env node\n\n/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable no-console */\n\nimport fs from 'fs';\nimport os from 'os';\nimport path from 'path';\nimport program from 'commander';\nimport { runDriver, runServer, printApiJson, launchBrowserServer } from './driver';\nimport { showTraceViewer } from '../server/trace/viewer/traceViewer';\nimport * as playwright from '../..';\nimport { BrowserContext } from '../client/browserContext';\nimport { Browser } from '../client/browser';\nimport { Page } from '../client/page';\nimport { BrowserType } from '../client/browserType';\nimport { BrowserContextOptions, LaunchOptions } from '../client/types';\nimport { spawn } from 'child_process';\nimport { registry, Executable } from '../utils/registry';\n\nconst packageJSON = require('../../package.json');\n\nprogram\n    .version('Version ' + packageJSON.version)\n    .name(process.env.PW_CLI_NAME || 'npx playwright');\n\ncommandWithOpenOptions('open [url]', 'open page in browser specified via -b, --browser', [])\n    .action(function(url, command) {\n      open(command, url, language()).catch(logErrorAndExit);\n    })\n    .on('--help', function() {\n      console.log('');\n      console.log('Examples:');\n      console.log('');\n      console.log('  $ open');\n      console.log('  $ open -b webkit https://example.com');\n    });\n\ncommandWithOpenOptions('codegen [url]', 'open page and generate code for user actions',\n    [\n      ['-o, --output <file name>', 'saves the generated script to a file'],\n      ['--target <language>', `language to generate, one of javascript, test, python, python-async, csharp`, language()],\n    ]).action(function(url, command) {\n  codegen(command, url, command.target, command.output).catch(logErrorAndExit);\n}).on('--help', function() {\n  console.log('');\n  console.log('Examples:');\n  console.log('');\n  console.log('  $ codegen');\n  console.log('  $ codegen --target=python');\n  console.log('  $ codegen -b webkit https://example.com');\n});\n\nprogram\n    .command('debug <app> [args...]')\n    .description('run command in debug mode: disable timeout, open inspector')\n    .action(function(app, args) {\n      spawn(app, args, {\n        env: { ...process.env, PWDEBUG: '1' },\n        stdio: 'inherit'\n      });\n    }).on('--help', function() {\n      console.log('');\n      console.log('Examples:');\n      console.log('');\n      console.log('  $ debug node test.js');\n      console.log('  $ debug npm run test');\n    });\n\nfunction suggestedBrowsersToInstall() {\n  return registry.executables().filter(e => e.installType !== 'none' && e.type !== 'tool').map(e => e.name).join(', ');\n}\n\nfunction checkBrowsersToInstall(args: string[]): Executable[] {\n  const faultyArguments: string[] = [];\n  const executables: Executable[] = [];\n  for (const arg of args) {\n    const executable = registry.findExecutable(arg);\n    if (!executable || executable.installType === 'none')\n      faultyArguments.push(arg);\n    else\n      executables.push(executable);\n  }\n  if (faultyArguments.length) {\n    console.log(`Invalid installation targets: ${faultyArguments.map(name => `'${name}'`).join(', ')}. Expecting one of: ${suggestedBrowsersToInstall()}`);\n    process.exit(1);\n  }\n  return executables;\n}\n\nprogram\n    .command('install [browser...]')\n    .description('ensure browsers necessary for this version of Playwright are installed')\n    .option('--with-deps', 'install system dependencies for browsers')\n    .action(async function(args: string[], command: program.Command) {\n      try {\n        if (!args.length) {\n          if (command.opts().withDeps)\n            await registry.installDeps();\n          await registry.install();\n        } else {\n          const executables = checkBrowsersToInstall(args);\n          if (command.opts().withDeps)\n            await registry.installDeps(executables);\n          await registry.install(executables);\n        }\n      } catch (e) {\n        console.log(`Failed to install browsers\\n${e}`);\n        process.exit(1);\n      }\n    }).on('--help', function() {\n      console.log(``);\n      console.log(`Examples:`);\n      console.log(`  - $ install`);\n      console.log(`    Install default browsers.`);\n      console.log(``);\n      console.log(`  - $ install chrome firefox`);\n      console.log(`    Install custom browsers, supports ${suggestedBrowsersToInstall()}.`);\n    });\n\n\nprogram\n    .command('install-deps [browser...]')\n    .description('install dependencies necessary to run browsers (will ask for sudo permissions)')\n    .action(async function(args: string[]) {\n      try {\n        if (!args.length)\n          await registry.installDeps();\n        else\n          await registry.installDeps(checkBrowsersToInstall(args));\n      } catch (e) {\n        console.log(`Failed to install browser dependencies\\n${e}`);\n        process.exit(1);\n      }\n    }).on('--help', function() {\n      console.log(``);\n      console.log(`Examples:`);\n      console.log(`  - $ install-deps`);\n      console.log(`    Install dependencies for default browsers.`);\n      console.log(``);\n      console.log(`  - $ install-deps chrome firefox`);\n      console.log(`    Install dependencies for specific browsers, supports ${suggestedBrowsersToInstall()}.`);\n    });\n\nconst browsers = [\n  { alias: 'cr', name: 'Chromium', type: 'chromium' },\n  { alias: 'ff', name: 'Firefox', type: 'firefox' },\n  { alias: 'wk', name: 'WebKit', type: 'webkit' },\n];\n\nfor (const {alias, name, type} of browsers) {\n  commandWithOpenOptions(`${alias} [url]`, `open page in ${name}`, [])\n      .action(function(url, command) {\n        open({ ...command, browser: type }, url, command.target).catch(logErrorAndExit);\n      }).on('--help', function() {\n        console.log('');\n        console.log('Examples:');\n        console.log('');\n        console.log(`  $ ${alias} https://example.com`);\n      });\n}\n\ncommandWithOpenOptions('screenshot <url> <filename>', 'capture a page screenshot',\n    [\n      ['--wait-for-selector <selector>', 'wait for selector before taking a screenshot'],\n      ['--wait-for-timeout <timeout>', 'wait for timeout in milliseconds before taking a screenshot'],\n      ['--full-page', 'whether to take a full page screenshot (entire scrollable area)'],\n    ]).action(function(url, filename, command) {\n  screenshot(command, command, url, filename).catch(logErrorAndExit);\n}).on('--help', function() {\n  console.log('');\n  console.log('Examples:');\n  console.log('');\n  console.log('  $ screenshot -b webkit https://example.com example.png');\n});\n\ncommandWithOpenOptions('pdf <url> <filename>', 'save page as pdf',\n    [\n      ['--wait-for-selector <selector>', 'wait for given selector before saving as pdf'],\n      ['--wait-for-timeout <timeout>', 'wait for given timeout in milliseconds before saving as pdf'],\n    ]).action(function(url, filename, command) {\n  pdf(command, command, url, filename).catch(logErrorAndExit);\n}).on('--help', function() {\n  console.log('');\n  console.log('Examples:');\n  console.log('');\n  console.log('  $ pdf https://example.com example.pdf');\n});\n\nprogram\n    .command('show-trace [trace]')\n    .option('-b, --browser <browserType>', 'browser to use, one of cr, chromium, ff, firefox, wk, webkit', 'chromium')\n    .description('Show trace viewer')\n    .action(function(trace, command) {\n      if (command.browser === 'cr')\n        command.browser = 'chromium';\n      if (command.browser === 'ff')\n        command.browser = 'firefox';\n      if (command.browser === 'wk')\n        command.browser = 'webkit';\n      showTraceViewer(trace, command.browser).catch(logErrorAndExit);\n    }).on('--help', function() {\n      console.log('');\n      console.log('Examples:');\n      console.log('');\n      console.log('  $ show-trace trace/directory');\n    });\n\nif (!process.env.PW_CLI_TARGET_LANG) {\n  let playwrightTestPackagePath = null;\n  try {\n    const isLocal = packageJSON.name === '@playwright/test' || process.env.PWTEST_CLI_ALLOW_TEST_COMMAND;\n    if (isLocal) {\n      playwrightTestPackagePath = '../test/cli';\n    } else {\n      playwrightTestPackagePath = require.resolve('@playwright/test/lib/test/cli', {\n        paths: [__dirname, process.cwd()]\n      });\n    }\n  } catch {}\n\n  if (playwrightTestPackagePath) {\n    require(playwrightTestPackagePath).addTestCommand(program);\n  } else {\n    const command = program.command('test').allowUnknownOption(true);\n    command.description('Run tests with Playwright Test. Available in @playwright/test package.');\n    command.action(async (args, opts) => {\n      console.error('Please install @playwright/test package to use Playwright Test.');\n      console.error('  npm install -D @playwright/test');\n      process.exit(1);\n    });\n  }\n}\n\nif (process.argv[2] === 'run-driver')\n  runDriver();\nelse if (process.argv[2] === 'run-server')\n  runServer(process.argv[3] ? +process.argv[3] : undefined, process.argv[4]).catch(logErrorAndExit);\nelse if (process.argv[2] === 'print-api-json')\n  printApiJson();\nelse if (process.argv[2] === 'launch-server')\n  launchBrowserServer(process.argv[3], process.argv[4]).catch(logErrorAndExit);\nelse\n  program.parse(process.argv);\n\n\ntype Options = {\n  browser: string;\n  channel?: string;\n  colorScheme?: string;\n  device?: string;\n  geolocation?: string;\n  ignoreHttpsErrors?: boolean;\n  lang?: string;\n  loadStorage?: string;\n  proxyServer?: string;\n  saveStorage?: string;\n  saveTrace?: string;\n  timeout: string;\n  timezone?: string;\n  viewportSize?: string;\n  userAgent?: string;\n};\n\ntype CaptureOptions = {\n  waitForSelector?: string;\n  waitForTimeout?: string;\n  fullPage: boolean;\n};\n\nasync function launchContext(options: Options, headless: boolean, executablePath?: string): Promise<{ browser: Browser, browserName: string, launchOptions: LaunchOptions, contextOptions: BrowserContextOptions, context: BrowserContext }> {\n  validateOptions(options);\n  const browserType = lookupBrowserType(options);\n  const launchOptions: LaunchOptions = { headless, executablePath };\n  if (options.channel)\n    launchOptions.channel = options.channel as any;\n\n  const contextOptions: BrowserContextOptions =\n    // Copy the device descriptor since we have to compare and modify the options.\n    options.device ? { ...playwright.devices[options.device] } : {};\n\n  // In headful mode, use host device scale factor for things to look nice.\n  // In headless, keep things the way it works in Playwright by default.\n  // Assume high-dpi on MacOS. TODO: this is not perfect.\n  if (!headless)\n    contextOptions.deviceScaleFactor = os.platform() === 'darwin' ? 2 : 1;\n\n  // Work around the WebKit GTK scrolling issue.\n  if (browserType.name() === 'webkit' && process.platform === 'linux') {\n    delete contextOptions.hasTouch;\n    delete contextOptions.isMobile;\n  }\n\n  if (contextOptions.isMobile && browserType.name() === 'firefox')\n    contextOptions.isMobile = undefined;\n\n  contextOptions.acceptDownloads = true;\n\n  // Proxy\n\n  if (options.proxyServer) {\n    launchOptions.proxy = {\n      server: options.proxyServer\n    };\n  }\n\n  const browser = await browserType.launch(launchOptions);\n\n  // Viewport size\n  if (options.viewportSize) {\n    try {\n      const [ width, height ] = options.viewportSize.split(',').map(n => parseInt(n, 10));\n      contextOptions.viewport = { width, height };\n    } catch (e) {\n      console.log('Invalid window size format: use \"width, height\", for example --window-size=800,600');\n      process.exit(0);\n    }\n  }\n\n  // Geolocation\n\n  if (options.geolocation) {\n    try {\n      const [latitude, longitude] = options.geolocation.split(',').map(n => parseFloat(n.trim()));\n      contextOptions.geolocation = {\n        latitude,\n        longitude\n      };\n    } catch (e) {\n      console.log('Invalid geolocation format: user lat, long, for example --geolocation=\"37.819722,-122.478611\"');\n      process.exit(0);\n    }\n    contextOptions.permissions = ['geolocation'];\n  }\n\n  // User agent\n\n  if (options.userAgent)\n    contextOptions.userAgent = options.userAgent;\n\n  // Lang\n\n  if (options.lang)\n    contextOptions.locale = options.lang;\n\n  // Color scheme\n\n  if (options.colorScheme)\n    contextOptions.colorScheme = options.colorScheme as 'dark' | 'light';\n\n  // Timezone\n\n  if (options.timezone)\n    contextOptions.timezoneId = options.timezone;\n\n  // Storage\n\n  if (options.loadStorage)\n    contextOptions.storageState = options.loadStorage;\n\n  if (options.ignoreHttpsErrors)\n    contextOptions.ignoreHTTPSErrors = true;\n\n  // Close app when the last window closes.\n\n  const context = await browser.newContext(contextOptions);\n\n  let closingBrowser = false;\n  async function closeBrowser() {\n    // We can come here multiple times. For example, saving storage creates\n    // a temporary page and we call closeBrowser again when that page closes.\n    if (closingBrowser)\n      return;\n    closingBrowser = true;\n    if (options.saveTrace)\n      await context.tracing.stop({ path: options.saveTrace });\n    if (options.saveStorage)\n      await context.storageState({ path: options.saveStorage }).catch(e => null);\n    await browser.close();\n  }\n\n  context.on('page', page => {\n    page.on('dialog', () => {});  // Prevent dialogs from being automatically dismissed.\n    page.on('close', () => {\n      const hasPage = browser.contexts().some(context => context.pages().length > 0);\n      if (hasPage)\n        return;\n      // Avoid the error when the last page is closed because the browser has been closed.\n      closeBrowser().catch(e => null);\n    });\n  });\n  if (options.timeout) {\n    context.setDefaultTimeout(parseInt(options.timeout, 10));\n    context.setDefaultNavigationTimeout(parseInt(options.timeout, 10));\n  }\n\n  if (options.saveTrace)\n    await context.tracing.start({ screenshots: true, snapshots: true });\n\n  // Omit options that we add automatically for presentation purpose.\n  delete launchOptions.headless;\n  delete launchOptions.executablePath;\n  delete contextOptions.deviceScaleFactor;\n  delete contextOptions.acceptDownloads;\n  return { browser, browserName: browserType.name(), context, contextOptions, launchOptions };\n}\n\nasync function openPage(context: BrowserContext, url: string | undefined): Promise<Page> {\n  const page = await context.newPage();\n  if (url) {\n    if (fs.existsSync(url))\n      url = 'file://' + path.resolve(url);\n    else if (!url.startsWith('http') && !url.startsWith('file://') && !url.startsWith('about:') && !url.startsWith('data:'))\n      url = 'http://' + url;\n    await page.goto(url);\n  }\n  return page;\n}\n\nasync function open(options: Options, url: string | undefined, language: string) {\n  const { context, launchOptions, contextOptions } = await launchContext(options, !!process.env.PWTEST_CLI_HEADLESS, process.env.PWTEST_CLI_EXECUTABLE_PATH);\n  await context._enableRecorder({\n    language,\n    launchOptions,\n    contextOptions,\n    device: options.device,\n    saveStorage: options.saveStorage,\n  });\n  await openPage(context, url);\n  if (process.env.PWTEST_CLI_EXIT)\n    await Promise.all(context.pages().map(p => p.close()));\n}\n\nasync function codegen(options: Options, url: string | undefined, language: string, outputFile?: string) {\n  const { context, launchOptions, contextOptions } = await launchContext(options, !!process.env.PWTEST_CLI_HEADLESS, process.env.PWTEST_CLI_EXECUTABLE_PATH);\n  await context._enableRecorder({\n    language,\n    launchOptions,\n    contextOptions,\n    device: options.device,\n    saveStorage: options.saveStorage,\n    startRecording: true,\n    outputFile: outputFile ? path.resolve(outputFile) : undefined\n  });\n  await openPage(context, url);\n  if (process.env.PWTEST_CLI_EXIT)\n    await Promise.all(context.pages().map(p => p.close()));\n}\n\nasync function waitForPage(page: Page, captureOptions: CaptureOptions) {\n  if (captureOptions.waitForSelector) {\n    console.log(`Waiting for selector ${captureOptions.waitForSelector}...`);\n    await page.waitForSelector(captureOptions.waitForSelector);\n  }\n  if (captureOptions.waitForTimeout) {\n    console.log(`Waiting for timeout ${captureOptions.waitForTimeout}...`);\n    await page.waitForTimeout(parseInt(captureOptions.waitForTimeout, 10));\n  }\n}\n\nasync function screenshot(options: Options, captureOptions: CaptureOptions, url: string, path: string) {\n  const { browser, context } = await launchContext(options, true);\n  console.log('Navigating to ' + url);\n  const page = await openPage(context, url);\n  await waitForPage(page, captureOptions);\n  console.log('Capturing screenshot into ' + path);\n  await page.screenshot({ path, fullPage: !!captureOptions.fullPage });\n  await browser.close();\n}\n\nasync function pdf(options: Options, captureOptions: CaptureOptions, url: string, path: string) {\n  if (options.browser !== 'chromium') {\n    console.error('PDF creation is only working with Chromium');\n    process.exit(1);\n  }\n  const { browser, context } = await launchContext({ ...options, browser: 'chromium' }, true);\n  console.log('Navigating to ' + url);\n  const page = await openPage(context, url);\n  await waitForPage(page, captureOptions);\n  console.log('Saving as pdf into ' + path);\n  await page.pdf!({ path });\n  await browser.close();\n}\n\nfunction lookupBrowserType(options: Options): BrowserType {\n  let name = options.browser;\n  if (options.device) {\n    const device = playwright.devices[options.device];\n    name = device.defaultBrowserType;\n  }\n  let browserType: any;\n  switch (name) {\n    case 'chromium': browserType = playwright.chromium; break;\n    case 'webkit': browserType = playwright.webkit; break;\n    case 'firefox': browserType = playwright.firefox; break;\n    case 'cr': browserType = playwright.chromium; break;\n    case 'wk': browserType = playwright.webkit; break;\n    case 'ff': browserType = playwright.firefox; break;\n  }\n  if (browserType)\n    return browserType;\n  program.help();\n}\n\nfunction validateOptions(options: Options) {\n  if (options.device && !(options.device in playwright.devices)) {\n    console.log(`Device descriptor not found: '${options.device}', available devices are:`);\n    for (const name in playwright.devices)\n      console.log(`  \"${name}\"`);\n    process.exit(0);\n  }\n  if (options.colorScheme && !['light', 'dark'].includes(options.colorScheme)) {\n    console.log('Invalid color scheme, should be one of \"light\", \"dark\"');\n    process.exit(0);\n  }\n}\n\nfunction logErrorAndExit(e: Error) {\n  console.error(e);\n  process.exit(1);\n}\n\nfunction language(): string {\n  return process.env.PW_CLI_TARGET_LANG || 'test';\n}\n\nfunction commandWithOpenOptions(command: string, description: string, options: any[][]): program.Command {\n  let result = program.command(command).description(description);\n  for (const option of options)\n    result = result.option(option[0], ...option.slice(1));\n  return result\n      .option('-b, --browser <browserType>', 'browser to use, one of cr, chromium, ff, firefox, wk, webkit', 'chromium')\n      .option('--channel <channel>', 'Chromium distribution channel, \"chrome\", \"chrome-beta\", \"msedge-dev\", etc')\n      .option('--color-scheme <scheme>', 'emulate preferred color scheme, \"light\" or \"dark\"')\n      .option('--device <deviceName>', 'emulate device, for example  \"iPhone 11\"')\n      .option('--geolocation <coordinates>', 'specify geolocation coordinates, for example \"37.819722,-122.478611\"')\n      .option('--ignore-https-errors', 'ignore https errors')\n      .option('--load-storage <filename>', 'load context storage state from the file, previously saved with --save-storage')\n      .option('--lang <language>', 'specify language / locale, for example \"en-GB\"')\n      .option('--proxy-server <proxy>', 'specify proxy server, for example \"http://myproxy:3128\" or \"socks5://myproxy:8080\"')\n      .option('--save-storage <filename>', 'save context storage state at the end, for later use with --load-storage')\n      .option('--save-trace <filename>', 'record a trace for the session and save it to a file')\n      .option('--timezone <time zone>', 'time zone to emulate, for example \"Europe/Rome\"')\n      .option('--timeout <timeout>', 'timeout for Playwright actions in milliseconds', '10000')\n      .option('--user-agent <ua string>', 'specify user agent string')\n      .option('--viewport-size <size>', 'specify browser viewport size in pixels, for example \"1280, 720\"');\n}\n"],"file":"cli.js"}