{"version":3,"file":"testType.js","names":["_expect","require","_globals","_test","_transform","_utils","testTypeSymbol","Symbol","TestTypeImpl","constructor","fixtures","test","wrapFunctionWithLocation","_createTest","bind","expect","only","describe","_describe","configure","_configure","fixme","parallel","serial","skip","beforeEach","_hook","afterEach","beforeAll","afterAll","_modifier","fail","slow","setTimeout","_setTimeout","step","_step","use","_use","extend","_extend","info","result","currentTestInfo","Error","_currentSuite","title","suite","currentlyLoadingFileSuite","join","_testTypeImpl","type","location","fnOrDetails","fn","throwIfRunningInsideJest","details","body","validatedDetails","validateTestDetails","TestCase","_requireFile","_staticAnnotations","push","annotations","_tags","tags","_addTest","_only","titleOrFn","child","Suite","_addSuite","_parallelMode","parent","setCurrentlyLoadingFileSuite","name","_hooks","options","timeout","undefined","_timeout","retries","_retries","mode","modifierArgs","_modifiers","description","length","testInfo","_addStep","category","box","zones","run","complete","error","fixturesWithLocation","exports","process","env","JEST_WORKER_ID","packageManagerCommand","getPackageManagerExecCommand","Array","isArray","annotation","tag","rootTestType","mergeTests","tests","t","testTypeImpl","newFixtures","filter","theirs","find","ours"],"sources":["../../src/common/testType.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { expect } from '../matchers/expect';\nimport { currentlyLoadingFileSuite, currentTestInfo, setCurrentlyLoadingFileSuite } from './globals';\nimport { TestCase, Suite } from './test';\nimport { wrapFunctionWithLocation } from '../transform/transform';\nimport type { FixturesWithLocation } from './config';\nimport type { Fixtures, TestType, TestDetails } from '../../types/test';\nimport type { Location } from '../../types/testReporter';\nimport { getPackageManagerExecCommand, zones } from 'playwright-core/lib/utils';\n\nconst testTypeSymbol = Symbol('testType');\n\nexport class TestTypeImpl {\n  readonly fixtures: FixturesWithLocation[];\n  readonly test: TestType<any, any>;\n\n  constructor(fixtures: FixturesWithLocation[]) {\n    this.fixtures = fixtures;\n\n    const test: any = wrapFunctionWithLocation(this._createTest.bind(this, 'default'));\n    test[testTypeSymbol] = this;\n    test.expect = expect;\n    test.only = wrapFunctionWithLocation(this._createTest.bind(this, 'only'));\n    test.describe = wrapFunctionWithLocation(this._describe.bind(this, 'default'));\n    test.describe.only = wrapFunctionWithLocation(this._describe.bind(this, 'only'));\n    test.describe.configure = this._configure.bind(this);\n    test.describe.fixme = wrapFunctionWithLocation(this._describe.bind(this, 'fixme'));\n    test.describe.parallel = wrapFunctionWithLocation(this._describe.bind(this, 'parallel'));\n    test.describe.parallel.only = wrapFunctionWithLocation(this._describe.bind(this, 'parallel.only'));\n    test.describe.serial = wrapFunctionWithLocation(this._describe.bind(this, 'serial'));\n    test.describe.serial.only = wrapFunctionWithLocation(this._describe.bind(this, 'serial.only'));\n    test.describe.skip = wrapFunctionWithLocation(this._describe.bind(this, 'skip'));\n    test.beforeEach = wrapFunctionWithLocation(this._hook.bind(this, 'beforeEach'));\n    test.afterEach = wrapFunctionWithLocation(this._hook.bind(this, 'afterEach'));\n    test.beforeAll = wrapFunctionWithLocation(this._hook.bind(this, 'beforeAll'));\n    test.afterAll = wrapFunctionWithLocation(this._hook.bind(this, 'afterAll'));\n    test.skip = wrapFunctionWithLocation(this._modifier.bind(this, 'skip'));\n    test.fixme = wrapFunctionWithLocation(this._modifier.bind(this, 'fixme'));\n    test.fail = wrapFunctionWithLocation(this._modifier.bind(this, 'fail'));\n    test.slow = wrapFunctionWithLocation(this._modifier.bind(this, 'slow'));\n    test.setTimeout = this._setTimeout.bind(this);\n    test.step = this._step.bind(this);\n    test.use = wrapFunctionWithLocation(this._use.bind(this));\n    test.extend = wrapFunctionWithLocation(this._extend.bind(this));\n    test.info = () => {\n      const result = currentTestInfo();\n      if (!result)\n        throw new Error('test.info() can only be called while test is running');\n      return result;\n    };\n    this.test = test;\n  }\n\n  private _currentSuite(title: string): Suite | undefined {\n    const suite = currentlyLoadingFileSuite();\n    if (!suite) {\n      throw new Error([\n        `Playwright Test did not expect ${title} to be called here.`,\n        `Most common reasons include:`,\n        `- You are calling ${title} in a configuration file.`,\n        `- You are calling ${title} in a file that is imported by the configuration file.`,\n        `- You have two different versions of @playwright/test. This usually happens`,\n        `  when one of the dependencies in your package.json depends on @playwright/test.`,\n      ].join('\\n'));\n    }\n    if (suite._testTypeImpl && suite._testTypeImpl !== this) {\n      throw new Error([\n        `Can't call ${title} inside a describe() suite of a different test type.`,\n        `Make sure to use the same \"test\" function (created by the test.extend() call) for all declarations inside a suite.`,\n      ].join('\\n'));\n    }\n    return suite;\n  }\n\n  private _createTest(type: 'default' | 'only' | 'skip' | 'fixme' | 'fail', location: Location, title: string, fnOrDetails: Function | TestDetails, fn?: Function) {\n    throwIfRunningInsideJest();\n    const suite = this._currentSuite('test()');\n    if (!suite)\n      return;\n\n    let details: TestDetails;\n    let body: Function;\n    if (typeof fnOrDetails === 'function') {\n      body = fnOrDetails;\n      details = {};\n    } else {\n      body = fn!;\n      details = fnOrDetails;\n    }\n\n    const validatedDetails = validateTestDetails(details);\n    const test = new TestCase(title, body, this, location);\n    test._requireFile = suite._requireFile;\n    test._staticAnnotations.push(...validatedDetails.annotations);\n    test._tags.push(...validatedDetails.tags);\n    suite._addTest(test);\n\n    if (type === 'only')\n      test._only = true;\n    if (type === 'skip' || type === 'fixme' || type === 'fail')\n      test._staticAnnotations.push({ type });\n  }\n\n  private _describe(type: 'default' | 'only' | 'serial' | 'serial.only' | 'parallel' | 'parallel.only' | 'skip' | 'fixme', location: Location, titleOrFn: string | Function, fnOrDetails?: TestDetails | Function, fn?: Function) {\n    throwIfRunningInsideJest();\n    const suite = this._currentSuite('test.describe()');\n    if (!suite)\n      return;\n\n    let title: string;\n    let body: Function;\n    let details: TestDetails;\n\n    if (typeof titleOrFn === 'function') {\n      title = '';\n      details = {};\n      body = titleOrFn;\n    } else if (typeof fnOrDetails === 'function') {\n      title = titleOrFn;\n      details = {};\n      body = fnOrDetails;\n    } else {\n      title = titleOrFn;\n      details = fnOrDetails!;\n      body = fn!;\n    }\n\n    const validatedDetails = validateTestDetails(details);\n    const child = new Suite(title, 'describe', this);\n    child._requireFile = suite._requireFile;\n    child.location = location;\n    child._staticAnnotations.push(...validatedDetails.annotations);\n    child._tags.push(...validatedDetails.tags);\n    suite._addSuite(child);\n\n    if (type === 'only' || type === 'serial.only' || type === 'parallel.only')\n      child._only = true;\n    if (type === 'serial' || type === 'serial.only')\n      child._parallelMode = 'serial';\n    if (type === 'parallel' || type === 'parallel.only')\n      child._parallelMode = 'parallel';\n    if (type === 'skip' || type === 'fixme')\n      child._staticAnnotations.push({ type });\n\n    for (let parent: Suite | undefined = suite; parent; parent = parent.parent) {\n      if (parent._parallelMode === 'serial' && child._parallelMode === 'parallel')\n        throw new Error('describe.parallel cannot be nested inside describe.serial');\n      if (parent._parallelMode === 'default' && child._parallelMode === 'parallel')\n        throw new Error('describe.parallel cannot be nested inside describe with default mode');\n    }\n\n    setCurrentlyLoadingFileSuite(child);\n    body();\n    setCurrentlyLoadingFileSuite(suite);\n  }\n\n  private _hook(name: 'beforeEach' | 'afterEach' | 'beforeAll' | 'afterAll', location: Location, title: string | Function, fn?: Function) {\n    const suite = this._currentSuite(`test.${name}()`);\n    if (!suite)\n      return;\n    if (typeof title === 'function') {\n      fn = title;\n      title = `${name} hook`;\n    }\n\n    suite._hooks.push({ type: name, fn: fn!, title, location });\n  }\n\n  private _configure(options: { mode?: 'default' | 'parallel' | 'serial', retries?: number, timeout?: number }) {\n    throwIfRunningInsideJest();\n    const suite = this._currentSuite(`test.describe.configure()`);\n    if (!suite)\n      return;\n\n    if (options.timeout !== undefined)\n      suite._timeout = options.timeout;\n\n    if (options.retries !== undefined)\n      suite._retries = options.retries;\n\n    if (options.mode !== undefined) {\n      if (suite._parallelMode !== 'none')\n        throw new Error(`\"${suite._parallelMode}\" mode is already assigned for the enclosing scope.`);\n      suite._parallelMode = options.mode;\n      for (let parent: Suite | undefined = suite.parent; parent; parent = parent.parent) {\n        if (parent._parallelMode === 'serial' && suite._parallelMode === 'parallel')\n          throw new Error('describe with parallel mode cannot be nested inside describe with serial mode');\n        if (parent._parallelMode === 'default' && suite._parallelMode === 'parallel')\n          throw new Error('describe with parallel mode cannot be nested inside describe with default mode');\n      }\n    }\n  }\n\n  private _modifier(type: 'skip' | 'fail' | 'fixme' | 'slow', location: Location, ...modifierArgs: any[]) {\n    const suite = currentlyLoadingFileSuite();\n    if (suite) {\n      if (typeof modifierArgs[0] === 'string' && typeof modifierArgs[1] === 'function' && (type === 'skip' || type === 'fixme' || type === 'fail')) {\n        // Support for test.{skip,fixme,fail}(title, body)\n        this._createTest(type, location, modifierArgs[0], modifierArgs[1]);\n        return;\n      }\n      if (typeof modifierArgs[0] === 'string' && typeof modifierArgs[1] === 'object' && typeof modifierArgs[2] === 'function' && (type === 'skip' || type === 'fixme' || type === 'fail')) {\n        // Support for test.{skip,fixme,fail}(title, details, body)\n        this._createTest(type, location, modifierArgs[0], modifierArgs[1], modifierArgs[2]);\n        return;\n      }\n\n      if (typeof modifierArgs[0] === 'function') {\n        suite._modifiers.push({ type, fn: modifierArgs[0], location, description: modifierArgs[1] });\n      } else {\n        if (modifierArgs.length >= 1 && !modifierArgs[0])\n          return;\n        const description = modifierArgs[1];\n        suite._staticAnnotations.push({ type, description });\n      }\n      return;\n    }\n\n    const testInfo = currentTestInfo();\n    if (!testInfo)\n      throw new Error(`test.${type}() can only be called inside test, describe block or fixture`);\n    if (typeof modifierArgs[0] === 'function')\n      throw new Error(`test.${type}() with a function can only be called inside describe block`);\n    testInfo[type](...modifierArgs as [any, any]);\n  }\n\n  private _setTimeout(timeout: number) {\n    const suite = currentlyLoadingFileSuite();\n    if (suite) {\n      suite._timeout = timeout;\n      return;\n    }\n\n    const testInfo = currentTestInfo();\n    if (!testInfo)\n      throw new Error(`test.setTimeout() can only be called from a test`);\n    testInfo.setTimeout(timeout);\n  }\n\n  private _use(location: Location, fixtures: Fixtures) {\n    const suite = this._currentSuite(`test.use()`);\n    if (!suite)\n      return;\n    suite._use.push({ fixtures, location });\n  }\n\n  async _step<T>(title: string, body: () => Promise<T>, options: { box?: boolean } = {}): Promise<T> {\n    const testInfo = currentTestInfo();\n    if (!testInfo)\n      throw new Error(`test.step() can only be called from a test`);\n    const step = testInfo._addStep({ category: 'test.step', title, box: options.box });\n    return await zones.run('stepZone', step, async () => {\n      try {\n        const result = await body();\n        step.complete({});\n        return result;\n      } catch (error) {\n        step.complete({ error });\n        throw error;\n      }\n    });\n  }\n\n  private _extend(location: Location, fixtures: Fixtures) {\n    if ((fixtures as any)[testTypeSymbol])\n      throw new Error(`test.extend() accepts fixtures object, not a test object.\\nDid you mean to call mergeTests()?`);\n    const fixturesWithLocation: FixturesWithLocation = { fixtures, location };\n    return new TestTypeImpl([...this.fixtures, fixturesWithLocation]).test;\n  }\n}\n\nfunction throwIfRunningInsideJest() {\n  if (process.env.JEST_WORKER_ID) {\n    const packageManagerCommand = getPackageManagerExecCommand();\n    throw new Error(\n        `Playwright Test needs to be invoked via '${packageManagerCommand} playwright test' and excluded from Jest test runs.\\n` +\n        `Creating one directory for Playwright tests and one for Jest is the recommended way of doing it.\\n` +\n        `See https://playwright.dev/docs/intro for more information about Playwright Test.`,\n    );\n  }\n}\n\nfunction validateTestDetails(details: TestDetails) {\n  const annotations = Array.isArray(details.annotation) ? details.annotation : (details.annotation ? [details.annotation] : []);\n  const tags = Array.isArray(details.tag) ? details.tag : (details.tag ? [details.tag] : []);\n  for (const tag of tags) {\n    if (tag[0] !== '@')\n      throw new Error(`Tag must start with \"@\" symbol, got \"${tag}\" instead.`);\n  }\n  return { annotations, tags };\n}\n\nexport const rootTestType = new TestTypeImpl([]);\n\nexport function mergeTests(...tests: TestType<any, any>[]) {\n  let result = rootTestType;\n  for (const t of tests) {\n    const testTypeImpl = (t as any)[testTypeSymbol] as TestTypeImpl;\n    if (!testTypeImpl)\n      throw new Error(`mergeTests() accepts \"test\" functions as parameters.\\nDid you mean to call test.extend() with fixtures instead?`);\n    // Filter out common ancestor fixtures.\n    const newFixtures = testTypeImpl.fixtures.filter(theirs => !result.fixtures.find(ours => ours.fixtures === theirs.fixtures));\n    result = new TestTypeImpl([...result.fixtures, ...newFixtures]);\n  }\n  return result.test;\n}\n"],"mappings":"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"}