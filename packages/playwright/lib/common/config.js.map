{"version":3,"file":"config.js","names":["_fs","_interopRequireDefault","require","_path","_os","_util","obj","__esModule","default","defaultTimeout","exports","FullConfigInternal","constructor","location","userConfig","configCLIOverrides","config","configDir","webServers","plugins","projects","cliArgs","cliGrep","cliGrepInvert","cliOnlyChanged","cliProjectFilter","cliListOnly","cliPassWithNoTests","cliFailOnFlakyTests","testIdMatcher","defineConfigWasUsed","Error","resolvedConfigFile","packageJsonPath","getPackageJsonPath","packageJsonDir","path","dirname","process","cwd","privateConfiguration","map","p","factory","configFile","rootDir","pathResolve","testDir","forbidOnly","takeFirst","fullyParallel","globalSetup","resolveScript","globalTeardown","globalTimeout","grep","defaultGrep","grepInvert","maxFailures","debug","undefined","metadata","preserveOutput","reporter","resolveReporters","defaultReporter","reportSlowTests","max","threshold","quiet","shard","updateSnapshots","version","workers","webServer","key","startsWith","configInternalSymbol","endsWith","cpus","os","length","Math","floor","parseInt","parseWorkers","Array","isArray","projectConfigs","FullProjectInternal","resolveProjectDependencies","_assignUniqueProjectIds","project","usedNames","Set","name","i","candidate","has","id","__projectId","add","fullConfig","projectConfig","_this$expect$toHaveSc","expect","respectGitIgnore","snapshotPathTemplate","ignoreSnapshots","deps","teardown","defaultSnapshotPathTemplate","outputDir","join","repeatEach","retries","snapshotDir","testIgnore","testMatch","timeout","use","mergeObjects","dependencies","toHaveScreenshot","stylePath","stylePaths","resolve","args","arg","baseDir","relative","reporters","_toReporters","toReporters","builtInReporters","includes","paths","parsedWorkers","isNaN","teardownSet","dependencyName","filter","push","teardowns","dep","localPath","fs","existsSync","env","CI","Symbol","getProjectId"],"sources":["../../src/common/config.ts"],"sourcesContent":["/**\n * Copyright Microsoft Corporation. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport fs from 'fs';\nimport path from 'path';\nimport os from 'os';\nimport type { Config, Fixtures, Project, ReporterDescription } from '../../types/test';\nimport type { Location } from '../../types/testReporter';\nimport type { TestRunnerPluginRegistration } from '../plugins';\nimport { getPackageJsonPath, mergeObjects } from '../util';\nimport type { Matcher } from '../util';\nimport type { ConfigCLIOverrides } from './ipc';\nimport type { FullConfig, FullProject } from '../../types/testReporter';\n\nexport type ConfigLocation = {\n  resolvedConfigFile?: string;\n  configDir: string;\n};\n\nexport type FixturesWithLocation = {\n  fixtures: Fixtures;\n  location: Location;\n};\nexport type Annotation = { type: string, description?: string };\n\nexport const defaultTimeout = 30000;\n\nexport class FullConfigInternal {\n  readonly config: FullConfig;\n  readonly configDir: string;\n  readonly configCLIOverrides: ConfigCLIOverrides;\n  readonly webServers: NonNullable<FullConfig['webServer']>[];\n  readonly plugins: TestRunnerPluginRegistration[];\n  readonly projects: FullProjectInternal[] = [];\n  cliArgs: string[] = [];\n  cliGrep: string | undefined;\n  cliGrepInvert: string | undefined;\n  cliOnlyChanged: string | undefined;\n  cliProjectFilter?: string[];\n  cliListOnly = false;\n  cliPassWithNoTests?: boolean;\n  cliFailOnFlakyTests?: boolean;\n  testIdMatcher?: Matcher;\n  defineConfigWasUsed = false;\n\n  constructor(location: ConfigLocation, userConfig: Config, configCLIOverrides: ConfigCLIOverrides) {\n    if (configCLIOverrides.projects && userConfig.projects)\n      throw new Error(`Cannot use --browser option when configuration file defines projects. Specify browserName in the projects instead.`);\n\n    const { resolvedConfigFile, configDir } = location;\n    const packageJsonPath = getPackageJsonPath(configDir);\n    const packageJsonDir = packageJsonPath ? path.dirname(packageJsonPath) : process.cwd();\n\n    this.configDir = configDir;\n    this.configCLIOverrides = configCLIOverrides;\n    const privateConfiguration = (userConfig as any)['@playwright/test'];\n    this.plugins = (privateConfiguration?.plugins || []).map((p: any) => ({ factory: p }));\n\n    this.config = {\n      configFile: resolvedConfigFile,\n      rootDir: pathResolve(configDir, userConfig.testDir) || configDir,\n      forbidOnly: takeFirst(configCLIOverrides.forbidOnly, userConfig.forbidOnly, false),\n      fullyParallel: takeFirst(configCLIOverrides.fullyParallel, userConfig.fullyParallel, false),\n      globalSetup: takeFirst(resolveScript(userConfig.globalSetup, configDir), null),\n      globalTeardown: takeFirst(resolveScript(userConfig.globalTeardown, configDir), null),\n      globalTimeout: takeFirst(configCLIOverrides.globalTimeout, userConfig.globalTimeout, 0),\n      grep: takeFirst(userConfig.grep, defaultGrep),\n      grepInvert: takeFirst(userConfig.grepInvert, null),\n      maxFailures: takeFirst(configCLIOverrides.debug ? 1 : undefined, configCLIOverrides.maxFailures, userConfig.maxFailures, 0),\n      metadata: takeFirst(userConfig.metadata, {}),\n      preserveOutput: takeFirst(userConfig.preserveOutput, 'always'),\n      reporter: takeFirst(configCLIOverrides.reporter, resolveReporters(userConfig.reporter, configDir), [[defaultReporter]]),\n      reportSlowTests: takeFirst(userConfig.reportSlowTests, { max: 5, threshold: 15000 }),\n      quiet: takeFirst(configCLIOverrides.quiet, userConfig.quiet, false),\n      projects: [],\n      shard: takeFirst(configCLIOverrides.shard, userConfig.shard, null),\n      updateSnapshots: takeFirst(configCLIOverrides.updateSnapshots, userConfig.updateSnapshots, 'missing'),\n      version: require('../../package.json').version,\n      workers: 0,\n      webServer: null,\n    };\n    for (const key in userConfig) {\n      if (key.startsWith('@'))\n        (this.config as any)[key] = (userConfig as any)[key];\n    }\n\n    (this.config as any)[configInternalSymbol] = this;\n\n    const workers = takeFirst(configCLIOverrides.debug ? 1 : undefined, configCLIOverrides.workers, userConfig.workers, '50%');\n    if (typeof workers === 'string') {\n      if (workers.endsWith('%')) {\n        const cpus = os.cpus().length;\n        this.config.workers = Math.max(1, Math.floor(cpus * (parseInt(workers, 10) / 100)));\n      } else {\n        this.config.workers = parseWorkers(workers);\n      }\n    } else {\n      this.config.workers = workers;\n    }\n\n    const webServers = takeFirst(userConfig.webServer, null);\n    if (Array.isArray(webServers)) { // multiple web server mode\n      // Due to previous choices, this value shows up to the user in globalSetup as part of FullConfig. Arrays are not supported by the old type.\n      this.config.webServer = null;\n      this.webServers = webServers;\n    } else if (webServers) { // legacy singleton mode\n      this.config.webServer = webServers;\n      this.webServers = [webServers];\n    } else {\n      this.webServers = [];\n    }\n\n    const projectConfigs = configCLIOverrides.projects || userConfig.projects || [userConfig];\n    this.projects = projectConfigs.map(p => new FullProjectInternal(configDir, userConfig, this, p, this.configCLIOverrides, packageJsonDir));\n    resolveProjectDependencies(this.projects);\n    this._assignUniqueProjectIds(this.projects);\n    this.config.projects = this.projects.map(p => p.project);\n  }\n\n  private _assignUniqueProjectIds(projects: FullProjectInternal[]) {\n    const usedNames = new Set();\n    for (const p of projects) {\n      const name = p.project.name || '';\n      for (let i = 0; i < projects.length; ++i) {\n        const candidate = name + (i ? i : '');\n        if (usedNames.has(candidate))\n          continue;\n        p.id = candidate;\n        (p.project as any).__projectId = p.id;\n        usedNames.add(candidate);\n        break;\n      }\n    }\n  }\n}\n\nexport class FullProjectInternal {\n  readonly project: FullProject;\n  readonly fullConfig: FullConfigInternal;\n  readonly fullyParallel: boolean;\n  readonly expect: Project['expect'];\n  readonly respectGitIgnore: boolean;\n  readonly snapshotPathTemplate: string;\n  readonly ignoreSnapshots: boolean;\n  id = '';\n  deps: FullProjectInternal[] = [];\n  teardown: FullProjectInternal | undefined;\n\n  constructor(configDir: string, config: Config, fullConfig: FullConfigInternal, projectConfig: Project, configCLIOverrides: ConfigCLIOverrides, packageJsonDir: string) {\n    this.fullConfig = fullConfig;\n    const testDir = takeFirst(pathResolve(configDir, projectConfig.testDir), pathResolve(configDir, config.testDir), fullConfig.configDir);\n    const defaultSnapshotPathTemplate = '{snapshotDir}/{testFileDir}/{testFileName}-snapshots/{arg}{-projectName}{-snapshotSuffix}{ext}';\n    this.snapshotPathTemplate = takeFirst(projectConfig.snapshotPathTemplate, config.snapshotPathTemplate, defaultSnapshotPathTemplate);\n\n    this.project = {\n      grep: takeFirst(projectConfig.grep, config.grep, defaultGrep),\n      grepInvert: takeFirst(projectConfig.grepInvert, config.grepInvert, null),\n      outputDir: takeFirst(configCLIOverrides.outputDir, pathResolve(configDir, projectConfig.outputDir), pathResolve(configDir, config.outputDir), path.join(packageJsonDir, 'test-results')),\n      // Note: we either apply the cli override for repeatEach or not, depending on whether the\n      // project is top-level vs dependency. See collectProjectsAndTestFiles in loadUtils.\n      repeatEach: takeFirst(projectConfig.repeatEach, config.repeatEach, 1),\n      retries: takeFirst(configCLIOverrides.retries, projectConfig.retries, config.retries, 0),\n      metadata: takeFirst(projectConfig.metadata, config.metadata, {}),\n      name: takeFirst(projectConfig.name, config.name, ''),\n      testDir,\n      snapshotDir: takeFirst(pathResolve(configDir, projectConfig.snapshotDir), pathResolve(configDir, config.snapshotDir), testDir),\n      testIgnore: takeFirst(projectConfig.testIgnore, config.testIgnore, []),\n      testMatch: takeFirst(projectConfig.testMatch, config.testMatch, '**/*.@(spec|test).?(c|m)[jt]s?(x)'),\n      timeout: takeFirst(configCLIOverrides.debug ? 0 : undefined, configCLIOverrides.timeout, projectConfig.timeout, config.timeout, defaultTimeout),\n      use: mergeObjects(config.use, projectConfig.use, configCLIOverrides.use),\n      dependencies: projectConfig.dependencies || [],\n      teardown: projectConfig.teardown,\n    };\n    this.fullyParallel = takeFirst(configCLIOverrides.fullyParallel, projectConfig.fullyParallel, config.fullyParallel, undefined);\n    this.expect = takeFirst(projectConfig.expect, config.expect, {});\n    if (this.expect.toHaveScreenshot?.stylePath) {\n      const stylePaths = Array.isArray(this.expect.toHaveScreenshot.stylePath) ? this.expect.toHaveScreenshot.stylePath : [this.expect.toHaveScreenshot.stylePath];\n      this.expect.toHaveScreenshot.stylePath = stylePaths.map(stylePath => path.resolve(configDir, stylePath));\n    }\n    this.respectGitIgnore = takeFirst(projectConfig.respectGitIgnore, config.respectGitIgnore, !projectConfig.testDir && !config.testDir);\n    this.ignoreSnapshots = takeFirst(configCLIOverrides.ignoreSnapshots,  projectConfig.ignoreSnapshots, config.ignoreSnapshots, false);\n  }\n}\n\nexport function takeFirst<T>(...args: (T | undefined)[]): T {\n  for (const arg of args) {\n    if (arg !== undefined)\n      return arg;\n  }\n  return undefined as any as T;\n}\n\nfunction pathResolve(baseDir: string, relative: string | undefined): string | undefined {\n  if (!relative)\n    return undefined;\n  return path.resolve(baseDir, relative);\n}\n\nfunction resolveReporters(reporters: Config['reporter'], rootDir: string): ReporterDescription[] | undefined {\n  return toReporters(reporters as any)?.map(([id, arg]) => {\n    if (builtInReporters.includes(id as any))\n      return [id, arg];\n    return [require.resolve(id, { paths: [rootDir] }), arg];\n  });\n}\n\nfunction parseWorkers(workers: string) {\n  const parsedWorkers = parseInt(workers, 10);\n  if (isNaN(parsedWorkers))\n    throw new Error(`Workers ${workers} must be a number or percentage.`);\n\n  return parsedWorkers;\n}\n\nfunction resolveProjectDependencies(projects: FullProjectInternal[]) {\n  const teardownSet = new Set<FullProjectInternal>();\n  for (const project of projects) {\n    for (const dependencyName of project.project.dependencies) {\n      const dependencies = projects.filter(p => p.project.name === dependencyName);\n      if (!dependencies.length)\n        throw new Error(`Project '${project.project.name}' depends on unknown project '${dependencyName}'`);\n      if (dependencies.length > 1)\n        throw new Error(`Project dependencies should have unique names, reading ${dependencyName}`);\n      project.deps.push(...dependencies);\n    }\n    if (project.project.teardown) {\n      const teardowns = projects.filter(p => p.project.name === project.project.teardown);\n      if (!teardowns.length)\n        throw new Error(`Project '${project.project.name}' has unknown teardown project '${project.project.teardown}'`);\n      if (teardowns.length > 1)\n        throw new Error(`Project teardowns should have unique names, reading ${project.project.teardown}`);\n      const teardown = teardowns[0];\n      project.teardown = teardown;\n      teardownSet.add(teardown);\n    }\n  }\n  for (const teardown of teardownSet) {\n    if (teardown.deps.length)\n      throw new Error(`Teardown project ${teardown.project.name} must not have dependencies`);\n  }\n  for (const project of projects) {\n    for (const dep of project.deps) {\n      if (teardownSet.has(dep))\n        throw new Error(`Project ${project.project.name} must not depend on a teardown project ${dep.project.name}`);\n    }\n  }\n}\n\nexport function toReporters(reporters: BuiltInReporter | ReporterDescription[] | undefined): ReporterDescription[] | undefined {\n  if (!reporters)\n    return;\n  if (typeof reporters === 'string')\n    return [[reporters]];\n  return reporters;\n}\n\nexport const builtInReporters = ['list', 'line', 'dot', 'json', 'junit', 'null', 'github', 'html', 'blob', 'markdown'] as const;\nexport type BuiltInReporter = typeof builtInReporters[number];\n\nexport type ContextReuseMode = 'none' | 'when-possible';\n\nfunction resolveScript(id: string | undefined, rootDir: string): string | undefined {\n  if (!id)\n    return undefined;\n  const localPath = path.resolve(rootDir, id);\n  if (fs.existsSync(localPath))\n    return localPath;\n  return require.resolve(id, { paths: [rootDir] });\n}\n\nexport const defaultGrep = /.*/;\nexport const defaultReporter = process.env.CI ? 'dot' : 'list';\n\nconst configInternalSymbol = Symbol('configInternalSymbol');\n\nexport function getProjectId(project: FullProject): string {\n  return (project as any).__projectId!;\n}"],"mappings":"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"}