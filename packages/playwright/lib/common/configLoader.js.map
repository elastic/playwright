{"version":3,"file":"configLoader.js","names":["fs","_interopRequireWildcard","require","path","_utils","_transform","_util","_config","_compilationCache","_esmLoaderHost","_esmUtils","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","kDefineConfigWasUsed","Symbol","defineConfig","configs","result","length","config","expect","use","build","webServer","Array","isArray","projects","projectOverrides","Map","project","name","projectOverride","push","delete","values","exports","deserializeConfig","data","compilationCache","addToCompilationCache","loadConfig","location","configCLIOverrides","loadUserConfig","object","resolvedConfigFile","requireOrImport","overrides","ignoreProjectDependencies","_playwrightTest","_userConfig$build","setSingleTSConfig","tsconfig","configureESMLoader","userConfig","validateConfig","fullConfig","FullConfigInternal","defineConfigWasUsed","deps","teardown","undefined","babelPlugins","external","setTransformConfig","configureESMLoaderTransformConfig","file","errorWithFile","validateProject","forbidOnly","globalSetup","globalTeardown","globalTimeout","grep","forEach","item","index","isRegExp","grepInvert","maxFailures","preserveOutput","includes","quiet","reporter","reportSlowTests","max","threshold","shard","total","current","updateSnapshots","workers","endsWith","title","outputDir","repeatEach","retries","testDir","prop","value","timeout","ignoreSnapshots","resolveConfigLocation","configFile","configFileOrDirectory","resolve","process","cwd","resolveConfigFile","configDir","dirname","resolveConfig","existsSync","resolveConfigFileFromDirectory","directory","ext","Error","statSync","isDirectory","loadConfigFromFileRestartIfNeeded","ignoreDeps","restartWithExperimentalTsEsm","loadEmptyConfigForMergeReports","force","env","PW_DISABLE_TS_ESM","globalThis","__esmLoaderPortPreV20","execArgv","execArgvWithoutExperimentalLoaderOptions","register","nodeVersion","versions","node","split","configIsModule","fileIsModule","innerProcess","fork","argv","slice","PW_TS_ESM_LEGACY_LOADER_ON","execArgvWithExperimentalLoaderOptions","on","code","gracefullyProcessExitDoNotHang","registerESMLoader"],"sources":["../../src/common/configLoader.ts"],"sourcesContent":["/**\n * Copyright Microsoft Corporation. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport { gracefullyProcessExitDoNotHang, isRegExp } from 'playwright-core/lib/utils';\nimport type { ConfigCLIOverrides, SerializedConfig } from './ipc';\nimport { requireOrImport, setSingleTSConfig, setTransformConfig } from '../transform/transform';\nimport type { Config, Project } from '../../types/test';\nimport { errorWithFile, fileIsModule } from '../util';\nimport type { ConfigLocation } from './config';\nimport { FullConfigInternal } from './config';\nimport { addToCompilationCache } from '../transform/compilationCache';\nimport { configureESMLoader, configureESMLoaderTransformConfig, registerESMLoader } from './esmLoaderHost';\nimport { execArgvWithExperimentalLoaderOptions, execArgvWithoutExperimentalLoaderOptions } from '../transform/esmUtils';\n\nconst kDefineConfigWasUsed = Symbol('defineConfigWasUsed');\nexport const defineConfig = (...configs: any[]) => {\n  let result = configs[0];\n  for (let i = 1; i < configs.length; ++i) {\n    const config = configs[i];\n    result = {\n      ...result,\n      ...config,\n      expect: {\n        ...result.expect,\n        ...config.expect,\n      },\n      use: {\n        ...result.use,\n        ...config.use,\n      },\n      build: {\n        ...result.build,\n        ...config.build,\n      },\n      webServer: [\n        ...(Array.isArray(result.webServer) ? result.webServer : (result.webServer ? [result.webServer] : [])),\n        ...(Array.isArray(config.webServer) ? config.webServer : (config.webServer ? [config.webServer] : [])),\n      ]\n    };\n\n    if (!result.projects && !config.projects)\n      continue;\n\n    const projectOverrides = new Map<string, any>();\n    for (const project of config.projects || [])\n      projectOverrides.set(project.name, project);\n\n    const projects = [];\n    for (const project of result.projects || []) {\n      const projectOverride = projectOverrides.get(project.name);\n      if (projectOverride) {\n        projects.push({\n          ...project,\n          ...projectOverride,\n          use: {\n            ...project.use,\n            ...projectOverride.use,\n          }\n        });\n        projectOverrides.delete(project.name);\n      } else {\n        projects.push(project);\n      }\n    }\n    projects.push(...projectOverrides.values());\n    result.projects = projects;\n  }\n  result[kDefineConfigWasUsed] = true;\n  return result;\n};\n\nexport async function deserializeConfig(data: SerializedConfig): Promise<FullConfigInternal> {\n  if (data.compilationCache)\n    addToCompilationCache(data.compilationCache);\n  return await loadConfig(data.location, data.configCLIOverrides);\n}\n\nasync function loadUserConfig(location: ConfigLocation): Promise<Config> {\n  let object = location.resolvedConfigFile ? await requireOrImport(location.resolvedConfigFile) : {};\n  if (object && typeof object === 'object' && ('default' in object))\n    object = object['default'];\n  return object as Config;\n}\n\nexport async function loadConfig(location: ConfigLocation, overrides?: ConfigCLIOverrides, ignoreProjectDependencies = false): Promise<FullConfigInternal> {\n  // 1. Setup tsconfig; configure ESM loader with tsconfig and compilation cache.\n  setSingleTSConfig(overrides?.tsconfig);\n  await configureESMLoader();\n\n  // 2. Load and validate playwright config.\n  const userConfig = await loadUserConfig(location);\n  validateConfig(location.resolvedConfigFile || '<default config>', userConfig);\n  const fullConfig = new FullConfigInternal(location, userConfig, overrides || {});\n  fullConfig.defineConfigWasUsed = !!(userConfig as any)[kDefineConfigWasUsed];\n  if (ignoreProjectDependencies) {\n    for (const project of fullConfig.projects) {\n      project.deps = [];\n      project.teardown = undefined;\n    }\n  }\n\n  // 3. Load transform options from the playwright config.\n  const babelPlugins = (userConfig as any)['@playwright/test']?.babelPlugins || [];\n  const external = userConfig.build?.external || [];\n  setTransformConfig({ babelPlugins, external });\n\n  // 4. Send transform options to ESM loader.\n  await configureESMLoaderTransformConfig();\n\n  return fullConfig;\n}\n\nfunction validateConfig(file: string, config: Config) {\n  if (typeof config !== 'object' || !config)\n    throw errorWithFile(file, `Configuration file must export a single object`);\n\n  validateProject(file, config, 'config');\n\n  if ('forbidOnly' in config && config.forbidOnly !== undefined) {\n    if (typeof config.forbidOnly !== 'boolean')\n      throw errorWithFile(file, `config.forbidOnly must be a boolean`);\n  }\n\n  if ('globalSetup' in config && config.globalSetup !== undefined) {\n    if (typeof config.globalSetup !== 'string')\n      throw errorWithFile(file, `config.globalSetup must be a string`);\n  }\n\n  if ('globalTeardown' in config && config.globalTeardown !== undefined) {\n    if (typeof config.globalTeardown !== 'string')\n      throw errorWithFile(file, `config.globalTeardown must be a string`);\n  }\n\n  if ('globalTimeout' in config && config.globalTimeout !== undefined) {\n    if (typeof config.globalTimeout !== 'number' || config.globalTimeout < 0)\n      throw errorWithFile(file, `config.globalTimeout must be a non-negative number`);\n  }\n\n  if ('grep' in config && config.grep !== undefined) {\n    if (Array.isArray(config.grep)) {\n      config.grep.forEach((item, index) => {\n        if (!isRegExp(item))\n          throw errorWithFile(file, `config.grep[${index}] must be a RegExp`);\n      });\n    } else if (!isRegExp(config.grep)) {\n      throw errorWithFile(file, `config.grep must be a RegExp`);\n    }\n  }\n\n  if ('grepInvert' in config && config.grepInvert !== undefined) {\n    if (Array.isArray(config.grepInvert)) {\n      config.grepInvert.forEach((item, index) => {\n        if (!isRegExp(item))\n          throw errorWithFile(file, `config.grepInvert[${index}] must be a RegExp`);\n      });\n    } else if (!isRegExp(config.grepInvert)) {\n      throw errorWithFile(file, `config.grepInvert must be a RegExp`);\n    }\n  }\n\n  if ('maxFailures' in config && config.maxFailures !== undefined) {\n    if (typeof config.maxFailures !== 'number' || config.maxFailures < 0)\n      throw errorWithFile(file, `config.maxFailures must be a non-negative number`);\n  }\n\n  if ('preserveOutput' in config && config.preserveOutput !== undefined) {\n    if (typeof config.preserveOutput !== 'string' || !['always', 'never', 'failures-only'].includes(config.preserveOutput))\n      throw errorWithFile(file, `config.preserveOutput must be one of \"always\", \"never\" or \"failures-only\"`);\n  }\n\n  if ('projects' in config && config.projects !== undefined) {\n    if (!Array.isArray(config.projects))\n      throw errorWithFile(file, `config.projects must be an array`);\n    config.projects.forEach((project, index) => {\n      validateProject(file, project, `config.projects[${index}]`);\n    });\n  }\n\n  if ('quiet' in config && config.quiet !== undefined) {\n    if (typeof config.quiet !== 'boolean')\n      throw errorWithFile(file, `config.quiet must be a boolean`);\n  }\n\n  if ('reporter' in config && config.reporter !== undefined) {\n    if (Array.isArray(config.reporter)) {\n      config.reporter.forEach((item, index) => {\n        if (!Array.isArray(item) || item.length <= 0 || item.length > 2 || typeof item[0] !== 'string')\n          throw errorWithFile(file, `config.reporter[${index}] must be a tuple [name, optionalArgument]`);\n      });\n    } else if (typeof config.reporter !== 'string') {\n      throw errorWithFile(file, `config.reporter must be a string`);\n    }\n  }\n\n  if ('reportSlowTests' in config && config.reportSlowTests !== undefined && config.reportSlowTests !== null) {\n    if (!config.reportSlowTests || typeof config.reportSlowTests !== 'object')\n      throw errorWithFile(file, `config.reportSlowTests must be an object`);\n    if (!('max' in config.reportSlowTests) || typeof config.reportSlowTests.max !== 'number' || config.reportSlowTests.max < 0)\n      throw errorWithFile(file, `config.reportSlowTests.max must be a non-negative number`);\n    if (!('threshold' in config.reportSlowTests) || typeof config.reportSlowTests.threshold !== 'number' || config.reportSlowTests.threshold < 0)\n      throw errorWithFile(file, `config.reportSlowTests.threshold must be a non-negative number`);\n  }\n\n  if ('shard' in config && config.shard !== undefined && config.shard !== null) {\n    if (!config.shard || typeof config.shard !== 'object')\n      throw errorWithFile(file, `config.shard must be an object`);\n    if (!('total' in config.shard) || typeof config.shard.total !== 'number' || config.shard.total < 1)\n      throw errorWithFile(file, `config.shard.total must be a positive number`);\n    if (!('current' in config.shard) || typeof config.shard.current !== 'number' || config.shard.current < 1 || config.shard.current > config.shard.total)\n      throw errorWithFile(file, `config.shard.current must be a positive number, not greater than config.shard.total`);\n  }\n\n  if ('updateSnapshots' in config && config.updateSnapshots !== undefined) {\n    if (typeof config.updateSnapshots !== 'string' || !['all', 'none', 'missing'].includes(config.updateSnapshots))\n      throw errorWithFile(file, `config.updateSnapshots must be one of \"all\", \"none\" or \"missing\"`);\n  }\n\n  if ('workers' in config && config.workers !== undefined) {\n    if (typeof config.workers === 'number' && config.workers <= 0)\n      throw errorWithFile(file, `config.workers must be a positive number`);\n    else if (typeof config.workers === 'string' && !config.workers.endsWith('%'))\n      throw errorWithFile(file, `config.workers must be a number or percentage`);\n  }\n}\n\nfunction validateProject(file: string, project: Project, title: string) {\n  if (typeof project !== 'object' || !project)\n    throw errorWithFile(file, `${title} must be an object`);\n\n  if ('name' in project && project.name !== undefined) {\n    if (typeof project.name !== 'string')\n      throw errorWithFile(file, `${title}.name must be a string`);\n  }\n\n  if ('outputDir' in project && project.outputDir !== undefined) {\n    if (typeof project.outputDir !== 'string')\n      throw errorWithFile(file, `${title}.outputDir must be a string`);\n  }\n\n  if ('repeatEach' in project && project.repeatEach !== undefined) {\n    if (typeof project.repeatEach !== 'number' || project.repeatEach < 0)\n      throw errorWithFile(file, `${title}.repeatEach must be a non-negative number`);\n  }\n\n  if ('retries' in project && project.retries !== undefined) {\n    if (typeof project.retries !== 'number' || project.retries < 0)\n      throw errorWithFile(file, `${title}.retries must be a non-negative number`);\n  }\n\n  if ('testDir' in project && project.testDir !== undefined) {\n    if (typeof project.testDir !== 'string')\n      throw errorWithFile(file, `${title}.testDir must be a string`);\n  }\n\n  for (const prop of ['testIgnore', 'testMatch'] as const) {\n    if (prop in project && project[prop] !== undefined) {\n      const value = project[prop];\n      if (Array.isArray(value)) {\n        value.forEach((item, index) => {\n          if (typeof item !== 'string' && !isRegExp(item))\n            throw errorWithFile(file, `${title}.${prop}[${index}] must be a string or a RegExp`);\n        });\n      } else if (typeof value !== 'string' && !isRegExp(value)) {\n        throw errorWithFile(file, `${title}.${prop} must be a string or a RegExp`);\n      }\n    }\n  }\n\n  if ('timeout' in project && project.timeout !== undefined) {\n    if (typeof project.timeout !== 'number' || project.timeout < 0)\n      throw errorWithFile(file, `${title}.timeout must be a non-negative number`);\n  }\n\n  if ('use' in project && project.use !== undefined) {\n    if (!project.use || typeof project.use !== 'object')\n      throw errorWithFile(file, `${title}.use must be an object`);\n  }\n\n  if ('ignoreSnapshots' in project && project.ignoreSnapshots !== undefined) {\n    if (typeof project.ignoreSnapshots !== 'boolean')\n      throw errorWithFile(file, `${title}.ignoreSnapshots must be a boolean`);\n  }\n}\n\nexport function resolveConfigLocation(configFile: string | undefined): ConfigLocation {\n  const configFileOrDirectory = configFile ? path.resolve(process.cwd(), configFile) : process.cwd();\n  const resolvedConfigFile = resolveConfigFile(configFileOrDirectory);\n  return {\n    resolvedConfigFile,\n    configDir: resolvedConfigFile ? path.dirname(resolvedConfigFile) : configFileOrDirectory,\n  };\n}\n\nfunction resolveConfigFile(configFileOrDirectory: string): string | undefined {\n  const resolveConfig = (configFile: string) => {\n    if (fs.existsSync(configFile))\n      return configFile;\n  };\n\n  const resolveConfigFileFromDirectory = (directory: string) => {\n    for (const ext of ['.ts', '.js', '.mts', '.mjs', '.cts', '.cjs']) {\n      const configFile = resolveConfig(path.resolve(directory, 'playwright.config' + ext));\n      if (configFile)\n        return configFile;\n    }\n  };\n\n  if (!fs.existsSync(configFileOrDirectory))\n    throw new Error(`${configFileOrDirectory} does not exist`);\n  if (fs.statSync(configFileOrDirectory).isDirectory()) {\n    // When passed a directory, look for a config file inside.\n    const configFile = resolveConfigFileFromDirectory(configFileOrDirectory);\n    if (configFile)\n      return configFile;\n    // If there is no config, assume this as a root testing directory.\n    return undefined;\n  }\n  // When passed a file, it must be a config file.\n  return configFileOrDirectory!;\n}\n\nexport async function loadConfigFromFileRestartIfNeeded(configFile: string | undefined, overrides?: ConfigCLIOverrides, ignoreDeps?: boolean): Promise<FullConfigInternal | null> {\n  const location = resolveConfigLocation(configFile);\n  if (restartWithExperimentalTsEsm(location.resolvedConfigFile))\n    return null;\n  return await loadConfig(location, overrides, ignoreDeps);\n}\n\nexport async function loadEmptyConfigForMergeReports() {\n  // Merge reports is \"different\" for no good reason. It should not pick up local config from the cwd.\n  return await loadConfig({ configDir: process.cwd() });\n}\n\nexport function restartWithExperimentalTsEsm(configFile: string | undefined, force: boolean = false): boolean {\n  // Opt-out switch.\n  if (process.env.PW_DISABLE_TS_ESM)\n    return false;\n\n  // There are two esm loader APIs:\n  // - Older API that needs a process restart. Available in Node 16, 17, and non-latest 18, 19 and 20.\n  // - Newer API that works in-process. Available in Node 21+ and latest 18, 19 and 20.\n\n  // First check whether we have already restarted with the ESM loader from the older API.\n  if ((globalThis as any).__esmLoaderPortPreV20) {\n    // clear execArgv after restart, so that childProcess.fork in user code does not inherit our loader.\n    process.execArgv = execArgvWithoutExperimentalLoaderOptions();\n    return false;\n  }\n\n  // Now check for the newer API presence.\n  if (!require('node:module').register) {\n    // Older API is experimental, only supported on Node 16+.\n    const nodeVersion = +process.versions.node.split('.')[0];\n    if (nodeVersion < 16)\n      return false;\n\n    // With older API requiring a process restart, do so conditionally on the config.\n    const configIsModule = !!configFile && fileIsModule(configFile);\n    if (!force && !configIsModule)\n      return false;\n\n    const innerProcess = (require('child_process') as typeof import('child_process')).fork(require.resolve('../../cli'), process.argv.slice(2), {\n      env: {\n        ...process.env,\n        PW_TS_ESM_LEGACY_LOADER_ON: '1',\n      },\n      execArgv: execArgvWithExperimentalLoaderOptions(),\n    });\n\n    innerProcess.on('close', (code: number | null) => {\n      if (code !== 0 && code !== null)\n        gracefullyProcessExitDoNotHang(code);\n    });\n    return true;\n  }\n\n  // With the newer API, always enable the ESM loader, because it does not need a restart.\n  registerESMLoader();\n  return false;\n}\n"],"mappings":"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"}