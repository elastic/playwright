{"version":3,"file":"testInfo.js","names":["_fs","_interopRequireDefault","require","_path","_utils","_timeoutManager","_util","_testTracing","obj","__esModule","default","TestInfoImpl","error","errors","e","undefined","Error","timeout","defaultSlot","_deadlineForMatcher","startTime","monotonicTime","matcherDeadline","kMaxDeadline","testDeadline","currentSlotDeadline","matcherMessage","testMessage","deadline","Math","min","timeoutMessage","_defaultDeadlineForMatcher","constructor","configInternal","projectInternal","workerParams","test","retry","onStepBegin","onStepEnd","onAttach","_test$id","_test$_requireFile","_test$title","_test$titlePath","_test$location$file","_test$location$line","_test$location$column","_test$tags","_test$fn","_test$expectedStatus","_onStepBegin","_onStepEnd","_onAttach","_startTime","_startWallTime","_tracing","_wasInterrupted","_lastStepId","_requireFile","_projectInternal","_configInternal","_steps","_onDidFinishTestFunction","_hasNonRetriableError","_hasUnhandledError","_allowSkips","testId","repeatEachIndex","workerIndex","parallelIndex","project","config","title","titlePath","file","line","tags","column","fn","expectedStatus","duration","annotations","attachments","status","snapshotSuffix","outputDir","snapshotDir","_attachmentsPush","id","Date","now","location","TimeoutManager","configCLIOverrides","debug","_setDebugMode","relativeTestFilePath","path","relative","testDir","replace","sanitizedRelativePath","process","platform","RegExp","fullTitleWithoutSpec","slice","join","testOutputDir","trimLongString","sanitizeForFilePath","windowsFilesystemFriendlyLength","push","bind","a","_attach","name","length","TestTracing","artifactsDir","_modifier","type","modifierArgs","description","slow","SkipError","_findLastStageStep","steps","i","child","isStage","endWallTime","_addStep","data","_parentStep","_parentStep2","stepId","category","parentStep","zones","zoneData","filteredStack","filteredStackTrace","captureRawStack","boxedStack","box","step","complete","result","_result$error","stepSymbol","serializeError","stack","message","stringifyStackFrames","childStep","infectParentStepsWithError","payload","wallTime","errorForTrace","appendAfterActionForStep","parentStepList","parentStepId","appendBeforeActionForStep","apiName","params","_interrupt","interrupt","_failWithError","TimeoutManagerError","serialized","appendForError","_runAsStage","stage","cb","debugTest","enabled","_stage$runnable","runnable","formatLocation","stepInfo","_stage$step","withRunnable","_stage$step2","_isFailure","_currentHookType","currentSlotType","includes","setIgnoreTimeouts","attach","options","normalizeAndSaveAttachment","outputPath","attachment","_attachment$body","contentType","body","toString","pathSegments","_getOutputPath","fs","mkdirSync","recursive","joinedPath","getContainedPath","_fsSanitizedTestName","snapshotPath","subPath","parsedSubPath","parse","parsedRelativeTestFilePath","projectNamePathSegment","snapshotPathTemplate","dir","base","ext","normalize","resolve","configDir","skip","args","fixme","fail","setTimeout","exports","Symbol"],"sources":["../../src/worker/testInfo.ts"],"sourcesContent":["/**\n * Copyright Microsoft Corporation. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport fs from 'fs';\nimport path from 'path';\nimport { captureRawStack, monotonicTime, zones, sanitizeForFilePath, stringifyStackFrames } from 'playwright-core/lib/utils';\nimport type { TestInfoError, TestInfo, TestStatus, FullProject } from '../../types/test';\nimport type { AttachmentPayload, StepBeginPayload, StepEndPayload, WorkerInitParams } from '../common/ipc';\nimport type { TestCase } from '../common/test';\nimport { TimeoutManager, TimeoutManagerError, kMaxDeadline } from './timeoutManager';\nimport type { RunnableDescription } from './timeoutManager';\nimport type { Annotation, FullConfigInternal, FullProjectInternal } from '../common/config';\nimport type { FullConfig, Location } from '../../types/testReporter';\nimport { debugTest, filteredStackTrace, formatLocation, getContainedPath, normalizeAndSaveAttachment, serializeError, trimLongString, windowsFilesystemFriendlyLength } from '../util';\nimport { TestTracing } from './testTracing';\nimport type { Attachment } from './testTracing';\nimport type { StackFrame } from '@protocol/channels';\n\nexport interface TestStepInternal {\n  complete(result: { error?: Error | unknown, attachments?: Attachment[] }): void;\n  stepId: string;\n  title: string;\n  category: 'hook' | 'fixture' | 'test.step' | 'expect' | 'attach' | string;\n  location?: Location;\n  boxedStack?: StackFrame[];\n  steps: TestStepInternal[];\n  endWallTime?: number;\n  apiName?: string;\n  params?: Record<string, any>;\n  error?: TestInfoError;\n  infectParentStepsWithError?: boolean;\n  box?: boolean;\n  isStage?: boolean;\n}\n\nexport type TestStage = {\n  title: string;\n  stepInfo?: { category: 'hook' | 'fixture', location?: Location };\n  runnable?: RunnableDescription;\n  step?: TestStepInternal;\n};\n\nexport class TestInfoImpl implements TestInfo {\n  private _onStepBegin: (payload: StepBeginPayload) => void;\n  private _onStepEnd: (payload: StepEndPayload) => void;\n  private _onAttach: (payload: AttachmentPayload) => void;\n  readonly _timeoutManager: TimeoutManager;\n  readonly _startTime: number;\n  readonly _startWallTime: number;\n  readonly _tracing: TestTracing;\n\n  _wasInterrupted = false;\n  _lastStepId = 0;\n  private readonly _requireFile: string;\n  readonly _projectInternal: FullProjectInternal;\n  readonly _configInternal: FullConfigInternal;\n  private readonly _steps: TestStepInternal[] = [];\n  _onDidFinishTestFunction: (() => Promise<void>) | undefined;\n  _hasNonRetriableError = false;\n  _hasUnhandledError = false;\n  _allowSkips = false;\n\n  // ------------ TestInfo fields ------------\n  readonly testId: string;\n  readonly repeatEachIndex: number;\n  readonly retry: number;\n  readonly workerIndex: number;\n  readonly parallelIndex: number;\n  readonly project: FullProject;\n  readonly config: FullConfig;\n  readonly title: string;\n  readonly titlePath: string[];\n  readonly file: string;\n  readonly line: number;\n  readonly tags: string[];\n  readonly column: number;\n  readonly fn: Function;\n  expectedStatus: TestStatus;\n  duration: number = 0;\n  readonly annotations: Annotation[] = [];\n  readonly attachments: TestInfo['attachments'] = [];\n  status: TestStatus = 'passed';\n  snapshotSuffix: string = '';\n  readonly outputDir: string;\n  readonly snapshotDir: string;\n  errors: TestInfoError[] = [];\n  readonly _attachmentsPush: (...items: TestInfo['attachments']) => number;\n\n  get error(): TestInfoError | undefined {\n    return this.errors[0];\n  }\n\n  set error(e: TestInfoError | undefined) {\n    if (e === undefined)\n      throw new Error('Cannot assign testInfo.error undefined value!');\n    this.errors[0] = e;\n  }\n\n  get timeout(): number {\n    return this._timeoutManager.defaultSlot().timeout;\n  }\n\n  set timeout(timeout: number) {\n    // Ignored.\n  }\n\n  _deadlineForMatcher(timeout: number): { deadline: number, timeoutMessage: string } {\n    const startTime = monotonicTime();\n    const matcherDeadline = timeout ? startTime + timeout : kMaxDeadline;\n    const testDeadline = this._timeoutManager.currentSlotDeadline() - 250;\n    const matcherMessage = `Timeout ${timeout}ms exceeded while waiting on the predicate`;\n    const testMessage = `Test timeout of ${this.timeout}ms exceeded`;\n    return { deadline: Math.min(testDeadline, matcherDeadline), timeoutMessage: testDeadline < matcherDeadline ? testMessage : matcherMessage };\n  }\n\n  static _defaultDeadlineForMatcher(timeout: number): { deadline: any; timeoutMessage: any; } {\n    return { deadline: (timeout ? monotonicTime() + timeout : 0), timeoutMessage: `Timeout ${timeout}ms exceeded while waiting on the predicate` };\n  }\n\n  constructor(\n    configInternal: FullConfigInternal,\n    projectInternal: FullProjectInternal,\n    workerParams: WorkerInitParams,\n    test: TestCase | undefined,\n    retry: number,\n    onStepBegin: (payload: StepBeginPayload) => void,\n    onStepEnd: (payload: StepEndPayload) => void,\n    onAttach: (payload: AttachmentPayload) => void,\n  ) {\n    this.testId = test?.id ?? '';\n    this._onStepBegin = onStepBegin;\n    this._onStepEnd = onStepEnd;\n    this._onAttach = onAttach;\n    this._startTime = monotonicTime();\n    this._startWallTime = Date.now();\n    this._requireFile = test?._requireFile ?? '';\n\n    this.repeatEachIndex = workerParams.repeatEachIndex;\n    this.retry = retry;\n    this.workerIndex = workerParams.workerIndex;\n    this.parallelIndex =  workerParams.parallelIndex;\n    this._projectInternal = projectInternal;\n    this.project = projectInternal.project;\n    this._configInternal = configInternal;\n    this.config = configInternal.config;\n    this.title = test?.title ?? '';\n    this.titlePath = test?.titlePath() ?? [];\n    this.file = test?.location.file ?? '';\n    this.line = test?.location.line ?? 0;\n    this.column = test?.location.column ?? 0;\n    this.tags = test?.tags ?? [];\n    this.fn = test?.fn ?? (() => {});\n    this.expectedStatus = test?.expectedStatus ?? 'skipped';\n\n    this._timeoutManager = new TimeoutManager(this.project.timeout);\n    if (configInternal.configCLIOverrides.debug)\n      this._setDebugMode();\n\n    this.outputDir = (() => {\n      const relativeTestFilePath = path.relative(this.project.testDir, this._requireFile.replace(/\\.(spec|test)\\.(js|ts|jsx|tsx|mjs|mts|cjs|cts)$/, ''));\n      const sanitizedRelativePath = relativeTestFilePath.replace(process.platform === 'win32' ? new RegExp('\\\\\\\\', 'g') : new RegExp('/', 'g'), '-');\n      const fullTitleWithoutSpec = this.titlePath.slice(1).join(' ');\n\n      let testOutputDir = trimLongString(sanitizedRelativePath + '-' + sanitizeForFilePath(fullTitleWithoutSpec), windowsFilesystemFriendlyLength);\n      if (projectInternal.id)\n        testOutputDir += '-' + sanitizeForFilePath(projectInternal.id);\n      if (this.retry)\n        testOutputDir += '-retry' + this.retry;\n      if (this.repeatEachIndex)\n        testOutputDir += '-repeat' + this.repeatEachIndex;\n      return path.join(this.project.outputDir, testOutputDir);\n    })();\n\n    this.snapshotDir = (() => {\n      const relativeTestFilePath = path.relative(this.project.testDir, this._requireFile);\n      return path.join(this.project.snapshotDir, relativeTestFilePath + '-snapshots');\n    })();\n\n    this._attachmentsPush = this.attachments.push.bind(this.attachments);\n    this.attachments.push = (...attachments: TestInfo['attachments']) => {\n      for (const a of attachments)\n        this._attach(a.name, a);\n      return this.attachments.length;\n    };\n\n    this._tracing = new TestTracing(this, workerParams.artifactsDir);\n  }\n\n  private _modifier(type: 'skip' | 'fail' | 'fixme' | 'slow', modifierArgs: [arg?: any, description?: string]) {\n    if (typeof modifierArgs[1] === 'function') {\n      throw new Error([\n        'It looks like you are calling test.skip() inside the test and pass a callback.',\n        'Pass a condition instead and optional description instead:',\n        `test('my test', async ({ page, isMobile }) => {`,\n        `  test.skip(isMobile, 'This test is not applicable on mobile');`,\n        `});`,\n      ].join('\\n'));\n    }\n\n    if (modifierArgs.length >= 1 && !modifierArgs[0])\n      return;\n\n    const description = modifierArgs[1];\n    this.annotations.push({ type, description });\n    if (type === 'slow') {\n      this._timeoutManager.slow();\n    } else if (type === 'skip' || type === 'fixme') {\n      this.expectedStatus = 'skipped';\n      throw new SkipError('Test is skipped: ' + (description || ''));\n    } else if (type === 'fail') {\n      if (this.expectedStatus !== 'skipped')\n        this.expectedStatus = 'failed';\n    }\n  }\n\n  private _findLastStageStep(steps: TestStepInternal[]): TestStepInternal | undefined {\n    // Find the deepest step that is marked as isStage and has not finished yet.\n    for (let i = steps.length - 1; i >= 0; i--) {\n      const child = this._findLastStageStep(steps[i].steps);\n      if (child)\n        return child;\n      if (steps[i].isStage && !steps[i].endWallTime)\n        return steps[i];\n    }\n  }\n\n  _addStep(data: Omit<TestStepInternal, 'complete' | 'stepId' | 'steps'>): TestStepInternal {\n    const stepId = `${data.category}@${++this._lastStepId}`;\n\n    let parentStep: TestStepInternal | undefined;\n    if (data.isStage) {\n      // Predefined stages form a fixed hierarchy - use the current one as parent.\n      parentStep = this._findLastStageStep(this._steps);\n    } else {\n      parentStep = zones.zoneData<TestStepInternal>('stepZone');\n      if (!parentStep) {\n        // If no parent step on stack, assume the current stage as parent.\n        parentStep = this._findLastStageStep(this._steps);\n      }\n    }\n\n    const filteredStack = filteredStackTrace(captureRawStack());\n    data.boxedStack = parentStep?.boxedStack;\n    if (!data.boxedStack && data.box) {\n      data.boxedStack = filteredStack.slice(1);\n      data.location = data.location || data.boxedStack[0];\n    }\n    data.location = data.location || filteredStack[0];\n\n    const step: TestStepInternal = {\n      stepId,\n      ...data,\n      steps: [],\n      complete: result => {\n        if (step.endWallTime)\n          return;\n\n        step.endWallTime = Date.now();\n        if (result.error) {\n          if (typeof result.error === 'object' && !(result.error as any)?.[stepSymbol])\n            (result.error as any)[stepSymbol] = step;\n          const error = serializeError(result.error);\n          if (data.boxedStack)\n            error.stack = `${error.message}\\n${stringifyStackFrames(data.boxedStack).join('\\n')}`;\n          step.error = error;\n        }\n\n        if (!step.error) {\n          // Soft errors inside try/catch will make the test fail.\n          // In order to locate the failing step, we are marking all the parent\n          // steps as failing unconditionally.\n          for (const childStep of step.steps) {\n            if (childStep.error && childStep.infectParentStepsWithError) {\n              step.error = childStep.error;\n              step.infectParentStepsWithError = true;\n              break;\n            }\n          }\n        }\n\n        const payload: StepEndPayload = {\n          testId: this.testId,\n          stepId,\n          wallTime: step.endWallTime,\n          error: step.error,\n        };\n        this._onStepEnd(payload);\n        const errorForTrace = step.error ? { name: '', message: step.error.message || '', stack: step.error.stack } : undefined;\n        this._tracing.appendAfterActionForStep(stepId, errorForTrace, result.attachments);\n      }\n    };\n    const parentStepList = parentStep ? parentStep.steps : this._steps;\n    parentStepList.push(step);\n    const payload: StepBeginPayload = {\n      testId: this.testId,\n      stepId,\n      parentStepId: parentStep ? parentStep.stepId : undefined,\n      title: data.title,\n      category: data.category,\n      wallTime: Date.now(),\n      location: data.location,\n    };\n    this._onStepBegin(payload);\n    this._tracing.appendBeforeActionForStep(stepId, parentStep?.stepId, data.apiName || data.title, data.params, data.location ? [data.location] : []);\n    return step;\n  }\n\n  _interrupt() {\n    // Mark as interrupted so we can ignore TimeoutError thrown by interrupt() call.\n    this._wasInterrupted = true;\n    this._timeoutManager.interrupt();\n    // Do not overwrite existing failure (for example, unhandled rejection) with \"interrupted\".\n    if (this.status === 'passed')\n      this.status = 'interrupted';\n  }\n\n  _failWithError(error: Error | unknown) {\n    if (this.status === 'passed' || this.status === 'skipped')\n      this.status = error instanceof TimeoutManagerError ? 'timedOut' : 'failed';\n    const serialized = serializeError(error);\n    const step: TestStepInternal | undefined = typeof error === 'object' ? (error as any)?.[stepSymbol] : undefined;\n    if (step && step.boxedStack)\n      serialized.stack = `${(error as Error).name}: ${(error as Error).message}\\n${stringifyStackFrames(step.boxedStack).join('\\n')}`;\n    this.errors.push(serialized);\n    this._tracing.appendForError(serialized);\n  }\n\n  async _runAsStage(stage: TestStage, cb: () => Promise<any>) {\n    if (debugTest.enabled) {\n      const location = stage.runnable?.location ? ` at \"${formatLocation(stage.runnable.location)}\"` : ``;\n      debugTest(`started stage \"${stage.title}\"${location}`);\n    }\n    stage.step = stage.stepInfo ? this._addStep({ ...stage.stepInfo, title: stage.title, isStage: true }) : undefined;\n\n    try {\n      await this._timeoutManager.withRunnable(stage.runnable, async () => {\n        try {\n          await cb();\n        } catch (e) {\n          // Only handle errors directly thrown by the user code.\n          if (!stage.runnable)\n            throw e;\n          if (this._allowSkips && (e instanceof SkipError)) {\n            if (this.status === 'passed')\n              this.status = 'skipped';\n          } else {\n            // Unfortunately, we have to handle user errors and timeout errors differently.\n            // Consider the following scenario:\n            // - locator.click times out\n            // - all stages containing the test function finish with TimeoutManagerError\n            // - test finishes, the page is closed and this triggers locator.click error\n            // - we would like to present the locator.click error to the user\n            // - therefore, we need a try/catch inside the \"run with timeout\" block and capture the error\n            this._failWithError(e);\n          }\n          throw e;\n        }\n      });\n      stage.step?.complete({});\n    } catch (error) {\n      // When interrupting, we arrive here with a TimeoutManagerError, but we should not\n      // consider it a timeout.\n      if (!this._wasInterrupted && (error instanceof TimeoutManagerError) && stage.runnable)\n        this._failWithError(error);\n      stage.step?.complete({ error });\n      throw error;\n    } finally {\n      debugTest(`finished stage \"${stage.title}\"`);\n    }\n  }\n\n  _isFailure() {\n    return this.status !== 'skipped' && this.status !== this.expectedStatus;\n  }\n\n  _currentHookType() {\n    const type = this._timeoutManager.currentSlotType();\n    return ['beforeAll', 'afterAll', 'beforeEach', 'afterEach'].includes(type) ? type : undefined;\n  }\n\n  _setDebugMode() {\n    this._timeoutManager.setIgnoreTimeouts();\n  }\n\n  // ------------ TestInfo methods ------------\n\n  async attach(name: string, options: { path?: string, body?: string | Buffer, contentType?: string } = {}) {\n    this._attach(name, await normalizeAndSaveAttachment(this.outputPath(), name, options));\n  }\n\n  private _attach(name: string, attachment: TestInfo['attachments'][0]) {\n    const step = this._addStep({\n      title: `attach \"${name}\"`,\n      category: 'attach',\n    });\n    this._attachmentsPush(attachment);\n    this._onAttach({\n      testId: this.testId,\n      name: attachment.name,\n      contentType: attachment.contentType,\n      path: attachment.path,\n      body: attachment.body?.toString('base64')\n    });\n    step.complete({ attachments: [attachment] });\n  }\n\n  outputPath(...pathSegments: string[]){\n    const outputPath = this._getOutputPath(...pathSegments);\n    fs.mkdirSync(this.outputDir, { recursive: true });\n    return outputPath;\n  }\n\n  _getOutputPath(...pathSegments: string[]){\n    const joinedPath = path.join(...pathSegments);\n    const outputPath = getContainedPath(this.outputDir, joinedPath);\n    if (outputPath)\n      return outputPath;\n    throw new Error(`The outputPath is not allowed outside of the parent directory. Please fix the defined path.\\n\\n\\toutputPath: ${joinedPath}`);\n  }\n\n  _fsSanitizedTestName() {\n    const fullTitleWithoutSpec = this.titlePath.slice(1).join(' ');\n    return sanitizeForFilePath(trimLongString(fullTitleWithoutSpec));\n  }\n\n  snapshotPath(...pathSegments: string[]) {\n    const subPath = path.join(...pathSegments);\n    const parsedSubPath = path.parse(subPath);\n    const relativeTestFilePath = path.relative(this.project.testDir, this._requireFile);\n    const parsedRelativeTestFilePath = path.parse(relativeTestFilePath);\n    const projectNamePathSegment = sanitizeForFilePath(this.project.name);\n\n    const snapshotPath = (this._projectInternal.snapshotPathTemplate || '')\n        .replace(/\\{(.)?testDir\\}/g, '$1' + this.project.testDir)\n        .replace(/\\{(.)?snapshotDir\\}/g, '$1' + this.project.snapshotDir)\n        .replace(/\\{(.)?snapshotSuffix\\}/g, this.snapshotSuffix ? '$1' + this.snapshotSuffix : '')\n        .replace(/\\{(.)?testFileDir\\}/g, '$1' + parsedRelativeTestFilePath.dir)\n        .replace(/\\{(.)?platform\\}/g, '$1' + process.platform)\n        .replace(/\\{(.)?projectName\\}/g, projectNamePathSegment ? '$1' + projectNamePathSegment : '')\n        .replace(/\\{(.)?testName\\}/g, '$1' + this._fsSanitizedTestName())\n        .replace(/\\{(.)?testFileName\\}/g, '$1' + parsedRelativeTestFilePath.base)\n        .replace(/\\{(.)?testFilePath\\}/g, '$1' + relativeTestFilePath)\n        .replace(/\\{(.)?arg\\}/g, '$1' + path.join(parsedSubPath.dir, parsedSubPath.name))\n        .replace(/\\{(.)?ext\\}/g, parsedSubPath.ext ? '$1' + parsedSubPath.ext : '');\n\n    return path.normalize(path.resolve(this._configInternal.configDir, snapshotPath));\n  }\n\n  skip(...args: [arg?: any, description?: string]) {\n    this._modifier('skip', args);\n  }\n\n  fixme(...args: [arg?: any, description?: string]) {\n    this._modifier('fixme', args);\n  }\n\n  fail(...args: [arg?: any, description?: string]) {\n    this._modifier('fail', args);\n  }\n\n  slow(...args: [arg?: any, description?: string]) {\n    this._modifier('slow', args);\n  }\n\n  setTimeout(timeout: number) {\n    this._timeoutManager.setTimeout(timeout);\n  }\n}\n\nexport class SkipError extends Error {\n}\n\nconst stepSymbol = Symbol('step');\n"],"mappings":"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"}