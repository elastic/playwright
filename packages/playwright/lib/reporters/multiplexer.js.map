{"version":3,"file":"multiplexer.js","names":["Multiplexer","constructor","reporters","_reporters","version","onConfigure","config","reporter","wrap","onBegin","suite","onTestBegin","test","result","onStdOut","chunk","onStdErr","onTestEnd","onEnd","outResult","wrapAsync","status","onExit","onError","error","onStepBegin","step","onStepEnd","printsToStdio","some","r","prints","exports","callback","e","console"],"sources":["../../src/reporters/multiplexer.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { FullConfig, TestCase, TestError, TestResult, FullResult, TestStep } from '../../types/testReporter';\nimport type { Suite } from '../common/test';\nimport type { ReporterV2 } from './reporterV2';\n\nexport class Multiplexer implements ReporterV2 {\n  private _reporters: ReporterV2[];\n\n  constructor(reporters: ReporterV2[]) {\n    this._reporters = reporters;\n  }\n\n  version(): 'v2' {\n    return 'v2';\n  }\n\n  onConfigure(config: FullConfig) {\n    for (const reporter of this._reporters)\n      wrap(() => reporter.onConfigure(config));\n  }\n\n  onBegin(suite: Suite) {\n    for (const reporter of this._reporters)\n      wrap(() => reporter.onBegin(suite));\n  }\n\n  onTestBegin(test: TestCase, result: TestResult) {\n    for (const reporter of this._reporters)\n      wrap(() => reporter.onTestBegin(test, result));\n  }\n\n  onStdOut(chunk: string | Buffer, test?: TestCase, result?: TestResult) {\n    for (const reporter of this._reporters)\n      wrap(() => reporter.onStdOut(chunk, test, result));\n  }\n\n  onStdErr(chunk: string | Buffer, test?: TestCase, result?: TestResult) {\n    for (const reporter of this._reporters)\n      wrap(() => reporter.onStdErr(chunk, test, result));\n  }\n\n  onTestEnd(test: TestCase, result: TestResult) {\n    for (const reporter of this._reporters)\n      wrap(() => reporter.onTestEnd(test, result));\n  }\n\n  async onEnd(result: FullResult) {\n    for (const reporter of this._reporters) {\n      const outResult = await wrapAsync(() => reporter.onEnd(result));\n      if (outResult?.status)\n        result.status = outResult.status;\n    }\n    return result;\n  }\n\n  async onExit() {\n    for (const reporter of this._reporters)\n      await wrapAsync(() => reporter.onExit());\n  }\n\n  onError(error: TestError) {\n    for (const reporter of this._reporters)\n      wrap(() => reporter.onError(error));\n  }\n\n  onStepBegin(test: TestCase, result: TestResult, step: TestStep) {\n    for (const reporter of this._reporters)\n      wrap(() => reporter.onStepBegin(test, result, step));\n  }\n\n  onStepEnd(test: TestCase, result: TestResult, step: TestStep) {\n    for (const reporter of this._reporters)\n      wrap(() => reporter.onStepEnd(test, result, step));\n  }\n\n  printsToStdio(): boolean {\n    return this._reporters.some(r => {\n      let prints = true;\n      wrap(() => prints = r.printsToStdio());\n      return prints;\n    });\n  }\n}\n\nasync function wrapAsync<T>(callback: () => T | Promise<T>) {\n  try {\n    return await callback();\n  } catch (e) {\n    console.error('Error in reporter', e);\n  }\n}\n\nfunction wrap(callback: () => void) {\n  try {\n    callback();\n  } catch (e) {\n    console.error('Error in reporter', e);\n  }\n}\n"],"mappings":"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"}