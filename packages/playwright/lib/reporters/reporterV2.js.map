{"version":3,"file":"reporterV2.js","names":["wrapReporterAsV2","reporter","version","e","ReporterV2Wrapper","constructor","_reporter","_deferred","_config","onConfigure","config","onBegin","suite","_this$_reporter$onBeg","_this$_reporter","call","deferred","item","error","onError","stdout","onStdOut","chunk","test","result","stderr","onStdErr","onTestBegin","_this$_reporter$onTes","_this$_reporter2","_this$_reporter$onStd","_this$_reporter3","push","_this$_reporter$onStd2","_this$_reporter4","onTestEnd","_this$_reporter$onTes2","_this$_reporter5","onEnd","_this$_reporter$onEnd","_this$_reporter6","onExit","_this$_reporter$onExi","_this$_reporter7","_this$_reporter$onErr","_this$_reporter8","onStepBegin","step","_this$_reporter$onSte","_this$_reporter9","onStepEnd","_this$_reporter$onSte2","_this$_reporter10","printsToStdio"],"sources":["../../src/reporters/reporterV2.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { FullConfig, TestCase, TestError, TestResult, FullResult, TestStep, Reporter, Suite } from '../../types/testReporter';\n\nexport interface ReporterV2 {\n  onConfigure(config: FullConfig): void;\n  onBegin(suite: Suite): void;\n  onTestBegin(test: TestCase, result: TestResult): void;\n  onStdOut(chunk: string | Buffer, test?: TestCase, result?: TestResult): void;\n  onStdErr(chunk: string | Buffer, test?: TestCase, result?: TestResult): void;\n  onTestEnd(test: TestCase, result: TestResult): void;\n  onEnd(result: FullResult): Promise<{ status?: FullResult['status'] } | undefined | void> | void;\n  onExit(): void | Promise<void>;\n  onError(error: TestError): void;\n  onStepBegin(test: TestCase, result: TestResult, step: TestStep): void;\n  onStepEnd(test: TestCase, result: TestResult, step: TestStep): void;\n  printsToStdio(): boolean;\n  version(): 'v2';\n}\n\ntype StdIOChunk = {\n  chunk: string | Buffer;\n  test?: TestCase;\n  result?: TestResult;\n};\n\nexport function wrapReporterAsV2(reporter: Reporter | ReporterV2): ReporterV2 {\n  try {\n    if ('version' in reporter && reporter.version() === 'v2')\n      return reporter as ReporterV2;\n  } catch (e) {\n  }\n  return new ReporterV2Wrapper(reporter as Reporter);\n}\n\nclass ReporterV2Wrapper implements ReporterV2 {\n  private _reporter: Reporter;\n  private _deferred: { error?: TestError, stdout?: StdIOChunk, stderr?: StdIOChunk }[] | null = [];\n  private _config!: FullConfig;\n\n  constructor(reporter: Reporter) {\n    this._reporter = reporter;\n  }\n\n  version(): 'v2' {\n    return 'v2';\n  }\n\n  onConfigure(config: FullConfig) {\n    this._config = config;\n  }\n\n  onBegin(suite: Suite) {\n    this._reporter.onBegin?.(this._config, suite);\n\n    const deferred = this._deferred!;\n    this._deferred = null;\n    for (const item of deferred) {\n      if (item.error)\n        this.onError(item.error);\n      if (item.stdout)\n        this.onStdOut(item.stdout.chunk, item.stdout.test, item.stdout.result);\n      if (item.stderr)\n        this.onStdErr(item.stderr.chunk, item.stderr.test, item.stderr.result);\n    }\n  }\n\n  onTestBegin(test: TestCase, result: TestResult) {\n    this._reporter.onTestBegin?.(test, result);\n  }\n\n  onStdOut(chunk: string | Buffer, test?: TestCase, result?: TestResult) {\n    if (this._deferred) {\n      this._deferred.push({ stdout: { chunk, test, result } });\n      return;\n    }\n    this._reporter.onStdOut?.(chunk, test, result);\n  }\n\n  onStdErr(chunk: string | Buffer, test?: TestCase, result?: TestResult) {\n    if (this._deferred) {\n      this._deferred.push({ stderr: { chunk, test, result } });\n      return;\n    }\n    this._reporter.onStdErr?.(chunk, test, result);\n  }\n\n  onTestEnd(test: TestCase, result: TestResult) {\n    this._reporter.onTestEnd?.(test, result);\n  }\n\n  async onEnd(result: FullResult) {\n    return await this._reporter.onEnd?.(result);\n  }\n\n  async onExit() {\n    await this._reporter.onExit?.();\n  }\n\n  onError(error: TestError) {\n    if (this._deferred) {\n      this._deferred.push({ error });\n      return;\n    }\n    this._reporter.onError?.(error);\n  }\n\n  onStepBegin(test: TestCase, result: TestResult, step: TestStep) {\n    this._reporter.onStepBegin?.(test, result, step);\n  }\n\n  onStepEnd(test: TestCase, result: TestResult, step: TestStep) {\n    this._reporter.onStepEnd?.(test, result, step);\n  }\n\n  printsToStdio() {\n    return this._reporter.printsToStdio ? this._reporter.printsToStdio() : true;\n  }\n}\n"],"mappings":"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"}