{"version":3,"file":"markdown.js","names":["_fs","_interopRequireDefault","require","_path","_util","_base","obj","__esModule","default","MarkdownReporter","BaseReporter","constructor","options","_options","printsToStdio","onEnd","result","summary","generateSummary","lines","fatalErrors","length","push","unexpected","_printTestList","flaky","interrupted","skipped","didNotRun","expected","reportFile","resolveReporterOutputPath","configDir","outputFile","fs","promises","mkdir","path","dirname","recursive","writeFile","join","prefix","tests","suffix","test","formatTestTitle","config","_default","exports"],"sources":["../../src/reporters/markdown.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport fs from 'fs';\nimport path from 'path';\nimport type { FullResult, TestCase } from '../../types/testReporter';\nimport { resolveReporterOutputPath } from '../util';\nimport { BaseReporter, formatTestTitle } from './base';\n\ntype MarkdownReporterOptions = {\n  configDir: string,\n  outputFile?: string;\n};\n\n\nclass MarkdownReporter extends BaseReporter {\n  private _options: MarkdownReporterOptions;\n\n  constructor(options: MarkdownReporterOptions) {\n    super();\n    this._options = options;\n  }\n\n  override printsToStdio() {\n    return false;\n  }\n\n  override async onEnd(result: FullResult) {\n    await super.onEnd(result);\n    const summary = this.generateSummary();\n    const lines: string[] = [];\n    if (summary.fatalErrors.length)\n      lines.push(`**${summary.fatalErrors.length} fatal errors, not part of any test**`);\n    if (summary.unexpected.length) {\n      lines.push(`**${summary.unexpected.length} failed**`);\n      this._printTestList(':x:', summary.unexpected, lines);\n    }\n    if (summary.flaky.length) {\n      lines.push(`<details>`);\n      lines.push(`<summary><b>${summary.flaky.length} flaky</b></summary>`);\n      this._printTestList(':warning:', summary.flaky, lines, ' <br/>');\n      lines.push(`</details>`);\n      lines.push(``);\n    }\n    if (summary.interrupted.length) {\n      lines.push(`<details>`);\n      lines.push(`<summary><b>${summary.interrupted.length} interrupted</b></summary>`);\n      this._printTestList(':warning:', summary.interrupted, lines, ' <br/>');\n      lines.push(`</details>`);\n      lines.push(``);\n    }\n    const skipped = summary.skipped ? `, ${summary.skipped} skipped` : '';\n    const didNotRun = summary.didNotRun ? `, ${summary.didNotRun} did not run` : '';\n    lines.push(`**${summary.expected} passed${skipped}${didNotRun}**`);\n    lines.push(`:heavy_check_mark::heavy_check_mark::heavy_check_mark:`);\n    lines.push(``);\n\n    const reportFile = resolveReporterOutputPath('report.md', this._options.configDir, this._options.outputFile);\n    await fs.promises.mkdir(path.dirname(reportFile), { recursive: true });\n    await fs.promises.writeFile(reportFile, lines.join('\\n'));\n  }\n\n  private _printTestList(prefix: string, tests: TestCase[], lines: string[], suffix?: string) {\n    for (const test of tests)\n      lines.push(`${prefix} ${formatTestTitle(this.config, test)}${suffix || ''}`);\n    lines.push(``);\n  }\n}\n\nexport default MarkdownReporter;\n"],"mappings":"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"}