{"version":3,"file":"events.js","names":["Disposable","exports","_Disposable","disposeAll","disposables","disposable","splice","dispose","EventEmitter","constructor","event","_deliveryQueue","_listeners","Set","listener","add","disposed","self","result","delete","push","fire","dispatch","index","length","call","undefined","clear"],"sources":["../../src/isomorphic/events.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport namespace Disposable {\n  export function disposeAll(disposables: Disposable[]): void {\n    for (const disposable of disposables.splice(0))\n      disposable.dispose();\n  }\n}\n\nexport type Disposable = {\n  dispose(): void;\n};\n\nexport interface Event<T> {\n  (listener: (e: T) => any, disposables?: Disposable[]): Disposable;\n}\n\nexport class EventEmitter<T> {\n  public event: Event<T>;\n\n  private _deliveryQueue?: {listener: (e: T) => void, event: T}[];\n  private _listeners = new Set<(e: T) => void>();\n\n  constructor() {\n    this.event = (listener: (e: T) => any, disposables?: Disposable[]) => {\n      this._listeners.add(listener);\n      let disposed = false;\n      const self = this;\n      const result: Disposable = {\n        dispose() {\n          if (!disposed) {\n            disposed = true;\n            self._listeners.delete(listener);\n          }\n        }\n      };\n      if (disposables)\n        disposables.push(result);\n      return result;\n    };\n  }\n\n  fire(event: T): void {\n    const dispatch = !this._deliveryQueue;\n    if (!this._deliveryQueue)\n      this._deliveryQueue = [];\n    for (const listener of this._listeners)\n      this._deliveryQueue.push({ listener, event });\n    if (!dispatch)\n      return;\n    for (let index = 0; index < this._deliveryQueue.length; index++) {\n      const { listener, event } = this._deliveryQueue[index];\n      listener.call(null, event);\n    }\n    this._deliveryQueue = undefined;\n  }\n\n  dispose() {\n    this._listeners.clear();\n    if (this._deliveryQueue)\n      this._deliveryQueue = [];\n  }\n}\n"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAdA,IAgBiBA,UAAU,GAAAC,OAAA,CAAAD,UAAA;AAAA,WAAAE,WAAA;EAClB,SAASC,UAAUA,CAACC,WAAyB,EAAQ;IAC1D,KAAK,MAAMC,UAAU,IAAID,WAAW,CAACE,MAAM,CAAC,CAAC,CAAC,EAC5CD,UAAU,CAACE,OAAO,CAAC,CAAC;EACxB;EAACL,WAAA,CAAAC,UAAA,GAAAA,UAAA;AAAA,GAJcH,UAAU,KAAAC,OAAA,CAAAD,UAAA,GAAVA,UAAU;AAepB,MAAMQ,YAAY,CAAI;EAM3BC,WAAWA,CAAA,EAAG;IAAA,KALPC,KAAK;IAAA,KAEJC,cAAc;IAAA,KACdC,UAAU,GAAG,IAAIC,GAAG,CAAiB,CAAC;IAG5C,IAAI,CAACH,KAAK,GAAG,CAACI,QAAuB,EAAEV,WAA0B,KAAK;MACpE,IAAI,CAACQ,UAAU,CAACG,GAAG,CAACD,QAAQ,CAAC;MAC7B,IAAIE,QAAQ,GAAG,KAAK;MACpB,MAAMC,IAAI,GAAG,IAAI;MACjB,MAAMC,MAAkB,GAAG;QACzBX,OAAOA,CAAA,EAAG;UACR,IAAI,CAACS,QAAQ,EAAE;YACbA,QAAQ,GAAG,IAAI;YACfC,IAAI,CAACL,UAAU,CAACO,MAAM,CAACL,QAAQ,CAAC;UAClC;QACF;MACF,CAAC;MACD,IAAIV,WAAW,EACbA,WAAW,CAACgB,IAAI,CAACF,MAAM,CAAC;MAC1B,OAAOA,MAAM;IACf,CAAC;EACH;EAEAG,IAAIA,CAACX,KAAQ,EAAQ;IACnB,MAAMY,QAAQ,GAAG,CAAC,IAAI,CAACX,cAAc;IACrC,IAAI,CAAC,IAAI,CAACA,cAAc,EACtB,IAAI,CAACA,cAAc,GAAG,EAAE;IAC1B,KAAK,MAAMG,QAAQ,IAAI,IAAI,CAACF,UAAU,EACpC,IAAI,CAACD,cAAc,CAACS,IAAI,CAAC;MAAEN,QAAQ;MAAEJ;IAAM,CAAC,CAAC;IAC/C,IAAI,CAACY,QAAQ,EACX;IACF,KAAK,IAAIC,KAAK,GAAG,CAAC,EAAEA,KAAK,GAAG,IAAI,CAACZ,cAAc,CAACa,MAAM,EAAED,KAAK,EAAE,EAAE;MAC/D,MAAM;QAAET,QAAQ;QAAEJ;MAAM,CAAC,GAAG,IAAI,CAACC,cAAc,CAACY,KAAK,CAAC;MACtDT,QAAQ,CAACW,IAAI,CAAC,IAAI,EAAEf,KAAK,CAAC;IAC5B;IACA,IAAI,CAACC,cAAc,GAAGe,SAAS;EACjC;EAEAnB,OAAOA,CAAA,EAAG;IACR,IAAI,CAACK,UAAU,CAACe,KAAK,CAAC,CAAC;IACvB,IAAI,IAAI,CAAChB,cAAc,EACrB,IAAI,CAACA,cAAc,GAAG,EAAE;EAC5B;AACF;AAACV,OAAA,CAAAO,YAAA,GAAAA,YAAA"}