{"version":3,"file":"expect.js","names":["_utils","require","_matchers","_toMatchSnapshot","_globals","_util","_expectBundle","_testInfo","_matcherHint","printSubstring","val","replace","printReceivedStringContainExpectedSubstring","received","start","length","RECEIVED_COLOR","slice","INVERTED_COLOR","exports","printReceivedStringContainExpectedResult","result","printReceived","index","createMatchers","actual","info","Proxy","expectLibrary","ExpectMetaInfoProxyHandler","createExpect","expectInstance","apply","target","thisArg","argumentsList","messageOrOptions","message","isString","newInfo","isPoll","Error","generator","get","property","configure","matchers","wrappedMatchers","name","matcher","Object","entries","args","isNot","promise","utils","newThis","timeout","currentExpectTimeout","equals","throwUnsupportedExpectMatcherError","call","extend","soft","poll","_poll","configuration","isSoft","pollTimeout","pollIntervals","intervals","setState","expand","customAsyncMatchers","toBeAttached","toBeChecked","toBeDisabled","toBeEditable","toBeEmpty","toBeEnabled","toBeFocused","toBeHidden","toBeInViewport","toBeOK","toBeVisible","toContainText","toHaveAccessibleDescription","toHaveAccessibleName","toHaveAttribute","toHaveClass","toHaveCount","toHaveCSS","toHaveId","toHaveJSProperty","toHaveRole","toHaveText","toHaveTitle","toHaveURL","toHaveValue","toHaveValues","toHaveScreenshot","toPass","customMatchers","toMatchSnapshot","constructor","_info","matcherName","receiver","Reflect","undefined","_this$_info$pollTimeo","pollMatcher","testInfo","currentTestInfo","setCurrentExpectConfigureTimeout","customMessage","argsSuffix","computeArgsSuffix","defaultTitle","title","stackFrames","filteredStackTrace","captureRawStack","stepInfo","category","trimLongString","params","expected","infectParentStepsWithError","step","_addStep","reportStepError","jestError","error","isExpectError","ExpectError","complete","_failWithError","finalizer","callback","zones","run","stepId","Promise","then","catch","e","deadline","timeoutMessage","_deadlineForMatcher","TestInfoImpl","_defaultDeadlineForMatcher","pollAgainstDeadline","continuePolling","value","not","timedOut","join","currentExpectConfigureTimeout","_testInfo$_projectInt","defaultExpectTimeout","_projectInternal","expect","toHaveScreenshotStepTitle","mergeExpects","expects"],"sources":["../../src/matchers/expect.ts"],"sourcesContent":["/**\n * Copyright Microsoft Corporation. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  captureRawStack,\n  isString,\n  pollAgainstDeadline } from 'playwright-core/lib/utils';\nimport type { ExpectZone } from 'playwright-core/lib/utils';\nimport {\n  toBeAttached,\n  toBeChecked,\n  toBeDisabled,\n  toBeEditable,\n  toBeEmpty,\n  toBeEnabled,\n  toBeFocused,\n  toBeHidden,\n  toBeInViewport,\n  toBeOK,\n  toBeVisible,\n  toContainText,\n  toHaveAccessibleDescription,\n  toHaveAccessibleName,\n  toHaveAttribute,\n  toHaveClass,\n  toHaveCount,\n  toHaveCSS,\n  toHaveId,\n  toHaveJSProperty,\n  toHaveRole,\n  toHaveText,\n  toHaveTitle,\n  toHaveURL,\n  toHaveValue,\n  toHaveValues,\n  toPass\n} from './matchers';\nimport { toMatchSnapshot, toHaveScreenshot, toHaveScreenshotStepTitle } from './toMatchSnapshot';\nimport type { Expect, ExpectMatcherState } from '../../types/test';\nimport { currentTestInfo } from '../common/globals';\nimport { filteredStackTrace, trimLongString } from '../util';\nimport {\n  expect as expectLibrary,\n  INVERTED_COLOR,\n  RECEIVED_COLOR,\n  printReceived,\n} from '../common/expectBundle';\nimport { zones } from 'playwright-core/lib/utils';\nimport { TestInfoImpl } from '../worker/testInfo';\nimport { ExpectError, isExpectError } from './matcherHint';\n\n// #region\n// Mirrored from https://github.com/facebook/jest/blob/f13abff8df9a0e1148baf3584bcde6d1b479edc7/packages/expect/src/print.ts\n/**\n * Copyright (c) Facebook, Inc. and its affiliates. All Rights Reserved.\n *\n * This source code is licensed under the MIT license found here\n * https://github.com/facebook/jest/blob/1547740bbc26400d69f4576bf35645163e942829/LICENSE\n */\n\n// Format substring but do not enclose in double quote marks.\n// The replacement is compatible with pretty-format package.\nconst printSubstring = (val: string): string => val.replace(/\"|\\\\/g, '\\\\$&');\n\nexport const printReceivedStringContainExpectedSubstring = (\n  received: string,\n  start: number,\n  length: number, // not end\n): string =>\n  RECEIVED_COLOR(\n      '\"' +\n      printSubstring(received.slice(0, start)) +\n      INVERTED_COLOR(printSubstring(received.slice(start, start + length))) +\n      printSubstring(received.slice(start + length)) +\n      '\"',\n  );\n\nexport const printReceivedStringContainExpectedResult = (\n  received: string,\n  result: RegExpExecArray | null,\n): string =>\n  result === null\n    ? printReceived(received)\n    : printReceivedStringContainExpectedSubstring(\n        received,\n        result.index,\n        result[0].length,\n    );\n\n// #endregion\n\ntype ExpectMessage = string | { message?: string };\n\nfunction createMatchers(actual: unknown, info: ExpectMetaInfo): any {\n  return new Proxy(expectLibrary(actual), new ExpectMetaInfoProxyHandler(info));\n}\n\nfunction createExpect(info: ExpectMetaInfo) {\n  const expectInstance: Expect<{}> = new Proxy(expectLibrary, {\n    apply: function(target: any, thisArg: any, argumentsList: [unknown, ExpectMessage?]) {\n      const [actual, messageOrOptions] = argumentsList;\n      const message = isString(messageOrOptions) ? messageOrOptions : messageOrOptions?.message || info.message;\n      const newInfo = { ...info, message };\n      if (newInfo.isPoll) {\n        if (typeof actual !== 'function')\n          throw new Error('`expect.poll()` accepts only function as a first argument');\n        newInfo.generator = actual as any;\n      }\n      return createMatchers(actual, newInfo);\n    },\n\n    get: function(target: any, property: string) {\n      if (property === 'configure')\n        return configure;\n\n      if (property === 'extend') {\n        return (matchers: any) => {\n          const wrappedMatchers: any = {};\n          for (const [name, matcher] of Object.entries(matchers)) {\n            wrappedMatchers[name] = function(...args: any[]) {\n              const { isNot, promise, utils } = this;\n              const newThis: ExpectMatcherState = {\n                isNot,\n                promise,\n                utils,\n                timeout: currentExpectTimeout()\n              };\n              (newThis as any).equals = throwUnsupportedExpectMatcherError;\n              return (matcher as any).call(newThis, ...args);\n            };\n          }\n          expectLibrary.extend(wrappedMatchers);\n          return expectInstance;\n        };\n      }\n\n      if (property === 'soft') {\n        return (actual: unknown, messageOrOptions?: ExpectMessage) => {\n          return configure({ soft: true })(actual, messageOrOptions) as any;\n        };\n      }\n\n      if (property === 'poll') {\n        return (actual: unknown, messageOrOptions?: ExpectMessage & { timeout?: number, intervals?: number[] }) => {\n          const poll = isString(messageOrOptions) ? {} : messageOrOptions || {};\n          return configure({ _poll: poll })(actual, messageOrOptions) as any;\n        };\n      }\n      return (expectLibrary as any)[property];\n    },\n  });\n\n  const configure = (configuration: { message?: string, timeout?: number, soft?: boolean, _poll?: boolean | { timeout?: number, intervals?: number[] } }) => {\n    const newInfo = { ...info };\n    if ('message' in configuration)\n      newInfo.message = configuration.message;\n    if ('timeout' in configuration)\n      newInfo.timeout = configuration.timeout;\n    if ('soft' in configuration)\n      newInfo.isSoft = configuration.soft;\n    if ('_poll' in configuration) {\n      newInfo.isPoll = !!configuration._poll;\n      if (typeof configuration._poll === 'object') {\n        newInfo.pollTimeout = configuration._poll.timeout;\n        newInfo.pollIntervals = configuration._poll.intervals;\n      }\n    }\n    return createExpect(newInfo);\n  };\n\n  return expectInstance;\n}\n\nfunction throwUnsupportedExpectMatcherError() {\n  throw new Error('It looks like you are using custom expect matchers that are not compatible with Playwright. See https://aka.ms/playwright/expect-compatibility');\n}\n\nexpectLibrary.setState({ expand: false });\n\nconst customAsyncMatchers = {\n  toBeAttached,\n  toBeChecked,\n  toBeDisabled,\n  toBeEditable,\n  toBeEmpty,\n  toBeEnabled,\n  toBeFocused,\n  toBeHidden,\n  toBeInViewport,\n  toBeOK,\n  toBeVisible,\n  toContainText,\n  toHaveAccessibleDescription,\n  toHaveAccessibleName,\n  toHaveAttribute,\n  toHaveClass,\n  toHaveCount,\n  toHaveCSS,\n  toHaveId,\n  toHaveJSProperty,\n  toHaveRole,\n  toHaveText,\n  toHaveTitle,\n  toHaveURL,\n  toHaveValue,\n  toHaveValues,\n  toHaveScreenshot,\n  toPass,\n};\n\nconst customMatchers = {\n  ...customAsyncMatchers,\n  toMatchSnapshot,\n};\n\ntype Generator = () => any;\n\ntype ExpectMetaInfo = {\n  message?: string;\n  isNot?: boolean;\n  isSoft?: boolean;\n  isPoll?: boolean;\n  timeout?: number;\n  pollTimeout?: number;\n  pollIntervals?: number[];\n  generator?: Generator;\n};\n\nclass ExpectMetaInfoProxyHandler implements ProxyHandler<any> {\n  private _info: ExpectMetaInfo;\n\n  constructor(info: ExpectMetaInfo) {\n    this._info = { ...info };\n  }\n\n  get(target: Object, matcherName: string | symbol, receiver: any): any {\n    let matcher = Reflect.get(target, matcherName, receiver);\n    if (typeof matcherName !== 'string')\n      return matcher;\n    if (matcher === undefined)\n      throw new Error(`expect: Property '${matcherName}' not found.`);\n    if (typeof matcher !== 'function') {\n      if (matcherName === 'not')\n        this._info.isNot = !this._info.isNot;\n      return new Proxy(matcher, this);\n    }\n    if (this._info.isPoll) {\n      if ((customAsyncMatchers as any)[matcherName] || matcherName === 'resolves' || matcherName === 'rejects')\n        throw new Error(`\\`expect.poll()\\` does not support \"${matcherName}\" matcher.`);\n      matcher = (...args: any[]) => pollMatcher(matcherName, !!this._info.isNot, this._info.pollIntervals, this._info.pollTimeout ?? currentExpectTimeout(), this._info.generator!, ...args);\n    }\n    return (...args: any[]) => {\n      const testInfo = currentTestInfo();\n      // We assume that the matcher will read the current expect timeout the first thing.\n      setCurrentExpectConfigureTimeout(this._info.timeout);\n      if (!testInfo)\n        return matcher.call(target, ...args);\n\n      const customMessage = this._info.message || '';\n      const argsSuffix = computeArgsSuffix(matcherName, args);\n\n      const defaultTitle = `expect${this._info.isPoll ? '.poll' : ''}${this._info.isSoft ? '.soft' : ''}${this._info.isNot ? '.not' : ''}.${matcherName}${argsSuffix}`;\n      const title = customMessage || defaultTitle;\n\n      // This looks like it is unnecessary, but it isn't - we need to filter\n      // out all the frames that belong to the test runner from caught runtime errors.\n      const stackFrames = filteredStackTrace(captureRawStack());\n\n      // Enclose toPass in a step to maintain async stacks, toPass matcher is always async.\n      const stepInfo = {\n        category: 'expect',\n        title: trimLongString(title, 1024),\n        params: args[0] ? { expected: args[0] } : undefined,\n        infectParentStepsWithError: this._info.isSoft,\n      };\n\n      const step = testInfo._addStep(stepInfo);\n\n      const reportStepError = (jestError: Error | unknown) => {\n        const error = isExpectError(jestError) ? new ExpectError(jestError, customMessage, stackFrames) : jestError;\n        step.complete({ error });\n        if (this._info.isSoft)\n          testInfo._failWithError(error);\n        else\n          throw error;\n      };\n\n      const finalizer = () => {\n        step.complete({});\n      };\n\n      try {\n        const callback = () => matcher.call(target, ...args);\n        // toPass and poll matchers can contain other steps, expects and API calls,\n        // so they behave like a retriable step.\n        const result = (matcherName === 'toPass' || this._info.isPoll) ?\n          zones.run('stepZone', step, callback) :\n          zones.run<ExpectZone, any>('expectZone', { title, stepId: step.stepId }, callback);\n        if (result instanceof Promise)\n          return result.then(finalizer).catch(reportStepError);\n        finalizer();\n        return result;\n      } catch (e) {\n        reportStepError(e);\n      }\n    };\n  }\n}\n\nasync function pollMatcher(matcherName: any, isNot: boolean, pollIntervals: number[] | undefined, timeout: number, generator: () => any, ...args: any[]) {\n  const testInfo = currentTestInfo();\n  const { deadline, timeoutMessage } = testInfo ? testInfo._deadlineForMatcher(timeout) : TestInfoImpl._defaultDeadlineForMatcher(timeout);\n\n  const result = await pollAgainstDeadline<Error|undefined>(async () => {\n    if (testInfo && currentTestInfo() !== testInfo)\n      return { continuePolling: false, result: undefined };\n\n    const value = await generator();\n    let expectInstance = expectLibrary(value) as any;\n    if (isNot)\n      expectInstance = expectInstance.not;\n    try {\n      expectInstance[matcherName].call(expectInstance, ...args);\n      return { continuePolling: false, result: undefined };\n    } catch (error) {\n      return { continuePolling: true, result: error };\n    }\n  }, deadline, pollIntervals ?? [100, 250, 500, 1000]);\n\n  if (result.timedOut) {\n    const message = result.result ? [\n      result.result.message,\n      '',\n      `Call Log:`,\n      `- ${timeoutMessage}`,\n    ].join('\\n') : timeoutMessage;\n\n    throw new Error(message);\n  }\n}\n\nlet currentExpectConfigureTimeout: number | undefined;\n\nfunction setCurrentExpectConfigureTimeout(timeout: number | undefined) {\n  currentExpectConfigureTimeout = timeout;\n}\n\nfunction currentExpectTimeout() {\n  if (currentExpectConfigureTimeout !== undefined)\n    return currentExpectConfigureTimeout;\n  const testInfo = currentTestInfo();\n  let defaultExpectTimeout = testInfo?._projectInternal?.expect?.timeout;\n  if (typeof defaultExpectTimeout === 'undefined')\n    defaultExpectTimeout = 5000;\n  return defaultExpectTimeout;\n}\n\nfunction computeArgsSuffix(matcherName: string, args: any[]) {\n  let value = '';\n  if (matcherName === 'toHaveScreenshot')\n    value = toHaveScreenshotStepTitle(...args);\n  return value ? `(${value})` : '';\n}\n\nexport const expect: Expect<{}> = createExpect({}).extend(customMatchers);\n\nexport function mergeExpects(...expects: any[]) {\n  return expect;\n}\n"],"mappings":"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"}