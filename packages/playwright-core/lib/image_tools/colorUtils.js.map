{"version":3,"file":"colorUtils.js","names":["blendWithWhite","c","a","rgb2gray","r","g","b","colorDeltaE94","rgb1","rgb2","l1","a1","b1","xyz2lab","srgb2xyz","l2","a2","b2","deltaL","deltaA","deltaB","c1","Math","sqrt","c2","deltaC","deltaH","k1","k2","kL","kC","kH","sC","sH","sL","rgb","pow","sigma_pow2","sigma_pow3","xyz","x","y","z","fx","fy","fz","l"],"sources":["../../src/image_tools/colorUtils.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport function blendWithWhite(c: number, a: number): number {\n  return 255 + (c - 255) * a;\n}\n\nexport function rgb2gray(r: number, g: number, b: number): number {\n  // NOTE: this is the exact integer formula from SSIM.js.\n  // See https://github.com/obartra/ssim/blob/ca8e3c6a6ff5f4f2e232239e0c3d91806f3c97d5/src/matlab/rgb2gray.ts#L56\n  return (77 * r + 150 * g + 29 * b + 128) >> 8;\n}\n\n// Perceived color difference defined by CIE94.\n// See https://en.wikipedia.org/wiki/Color_difference#CIE94\n//\n// The result of 1.0 is a \"just-noticeable difference\".\n//\n// Other results interpretation (taken from http://zschuessler.github.io/DeltaE/learn/):\n//   < 1.0     Not perceptible by human eyes.\n//   1-2        Perceptible through close observation.\n//   2-10       Perceptible at a glance.\n//   11-49      Colors are more similar than opposite\n//   100        Colors are exact opposite\nexport function colorDeltaE94(rgb1: number[], rgb2: number[]) {\n  const [l1, a1, b1] = xyz2lab(srgb2xyz(rgb1));\n  const [l2, a2, b2] = xyz2lab(srgb2xyz(rgb2));\n  const deltaL = l1 - l2;\n  const deltaA = a1 - a2;\n  const deltaB = b1 - b2;\n  const c1 = Math.sqrt(a1 ** 2 + b1 ** 2);\n  const c2 = Math.sqrt(a2 ** 2 + b2 ** 2);\n  const deltaC = c1 - c2;\n  let deltaH = deltaA ** 2 + deltaB ** 2 - deltaC ** 2;\n  deltaH = deltaH < 0 ? 0 : Math.sqrt(deltaH);\n  // The k1, k2, kL, kC, kH values for \"graphic arts\" applications.\n  // See https://en.wikipedia.org/wiki/Color_difference#CIE94\n  const k1 = 0.045;\n  const k2 = 0.015;\n  const kL = 1;\n  const kC = 1;\n  const kH = 1;\n\n  const sC = 1.0 + k1 * c1;\n  const sH = 1.0 + k2 * c1;\n  const sL = 1;\n\n  return Math.sqrt((deltaL / sL / kL) ** 2 + (deltaC / sC / kC) ** 2 + (deltaH / sH / kH) ** 2);\n}\n\n// sRGB -> 1-normalized XYZ (i.e. Y âˆˆ [0, 1]) with D65 illuminant\n// See https://en.wikipedia.org/wiki/SRGB#From_sRGB_to_CIE_XYZ\nexport function srgb2xyz(rgb: number[]): number[] {\n  let r = rgb[0] / 255;\n  let g = rgb[1] / 255;\n  let b = rgb[2] / 255;\n  r = (r > 0.04045) ? Math.pow((r + 0.055) / 1.055, 2.4) : r / 12.92;\n  g = (g > 0.04045) ? Math.pow((g + 0.055) / 1.055, 2.4) : g / 12.92;\n  b = (b > 0.04045) ? Math.pow((b + 0.055) / 1.055, 2.4) : b / 12.92;\n  return [\n    (r * 0.4124 + g * 0.3576 + b * 0.1805),\n    (r * 0.2126 + g * 0.7152 + b * 0.0722),\n    (r * 0.0193 + g * 0.1192 + b * 0.9505),\n  ];\n}\n\nconst sigma_pow2 = 6 * 6 / 29 / 29;\nconst sigma_pow3 = 6 * 6 * 6 / 29 / 29 / 29;\n\n// 1-normalized CIE XYZ with D65 to L*a*b*\n// See https://en.wikipedia.org/wiki/CIELAB_color_space#From_CIEXYZ_to_CIELAB\nexport function xyz2lab(xyz: number[]): number[] {\n  const x = xyz[0] / 0.950489;\n  const y = xyz[1];\n  const z = xyz[2] / 1.088840;\n\n  const fx = x > sigma_pow3 ? x ** (1 / 3) : x / 3 / sigma_pow2 + 4 / 29;\n  const fy = y > sigma_pow3 ? y ** (1 / 3) : y / 3 / sigma_pow2 + 4 / 29;\n  const fz = z > sigma_pow3 ? z ** (1 / 3) : z / 3 / sigma_pow2 + 4 / 29;\n\n  const l = 116 * fy - 16;\n  const a = 500 * (fx - fy);\n  const b = 200 * (fy - fz);\n\n  return [l, a, b];\n}\n"],"mappings":"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"}