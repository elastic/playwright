{"version":3,"file":"browserContext.js","names":["_page","require","_frame","network","_interopRequireWildcard","_fs","_interopRequireDefault","_path","_channelOwner","_clientHelper","_browser","_worker","_events","_timeoutSettings","_waiter","_utils","_cdpSession","_tracing","_artifact","_fetch","_stackTrace","_harRouter","_consoleMessage","_dialog","_webError","_errors","_clock","_Symbol$asyncDispose","obj","__esModule","default","_getRequireWildcardCache","e","WeakMap","r","t","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","Symbol","asyncDispose","BrowserContext","ChannelOwner","from","context","_object","fromNullable","constructor","parent","type","guid","initializer","_this$_browser","_this$_browser2","_pages","Set","_routes","_browserType","_bindings","Map","TimeoutSettings","_ownerPage","_closedPromise","_options","request","tracing","clock","_backgroundPages","_serviceWorkers","_isChromium","_harRecorders","_closeWasCalled","_closeReason","_harRouters","Browser","_contexts","add","_name","Tracing","APIRequestContext","requestContext","Clock","_channel","on","binding","_onBinding","BindingCall","_onClose","page","_onPage","Page","route","_onRoute","Route","backgroundPage","emit","Events","BackgroundPage","worker","serviceWorker","Worker","_context","ServiceWorker","event","consoleMessage","ConsoleMessage","Console","error","pageObject","parsedError","parseError","WebError","PageError","dialog","dialogObject","Dialog","hasListeners","accept","catch","dismiss","_onRequest","Request","failureText","responseEndTiming","_onRequestFailed","params","_onRequestFinished","response","_onResponse","Response","Promise","f","once","Close","_setEventToSubscriptionMapping","RequestFinished","RequestFailed","_setOptions","contextOptions","browserOptions","recordHar","path","content","_tracesDir","tracesDir","_opener","isClosed","Popup","_failureText","_setResponseEndTiming","_finishedPromise","resolve","_safePage","routeHandlers","slice","routeHandler","matches","url","index","indexOf","willExpire","splice","handled","handle","length","_wrapApiCall","_updateInterceptionPatterns","_innerContinue","bindingCall","func","_initializer","name","setDefaultNavigationTimeout","timeout","setDefaultNavigationTimeoutNoReply","setDefaultTimeout","setDefaultTimeoutNoReply","browser","pages","newPage","Error","cookies","urls","addCookies","clearCookies","options","isString","undefined","nameRegexSource","isRegExp","source","nameRegexFlags","flags","domain","domainRegexSource","domainRegexFlags","pathRegexSource","pathRegexFlags","grantPermissions","permissions","clearPermissions","setGeolocation","geolocation","setExtraHTTPHeaders","headers","validateHeaders","headersObjectToArray","setOffline","offline","setHTTPCredentials","httpCredentials","addInitScript","script","arg","evaluationScript","exposeBinding","callback","needsHandle","exposeFunction","args","handler","unshift","RouteHandler","baseURL","times","_recordIntoHAR","har","_options$updateConten","_options$updateMode","_options$updateConten2","harId","harStart","prepareRecordHarOptions","updateContent","mode","updateMode","urlFilter","routeFromHAR","update","harRouter","HarRouter","create","_connection","localUtils","notFound","urlMatch","push","addContextRoute","_disposeHarRouters","forEach","router","dispose","unrouteAll","_unrouteInternal","behavior","unroute","removed","remaining","urlMatchesEqual","promises","map","stop","all","patterns","prepareInterceptionPatterns","setNetworkInterceptionPatterns","_effectiveCloseReason","_this$_browser3","waitForEvent","optionsOrPredicate","predicate","waiter","Waiter","createForEvent","rejectOnTimeout","rejectOnEvent","TargetClosedError","result","storageState","state","mkdirIfNeeded","fs","writeFile","JSON","stringify","backgroundPages","serviceWorkers","newCDPSession","Frame","frame","CDPSession","session","_this$_browserType","delete","_resetStackCounter","close","reason","_this$_browserType2","_willCloseContext","harParams","harExport","artifact","Artifact","isCompressed","endsWith","needCompressed","saveAs","harUnzip","zipFile","harFile","_enableRecorder","recorderSupplementEnable","exports","prepareStorageState","parse","readFile","rewriteErrorMessage","message","omitContent","urlGlob","urlRegexSource","urlRegexFlags","prepareBrowserContextParams","videoSize","videosPath","extraHTTPHeaders","contextParams","viewport","noDefaultViewport","colorScheme","reducedMotion","forcedColors","acceptDownloads","toAcceptDownloadsProtocol","clientCertificates","toClientCertificatesProtocol","recordVideo","dir","size","process","cwd","certs","bufferizeContent","value","cert","origin","certPath","key","keyPath","pfx","pfxPath","passphrase"],"sources":["../../src/client/browserContext.ts"],"sourcesContent":["/**\n * Copyright 2017 Google Inc. All rights reserved.\n * Modifications copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Page, BindingCall } from './page';\nimport { Frame } from './frame';\nimport * as network from './network';\nimport type * as channels from '@protocol/channels';\nimport fs from 'fs';\nimport path from 'path';\nimport { ChannelOwner } from './channelOwner';\nimport { evaluationScript } from './clientHelper';\nimport { Browser } from './browser';\nimport { Worker } from './worker';\nimport { Events } from './events';\nimport { TimeoutSettings } from '../common/timeoutSettings';\nimport { Waiter } from './waiter';\nimport type { Headers, WaitForEventOptions, BrowserContextOptions, StorageState, LaunchOptions } from './types';\nimport { type URLMatch, headersObjectToArray, isRegExp, isString, urlMatchesEqual, mkdirIfNeeded } from '../utils';\nimport type * as api from '../../types/types';\nimport type * as structs from '../../types/structs';\nimport { CDPSession } from './cdpSession';\nimport { Tracing } from './tracing';\nimport type { BrowserType } from './browserType';\nimport { Artifact } from './artifact';\nimport { APIRequestContext } from './fetch';\nimport { rewriteErrorMessage } from '../utils/stackTrace';\nimport { HarRouter } from './harRouter';\nimport { ConsoleMessage } from './consoleMessage';\nimport { Dialog } from './dialog';\nimport { WebError } from './webError';\nimport { TargetClosedError, parseError } from './errors';\nimport { Clock } from './clock';\n\nexport class BrowserContext extends ChannelOwner<channels.BrowserContextChannel> implements api.BrowserContext {\n  _pages = new Set<Page>();\n  _routes: network.RouteHandler[] = [];\n  readonly _browser: Browser | null = null;\n  _browserType: BrowserType | undefined;\n  readonly _bindings = new Map<string, (source: structs.BindingSource, ...args: any[]) => any>();\n  _timeoutSettings = new TimeoutSettings();\n  _ownerPage: Page | undefined;\n  private _closedPromise: Promise<void>;\n  _options: channels.BrowserNewContextParams = { };\n\n  readonly request: APIRequestContext;\n  readonly tracing: Tracing;\n  readonly clock: Clock;\n\n  readonly _backgroundPages = new Set<Page>();\n  readonly _serviceWorkers = new Set<Worker>();\n  readonly _isChromium: boolean;\n  private _harRecorders = new Map<string, { path: string, content: 'embed' | 'attach' | 'omit' | undefined }>();\n  _closeWasCalled = false;\n  private _closeReason: string | undefined;\n  private _harRouters: HarRouter[] = [];\n\n  static from(context: channels.BrowserContextChannel): BrowserContext {\n    return (context as any)._object;\n  }\n\n  static fromNullable(context: channels.BrowserContextChannel | null): BrowserContext | null {\n    return context ? BrowserContext.from(context) : null;\n  }\n\n  constructor(parent: ChannelOwner, type: string, guid: string, initializer: channels.BrowserContextInitializer) {\n    super(parent, type, guid, initializer);\n    if (parent instanceof Browser)\n      this._browser = parent;\n    this._browser?._contexts.add(this);\n    this._isChromium = this._browser?._name === 'chromium';\n    this.tracing = Tracing.from(initializer.tracing);\n    this.request = APIRequestContext.from(initializer.requestContext);\n    this.clock = new Clock(this);\n\n    this._channel.on('bindingCall', ({ binding }) => this._onBinding(BindingCall.from(binding)));\n    this._channel.on('close', () => this._onClose());\n    this._channel.on('page', ({ page }) => this._onPage(Page.from(page)));\n    this._channel.on('route', ({ route }) => this._onRoute(network.Route.from(route)));\n    this._channel.on('backgroundPage', ({ page }) => {\n      const backgroundPage = Page.from(page);\n      this._backgroundPages.add(backgroundPage);\n      this.emit(Events.BrowserContext.BackgroundPage, backgroundPage);\n    });\n    this._channel.on('serviceWorker', ({ worker }) => {\n      const serviceWorker = Worker.from(worker);\n      serviceWorker._context = this;\n      this._serviceWorkers.add(serviceWorker);\n      this.emit(Events.BrowserContext.ServiceWorker, serviceWorker);\n    });\n    this._channel.on('console', event => {\n      const consoleMessage = new ConsoleMessage(event);\n      this.emit(Events.BrowserContext.Console, consoleMessage);\n      const page = consoleMessage.page();\n      if (page)\n        page.emit(Events.Page.Console, consoleMessage);\n    });\n    this._channel.on('pageError', ({ error, page }) => {\n      const pageObject = Page.from(page);\n      const parsedError = parseError(error);\n      this.emit(Events.BrowserContext.WebError, new WebError(pageObject, parsedError));\n      if (pageObject)\n        pageObject.emit(Events.Page.PageError, parsedError);\n    });\n    this._channel.on('dialog', ({ dialog }) => {\n      const dialogObject = Dialog.from(dialog);\n      let hasListeners = this.emit(Events.BrowserContext.Dialog, dialogObject);\n      const page = dialogObject.page();\n      if (page)\n        hasListeners = page.emit(Events.Page.Dialog, dialogObject) || hasListeners;\n      if (!hasListeners) {\n        // Although we do similar handling on the server side, we still need this logic\n        // on the client side due to a possible race condition between two async calls:\n        // a) removing \"dialog\" listener subscription (client->server)\n        // b) actual \"dialog\" event (server->client)\n        if (dialogObject.type() === 'beforeunload')\n          dialog.accept({}).catch(() => {});\n        else\n          dialog.dismiss().catch(() => {});\n      }\n    });\n    this._channel.on('request', ({ request, page }) => this._onRequest(network.Request.from(request), Page.fromNullable(page)));\n    this._channel.on('requestFailed', ({ request, failureText, responseEndTiming, page }) => this._onRequestFailed(network.Request.from(request), responseEndTiming, failureText, Page.fromNullable(page)));\n    this._channel.on('requestFinished', params => this._onRequestFinished(params));\n    this._channel.on('response', ({ response, page }) => this._onResponse(network.Response.from(response), Page.fromNullable(page)));\n    this._closedPromise = new Promise(f => this.once(Events.BrowserContext.Close, f));\n\n    this._setEventToSubscriptionMapping(new Map<string, channels.BrowserContextUpdateSubscriptionParams['event']>([\n      [Events.BrowserContext.Console, 'console'],\n      [Events.BrowserContext.Dialog, 'dialog'],\n      [Events.BrowserContext.Request, 'request'],\n      [Events.BrowserContext.Response, 'response'],\n      [Events.BrowserContext.RequestFinished, 'requestFinished'],\n      [Events.BrowserContext.RequestFailed, 'requestFailed'],\n    ]));\n  }\n\n  _setOptions(contextOptions: channels.BrowserNewContextParams, browserOptions: LaunchOptions) {\n    this._options = contextOptions;\n    if (this._options.recordHar)\n      this._harRecorders.set('', { path: this._options.recordHar.path, content: this._options.recordHar.content });\n    this.tracing._tracesDir = browserOptions.tracesDir;\n  }\n\n  private _onPage(page: Page): void {\n    this._pages.add(page);\n    this.emit(Events.BrowserContext.Page, page);\n    if (page._opener && !page._opener.isClosed())\n      page._opener.emit(Events.Page.Popup, page);\n  }\n\n  private _onRequest(request: network.Request, page: Page | null) {\n    this.emit(Events.BrowserContext.Request, request);\n    if (page)\n      page.emit(Events.Page.Request, request);\n  }\n\n  private _onResponse(response: network.Response, page: Page | null) {\n    this.emit(Events.BrowserContext.Response, response);\n    if (page)\n      page.emit(Events.Page.Response, response);\n  }\n\n  private _onRequestFailed(request: network.Request, responseEndTiming: number, failureText: string | undefined, page: Page | null) {\n    request._failureText = failureText || null;\n    request._setResponseEndTiming(responseEndTiming);\n    this.emit(Events.BrowserContext.RequestFailed, request);\n    if (page)\n      page.emit(Events.Page.RequestFailed, request);\n  }\n\n  private _onRequestFinished(params: channels.BrowserContextRequestFinishedEvent) {\n    const { responseEndTiming } = params;\n    const request = network.Request.from(params.request);\n    const response = network.Response.fromNullable(params.response);\n    const page = Page.fromNullable(params.page);\n    request._setResponseEndTiming(responseEndTiming);\n    this.emit(Events.BrowserContext.RequestFinished, request);\n    if (page)\n      page.emit(Events.Page.RequestFinished, request);\n    if (response)\n      response._finishedPromise.resolve(null);\n  }\n\n  async _onRoute(route: network.Route) {\n    route._context = this;\n    const page = route.request()._safePage();\n    const routeHandlers = this._routes.slice();\n    for (const routeHandler of routeHandlers) {\n      // If the page or the context was closed we stall all requests right away.\n      if (page?._closeWasCalled || this._closeWasCalled)\n        return;\n      if (!routeHandler.matches(route.request().url()))\n        continue;\n      const index = this._routes.indexOf(routeHandler);\n      if (index === -1)\n        continue;\n      if (routeHandler.willExpire())\n        this._routes.splice(index, 1);\n      const handled = await routeHandler.handle(route);\n      if (!this._routes.length)\n        this._wrapApiCall(() => this._updateInterceptionPatterns(), true).catch(() => {});\n      if (handled)\n        return;\n    }\n    // If the page is closed or unrouteAll() was called without waiting and interception disabled,\n    // the method will throw an error - silence it.\n    await route._innerContinue(true).catch(() => {});\n  }\n\n  async _onBinding(bindingCall: BindingCall) {\n    const func = this._bindings.get(bindingCall._initializer.name);\n    if (!func)\n      return;\n    await bindingCall.call(func);\n  }\n\n  setDefaultNavigationTimeout(timeout: number | undefined) {\n    this._timeoutSettings.setDefaultNavigationTimeout(timeout);\n    this._wrapApiCall(async () => {\n      this._channel.setDefaultNavigationTimeoutNoReply({ timeout }).catch(() => {});\n    }, true);\n  }\n\n  setDefaultTimeout(timeout: number | undefined) {\n    this._timeoutSettings.setDefaultTimeout(timeout);\n    this._wrapApiCall(async () => {\n      this._channel.setDefaultTimeoutNoReply({ timeout }).catch(() => {});\n    }, true);\n  }\n\n  browser(): Browser | null {\n    return this._browser;\n  }\n\n  pages(): Page[] {\n    return [...this._pages];\n  }\n\n  async newPage(): Promise<Page> {\n    if (this._ownerPage)\n      throw new Error('Please use browser.newContext()');\n    return Page.from((await this._channel.newPage()).page);\n  }\n\n  async cookies(urls?: string | string[]): Promise<network.NetworkCookie[]> {\n    if (!urls)\n      urls = [];\n    if (urls && typeof urls === 'string')\n      urls = [urls];\n    return (await this._channel.cookies({ urls: urls as string[] })).cookies;\n  }\n\n  async addCookies(cookies: network.SetNetworkCookieParam[]): Promise<void> {\n    await this._channel.addCookies({ cookies });\n  }\n\n  async clearCookies(options: network.ClearNetworkCookieOptions = {}): Promise<void> {\n    await this._channel.clearCookies({\n      name: isString(options.name) ? options.name : undefined,\n      nameRegexSource: isRegExp(options.name) ? options.name.source : undefined,\n      nameRegexFlags: isRegExp(options.name) ? options.name.flags : undefined,\n      domain: isString(options.domain) ? options.domain : undefined,\n      domainRegexSource: isRegExp(options.domain) ? options.domain.source : undefined,\n      domainRegexFlags: isRegExp(options.domain) ? options.domain.flags : undefined,\n      path: isString(options.path) ? options.path : undefined,\n      pathRegexSource: isRegExp(options.path) ? options.path.source : undefined,\n      pathRegexFlags: isRegExp(options.path) ? options.path.flags : undefined,\n    });\n  }\n\n  async grantPermissions(permissions: string[], options?: { origin?: string }): Promise<void> {\n    await this._channel.grantPermissions({ permissions, ...options });\n  }\n\n  async clearPermissions(): Promise<void> {\n    await this._channel.clearPermissions();\n  }\n\n  async setGeolocation(geolocation: { longitude: number, latitude: number, accuracy?: number } | null): Promise<void> {\n    await this._channel.setGeolocation({ geolocation: geolocation || undefined });\n  }\n\n  async setExtraHTTPHeaders(headers: Headers): Promise<void> {\n    network.validateHeaders(headers);\n    await this._channel.setExtraHTTPHeaders({ headers: headersObjectToArray(headers) });\n  }\n\n  async setOffline(offline: boolean): Promise<void> {\n    await this._channel.setOffline({ offline });\n  }\n\n  async setHTTPCredentials(httpCredentials: { username: string, password: string } | null): Promise<void> {\n    await this._channel.setHTTPCredentials({ httpCredentials: httpCredentials || undefined });\n  }\n\n  async addInitScript(script: Function | string | { path?: string, content?: string }, arg?: any): Promise<void> {\n    const source = await evaluationScript(script, arg);\n    await this._channel.addInitScript({ source });\n  }\n\n  async exposeBinding(name: string, callback: (source: structs.BindingSource, ...args: any[]) => any, options: { handle?: boolean } = {}): Promise<void> {\n    await this._channel.exposeBinding({ name, needsHandle: options.handle });\n    this._bindings.set(name, callback);\n  }\n\n  async exposeFunction(name: string, callback: Function): Promise<void> {\n    await this._channel.exposeBinding({ name });\n    const binding = (source: structs.BindingSource, ...args: any[]) => callback(...args);\n    this._bindings.set(name, binding);\n  }\n\n  async route(url: URLMatch, handler: network.RouteHandlerCallback, options: { times?: number } = {}): Promise<void> {\n    this._routes.unshift(new network.RouteHandler(this._options.baseURL, url, handler, options.times));\n    await this._updateInterceptionPatterns();\n  }\n\n  async _recordIntoHAR(har: string, page: Page | null, options: { url?: string | RegExp, notFound?: 'abort' | 'fallback', update?: boolean, updateContent?: 'attach' | 'embed', updateMode?: 'minimal' | 'full'} = {}): Promise<void> {\n    const { harId } = await this._channel.harStart({\n      page: page?._channel,\n      options: prepareRecordHarOptions({\n        path: har,\n        content: options.updateContent ?? 'attach',\n        mode: options.updateMode ?? 'minimal',\n        urlFilter: options.url\n      })!\n    });\n    this._harRecorders.set(harId, { path: har, content: options.updateContent ?? 'attach' });\n  }\n\n  async routeFromHAR(har: string, options: { url?: string | RegExp, notFound?: 'abort' | 'fallback', update?: boolean, updateContent?: 'attach' | 'embed', updateMode?: 'minimal' | 'full' } = {}): Promise<void> {\n    if (options.update) {\n      await this._recordIntoHAR(har, null, options);\n      return;\n    }\n    const harRouter = await HarRouter.create(this._connection.localUtils(), har, options.notFound || 'abort', { urlMatch: options.url });\n    this._harRouters.push(harRouter);\n    await harRouter.addContextRoute(this);\n  }\n\n  private _disposeHarRouters() {\n    this._harRouters.forEach(router => router.dispose());\n    this._harRouters = [];\n  }\n\n  async unrouteAll(options?: { behavior?: 'wait'|'ignoreErrors'|'default' }): Promise<void> {\n    await this._unrouteInternal(this._routes, [], options?.behavior);\n    this._disposeHarRouters();\n  }\n\n  async unroute(url: URLMatch, handler?: network.RouteHandlerCallback): Promise<void> {\n    const removed = [];\n    const remaining = [];\n    for (const route of this._routes) {\n      if (urlMatchesEqual(route.url, url) && (!handler || route.handler === handler))\n        removed.push(route);\n      else\n        remaining.push(route);\n    }\n    await this._unrouteInternal(removed, remaining, 'default');\n  }\n\n  private async _unrouteInternal(removed: network.RouteHandler[], remaining: network.RouteHandler[], behavior?: 'wait'|'ignoreErrors'|'default'): Promise<void> {\n    this._routes = remaining;\n    await this._updateInterceptionPatterns();\n    if (!behavior || behavior === 'default')\n      return;\n    const promises = removed.map(routeHandler => routeHandler.stop(behavior));\n    await Promise.all(promises);\n  }\n\n  private async _updateInterceptionPatterns() {\n    const patterns = network.RouteHandler.prepareInterceptionPatterns(this._routes);\n    await this._channel.setNetworkInterceptionPatterns({ patterns });\n  }\n\n  _effectiveCloseReason(): string | undefined {\n    return this._closeReason || this._browser?._closeReason;\n  }\n\n  async waitForEvent(event: string, optionsOrPredicate: WaitForEventOptions = {}): Promise<any> {\n    return await this._wrapApiCall(async () => {\n      const timeout = this._timeoutSettings.timeout(typeof optionsOrPredicate === 'function'  ? {} : optionsOrPredicate);\n      const predicate = typeof optionsOrPredicate === 'function'  ? optionsOrPredicate : optionsOrPredicate.predicate;\n      const waiter = Waiter.createForEvent(this, event);\n      waiter.rejectOnTimeout(timeout, `Timeout ${timeout}ms exceeded while waiting for event \"${event}\"`);\n      if (event !== Events.BrowserContext.Close)\n        waiter.rejectOnEvent(this, Events.BrowserContext.Close, () => new TargetClosedError(this._effectiveCloseReason()));\n      const result = await waiter.waitForEvent(this, event, predicate as any);\n      waiter.dispose();\n      return result;\n    });\n  }\n\n  async storageState(options: { path?: string } = {}): Promise<StorageState> {\n    const state = await this._channel.storageState();\n    if (options.path) {\n      await mkdirIfNeeded(options.path);\n      await fs.promises.writeFile(options.path, JSON.stringify(state, undefined, 2), 'utf8');\n    }\n    return state;\n  }\n\n  backgroundPages(): Page[] {\n    return [...this._backgroundPages];\n  }\n\n  serviceWorkers(): Worker[] {\n    return [...this._serviceWorkers];\n  }\n\n  async newCDPSession(page: Page | Frame): Promise<api.CDPSession> {\n    // channelOwner.ts's validation messages don't handle the pseudo-union type, so we're explicit here\n    if (!(page instanceof Page) && !(page instanceof Frame))\n      throw new Error('page: expected Page or Frame');\n    const result = await this._channel.newCDPSession(page instanceof Page ? { page: page._channel } : { frame: page._channel });\n    return CDPSession.from(result.session);\n  }\n\n  _onClose() {\n    if (this._browser)\n      this._browser._contexts.delete(this);\n    this._browserType?._contexts?.delete(this);\n    this._disposeHarRouters();\n    this.tracing._resetStackCounter();\n    this.emit(Events.BrowserContext.Close, this);\n  }\n\n  async [Symbol.asyncDispose]() {\n    await this.close();\n  }\n\n  async close(options: { reason?: string } = {}): Promise<void> {\n    if (this._closeWasCalled)\n      return;\n    this._closeReason = options.reason;\n    this._closeWasCalled = true;\n    await this._wrapApiCall(async () => {\n      await this.request.dispose(options);\n    }, true);\n    await this._wrapApiCall(async () => {\n      await this._browserType?._willCloseContext(this);\n      for (const [harId, harParams] of this._harRecorders) {\n        const har = await this._channel.harExport({ harId });\n        const artifact = Artifact.from(har.artifact);\n        // Server side will compress artifact if content is attach or if file is .zip.\n        const isCompressed = harParams.content === 'attach' || harParams.path.endsWith('.zip');\n        const needCompressed = harParams.path.endsWith('.zip');\n        if (isCompressed && !needCompressed) {\n          await artifact.saveAs(harParams.path + '.tmp');\n          await this._connection.localUtils()._channel.harUnzip({ zipFile: harParams.path + '.tmp', harFile: harParams.path });\n        } else {\n          await artifact.saveAs(harParams.path);\n        }\n        await artifact.delete();\n      }\n    }, true);\n    await this._channel.close(options);\n    await this._closedPromise;\n  }\n\n  async _enableRecorder(params: channels.BrowserContextRecorderSupplementEnableParams) {\n    await this._channel.recorderSupplementEnable(params);\n  }\n}\n\nasync function prepareStorageState(options: BrowserContextOptions): Promise<channels.BrowserNewContextParams['storageState']> {\n  if (typeof options.storageState !== 'string')\n    return options.storageState;\n  try {\n    return JSON.parse(await fs.promises.readFile(options.storageState, 'utf8'));\n  } catch (e) {\n    rewriteErrorMessage(e, `Error reading storage state from ${options.storageState}:\\n` + e.message);\n    throw e;\n  }\n}\n\nfunction prepareRecordHarOptions(options: BrowserContextOptions['recordHar']): channels.RecordHarOptions | undefined {\n  if (!options)\n    return;\n  return {\n    path: options.path,\n    content: options.content || (options.omitContent ? 'omit' : undefined),\n    urlGlob: isString(options.urlFilter) ? options.urlFilter : undefined,\n    urlRegexSource: isRegExp(options.urlFilter) ? options.urlFilter.source : undefined,\n    urlRegexFlags: isRegExp(options.urlFilter) ? options.urlFilter.flags : undefined,\n    mode: options.mode\n  };\n}\n\nexport async function prepareBrowserContextParams(options: BrowserContextOptions): Promise<channels.BrowserNewContextParams> {\n  if (options.videoSize && !options.videosPath)\n    throw new Error(`\"videoSize\" option requires \"videosPath\" to be specified`);\n  if (options.extraHTTPHeaders)\n    network.validateHeaders(options.extraHTTPHeaders);\n  const contextParams: channels.BrowserNewContextParams = {\n    ...options,\n    viewport: options.viewport === null ? undefined : options.viewport,\n    noDefaultViewport: options.viewport === null,\n    extraHTTPHeaders: options.extraHTTPHeaders ? headersObjectToArray(options.extraHTTPHeaders) : undefined,\n    storageState: await prepareStorageState(options),\n    serviceWorkers: options.serviceWorkers,\n    recordHar: prepareRecordHarOptions(options.recordHar),\n    colorScheme: options.colorScheme === null ? 'no-override' : options.colorScheme,\n    reducedMotion: options.reducedMotion === null ? 'no-override' : options.reducedMotion,\n    forcedColors: options.forcedColors === null ? 'no-override' : options.forcedColors,\n    acceptDownloads: toAcceptDownloadsProtocol(options.acceptDownloads),\n    clientCertificates: await toClientCertificatesProtocol(options.clientCertificates),\n  };\n  if (!contextParams.recordVideo && options.videosPath) {\n    contextParams.recordVideo = {\n      dir: options.videosPath,\n      size: options.videoSize\n    };\n  }\n  if (contextParams.recordVideo && contextParams.recordVideo.dir)\n    contextParams.recordVideo.dir = path.resolve(process.cwd(), contextParams.recordVideo.dir);\n  return contextParams;\n}\n\nfunction toAcceptDownloadsProtocol(acceptDownloads?: boolean) {\n  if (acceptDownloads === undefined)\n    return undefined;\n  if (acceptDownloads)\n    return 'accept';\n  return 'deny';\n}\n\nexport async function toClientCertificatesProtocol(certs?: BrowserContextOptions['clientCertificates']): Promise<channels.PlaywrightNewRequestParams['clientCertificates']> {\n  if (!certs)\n    return undefined;\n\n  const bufferizeContent = async (value?: Buffer, path?: string): Promise<Buffer | undefined> => {\n    if (value)\n      return value;\n    if (path)\n      return await fs.promises.readFile(path);\n  };\n\n  return await Promise.all(certs.map(async cert => ({\n    origin: cert.origin,\n    cert: await bufferizeContent(cert.cert, cert.certPath),\n    key: await bufferizeContent(cert.key, cert.keyPath),\n    pfx: await bufferizeContent(cert.pfx, cert.pfxPath),\n    passphrase: cert.passphrase,\n  })));\n}\n"],"mappings":"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"}