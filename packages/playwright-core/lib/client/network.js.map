{"version":3,"file":"network.js","names":["_url","require","_channelOwner","_frame","_worker","_fs","_interopRequireDefault","_utilsBundle","_utils","_manualPromise","_events","_waiter","_fetch","_errors","obj","__esModule","default","Request","ChannelOwner","from","request","_object","fromNullable","constructor","parent","type","guid","initializer","_redirectedFrom","_redirectedTo","_failureText","_provisionalHeaders","_actualHeadersPromise","_timing","_fallbackOverrides","redirectedFrom","RawHeaders","headers","startTime","domainLookupStart","domainLookupEnd","connectStart","secureConnectionStart","connectEnd","requestStart","responseStart","responseEnd","url","_initializer","resourceType","method","postData","_ref","postDataBuffer","toString","postDataJSON","contentType","includes","entries","parsed","URLSearchParams","k","v","JSON","parse","e","Error","_fromHeadersObjectLossy","_actualHeaders","_wrapApiCall","_channel","rawRequestHeaders","allHeaders","headersArray","headerValue","name","get","response","Response","_internalResponse","frame","assert","serviceWorker","Frame","_page","join","_safePage","_Frame$fromNullable","Worker","isNavigationRequest","redirectedTo","failure","errorText","timing","sizes","_setResponseEndTiming","responseEndTiming","_finalRequest","_applyFallbackOverrides","overrides","isString","Buffer","stringify","_fallbackOverridesForContinue","_targetClosedScope","_this$serviceWorker","_this$_safePage","_closedScope","_closedOrCrashedScope","LongStandingScope","exports","Route","route","_handlingPromise","_context","_didThrow","_raceWithTargetClose","promise","safeRace","_startHandling","ManualPromise","fallback","options","_checkNotHandled","_reportHandled","abort","errorCode","_handleRoute","requestUrl","_redirectNavigationRequest","redirectNavigationRequest","fetch","_innerFetch","data","fulfill","_innerFulfill","callback","fetchResponseUid","status","statusOption","headersOption","body","json","undefined","APIResponse","_statusOption","_headersOption","path","_request","_connection","_fetchUid","isBase64","length","buffer","fs","promises","readFile","byteLength","header","Object","keys","toLowerCase","String","mime","getType","headersObjectToArray","continue","_innerContinue","done","chain","resolve","internal","isFallback","_finishedPromise","assign","ok","statusText","fromServiceWorker","rawResponseHeaders","slice","headerValues","getAll","finished","race","binary","text","content","serverAddr","value","securityDetails","WebSocket","webSocket","_isClosed","on","event","opcode","emit","Events","FrameSent","payload","FrameReceived","error","Close","isClosed","waitForEvent","optionsOrPredicate","timeout","_timeoutSettings","predicate","waiter","Waiter","createForEvent","rejectOnTimeout","rejectOnEvent","Page","_closeErrorWithReason","result","dispose","validateHeaders","key","is","RouteHandler","baseURL","handler","times","Number","MAX_SAFE_INTEGER","handledCount","_baseURL","_times","_ignoreException","_activeInvocations","Set","prepareInterceptionPatterns","handlers","patterns","all","push","glob","isRegExp","regexSource","source","regexFlags","flags","matches","requestURL","urlMatches","handle","handlerInvocation","complete","add","_handleInternal","isTargetClosedError","rewriteErrorMessage","message","delete","stop","behavior","activation","Promise","handledPromise","handled","willExpire","map","filter","_headersArray","_headersMap","MultiMap","set","values"],"sources":["../../src/client/network.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { URLSearchParams } from 'url';\nimport type * as channels from '@protocol/channels';\nimport { ChannelOwner } from './channelOwner';\nimport { Frame } from './frame';\nimport { Worker } from './worker';\nimport type { Headers, RemoteAddr, SecurityDetails, WaitForEventOptions } from './types';\nimport fs from 'fs';\nimport { mime } from '../utilsBundle';\nimport { assert, isString, headersObjectToArray, isRegExp, rewriteErrorMessage } from '../utils';\nimport { ManualPromise, LongStandingScope } from '../utils/manualPromise';\nimport { Events } from './events';\nimport type { Page } from './page';\nimport { Waiter } from './waiter';\nimport type * as api from '../../types/types';\nimport type { HeadersArray } from '../common/types';\nimport { MultiMap, urlMatches, type URLMatch } from '../utils';\nimport { APIResponse } from './fetch';\nimport type { Serializable } from '../../types/structs';\nimport type { BrowserContext } from './browserContext';\nimport { isTargetClosedError } from './errors';\n\nexport type NetworkCookie = {\n  name: string,\n  value: string,\n  domain: string,\n  path: string,\n  expires: number,\n  httpOnly: boolean,\n  secure: boolean,\n  sameSite: 'Strict' | 'Lax' | 'None'\n};\n\nexport type SetNetworkCookieParam = {\n  name: string,\n  value: string,\n  url?: string,\n  domain?: string,\n  path?: string,\n  expires?: number,\n  httpOnly?: boolean,\n  secure?: boolean,\n  sameSite?: 'Strict' | 'Lax' | 'None'\n};\n\nexport type ClearNetworkCookieOptions = {\n  name?: string | RegExp,\n  domain?: string | RegExp,\n  path?: string | RegExp,\n};\n\ntype SerializedFallbackOverrides = {\n  url?: string;\n  method?: string;\n  headers?: Headers;\n  postDataBuffer?: Buffer;\n};\n\ntype FallbackOverrides = {\n  url?: string;\n  method?: string;\n  headers?: Headers;\n  postData?: string | Buffer | Serializable;\n};\n\nexport class Request extends ChannelOwner<channels.RequestChannel> implements api.Request {\n  private _redirectedFrom: Request | null = null;\n  private _redirectedTo: Request | null = null;\n  _failureText: string | null = null;\n  private _provisionalHeaders: RawHeaders;\n  private _actualHeadersPromise: Promise<RawHeaders> | undefined;\n  _timing: ResourceTiming;\n  private _fallbackOverrides: SerializedFallbackOverrides = {};\n\n  static from(request: channels.RequestChannel): Request {\n    return (request as any)._object;\n  }\n\n  static fromNullable(request: channels.RequestChannel | undefined): Request | null {\n    return request ? Request.from(request) : null;\n  }\n\n  constructor(parent: ChannelOwner, type: string, guid: string, initializer: channels.RequestInitializer) {\n    super(parent, type, guid, initializer);\n    this._redirectedFrom = Request.fromNullable(initializer.redirectedFrom);\n    if (this._redirectedFrom)\n      this._redirectedFrom._redirectedTo = this;\n    this._provisionalHeaders = new RawHeaders(initializer.headers);\n    this._timing = {\n      startTime: 0,\n      domainLookupStart: -1,\n      domainLookupEnd: -1,\n      connectStart: -1,\n      secureConnectionStart: -1,\n      connectEnd: -1,\n      requestStart: -1,\n      responseStart: -1,\n      responseEnd: -1,\n    };\n  }\n\n  url(): string {\n    return this._fallbackOverrides.url || this._initializer.url;\n  }\n\n  resourceType(): string {\n    return this._initializer.resourceType;\n  }\n\n  method(): string {\n    return this._fallbackOverrides.method || this._initializer.method;\n  }\n\n  postData(): string | null {\n    return (this._fallbackOverrides.postDataBuffer || this._initializer.postData)?.toString('utf-8') || null;\n  }\n\n  postDataBuffer(): Buffer | null {\n    return this._fallbackOverrides.postDataBuffer || this._initializer.postData || null;\n  }\n\n  postDataJSON(): Object | null {\n    const postData = this.postData();\n    if (!postData)\n      return null;\n\n    const contentType = this.headers()['content-type'];\n    if (contentType?.includes('application/x-www-form-urlencoded')) {\n      const entries: Record<string, string> = {};\n      const parsed = new URLSearchParams(postData);\n      for (const [k, v] of parsed.entries())\n        entries[k] = v;\n      return entries;\n    }\n\n    try {\n      return JSON.parse(postData);\n    } catch (e) {\n      throw new Error('POST data is not a valid JSON object: ' + postData);\n    }\n  }\n\n  /**\n   * @deprecated\n   */\n  headers(): Headers {\n    if (this._fallbackOverrides.headers)\n      return RawHeaders._fromHeadersObjectLossy(this._fallbackOverrides.headers).headers();\n    return this._provisionalHeaders.headers();\n  }\n\n  async _actualHeaders(): Promise<RawHeaders> {\n    if (this._fallbackOverrides.headers)\n      return RawHeaders._fromHeadersObjectLossy(this._fallbackOverrides.headers);\n\n    if (!this._actualHeadersPromise) {\n      this._actualHeadersPromise = this._wrapApiCall(async () => {\n        return new RawHeaders((await this._channel.rawRequestHeaders()).headers);\n      });\n    }\n    return await this._actualHeadersPromise;\n  }\n\n  async allHeaders(): Promise<Headers> {\n    return (await this._actualHeaders()).headers();\n  }\n\n  async headersArray(): Promise<HeadersArray> {\n    return (await this._actualHeaders()).headersArray();\n  }\n\n  async headerValue(name: string): Promise<string | null> {\n    return (await this._actualHeaders()).get(name);\n  }\n\n  async response(): Promise<Response | null> {\n    return Response.fromNullable((await this._channel.response()).response);\n  }\n\n  async _internalResponse(): Promise<Response | null> {\n    return await this._wrapApiCall(async () => {\n      return Response.fromNullable((await this._channel.response()).response);\n    }, true);\n  }\n\n  frame(): Frame {\n    if (!this._initializer.frame) {\n      assert(this.serviceWorker());\n      throw new Error('Service Worker requests do not have an associated frame.');\n    }\n    const frame = Frame.from(this._initializer.frame);\n    if (!frame._page) {\n      throw new Error([\n        'Frame for this navigation request is not available, because the request',\n        'was issued before the frame is created. You can check whether the request',\n        'is a navigation request by calling isNavigationRequest() method.',\n      ].join('\\n'));\n    }\n    return frame;\n  }\n\n  _safePage(): Page | null {\n    return Frame.fromNullable(this._initializer.frame)?._page || null;\n  }\n\n  serviceWorker(): Worker | null {\n    return this._initializer.serviceWorker ? Worker.from(this._initializer.serviceWorker) : null;\n  }\n\n  isNavigationRequest(): boolean {\n    return this._initializer.isNavigationRequest;\n  }\n\n  redirectedFrom(): Request | null {\n    return this._redirectedFrom;\n  }\n\n  redirectedTo(): Request | null {\n    return this._redirectedTo;\n  }\n\n  failure(): { errorText: string; } | null {\n    if (this._failureText === null)\n      return null;\n    return {\n      errorText: this._failureText\n    };\n  }\n\n  timing(): ResourceTiming {\n    return this._timing;\n  }\n\n  async sizes(): Promise<RequestSizes> {\n    const response = await this.response();\n    if (!response)\n      throw new Error('Unable to fetch sizes for failed request');\n    return (await response._channel.sizes()).sizes;\n  }\n\n  _setResponseEndTiming(responseEndTiming: number) {\n    this._timing.responseEnd = responseEndTiming;\n    if (this._timing.responseStart === -1)\n      this._timing.responseStart = responseEndTiming;\n  }\n\n  _finalRequest(): Request {\n    return this._redirectedTo ? this._redirectedTo._finalRequest() : this;\n  }\n\n  _applyFallbackOverrides(overrides: FallbackOverrides) {\n    if (overrides.url)\n      this._fallbackOverrides.url = overrides.url;\n    if (overrides.method)\n      this._fallbackOverrides.method = overrides.method;\n    if (overrides.headers)\n      this._fallbackOverrides.headers = overrides.headers;\n\n    if (isString(overrides.postData))\n      this._fallbackOverrides.postDataBuffer = Buffer.from(overrides.postData, 'utf-8');\n    else if (overrides.postData instanceof Buffer)\n      this._fallbackOverrides.postDataBuffer = overrides.postData;\n    else if (overrides.postData)\n      this._fallbackOverrides.postDataBuffer = Buffer.from(JSON.stringify(overrides.postData), 'utf-8');\n  }\n\n  _fallbackOverridesForContinue() {\n    return this._fallbackOverrides;\n  }\n\n  _targetClosedScope(): LongStandingScope {\n    return this.serviceWorker()?._closedScope || this._safePage()?._closedOrCrashedScope || new LongStandingScope();\n  }\n}\n\nexport class Route extends ChannelOwner<channels.RouteChannel> implements api.Route {\n  private _handlingPromise: ManualPromise<boolean> | null = null;\n  _context!: BrowserContext;\n  _didThrow: boolean = false;\n\n  static from(route: channels.RouteChannel): Route {\n    return (route as any)._object;\n  }\n\n  constructor(parent: ChannelOwner, type: string, guid: string, initializer: channels.RouteInitializer) {\n    super(parent, type, guid, initializer);\n  }\n\n  request(): Request {\n    return Request.from(this._initializer.request);\n  }\n\n  private async _raceWithTargetClose(promise: Promise<any>): Promise<void> {\n    // When page closes or crashes, we catch any potential rejects from this Route.\n    // Note that page could be missing when routing popup's initial request that\n    // does not have a Page initialized just yet.\n    return await this.request()._targetClosedScope().safeRace(promise);\n  }\n\n  async _startHandling(): Promise<boolean> {\n    this._handlingPromise = new ManualPromise();\n    return await this._handlingPromise;\n  }\n\n  async fallback(options: FallbackOverrides = {}) {\n    this._checkNotHandled();\n    this.request()._applyFallbackOverrides(options);\n    this._reportHandled(false);\n  }\n\n  async abort(errorCode?: string) {\n    await this._handleRoute(async () => {\n      await this._raceWithTargetClose(this._channel.abort({ requestUrl: this.request()._initializer.url, errorCode }));\n    });\n  }\n\n  async _redirectNavigationRequest(url: string) {\n    await this._handleRoute(async () => {\n      await this._raceWithTargetClose(this._channel.redirectNavigationRequest({ url }));\n    });\n  }\n\n  async fetch(options: FallbackOverrides & { maxRedirects?: number, maxRetries?: number, timeout?: number } = {}): Promise<APIResponse> {\n    return await this._wrapApiCall(async () => {\n      return await this._context.request._innerFetch({ request: this.request(), data: options.postData, ...options });\n    });\n  }\n\n  async fulfill(options: { response?: api.APIResponse, status?: number, headers?: Headers, contentType?: string, body?: string | Buffer, json?: any, path?: string } = {}) {\n    await this._handleRoute(async () => {\n      await this._wrapApiCall(async () => {\n        await this._innerFulfill(options);\n      });\n    });\n  }\n\n  private async _handleRoute(callback: () => Promise<void>) {\n    this._checkNotHandled();\n    try {\n      await callback();\n      this._reportHandled(true);\n    } catch (e) {\n      this._didThrow = true;\n      throw e;\n    }\n  }\n\n  private async _innerFulfill(options: { response?: api.APIResponse, status?: number, headers?: Headers, contentType?: string, body?: string | Buffer, json?: any, path?: string } = {}): Promise<void> {\n    let fetchResponseUid;\n    let { status: statusOption, headers: headersOption, body } = options;\n\n    if (options.json !== undefined) {\n      assert(options.body === undefined, 'Can specify either body or json parameters');\n      body = JSON.stringify(options.json);\n    }\n\n    if (options.response instanceof APIResponse) {\n      statusOption ??= options.response.status();\n      headersOption ??= options.response.headers();\n      if (body === undefined && options.path === undefined) {\n        if (options.response._request._connection === this._connection)\n          fetchResponseUid = (options.response as APIResponse)._fetchUid();\n        else\n          body = await options.response.body();\n      }\n    }\n\n    let isBase64 = false;\n    let length = 0;\n    if (options.path) {\n      const buffer = await fs.promises.readFile(options.path);\n      body = buffer.toString('base64');\n      isBase64 = true;\n      length = buffer.length;\n    } else if (isString(body)) {\n      isBase64 = false;\n      length = Buffer.byteLength(body);\n    } else if (body) {\n      length = body.length;\n      body = body.toString('base64');\n      isBase64 = true;\n    }\n\n    const headers: Headers = {};\n    for (const header of Object.keys(headersOption || {}))\n      headers[header.toLowerCase()] = String(headersOption![header]);\n    if (options.contentType)\n      headers['content-type'] = String(options.contentType);\n    else if (options.json)\n      headers['content-type'] = 'application/json';\n    else if (options.path)\n      headers['content-type'] = mime.getType(options.path) || 'application/octet-stream';\n    if (length && !('content-length' in headers))\n      headers['content-length'] = String(length);\n\n    await this._raceWithTargetClose(this._channel.fulfill({\n      requestUrl: this.request()._initializer.url,\n      status: statusOption || 200,\n      headers: headersObjectToArray(headers),\n      body,\n      isBase64,\n      fetchResponseUid\n    }));\n  }\n\n  async continue(options: FallbackOverrides = {}) {\n    await this._handleRoute(async () => {\n      this.request()._applyFallbackOverrides(options);\n      await this._innerContinue();\n    });\n  }\n\n  _checkNotHandled() {\n    if (!this._handlingPromise)\n      throw new Error('Route is already handled!');\n  }\n\n  _reportHandled(done: boolean) {\n    const chain = this._handlingPromise!;\n    this._handlingPromise = null;\n    chain.resolve(done);\n  }\n\n  async _innerContinue(internal = false) {\n    const options = this.request()._fallbackOverridesForContinue();\n    return await this._wrapApiCall(async () => {\n      await this._raceWithTargetClose(this._channel.continue({\n        requestUrl: this.request()._initializer.url,\n        url: options.url,\n        method: options.method,\n        headers: options.headers ? headersObjectToArray(options.headers) : undefined,\n        postData: options.postDataBuffer,\n        isFallback: internal,\n      }));\n    }, !!internal);\n  }\n}\n\nexport type RouteHandlerCallback = (route: Route, request: Request) => Promise<any> | void;\n\nexport type ResourceTiming = {\n  startTime: number;\n  domainLookupStart: number;\n  domainLookupEnd: number;\n  connectStart: number;\n  secureConnectionStart: number;\n  connectEnd: number;\n  requestStart: number;\n  responseStart: number;\n  responseEnd: number;\n};\n\nexport type RequestSizes = {\n  requestBodySize: number;\n  requestHeadersSize: number;\n  responseBodySize: number;\n  responseHeadersSize: number;\n};\n\nexport class Response extends ChannelOwner<channels.ResponseChannel> implements api.Response {\n  private _provisionalHeaders: RawHeaders;\n  private _actualHeadersPromise: Promise<RawHeaders> | undefined;\n  private _request: Request;\n  readonly _finishedPromise = new ManualPromise<null>();\n\n  static from(response: channels.ResponseChannel): Response {\n    return (response as any)._object;\n  }\n\n  static fromNullable(response: channels.ResponseChannel | undefined): Response | null {\n    return response ? Response.from(response) : null;\n  }\n\n  constructor(parent: ChannelOwner, type: string, guid: string, initializer: channels.ResponseInitializer) {\n    super(parent, type, guid, initializer);\n    this._provisionalHeaders = new RawHeaders(initializer.headers);\n    this._request = Request.from(this._initializer.request);\n    Object.assign(this._request._timing, this._initializer.timing);\n  }\n\n  url(): string {\n    return this._initializer.url;\n  }\n\n  ok(): boolean {\n    // Status 0 is for file:// URLs\n    return this._initializer.status === 0 || (this._initializer.status >= 200 && this._initializer.status <= 299);\n  }\n\n  status(): number {\n    return this._initializer.status;\n  }\n\n  statusText(): string {\n    return this._initializer.statusText;\n  }\n\n  fromServiceWorker(): boolean {\n    return this._initializer.fromServiceWorker;\n  }\n\n  /**\n   * @deprecated\n   */\n  headers(): Headers {\n    return this._provisionalHeaders.headers();\n  }\n\n  async _actualHeaders(): Promise<RawHeaders> {\n    if (!this._actualHeadersPromise) {\n      this._actualHeadersPromise = (async () => {\n        return new RawHeaders((await this._channel.rawResponseHeaders()).headers);\n      })();\n    }\n    return await this._actualHeadersPromise;\n  }\n\n  async allHeaders(): Promise<Headers> {\n    return (await this._actualHeaders()).headers();\n  }\n\n  async headersArray(): Promise<HeadersArray> {\n    return (await this._actualHeaders()).headersArray().slice();\n  }\n\n  async headerValue(name: string): Promise<string | null> {\n    return (await this._actualHeaders()).get(name);\n  }\n\n  async headerValues(name: string): Promise<string[]> {\n    return (await this._actualHeaders()).getAll(name);\n  }\n\n  async finished(): Promise<null> {\n    return await this.request()._targetClosedScope().race(this._finishedPromise);\n  }\n\n  async body(): Promise<Buffer> {\n    return (await this._channel.body()).binary;\n  }\n\n  async text(): Promise<string> {\n    const content = await this.body();\n    return content.toString('utf8');\n  }\n\n  async json(): Promise<object> {\n    const content = await this.text();\n    return JSON.parse(content);\n  }\n\n  request(): Request {\n    return this._request;\n  }\n\n  frame(): Frame {\n    return this._request.frame();\n  }\n\n  async serverAddr(): Promise<RemoteAddr|null> {\n    return (await this._channel.serverAddr()).value || null;\n  }\n\n  async securityDetails(): Promise<SecurityDetails|null> {\n    return (await this._channel.securityDetails()).value || null;\n  }\n}\n\nexport class WebSocket extends ChannelOwner<channels.WebSocketChannel> implements api.WebSocket {\n  private _page: Page;\n  private _isClosed: boolean;\n\n  static from(webSocket: channels.WebSocketChannel): WebSocket {\n    return (webSocket as any)._object;\n  }\n\n  constructor(parent: ChannelOwner, type: string, guid: string, initializer: channels.WebSocketInitializer) {\n    super(parent, type, guid, initializer);\n    this._isClosed = false;\n    this._page = parent as Page;\n    this._channel.on('frameSent', event => {\n      if (event.opcode === 1)\n        this.emit(Events.WebSocket.FrameSent, { payload: event.data });\n      else if (event.opcode === 2)\n        this.emit(Events.WebSocket.FrameSent, { payload: Buffer.from(event.data, 'base64') });\n    });\n    this._channel.on('frameReceived', event => {\n      if (event.opcode === 1)\n        this.emit(Events.WebSocket.FrameReceived, { payload: event.data });\n      else if (event.opcode === 2)\n        this.emit(Events.WebSocket.FrameReceived, { payload: Buffer.from(event.data, 'base64') });\n    });\n    this._channel.on('socketError', ({ error }) => this.emit(Events.WebSocket.Error, error));\n    this._channel.on('close', () => {\n      this._isClosed = true;\n      this.emit(Events.WebSocket.Close, this);\n    });\n  }\n\n  url(): string {\n    return this._initializer.url;\n  }\n\n  isClosed(): boolean {\n    return this._isClosed;\n  }\n\n  async waitForEvent(event: string, optionsOrPredicate: WaitForEventOptions = {}): Promise<any> {\n    return await this._wrapApiCall(async () => {\n      const timeout = this._page._timeoutSettings.timeout(typeof optionsOrPredicate === 'function' ? {} : optionsOrPredicate);\n      const predicate = typeof optionsOrPredicate === 'function' ? optionsOrPredicate : optionsOrPredicate.predicate;\n      const waiter = Waiter.createForEvent(this, event);\n      waiter.rejectOnTimeout(timeout, `Timeout ${timeout}ms exceeded while waiting for event \"${event}\"`);\n      if (event !== Events.WebSocket.Error)\n        waiter.rejectOnEvent(this, Events.WebSocket.Error, new Error('Socket error'));\n      if (event !== Events.WebSocket.Close)\n        waiter.rejectOnEvent(this, Events.WebSocket.Close, new Error('Socket closed'));\n      waiter.rejectOnEvent(this._page, Events.Page.Close, () => this._page._closeErrorWithReason());\n      const result = await waiter.waitForEvent(this, event, predicate as any);\n      waiter.dispose();\n      return result;\n    });\n  }\n}\n\nexport function validateHeaders(headers: Headers) {\n  for (const key of Object.keys(headers)) {\n    const value = headers[key];\n    if (!Object.is(value, undefined) && !isString(value))\n      throw new Error(`Expected value of header \"${key}\" to be String, but \"${typeof value}\" is found.`);\n  }\n}\n\nexport class RouteHandler {\n  private handledCount = 0;\n  private readonly _baseURL: string | undefined;\n  private readonly _times: number;\n  readonly url: URLMatch;\n  readonly handler: RouteHandlerCallback;\n  private _ignoreException: boolean = false;\n  private _activeInvocations: Set<{ complete: Promise<void>, route: Route }> = new Set();\n\n  constructor(baseURL: string | undefined, url: URLMatch, handler: RouteHandlerCallback, times: number = Number.MAX_SAFE_INTEGER) {\n    this._baseURL = baseURL;\n    this._times = times;\n    this.url = url;\n    this.handler = handler;\n  }\n\n  static prepareInterceptionPatterns(handlers: RouteHandler[]) {\n    const patterns: channels.BrowserContextSetNetworkInterceptionPatternsParams['patterns'] = [];\n    let all = false;\n    for (const handler of handlers) {\n      if (isString(handler.url))\n        patterns.push({ glob: handler.url });\n      else if (isRegExp(handler.url))\n        patterns.push({ regexSource: handler.url.source, regexFlags: handler.url.flags });\n      else\n        all = true;\n    }\n    if (all)\n      return [{ glob: '**/*' }];\n    return patterns;\n  }\n\n  public matches(requestURL: string): boolean {\n    return urlMatches(this._baseURL, requestURL, this.url);\n  }\n\n  public async handle(route: Route): Promise<boolean> {\n    const handlerInvocation = { complete: new ManualPromise(), route } ;\n    this._activeInvocations.add(handlerInvocation);\n    try {\n      return await this._handleInternal(route);\n    } catch (e) {\n      // If the handler was stopped (without waiting for completion), we ignore all exceptions.\n      if (this._ignoreException)\n        return false;\n      if (isTargetClosedError(e)) {\n        // We are failing in the handler because the target close closed.\n        // Give user a hint!\n        rewriteErrorMessage(e, `\"${e.message}\" while running route callback.\\nConsider awaiting \\`await page.unrouteAll({ behavior: 'ignoreErrors' })\\`\\nbefore the end of the test to ignore remaining routes in flight.`);\n      }\n      throw e;\n    } finally {\n      handlerInvocation.complete.resolve();\n      this._activeInvocations.delete(handlerInvocation);\n    }\n  }\n\n  async stop(behavior: 'wait' | 'ignoreErrors') {\n    // When a handler is manually unrouted or its page/context is closed we either\n    // - wait for the current handler invocations to finish\n    // - or do not wait, if the user opted out of it, but swallow all exceptions\n    //   that happen after the unroute/close.\n    if (behavior === 'ignoreErrors') {\n      this._ignoreException = true;\n    } else {\n      const promises = [];\n      for (const activation of this._activeInvocations) {\n        if (!activation.route._didThrow)\n          promises.push(activation.complete);\n      }\n      await Promise.all(promises);\n    }\n  }\n\n  private async _handleInternal(route: Route): Promise<boolean> {\n    ++this.handledCount;\n    const handledPromise = route._startHandling();\n    // Extract handler into a variable to avoid [RouteHandler.handler] in the stack.\n    const handler = this.handler;\n    const [handled] = await Promise.all([\n      handledPromise,\n      handler(route, route.request()),\n    ]);\n    return handled;\n  }\n\n  public willExpire(): boolean {\n    return this.handledCount + 1 >= this._times;\n  }\n}\n\nexport class RawHeaders {\n  private _headersArray: HeadersArray;\n  private _headersMap = new MultiMap<string, string>();\n\n  static _fromHeadersObjectLossy(headers: Headers): RawHeaders {\n    const headersArray: HeadersArray = Object.entries(headers).map(([name, value]) => ({\n      name, value\n    })).filter(header => header.value !== undefined);\n    return new RawHeaders(headersArray);\n  }\n\n  constructor(headers: HeadersArray) {\n    this._headersArray = headers;\n    for (const header of headers)\n      this._headersMap.set(header.name.toLowerCase(), header.value);\n  }\n\n  get(name: string): string | null {\n    const values = this.getAll(name);\n    if (!values || !values.length)\n      return null;\n    return values.join(name.toLowerCase() === 'set-cookie' ? '\\n' : ', ');\n  }\n\n  getAll(name: string): string[] {\n    return [...this._headersMap.get(name.toLowerCase())];\n  }\n\n  headers(): Headers {\n    const result: Headers = {};\n    for (const name of this._headersMap.keys())\n      result[name] = this.get(name)!;\n    return result;\n  }\n\n  headersArray(): HeadersArray {\n    return this._headersArray;\n  }\n}\n"],"mappings":"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"}