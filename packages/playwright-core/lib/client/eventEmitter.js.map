{"version":3,"file":"eventEmitter.js","names":["_events","require","_utils","EventEmitter","constructor","undefined","_eventsCount","_maxListeners","_pendingHandlers","Map","_rejectionHandler","Object","getPrototypeOf","create","on","addListener","off","removeListener","setMaxListeners","n","Number","isNaN","RangeError","getMaxListeners","OriginalEventEmitter","defaultMaxListeners","emit","type","args","events","handler","_callHandler","len","length","listeners","slice","i","promise","Reflect","apply","Promise","set","get","Set","add","catch","e","finally","delete","listener","_addListener","prepend","checkListener","existing","newListener","unwrapListener","unshift","push","m","warned","w","Error","String","name","emitter","count","isUnderTest","console","warn","prependListener","once","OnceWrapper","wrapperFunction","prependOnceListener","list","_listener","position","originalListener","wrappedListener","shift","splice","removeAllListeners","options","_removeAllListeners","behavior","errors","error","_waitFor","then","resolve","keys","key","_listeners","rawListeners","listenerCount","eventNames","ownKeys","promises","pending","all","target","unwrap","unwrapListeners","exports","TypeError","eventEmitter","eventType","_fired","_eventEmitter","_eventType","_handle","bind","l","_wrappedListener","arr","map","_wrappedListener2"],"sources":["../../src/client/eventEmitter.ts"],"sourcesContent":["/**\n * Copyright Joyent, Inc. and other Node contributors.\n * Modifications copyright (c) Microsoft Corporation.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the\n * \"Software\"), to deal in the Software without restriction, including\n * without limitation the rights to use, copy, modify, merge, publish,\n * distribute, sublicense, and/or sell copies of the Software, and to permit\n * persons to whom the Software is furnished to do so, subject to the\n * following conditions:\n *\n * The above copyright notice and this permission notice shall be included\n * in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n * NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n * USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\ntype EventType = string | symbol;\ntype Listener = (...args: any[]) => any;\ntype EventMap = Record<EventType, Listener | Listener[]>;\nimport { EventEmitter as OriginalEventEmitter } from 'events';\nimport type { EventEmitter as EventEmitterType } from 'events';\nimport { isUnderTest } from '../utils';\n\nexport class EventEmitter implements EventEmitterType {\n\n  private _events: EventMap | undefined = undefined;\n  private _eventsCount = 0;\n  private _maxListeners: number | undefined = undefined;\n  readonly _pendingHandlers = new Map<EventType, Set<Promise<void>>>();\n  private _rejectionHandler: ((error: Error) => void) | undefined;\n\n  constructor() {\n    if (this._events === undefined || this._events === Object.getPrototypeOf(this)._events) {\n      this._events = Object.create(null);\n      this._eventsCount = 0;\n    }\n    this._maxListeners = this._maxListeners || undefined;\n    this.on = this.addListener;\n    this.off = this.removeListener;\n  }\n\n  setMaxListeners(n: number): this {\n    if (typeof n !== 'number' || n < 0 || Number.isNaN(n))\n      throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n    this._maxListeners = n;\n    return this;\n  }\n\n  getMaxListeners(): number {\n    return this._maxListeners === undefined ? OriginalEventEmitter.defaultMaxListeners : this._maxListeners;\n  }\n\n  emit(type: EventType, ...args: any[]): boolean {\n    const events = this._events;\n    if (events === undefined)\n      return false;\n\n    const handler = events?.[type];\n    if (handler === undefined)\n      return false;\n\n    if (typeof handler === 'function') {\n      this._callHandler(type, handler, args);\n    } else {\n      const len = handler.length;\n      const listeners = handler.slice();\n      for (let i = 0; i < len; ++i)\n        this._callHandler(type, listeners[i], args);\n    }\n    return true;\n  }\n\n  private _callHandler(type: EventType, handler: Listener, args: any[]): void {\n    const promise = Reflect.apply(handler, this, args);\n    if (!(promise instanceof Promise))\n      return;\n    let set = this._pendingHandlers.get(type);\n    if (!set) {\n      set = new Set();\n      this._pendingHandlers.set(type, set);\n    }\n    set.add(promise);\n    promise.catch(e => {\n      if (this._rejectionHandler)\n        this._rejectionHandler(e);\n      else\n        throw e;\n    }).finally(() => set.delete(promise));\n  }\n\n  addListener(type: EventType, listener: Listener): this {\n    return this._addListener(type, listener, false);\n  }\n\n  on(type: EventType, listener: Listener): this {\n    return this._addListener(type, listener, false);\n  }\n\n  private _addListener(type: EventType, listener: Listener, prepend: boolean): this {\n    checkListener(listener);\n    let events = this._events;\n    let existing;\n    if (events === undefined) {\n      events = this._events = Object.create(null);\n      this._eventsCount = 0;\n    } else {\n      // To avoid recursion in the case that type === \"newListener\"! Before\n      // adding it to the listeners, first emit \"newListener\".\n      if (events.newListener !== undefined) {\n        this.emit('newListener', type, unwrapListener(listener));\n\n        // Re-assign `events` because a newListener handler could have caused the\n        // this._events to be assigned to a new object\n        events = this._events!;\n      }\n      existing = events[type];\n    }\n\n    if (existing === undefined) {\n      // Optimize the case of one listener. Don't need the extra array object.\n      existing = events![type] = listener;\n      ++this._eventsCount;\n    } else {\n      if (typeof existing === 'function') {\n        // Adding the second element, need to change to array.\n        existing = events![type] =\n          prepend ? [listener, existing] : [existing, listener];\n        // If we've already got an array, just append.\n      } else if (prepend) {\n        existing.unshift(listener);\n      } else {\n        existing.push(listener);\n      }\n\n      // Check for listener leak\n      const m = this.getMaxListeners();\n      if (m > 0 && existing.length > m && !(existing as any).warned) {\n        (existing as any).warned = true;\n        // No error code for this since it is a Warning\n        const w = new Error('Possible EventEmitter memory leak detected. ' +\n                            existing.length + ' ' + String(type) + ' listeners ' +\n                            'added. Use emitter.setMaxListeners() to ' +\n                            'increase limit') as any;\n        w.name = 'MaxListenersExceededWarning';\n        w.emitter = this;\n        w.type = type;\n        w.count = existing.length;\n        if (!isUnderTest()) {\n          // eslint-disable-next-line no-console\n          console.warn(w);\n        }\n      }\n    }\n\n    return this;\n  }\n\n  prependListener(type: EventType, listener: Listener): this {\n    return this._addListener(type, listener, true);\n  }\n\n  once(type: EventType, listener: Listener): this {\n    checkListener(listener);\n    this.on(type, new OnceWrapper(this, type, listener).wrapperFunction);\n    return this;\n  }\n\n  prependOnceListener(type: EventType, listener: Listener): this {\n    checkListener(listener);\n    this.prependListener(type, new OnceWrapper(this, type, listener).wrapperFunction);\n    return this;\n  }\n\n  removeListener(type: EventType, listener: Listener): this {\n    checkListener(listener);\n\n    const events = this._events;\n    if (events === undefined)\n      return this;\n\n    const list = events[type];\n    if (list === undefined)\n      return this;\n\n    if (list === listener || (list as any).listener === listener) {\n      if (--this._eventsCount === 0) {\n        this._events = Object.create(null);\n      } else {\n        delete events[type];\n        if (events.removeListener)\n          this.emit('removeListener', type, (list as any).listener ?? listener);\n      }\n    } else if (typeof list !== 'function') {\n      let position = -1;\n      let originalListener;\n\n      for (let i = list.length - 1; i >= 0; i--) {\n        if (list[i] === listener || wrappedListener(list[i]) === listener) {\n          originalListener = wrappedListener(list[i]);\n          position = i;\n          break;\n        }\n      }\n\n      if (position < 0)\n        return this;\n\n      if (position === 0)\n        list.shift();\n      else\n        list.splice(position, 1);\n\n      if (list.length === 1)\n        events[type] = list[0];\n\n      if (events.removeListener !== undefined)\n        this.emit('removeListener', type, originalListener || listener);\n    }\n\n    return this;\n\n  }\n\n  off(type: EventType, listener: Listener): this {\n    return this.removeListener(type, listener);\n  }\n\n  removeAllListeners(type?: EventType): this;\n  removeAllListeners(type: EventType | undefined, options: { behavior?: 'wait'|'ignoreErrors'|'default' }): Promise<void>;\n  removeAllListeners(type?: string, options?: { behavior?: 'wait'|'ignoreErrors'|'default' }): this | Promise<void> {\n    this._removeAllListeners(type);\n    if (!options)\n      return this;\n\n    if (options.behavior === 'wait') {\n      const errors: Error[] = [];\n      this._rejectionHandler = error => errors.push(error);\n      // eslint-disable-next-line internal-playwright/await-promise-in-class-returns\n      return this._waitFor(type).then(() => {\n        if (errors.length)\n          throw errors[0];\n      });\n    }\n\n    if (options.behavior === 'ignoreErrors')\n      this._rejectionHandler = () => {};\n\n    // eslint-disable-next-line internal-playwright/await-promise-in-class-returns\n    return Promise.resolve();\n  }\n\n  private _removeAllListeners(type?: string) {\n    const events = this._events;\n    if (!events)\n      return;\n\n    // not listening for removeListener, no need to emit\n    if (!events.removeListener) {\n      if (type === undefined) {\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n      } else if (events[type] !== undefined) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else\n          delete events[type];\n      }\n      return;\n    }\n\n    // emit removeListener for all listeners on all events\n    if (type === undefined) {\n      const keys = Object.keys(events);\n      let key;\n      for (let i = 0; i < keys.length; ++i) {\n        key = keys[i];\n        if (key === 'removeListener')\n          continue;\n        this._removeAllListeners(key);\n      }\n      this._removeAllListeners('removeListener');\n      this._events = Object.create(null);\n      this._eventsCount = 0;\n      return;\n    }\n\n    const listeners = events[type];\n\n    if (typeof listeners === 'function') {\n      this.removeListener(type, listeners);\n    } else if (listeners !== undefined) {\n      // LIFO order\n      for (let i = listeners.length - 1; i >= 0; i--)\n        this.removeListener(type, listeners[i]);\n    }\n  }\n\n  listeners(type: EventType): Listener[] {\n    return this._listeners(this, type, true);\n  }\n\n  rawListeners(type: EventType): Listener[] {\n    return this._listeners(this, type, false);\n  }\n\n  listenerCount(type: EventType): number {\n    const events = this._events;\n    if (events !== undefined) {\n      const listener = events[type];\n      if (typeof listener === 'function')\n        return 1;\n      if (listener !== undefined)\n        return listener.length;\n    }\n    return 0;\n  }\n\n  eventNames(): Array<string | symbol> {\n    return this._eventsCount > 0 && this._events ? Reflect.ownKeys(this._events) : [];\n  }\n\n  private async _waitFor(type?: EventType) {\n    let promises: Promise<void>[] = [];\n    if (type) {\n      promises = [...(this._pendingHandlers.get(type) || [])];\n    } else {\n      promises = [];\n      for (const [, pending] of this._pendingHandlers)\n        promises.push(...pending);\n    }\n    await Promise.all(promises);\n  }\n\n  private _listeners(target: EventEmitter, type: EventType, unwrap: boolean): Listener[] {\n    const events = target._events;\n\n    if (events === undefined)\n      return [];\n\n    const listener = events[type];\n    if (listener === undefined)\n      return [];\n\n    if (typeof listener === 'function')\n      return unwrap ? [unwrapListener(listener)] : [listener];\n\n    return unwrap ? unwrapListeners(listener) : listener.slice();\n  }\n}\n\nfunction checkListener(listener: any) {\n  if (typeof listener !== 'function')\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n}\n\nclass OnceWrapper {\n  private _fired = false;\n  readonly wrapperFunction: (...args: any[]) => Promise<void> | void;\n  readonly _listener: Listener;\n  private _eventEmitter: EventEmitter;\n  private _eventType: EventType;\n\n  constructor(eventEmitter: EventEmitter, eventType: EventType, listener: Listener) {\n    this._eventEmitter = eventEmitter;\n    this._eventType = eventType;\n    this._listener = listener;\n    this.wrapperFunction = this._handle.bind(this);\n    (this.wrapperFunction as any).listener = listener;\n  }\n\n  private _handle(...args: any[]) {\n    if (this._fired)\n      return;\n    this._fired = true;\n    this._eventEmitter.removeListener(this._eventType, this.wrapperFunction);\n    return this._listener.apply(this._eventEmitter, args);\n  }\n}\n\nfunction unwrapListener(l: Listener): Listener {\n  return wrappedListener(l) ?? l;\n}\n\nfunction unwrapListeners(arr: Listener[]): Listener[] {\n  return arr.map(l => wrappedListener(l) ?? l);\n}\n\nfunction wrappedListener(l: Listener): Listener {\n  return (l as any).listener;\n}\n"],"mappings":"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"}