{"version":3,"file":"connection.js","names":["_browser","require","_browserContext","_browserType","_channelOwner","_elementHandle","_frame","_jsHandle","_network","_page","_worker","_dialog","_errors","_cdpSession","_playwright","_electron","_stream","_writableStream","_debugLogger","_selectors","_android","_artifact","_events","_jsonPipe","_fetch","_localUtils","_tracing","_validator","_clientInstrumentation","_utils","Root","ChannelOwner","constructor","connection","initialize","Playwright","from","_channel","sdkLanguage","playwright","DummyChannelOwner","Connection","EventEmitter","localUtils","instrumentation","_objects","Map","onmessage","message","_lastId","_callbacks","_rootObject","_closedError","_isRemote","_rawBuffers","toImpl","_tracingCount","_instrumentation","createInstrumentation","markAsRemote","isRemote","useRawBuffers","rawBuffers","initializePlaywright","getObjectWithKnownName","guid","get","setIsTracing","isTracing","sendMessageToServer","object","method","params","apiName","frames","stepId","_this$_localUtils","_wasCollected","Error","_guid","type","_type","id","debugLogger","isEnabled","log","JSON","stringify","location","file","line","column","undefined","metadata","internal","addStackToTracingNoReply","callData","stack","catch","zones","exitZones","Promise","resolve","reject","set","dispatch","result","error","callback","delete","parsedError","parseError","rewriteErrorMessage","formatCallLog","validator","findValidator","tChannelImpl","_tChannelImplFromWire","bind","binary","_createRemoteObject","initializer","child","_adopt","_dispose","reason","emit","close","cause","TargetClosedError","values","clear","names","arg","path","context","includes","ValidationError","toString","parentGuid","parent","Android","AndroidSocket","AndroidDevice","APIRequestContext","Artifact","BindingCall","Browser","BrowserContext","BrowserType","CDPSession","Dialog","Electron","ElectronApplication","ElementHandle","Frame","JSHandle","JsonPipe","LocalUtils","Page","Request","Response","Route","Stream","SelectorsOwner","Tracing","WebSocket","Worker","WritableStream","exports"],"sources":["../../src/client/connection.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Browser } from './browser';\nimport { BrowserContext } from './browserContext';\nimport { BrowserType } from './browserType';\nimport { ChannelOwner } from './channelOwner';\nimport { ElementHandle } from './elementHandle';\nimport { Frame } from './frame';\nimport { JSHandle } from './jsHandle';\nimport { Request, Response, Route, WebSocket } from './network';\nimport { Page, BindingCall } from './page';\nimport { Worker } from './worker';\nimport { Dialog } from './dialog';\nimport { parseError, TargetClosedError } from './errors';\nimport { CDPSession } from './cdpSession';\nimport { Playwright } from './playwright';\nimport { Electron, ElectronApplication } from './electron';\nimport type * as channels from '@protocol/channels';\nimport { Stream } from './stream';\nimport { WritableStream } from './writableStream';\nimport { debugLogger } from '../utils/debugLogger';\nimport { SelectorsOwner } from './selectors';\nimport { Android, AndroidSocket, AndroidDevice } from './android';\nimport { Artifact } from './artifact';\nimport { EventEmitter } from 'events';\nimport { JsonPipe } from './jsonPipe';\nimport { APIRequestContext } from './fetch';\nimport { LocalUtils } from './localUtils';\nimport { Tracing } from './tracing';\nimport { findValidator, ValidationError, type ValidatorContext } from '../protocol/validator';\nimport { createInstrumentation } from './clientInstrumentation';\nimport type { ClientInstrumentation } from './clientInstrumentation';\nimport { formatCallLog, rewriteErrorMessage, zones } from '../utils';\n\nclass Root extends ChannelOwner<channels.RootChannel> {\n  constructor(connection: Connection) {\n    super(connection, 'Root', '', {});\n  }\n\n  async initialize(): Promise<Playwright> {\n    return Playwright.from((await this._channel.initialize({\n      sdkLanguage: 'javascript',\n    })).playwright);\n  }\n}\n\nclass DummyChannelOwner extends ChannelOwner {\n}\n\nexport class Connection extends EventEmitter {\n  readonly _objects = new Map<string, ChannelOwner>();\n  onmessage = (message: object): void => {};\n  private _lastId = 0;\n  private _callbacks = new Map<number, { resolve: (a: any) => void, reject: (a: Error) => void, apiName: string | undefined, type: string, method: string }>();\n  private _rootObject: Root;\n  private _closedError: Error | undefined;\n  private _isRemote = false;\n  private _localUtils?: LocalUtils;\n  private _rawBuffers = false;\n  // Some connections allow resolving in-process dispatchers.\n  toImpl: ((client: ChannelOwner) => any) | undefined;\n  private _tracingCount = 0;\n  readonly _instrumentation: ClientInstrumentation;\n\n  constructor(localUtils: LocalUtils | undefined, instrumentation: ClientInstrumentation | undefined) {\n    super();\n    this._rootObject = new Root(this);\n    this._localUtils = localUtils;\n    this._instrumentation = instrumentation || createInstrumentation();\n  }\n\n  markAsRemote() {\n    this._isRemote = true;\n  }\n\n  isRemote() {\n    return this._isRemote;\n  }\n\n  useRawBuffers() {\n    this._rawBuffers = true;\n  }\n\n  rawBuffers() {\n    return this._rawBuffers;\n  }\n\n  localUtils(): LocalUtils {\n    return this._localUtils!;\n  }\n\n  async initializePlaywright(): Promise<Playwright> {\n    return await this._rootObject.initialize();\n  }\n\n  getObjectWithKnownName(guid: string): any {\n    return this._objects.get(guid)!;\n  }\n\n  setIsTracing(isTracing: boolean) {\n    if (isTracing)\n      this._tracingCount++;\n    else\n      this._tracingCount--;\n  }\n\n  async sendMessageToServer(object: ChannelOwner, method: string, params: any, apiName: string | undefined, frames: channels.StackFrame[], stepId?: string): Promise<any> {\n    if (this._closedError)\n      throw this._closedError;\n    if (object._wasCollected)\n      throw new Error('The object has been collected to prevent unbounded heap growth.');\n\n    const guid = object._guid;\n    const type = object._type;\n    const id = ++this._lastId;\n    const message = { id, guid, method, params };\n    if (debugLogger.isEnabled('channel')) {\n      // Do not include metadata in debug logs to avoid noise.\n      debugLogger.log('channel', 'SEND> ' + JSON.stringify(message));\n    }\n    const location = frames[0] ? { file: frames[0].file, line: frames[0].line, column: frames[0].column } : undefined;\n    const metadata: channels.Metadata = { apiName, location, internal: !apiName, stepId };\n    if (this._tracingCount && frames && type !== 'LocalUtils')\n      this._localUtils?._channel.addStackToTracingNoReply({ callData: { stack: frames, id } }).catch(() => {});\n    // We need to exit zones before calling into the server, otherwise\n    // when we receive events from the server, we would be in an API zone.\n    zones.exitZones(() => this.onmessage({ ...message, metadata }));\n    return await new Promise((resolve, reject) => this._callbacks.set(id, { resolve, reject, apiName, type, method }));\n  }\n\n  dispatch(message: object) {\n    if (this._closedError)\n      return;\n\n    const { id, guid, method, params, result, error, log } = message as any;\n    if (id) {\n      if (debugLogger.isEnabled('channel'))\n        debugLogger.log('channel', '<RECV ' + JSON.stringify(message));\n      const callback = this._callbacks.get(id);\n      if (!callback)\n        throw new Error(`Cannot find command to respond: ${id}`);\n      this._callbacks.delete(id);\n      if (error && !result) {\n        const parsedError = parseError(error);\n        rewriteErrorMessage(parsedError, parsedError.message + formatCallLog(log));\n        callback.reject(parsedError);\n      } else {\n        const validator = findValidator(callback.type, callback.method, 'Result');\n        callback.resolve(validator(result, '', { tChannelImpl: this._tChannelImplFromWire.bind(this), binary: this._rawBuffers ? 'buffer' : 'fromBase64' }));\n      }\n      return;\n    }\n\n    if (debugLogger.isEnabled('channel'))\n      debugLogger.log('channel', '<EVENT ' + JSON.stringify(message));\n    if (method === '__create__') {\n      this._createRemoteObject(guid, params.type, params.guid, params.initializer);\n      return;\n    }\n\n    const object = this._objects.get(guid);\n    if (!object)\n      throw new Error(`Cannot find object to \"${method}\": ${guid}`);\n\n    if (method === '__adopt__') {\n      const child = this._objects.get(params.guid);\n      if (!child)\n        throw new Error(`Unknown new child: ${params.guid}`);\n      object._adopt(child);\n      return;\n    }\n\n    if (method === '__dispose__') {\n      object._dispose(params.reason);\n      return;\n    }\n\n    const validator = findValidator(object._type, method, 'Event');\n    (object._channel as any).emit(method, validator(params, '', { tChannelImpl: this._tChannelImplFromWire.bind(this), binary: this._rawBuffers ? 'buffer' : 'fromBase64' }));\n  }\n\n  close(cause?: string) {\n    if (this._closedError)\n      return;\n    this._closedError = new TargetClosedError(cause);\n    for (const callback of this._callbacks.values())\n      callback.reject(this._closedError);\n    this._callbacks.clear();\n    this.emit('close');\n  }\n\n  private _tChannelImplFromWire(names: '*' | string[], arg: any, path: string, context: ValidatorContext) {\n    if (arg && typeof arg === 'object' && typeof arg.guid === 'string') {\n      const object = this._objects.get(arg.guid)!;\n      if (!object)\n        throw new Error(`Object with guid ${arg.guid} was not bound in the connection`);\n      if (names !== '*' && !names.includes(object._type))\n        throw new ValidationError(`${path}: expected channel ${names.toString()}`);\n      return object._channel;\n    }\n    throw new ValidationError(`${path}: expected channel ${names.toString()}`);\n  }\n\n  private _createRemoteObject(parentGuid: string, type: string, guid: string, initializer: any): any {\n    const parent = this._objects.get(parentGuid);\n    if (!parent)\n      throw new Error(`Cannot find parent object ${parentGuid} to create ${guid}`);\n    let result: ChannelOwner<any>;\n    const validator = findValidator(type, '', 'Initializer');\n    initializer = validator(initializer, '', { tChannelImpl: this._tChannelImplFromWire.bind(this), binary: this._rawBuffers ? 'buffer' : 'fromBase64' });\n    switch (type) {\n      case 'Android':\n        result = new Android(parent, type, guid, initializer);\n        break;\n      case 'AndroidSocket':\n        result = new AndroidSocket(parent, type, guid, initializer);\n        break;\n      case 'AndroidDevice':\n        result = new AndroidDevice(parent, type, guid, initializer);\n        break;\n      case 'APIRequestContext':\n        result = new APIRequestContext(parent, type, guid, initializer);\n        break;\n      case 'Artifact':\n        result = new Artifact(parent, type, guid, initializer);\n        break;\n      case 'BindingCall':\n        result = new BindingCall(parent, type, guid, initializer);\n        break;\n      case 'Browser':\n        result = new Browser(parent, type, guid, initializer);\n        break;\n      case 'BrowserContext':\n        result = new BrowserContext(parent, type, guid, initializer);\n        break;\n      case 'BrowserType':\n        result = new BrowserType(parent, type, guid, initializer);\n        break;\n      case 'CDPSession':\n        result = new CDPSession(parent, type, guid, initializer);\n        break;\n      case 'Dialog':\n        result = new Dialog(parent, type, guid, initializer);\n        break;\n      case 'Electron':\n        result = new Electron(parent, type, guid, initializer);\n        break;\n      case 'ElectronApplication':\n        result = new ElectronApplication(parent, type, guid, initializer);\n        break;\n      case 'ElementHandle':\n        result = new ElementHandle(parent, type, guid, initializer);\n        break;\n      case 'Frame':\n        result = new Frame(parent, type, guid, initializer);\n        break;\n      case 'JSHandle':\n        result = new JSHandle(parent, type, guid, initializer);\n        break;\n      case 'JsonPipe':\n        result = new JsonPipe(parent, type, guid, initializer);\n        break;\n      case 'LocalUtils':\n        result = new LocalUtils(parent, type, guid, initializer);\n        if (!this._localUtils)\n          this._localUtils = result as LocalUtils;\n        break;\n      case 'Page':\n        result = new Page(parent, type, guid, initializer);\n        break;\n      case 'Playwright':\n        result = new Playwright(parent, type, guid, initializer);\n        break;\n      case 'Request':\n        result = new Request(parent, type, guid, initializer);\n        break;\n      case 'Response':\n        result = new Response(parent, type, guid, initializer);\n        break;\n      case 'Route':\n        result = new Route(parent, type, guid, initializer);\n        break;\n      case 'Stream':\n        result = new Stream(parent, type, guid, initializer);\n        break;\n      case 'Selectors':\n        result = new SelectorsOwner(parent, type, guid, initializer);\n        break;\n      case 'SocksSupport':\n        result = new DummyChannelOwner(parent, type, guid, initializer);\n        break;\n      case 'Tracing':\n        result = new Tracing(parent, type, guid, initializer);\n        break;\n      case 'WebSocket':\n        result = new WebSocket(parent, type, guid, initializer);\n        break;\n      case 'Worker':\n        result = new Worker(parent, type, guid, initializer);\n        break;\n      case 'WritableStream':\n        result = new WritableStream(parent, type, guid, initializer);\n        break;\n      default:\n        throw new Error('Missing type ' + type);\n    }\n    return result;\n  }\n}\n"],"mappings":"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"}