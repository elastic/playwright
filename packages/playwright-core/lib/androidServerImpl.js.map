{"version":3,"file":"androidServerImpl.js","names":["_utilsBundle","require","_utils","_playwright","_playwrightServer","AndroidServerLauncherImpl","launchServer","options","playwright","createPlaywright","sdkLanguage","isServer","devices","android","host","adbHost","port","adbPort","omitDriverInstall","length","Error","deviceSerialNumber","filter","d","serial","device","path","wsPath","startsWith","createGuid","server","PlaywrightServer","mode","maxConnections","preLaunchedAndroidDevice","wsEndpoint","listen","browserServer","ws","EventEmitter","close","kill","on","emit","exports"],"sources":["../src/androidServerImpl.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { LaunchAndroidServerOptions } from './client/types';\nimport { ws } from './utilsBundle';\nimport type { WebSocketEventEmitter } from './utilsBundle';\nimport type { BrowserServer } from './client/browserType';\nimport { createGuid } from './utils';\nimport { createPlaywright } from './server/playwright';\nimport { PlaywrightServer } from './remote/playwrightServer';\n\nexport class AndroidServerLauncherImpl {\n  async launchServer(options: LaunchAndroidServerOptions = {}): Promise<BrowserServer> {\n    const playwright = createPlaywright({ sdkLanguage: 'javascript', isServer: true });\n    // 1. Pre-connect to the device\n    let devices = await playwright.android.devices({\n      host: options.adbHost,\n      port: options.adbPort,\n      omitDriverInstall: options.omitDriverInstall,\n    });\n\n    if (devices.length === 0)\n      throw new Error('No devices found');\n\n    if (options.deviceSerialNumber) {\n      devices = devices.filter(d => d.serial === options.deviceSerialNumber);\n      if (devices.length === 0)\n        throw new Error(`No device with serial number '${options.deviceSerialNumber}' not found`);\n    }\n\n    if (devices.length > 1)\n      throw new Error(`More than one device found. Please specify deviceSerialNumber`);\n\n    const device = devices[0];\n\n    const path = options.wsPath ? (options.wsPath.startsWith('/') ? options.wsPath : `/${options.wsPath}`) : `/${createGuid()}`;\n\n    // 2. Start the server\n    const server = new PlaywrightServer({ mode: 'launchServer', path, maxConnections: 1, preLaunchedAndroidDevice: device });\n    const wsEndpoint = await server.listen(options.port, options.host);\n\n    // 3. Return the BrowserServer interface\n    const browserServer = new ws.EventEmitter() as (BrowserServer & WebSocketEventEmitter);\n    browserServer.wsEndpoint = () => wsEndpoint;\n    browserServer.close = () => device.close();\n    browserServer.kill = () => device.close();\n    device.on('close', () => {\n      server.close();\n      browserServer.emit('close');\n    });\n    return browserServer;\n  }\n}\n"],"mappings":";;;;;;AAiBA,IAAAA,YAAA,GAAAC,OAAA;AAGA,IAAAC,MAAA,GAAAD,OAAA;AACA,IAAAE,WAAA,GAAAF,OAAA;AACA,IAAAG,iBAAA,GAAAH,OAAA;AAtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAUO,MAAMI,yBAAyB,CAAC;EACrC,MAAMC,YAAYA,CAACC,OAAmC,GAAG,CAAC,CAAC,EAA0B;IACnF,MAAMC,UAAU,GAAG,IAAAC,4BAAgB,EAAC;MAAEC,WAAW,EAAE,YAAY;MAAEC,QAAQ,EAAE;IAAK,CAAC,CAAC;IAClF;IACA,IAAIC,OAAO,GAAG,MAAMJ,UAAU,CAACK,OAAO,CAACD,OAAO,CAAC;MAC7CE,IAAI,EAAEP,OAAO,CAACQ,OAAO;MACrBC,IAAI,EAAET,OAAO,CAACU,OAAO;MACrBC,iBAAiB,EAAEX,OAAO,CAACW;IAC7B,CAAC,CAAC;IAEF,IAAIN,OAAO,CAACO,MAAM,KAAK,CAAC,EACtB,MAAM,IAAIC,KAAK,CAAC,kBAAkB,CAAC;IAErC,IAAIb,OAAO,CAACc,kBAAkB,EAAE;MAC9BT,OAAO,GAAGA,OAAO,CAACU,MAAM,CAACC,CAAC,IAAIA,CAAC,CAACC,MAAM,KAAKjB,OAAO,CAACc,kBAAkB,CAAC;MACtE,IAAIT,OAAO,CAACO,MAAM,KAAK,CAAC,EACtB,MAAM,IAAIC,KAAK,CAAE,iCAAgCb,OAAO,CAACc,kBAAmB,aAAY,CAAC;IAC7F;IAEA,IAAIT,OAAO,CAACO,MAAM,GAAG,CAAC,EACpB,MAAM,IAAIC,KAAK,CAAE,+DAA8D,CAAC;IAElF,MAAMK,MAAM,GAAGb,OAAO,CAAC,CAAC,CAAC;IAEzB,MAAMc,IAAI,GAAGnB,OAAO,CAACoB,MAAM,GAAIpB,OAAO,CAACoB,MAAM,CAACC,UAAU,CAAC,GAAG,CAAC,GAAGrB,OAAO,CAACoB,MAAM,GAAI,IAAGpB,OAAO,CAACoB,MAAO,EAAC,GAAK,IAAG,IAAAE,iBAAU,EAAC,CAAE,EAAC;;IAE3H;IACA,MAAMC,MAAM,GAAG,IAAIC,kCAAgB,CAAC;MAAEC,IAAI,EAAE,cAAc;MAAEN,IAAI;MAAEO,cAAc,EAAE,CAAC;MAAEC,wBAAwB,EAAET;IAAO,CAAC,CAAC;IACxH,MAAMU,UAAU,GAAG,MAAML,MAAM,CAACM,MAAM,CAAC7B,OAAO,CAACS,IAAI,EAAET,OAAO,CAACO,IAAI,CAAC;;IAElE;IACA,MAAMuB,aAAa,GAAG,IAAIC,eAAE,CAACC,YAAY,CAAC,CAA4C;IACtFF,aAAa,CAACF,UAAU,GAAG,MAAMA,UAAU;IAC3CE,aAAa,CAACG,KAAK,GAAG,MAAMf,MAAM,CAACe,KAAK,CAAC,CAAC;IAC1CH,aAAa,CAACI,IAAI,GAAG,MAAMhB,MAAM,CAACe,KAAK,CAAC,CAAC;IACzCf,MAAM,CAACiB,EAAE,CAAC,OAAO,EAAE,MAAM;MACvBZ,MAAM,CAACU,KAAK,CAAC,CAAC;MACdH,aAAa,CAACM,IAAI,CAAC,OAAO,CAAC;IAC7B,CAAC,CAAC;IACF,OAAON,aAAa;EACtB;AACF;AAACO,OAAA,CAAAvC,yBAAA,GAAAA,yBAAA"}