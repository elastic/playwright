{"version":3,"file":"javascript.js","names":["utilityScriptSource","_interopRequireWildcard","require","_utilityScriptSerializers","_instrumentation","_manualPromise","_utils","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","ExecutionContext","SdkObject","constructor","parent","delegate","worldNameForTest","_delegate","_utilityScriptPromise","_contextDestroyedScope","LongStandingScope","contextDestroyed","reason","close","Error","_raceAgainstContextDestroyed","promise","race","rawEvaluateJSON","expression","rawEvaluateHandle","rawCallFunctionNoReply","func","args","evaluateWithArguments","returnByValue","utilityScript","values","objectIds","getProperties","context","objectId","createHandle","remoteObject","releaseHandle","adoptIfNeeded","handle","source","isUnderTest","then","JSHandle","objectCount","doSlowMo","exports","type","preview","value","__jshandle","_context","_disposed","_objectId","_value","_objectType","_preview","_previewCallback","String","globalThis","leakedJSHandles","callFunctionNoReply","arg","evaluate","pageFunction","evaluateHandle","evaluateExpression","options","evaluateExpressionHandle","getProperty","propertyName","objectHandle","object","result","properties","dispose","Map","rawValue","jsonValue","script","asElement","catch","delete","toString","_setPreviewCallback","callback","_setPreview","isFunction","normalizeEvaluationExpression","handles","toDispose","pushHandle","push","length","map","serializeAsCallArgument","fallThrough","JavaScriptErrorInEvaluate","adopted","h","Promise","resolve","utilityScriptObjectIds","all","utilityScriptValues","handlePromise","parseUnserializableValue","unserializableValue","NaN","Infinity","trim","Function","e1","startsWith","substring","e2","test","isJavaScriptErrorInEvaluate","error","sparseArrayToString","entries","arrayEntries","name","index","isNaN","sort","b","lastIndex","tokens","emptyItems","join"],"sources":["../../src/server/javascript.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type * as dom from './dom';\nimport * as utilityScriptSource from '../generated/utilityScriptSource';\nimport { serializeAsCallArgument } from './isomorphic/utilityScriptSerializers';\nimport type { UtilityScript } from './injected/utilityScript';\nimport { SdkObject } from './instrumentation';\nimport { LongStandingScope } from '../utils/manualPromise';\nimport { isUnderTest } from '../utils';\n\nexport type ObjectId = string;\nexport type RemoteObject = {\n  objectId?: ObjectId,\n  value?: any\n};\n\ninterface TaggedAsJSHandle<T> {\n  __jshandle: T;\n}\ninterface TaggedAsElementHandle<T> {\n  __elementhandle: T;\n}\ntype NoHandles<Arg> = Arg extends TaggedAsJSHandle<any> ? never : (Arg extends object ? { [Key in keyof Arg]: NoHandles<Arg[Key]> } : Arg);\ntype Unboxed<Arg> =\n  Arg extends TaggedAsElementHandle<infer T> ? T :\n  Arg extends TaggedAsJSHandle<infer T> ? T :\n  Arg extends NoHandles<Arg> ? Arg :\n  Arg extends [infer A0] ? [Unboxed<A0>] :\n  Arg extends [infer A0, infer A1] ? [Unboxed<A0>, Unboxed<A1>] :\n  Arg extends [infer A0, infer A1, infer A2] ? [Unboxed<A0>, Unboxed<A1>, Unboxed<A2>] :\n  Arg extends Array<infer T> ? Array<Unboxed<T>> :\n  Arg extends object ? { [Key in keyof Arg]: Unboxed<Arg[Key]> } :\n  Arg;\nexport type Func0<R> = string | (() => R | Promise<R>);\nexport type Func1<Arg, R> = string | ((arg: Unboxed<Arg>) => R | Promise<R>);\nexport type FuncOn<On, Arg2, R> = string | ((on: On, arg2: Unboxed<Arg2>) => R | Promise<R>);\nexport type SmartHandle<T> = T extends Node ? dom.ElementHandle<T> : JSHandle<T>;\n\nexport interface ExecutionContextDelegate {\n  rawEvaluateJSON(expression: string): Promise<any>;\n  rawEvaluateHandle(expression: string): Promise<ObjectId>;\n  rawCallFunctionNoReply(func: Function, ...args: any[]): void;\n  evaluateWithArguments(expression: string, returnByValue: boolean, utilityScript: JSHandle<any>, values: any[], objectIds: ObjectId[]): Promise<any>;\n  getProperties(context: ExecutionContext, objectId: ObjectId): Promise<Map<string, JSHandle>>;\n  createHandle(context: ExecutionContext, remoteObject: RemoteObject): JSHandle;\n  releaseHandle(objectId: ObjectId): Promise<void>;\n  objectCount(objectId: ObjectId): Promise<number>;\n}\n\nexport class ExecutionContext extends SdkObject {\n  private _delegate: ExecutionContextDelegate;\n  private _utilityScriptPromise: Promise<JSHandle> | undefined;\n  private _contextDestroyedScope = new LongStandingScope();\n  readonly worldNameForTest: string;\n\n  constructor(parent: SdkObject, delegate: ExecutionContextDelegate, worldNameForTest: string) {\n    super(parent, 'execution-context');\n    this.worldNameForTest = worldNameForTest;\n    this._delegate = delegate;\n  }\n\n  contextDestroyed(reason: string) {\n    this._contextDestroyedScope.close(new Error(reason));\n  }\n\n  async _raceAgainstContextDestroyed<T>(promise: Promise<T>): Promise<T> {\n    return this._contextDestroyedScope.race(promise);\n  }\n\n  rawEvaluateJSON(expression: string): Promise<any> {\n    return this._raceAgainstContextDestroyed(this._delegate.rawEvaluateJSON(expression));\n  }\n\n  rawEvaluateHandle(expression: string): Promise<ObjectId> {\n    return this._raceAgainstContextDestroyed(this._delegate.rawEvaluateHandle(expression));\n  }\n\n  rawCallFunctionNoReply(func: Function, ...args: any[]): void {\n    this._delegate.rawCallFunctionNoReply(func, ...args);\n  }\n\n  evaluateWithArguments(expression: string, returnByValue: boolean, utilityScript: JSHandle<any>, values: any[], objectIds: ObjectId[]): Promise<any> {\n    return this._raceAgainstContextDestroyed(this._delegate.evaluateWithArguments(expression, returnByValue, utilityScript, values, objectIds));\n  }\n\n  getProperties(context: ExecutionContext, objectId: ObjectId): Promise<Map<string, JSHandle>> {\n    return this._raceAgainstContextDestroyed(this._delegate.getProperties(context, objectId));\n  }\n\n  createHandle(remoteObject: RemoteObject): JSHandle {\n    return this._delegate.createHandle(this, remoteObject);\n  }\n\n  releaseHandle(objectId: ObjectId): Promise<void> {\n    return this._delegate.releaseHandle(objectId);\n  }\n\n  adoptIfNeeded(handle: JSHandle): Promise<JSHandle> | null {\n    return null;\n  }\n\n  utilityScript(): Promise<JSHandle<UtilityScript>> {\n    if (!this._utilityScriptPromise) {\n      const source = `\n      (() => {\n        const module = {};\n        ${utilityScriptSource.source}\n        return new (module.exports.UtilityScript())(${isUnderTest()});\n      })();`;\n      this._utilityScriptPromise = this._raceAgainstContextDestroyed(this._delegate.rawEvaluateHandle(source).then(objectId => new JSHandle(this, 'object', 'UtilityScript', objectId)));\n    }\n    return this._utilityScriptPromise;\n  }\n\n  async objectCount(objectId: ObjectId): Promise<number> {\n    return this._delegate.objectCount(objectId);\n  }\n\n  async doSlowMo() {\n    // overridden in FrameExecutionContext\n  }\n}\n\nexport class JSHandle<T = any> extends SdkObject {\n  __jshandle: T = true as any;\n  readonly _context: ExecutionContext;\n  _disposed = false;\n  readonly _objectId: ObjectId | undefined;\n  readonly _value: any;\n  private _objectType: string;\n  protected _preview: string;\n  private _previewCallback: ((preview: string) => void) | undefined;\n\n  constructor(context: ExecutionContext, type: string, preview: string | undefined, objectId?: ObjectId, value?: any) {\n    super(context, 'handle');\n    this._context = context;\n    this._objectId = objectId;\n    this._value = value;\n    this._objectType = type;\n    this._preview = this._objectId ? preview || `JSHandle@${this._objectType}` : String(value);\n    if (this._objectId && (globalThis as any).leakedJSHandles)\n      (globalThis as any).leakedJSHandles.set(this, new Error('Leaked JSHandle'));\n  }\n\n  callFunctionNoReply(func: Function, arg: any) {\n    this._context.rawCallFunctionNoReply(func, this, arg);\n  }\n\n  async evaluate<R, Arg>(pageFunction: FuncOn<T, Arg, R>, arg?: Arg): Promise<R> {\n    return evaluate(this._context, true /* returnByValue */, pageFunction, this, arg);\n  }\n\n  async evaluateHandle<R, Arg>(pageFunction: FuncOn<T, Arg, R>, arg?: Arg): Promise<SmartHandle<R>> {\n    return evaluate(this._context, false /* returnByValue */, pageFunction, this, arg);\n  }\n\n  async evaluateExpression(expression: string, options: { isFunction?: boolean }, arg: any) {\n    const value = await evaluateExpression(this._context, expression, { ...options, returnByValue: true }, this, arg);\n    await this._context.doSlowMo();\n    return value;\n  }\n\n  async evaluateExpressionHandle(expression: string, options: { isFunction?: boolean }, arg: any): Promise<JSHandle<any>> {\n    const value = await evaluateExpression(this._context, expression, { ...options, returnByValue: false }, this, arg);\n    await this._context.doSlowMo();\n    return value;\n  }\n\n  async getProperty(propertyName: string): Promise<JSHandle> {\n    const objectHandle = await this.evaluateHandle((object: any, propertyName) => {\n      const result: any = { __proto__: null };\n      result[propertyName] = object[propertyName];\n      return result;\n    }, propertyName);\n    const properties = await objectHandle.getProperties();\n    const result = properties.get(propertyName)!;\n    objectHandle.dispose();\n    return result;\n  }\n\n  async getProperties(): Promise<Map<string, JSHandle>> {\n    if (!this._objectId)\n      return new Map();\n    return this._context.getProperties(this._context, this._objectId);\n  }\n\n  rawValue() {\n    return this._value;\n  }\n\n  async jsonValue(): Promise<T> {\n    if (!this._objectId)\n      return this._value;\n    const utilityScript = await this._context.utilityScript();\n    const script = `(utilityScript, ...args) => utilityScript.jsonValue(...args)`;\n    return this._context.evaluateWithArguments(script, true, utilityScript, [true], [this._objectId]);\n  }\n\n  asElement(): dom.ElementHandle | null {\n    return null;\n  }\n\n  dispose() {\n    if (this._disposed)\n      return;\n    this._disposed = true;\n    if (this._objectId) {\n      this._context.releaseHandle(this._objectId).catch(e => {});\n      if ((globalThis as any).leakedJSHandles)\n        (globalThis as any).leakedJSHandles.delete(this);\n    }\n  }\n\n  override toString(): string {\n    return this._preview;\n  }\n\n  _setPreviewCallback(callback: (preview: string) => void) {\n    this._previewCallback = callback;\n  }\n\n  preview(): string {\n    return this._preview;\n  }\n\n  worldNameForTest(): string {\n    return this._context.worldNameForTest;\n  }\n\n  _setPreview(preview: string) {\n    this._preview = preview;\n    if (this._previewCallback)\n      this._previewCallback(preview);\n  }\n\n  async objectCount(): Promise<number> {\n    if (!this._objectId)\n      throw new Error('Can only count objects for a handle that points to the constructor prototype');\n    return this._context.objectCount(this._objectId);\n  }\n}\n\nexport async function evaluate(context: ExecutionContext, returnByValue: boolean, pageFunction: Function | string, ...args: any[]): Promise<any> {\n  return evaluateExpression(context, String(pageFunction), { returnByValue, isFunction: typeof pageFunction === 'function' }, ...args);\n}\n\nexport async function evaluateExpression(context: ExecutionContext, expression: string, options: { returnByValue?: boolean, isFunction?: boolean }, ...args: any[]): Promise<any> {\n  const utilityScript = await context.utilityScript();\n  expression = normalizeEvaluationExpression(expression, options.isFunction);\n  const handles: (Promise<JSHandle>)[] = [];\n  const toDispose: Promise<JSHandle>[] = [];\n  const pushHandle = (handle: Promise<JSHandle>): number => {\n    handles.push(handle);\n    return handles.length - 1;\n  };\n\n  args = args.map(arg => serializeAsCallArgument(arg, handle => {\n    if (handle instanceof JSHandle) {\n      if (!handle._objectId)\n        return { fallThrough: handle._value };\n      if (handle._disposed)\n        throw new JavaScriptErrorInEvaluate('JSHandle is disposed!');\n      const adopted = context.adoptIfNeeded(handle);\n      if (adopted === null)\n        return { h: pushHandle(Promise.resolve(handle)) };\n      toDispose.push(adopted);\n      return { h: pushHandle(adopted) };\n    }\n    return { fallThrough: handle };\n  }));\n\n  const utilityScriptObjectIds: ObjectId[] = [];\n  for (const handle of await Promise.all(handles)) {\n    if (handle._context !== context)\n      throw new JavaScriptErrorInEvaluate('JSHandles can be evaluated only in the context they were created!');\n    utilityScriptObjectIds.push(handle._objectId!);\n  }\n\n  // See UtilityScript for arguments.\n  const utilityScriptValues = [options.isFunction, options.returnByValue, expression, args.length, ...args];\n\n  const script = `(utilityScript, ...args) => utilityScript.evaluate(...args)`;\n  try {\n    return await context.evaluateWithArguments(script, options.returnByValue || false, utilityScript, utilityScriptValues, utilityScriptObjectIds);\n  } finally {\n    toDispose.map(handlePromise => handlePromise.then(handle => handle.dispose()));\n  }\n}\n\nexport function parseUnserializableValue(unserializableValue: string): any {\n  if (unserializableValue === 'NaN')\n    return NaN;\n  if (unserializableValue === 'Infinity')\n    return Infinity;\n  if (unserializableValue === '-Infinity')\n    return -Infinity;\n  if (unserializableValue === '-0')\n    return -0;\n}\n\nexport function normalizeEvaluationExpression(expression: string, isFunction: boolean | undefined): string {\n  expression = expression.trim();\n\n  if (isFunction) {\n    try {\n      new Function('(' + expression + ')');\n    } catch (e1) {\n      // This means we might have a function shorthand. Try another\n      // time prefixing 'function '.\n      if (expression.startsWith('async '))\n        expression = 'async function ' + expression.substring('async '.length);\n      else\n        expression = 'function ' + expression;\n      try {\n        new Function('(' + expression  + ')');\n      } catch (e2) {\n        // We tried hard to serialize, but there's a weird beast here.\n        throw new Error('Passed function is not well-serializable!');\n      }\n    }\n  }\n\n  if (/^(async)?\\s*function(\\s|\\()/.test(expression))\n    expression = '(' + expression + ')';\n  return expression;\n}\n\n// Error inside the expression evaluation as opposed to a protocol error.\nexport class JavaScriptErrorInEvaluate extends Error {\n}\n\nexport function isJavaScriptErrorInEvaluate(error: Error) {\n  return error instanceof JavaScriptErrorInEvaluate;\n}\n\nexport function sparseArrayToString(entries: { name: string, value?: any }[]): string {\n  const arrayEntries = [];\n  for (const { name, value } of entries) {\n    const index = +name;\n    if (isNaN(index) || index < 0)\n      continue;\n    arrayEntries.push({ index, value });\n  }\n  arrayEntries.sort((a, b) => a.index - b.index);\n  let lastIndex = -1;\n  const tokens = [];\n  for (const { index, value } of arrayEntries) {\n    const emptyItems = index - lastIndex - 1;\n    if (emptyItems === 1)\n      tokens.push(`empty`);\n    else if (emptyItems > 1)\n      tokens.push(`empty x ${emptyItems}`);\n    tokens.push(String(value));\n    lastIndex = index;\n  }\n\n  return '[' + tokens.join(', ') + ']';\n}\n"],"mappings":"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"}