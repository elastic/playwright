{"version":3,"file":"ffInput.js","names":["toModifiersMask","modifiers","mask","has","toButtonNumber","button","toButtonsMask","buttons","RawKeyboardImpl","constructor","client","_client","keydown","code","keyCode","keyCodeWithoutLocation","key","location","autoRepeat","text","send","type","repeat","keyup","sendText","exports","RawMouseImpl","_page","move","x","y","forClick","Math","floor","down","clickCount","up","wheel","deltaX","deltaY","mainFrame","evaluateExpression","world","deltaZ","setPage","page","RawTouchscreenImpl","tap"],"sources":["../../../src/server/firefox/ffInput.ts"],"sourcesContent":["/**\n * Copyright 2017 Google Inc. All rights reserved.\n * Modifications copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type * as input from '../input';\nimport type { Page } from '../page';\nimport type * as types from '../types';\nimport type { FFSession } from './ffConnection';\n\nfunction toModifiersMask(modifiers: Set<types.KeyboardModifier>): number {\n  let mask = 0;\n  if (modifiers.has('Alt'))\n    mask |= 1;\n  if (modifiers.has('Control'))\n    mask |= 2;\n  if (modifiers.has('Shift'))\n    mask |= 4;\n  if (modifiers.has('Meta'))\n    mask |= 8;\n  return mask;\n}\n\nfunction toButtonNumber(button: types.MouseButton): number {\n  if (button === 'left')\n    return 0;\n  if (button === 'middle')\n    return 1;\n  if (button === 'right')\n    return 2;\n  return 0;\n}\n\nfunction toButtonsMask(buttons: Set<types.MouseButton>): number {\n  let mask = 0;\n  if (buttons.has('left'))\n    mask |= 1;\n  if (buttons.has('right'))\n    mask |= 2;\n  if (buttons.has('middle'))\n    mask |= 4;\n  return mask;\n}\n\nexport class RawKeyboardImpl implements input.RawKeyboard {\n  private _client: FFSession;\n\n  constructor(client: FFSession) {\n    this._client = client;\n  }\n\n  async keydown(modifiers: Set<types.KeyboardModifier>, code: string, keyCode: number, keyCodeWithoutLocation: number, key: string, location: number, autoRepeat: boolean, text: string | undefined): Promise<void> {\n    // Firefox will figure out Enter by itself\n    if (text === '\\r')\n      text = '';\n    await this._client.send('Page.dispatchKeyEvent', {\n      type: 'keydown',\n      keyCode: keyCodeWithoutLocation,\n      code,\n      key,\n      repeat: autoRepeat,\n      location,\n      text,\n    });\n  }\n\n  async keyup(modifiers: Set<types.KeyboardModifier>, code: string, keyCode: number, keyCodeWithoutLocation: number, key: string, location: number): Promise<void> {\n    await this._client.send('Page.dispatchKeyEvent', {\n      type: 'keyup',\n      key,\n      keyCode: keyCodeWithoutLocation,\n      code,\n      location,\n      repeat: false\n    });\n  }\n\n  async sendText(text: string): Promise<void> {\n    await this._client.send('Page.insertText', { text });\n  }\n}\n\nexport class RawMouseImpl implements input.RawMouse {\n  private _client: FFSession;\n  private _page?: Page;\n\n  constructor(client: FFSession) {\n    this._client = client;\n  }\n\n  async move(x: number, y: number, button: types.MouseButton | 'none', buttons: Set<types.MouseButton>, modifiers: Set<types.KeyboardModifier>, forClick: boolean): Promise<void> {\n    await this._client.send('Page.dispatchMouseEvent', {\n      type: 'mousemove',\n      button: 0,\n      buttons: toButtonsMask(buttons),\n      x: Math.floor(x),\n      y: Math.floor(y),\n      modifiers: toModifiersMask(modifiers)\n    });\n  }\n\n  async down(x: number, y: number, button: types.MouseButton, buttons: Set<types.MouseButton>, modifiers: Set<types.KeyboardModifier>, clickCount: number): Promise<void> {\n    await this._client.send('Page.dispatchMouseEvent', {\n      type: 'mousedown',\n      button: toButtonNumber(button),\n      buttons: toButtonsMask(buttons),\n      x: Math.floor(x),\n      y: Math.floor(y),\n      modifiers: toModifiersMask(modifiers),\n      clickCount\n    });\n  }\n\n  async up(x: number, y: number, button: types.MouseButton, buttons: Set<types.MouseButton>, modifiers: Set<types.KeyboardModifier>, clickCount: number): Promise<void> {\n    await this._client.send('Page.dispatchMouseEvent', {\n      type: 'mouseup',\n      button: toButtonNumber(button),\n      buttons: toButtonsMask(buttons),\n      x: Math.floor(x),\n      y: Math.floor(y),\n      modifiers: toModifiersMask(modifiers),\n      clickCount\n    });\n  }\n\n  async wheel(x: number, y: number, buttons: Set<types.MouseButton>, modifiers: Set<types.KeyboardModifier>, deltaX: number, deltaY: number): Promise<void> {\n    // Wheel events hit the compositor first, so wait one frame for it to be synced.\n    await this._page!.mainFrame().evaluateExpression(`new Promise(requestAnimationFrame)`, { world: 'utility' });\n    await this._client.send('Page.dispatchWheelEvent', {\n      deltaX,\n      deltaY,\n      x: Math.floor(x),\n      y: Math.floor(y),\n      deltaZ: 0,\n      modifiers: toModifiersMask(modifiers)\n    });\n  }\n\n  setPage(page: Page) {\n    this._page = page;\n  }\n}\n\nexport class RawTouchscreenImpl implements input.RawTouchscreen {\n  private _client: FFSession;\n\n  constructor(client: FFSession) {\n    this._client = client;\n  }\n  async tap(x: number, y: number, modifiers: Set<types.KeyboardModifier>) {\n    await this._client.send('Page.dispatchTapEvent', {\n      x,\n      y,\n      modifiers: toModifiersMask(modifiers),\n    });\n  }\n}\n"],"mappings":"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"}