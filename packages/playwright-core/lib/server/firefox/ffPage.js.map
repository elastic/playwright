{"version":3,"file":"ffPage.js","names":["dialog","_interopRequireWildcard","require","dom","_eventsHelper","_page","_ffAccessibility","_ffConnection","_ffExecutionContext","_ffInput","_ffNetworkManager","_stackTrace","_debugLogger","_manualPromise","_browserContext","_errors","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","UTILITY_WORLD_NAME","exports","FFPage","constructor","session","browserContext","opener","cspErrorsAsynchronousForInlineScripts","rawMouse","rawKeyboard","rawTouchscreen","_session","_networkManager","_pagePromise","ManualPromise","_initializedPage","_initializationFailed","_opener","_contextIdToContext","_eventListeners","_workers","Map","_screencastId","_initScripts","RawKeyboardImpl","RawMouseImpl","RawTouchscreenImpl","Page","setPage","FFNetworkManager","on","Events","FrameDetached","frame","_removeContextsForFrame","eventsHelper","addEventListener","_onEventFired","bind","_onFrameAttached","_onFrameDetached","_onNavigationAborted","_onNavigationCommitted","_onNavigationStarted","_onSameDocumentNavigation","_onExecutionContextCreated","_onExecutionContextDestroyed","_onExecutionContextsCleared","event","_onLinkClicked","phase","_onUncaughtError","_onConsole","_onDialogOpened","_onBindingCalled","_onFileChooserOpened","_onWorkerCreated","_onWorkerDestroyed","_onDispatchMessageFromWorker","_onCrashed","_onVideoRecordingStarted","_onWebSocketCreated","_onWebSocketClosed","_onWebSocketFrameReceived","_onWebSocketFrameSent","_onScreencastFrame","once","initOpener","reportAsNew","resolve","addInitScript","InitScript","catch","_markAsError","potentiallyUninitializedPage","error","pageOrError","_frameManager","onWebSocketCreated","webSocketId","frameId","wsid","requestURL","onWebSocketRequest","webSocketError","webSocketClosed","webSocketFrameReceived","opcode","data","onWebSocketFrameSent","payload","executionContextId","auxData","delegate","FFExecutionContext","worldName","name","context","FrameExecutionContext","contextDelegateSymbol","_contextCreated","delete","_contextDestroyed","Array","from","keys","contextId","frameWillPotentiallyRequestNavigation","frameDidPotentiallyRequestNavigation","params","frameRequestedNavigation","navigationId","frameAbortedNavigation","errorText","workerId","worker","frameCommittedNewDocumentNavigation","url","frameCommittedSameDocumentNavigation","frameAttached","parentFrameId","frameDetached","frameLifecycleEvent","message","splitErrorMessage","Error","stack","split","filter","Boolean","map","replace","join","emitOnContextOnceInitialized","BrowserContext","PageError","type","args","location","_addConsoleMessage","arg","createHandle","emitOnContext","Dialog","accept","promptText","sendMayFail","dialogId","defaultValue","element","handle","asElement","Worker","workerSession","FFSession","_connection","send","JSON","stringify","dispatchMessage","id","method","undefined","_addWorker","_createExecutionContext","_existingExecutionContext","dispose","_removeWorker","parse","markAsCrashed","_didCrash","_browser","_videoStarted","screencastId","file","didClose","TargetClosedError","removeEventListeners","_didClose","navigateFrame","referer","response","_id","newDocumentId","updateExtraHTTPHeaders","headers","extraHTTPHeaders","updateEmulatedViewportSize","viewportSize","bringToFront","updateEmulateMedia","emulatedMedia","colorScheme","reducedMotion","forcedColors","media","updateRequestInterception","setRequestInterception","needsRequestInterception","updateFileChooserInterception","enabled","fileChooserIntercepted","reload","goBack","success","mainFrame","goForward","initScript","push","scripts","s","script","source","removeNonInternalInitScripts","internal","closePage","runBeforeUnload","setBackgroundColor","color","takeScreenshot","progress","format","documentRect","viewportRect","quality","fitsViewport","scale","scrollOffset","waitForFunctionValueInUtility","x","window","scrollX","y","scrollY","width","height","throwIfAborted","mimeType","clip","omitDeviceScaleFactor","Buffer","getContentFrame","contentFrameId","_context","objectId","_objectId","getOwnerFrame","ownerFrameId","isElementHandle","remoteObject","subtype","getBoundingBox","quads","getContentQuads","length","minX","Infinity","maxX","minY","maxY","quad","point","Math","min","max","scrollRectIntoViewIfNeeded","rect","then","includes","setScreencastOptions","options","throttleScreencastFrameAck","debugLogger","log","buffer","emit","ScreencastFrame","deviceWidth","deviceHeight","rafCountForStablePosition","result","p1","p2","p3","p4","setInputFiles","files","evaluateInUtility","injected","node","setInputFilePaths","adoptElementHandle","to","_executionContextId","kUnableToAdoptErrorMessage","getAccessibilityTree","needle","inputActionEpilogue","resetForReuse","move","Set","getFrameElement","parent","parentFrame","_mainContext","shouldToggleStyleSheetToSyncAnimations","Symbol"],"sources":["../../../src/server/firefox/ffPage.ts"],"sourcesContent":["/**\n * Copyright 2019 Google Inc. All rights reserved.\n * Modifications copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as dialog from '../dialog';\nimport * as dom from '../dom';\nimport type * as frames from '../frames';\nimport type { RegisteredListener } from '../../utils/eventsHelper';\nimport { eventsHelper } from '../../utils/eventsHelper';\nimport type { PageDelegate } from '../page';\nimport { InitScript } from '../page';\nimport { Page, Worker } from '../page';\nimport type * as types from '../types';\nimport { getAccessibilityTree } from './ffAccessibility';\nimport type { FFBrowserContext } from './ffBrowser';\nimport { FFSession } from './ffConnection';\nimport { FFExecutionContext } from './ffExecutionContext';\nimport { RawKeyboardImpl, RawMouseImpl, RawTouchscreenImpl } from './ffInput';\nimport { FFNetworkManager } from './ffNetworkManager';\nimport type { Protocol } from './protocol';\nimport type { Progress } from '../progress';\nimport { splitErrorMessage } from '../../utils/stackTrace';\nimport { debugLogger } from '../../utils/debugLogger';\nimport { ManualPromise } from '../../utils/manualPromise';\nimport { BrowserContext } from '../browserContext';\nimport { TargetClosedError } from '../errors';\n\nexport const UTILITY_WORLD_NAME = '__playwright_utility_world__';\n\nexport class FFPage implements PageDelegate {\n  readonly cspErrorsAsynchronousForInlineScripts = true;\n  readonly rawMouse: RawMouseImpl;\n  readonly rawKeyboard: RawKeyboardImpl;\n  readonly rawTouchscreen: RawTouchscreenImpl;\n  readonly _session: FFSession;\n  readonly _page: Page;\n  readonly _networkManager: FFNetworkManager;\n  readonly _browserContext: FFBrowserContext;\n  private _pagePromise = new ManualPromise<Page | Error>();\n  _initializedPage: Page | null = null;\n  private _initializationFailed = false;\n  readonly _opener: FFPage | null;\n  private readonly _contextIdToContext: Map<string, dom.FrameExecutionContext>;\n  private _eventListeners: RegisteredListener[];\n  private _workers = new Map<string, { frameId: string, session: FFSession }>();\n  private _screencastId: string | undefined;\n  private _initScripts: { initScript: InitScript, worldName?: string }[] = [];\n\n  constructor(session: FFSession, browserContext: FFBrowserContext, opener: FFPage | null) {\n    this._session = session;\n    this._opener = opener;\n    this.rawKeyboard = new RawKeyboardImpl(session);\n    this.rawMouse = new RawMouseImpl(session);\n    this.rawTouchscreen = new RawTouchscreenImpl(session);\n    this._contextIdToContext = new Map();\n    this._browserContext = browserContext;\n    this._page = new Page(this, browserContext);\n    this.rawMouse.setPage(this._page);\n    this._networkManager = new FFNetworkManager(session, this._page);\n    this._page.on(Page.Events.FrameDetached, frame => this._removeContextsForFrame(frame));\n    // TODO: remove Page.willOpenNewWindowAsynchronously from the protocol.\n    this._eventListeners = [\n      eventsHelper.addEventListener(this._session, 'Page.eventFired', this._onEventFired.bind(this)),\n      eventsHelper.addEventListener(this._session, 'Page.frameAttached', this._onFrameAttached.bind(this)),\n      eventsHelper.addEventListener(this._session, 'Page.frameDetached', this._onFrameDetached.bind(this)),\n      eventsHelper.addEventListener(this._session, 'Page.navigationAborted', this._onNavigationAborted.bind(this)),\n      eventsHelper.addEventListener(this._session, 'Page.navigationCommitted', this._onNavigationCommitted.bind(this)),\n      eventsHelper.addEventListener(this._session, 'Page.navigationStarted', this._onNavigationStarted.bind(this)),\n      eventsHelper.addEventListener(this._session, 'Page.sameDocumentNavigation', this._onSameDocumentNavigation.bind(this)),\n      eventsHelper.addEventListener(this._session, 'Runtime.executionContextCreated', this._onExecutionContextCreated.bind(this)),\n      eventsHelper.addEventListener(this._session, 'Runtime.executionContextDestroyed', this._onExecutionContextDestroyed.bind(this)),\n      eventsHelper.addEventListener(this._session, 'Runtime.executionContextsCleared', this._onExecutionContextsCleared.bind(this)),\n      eventsHelper.addEventListener(this._session, 'Page.linkClicked', event => this._onLinkClicked(event.phase)),\n      eventsHelper.addEventListener(this._session, 'Page.uncaughtError', this._onUncaughtError.bind(this)),\n      eventsHelper.addEventListener(this._session, 'Runtime.console', this._onConsole.bind(this)),\n      eventsHelper.addEventListener(this._session, 'Page.dialogOpened', this._onDialogOpened.bind(this)),\n      eventsHelper.addEventListener(this._session, 'Page.bindingCalled', this._onBindingCalled.bind(this)),\n      eventsHelper.addEventListener(this._session, 'Page.fileChooserOpened', this._onFileChooserOpened.bind(this)),\n      eventsHelper.addEventListener(this._session, 'Page.workerCreated', this._onWorkerCreated.bind(this)),\n      eventsHelper.addEventListener(this._session, 'Page.workerDestroyed', this._onWorkerDestroyed.bind(this)),\n      eventsHelper.addEventListener(this._session, 'Page.dispatchMessageFromWorker', this._onDispatchMessageFromWorker.bind(this)),\n      eventsHelper.addEventListener(this._session, 'Page.crashed', this._onCrashed.bind(this)),\n      eventsHelper.addEventListener(this._session, 'Page.videoRecordingStarted', this._onVideoRecordingStarted.bind(this)),\n\n      eventsHelper.addEventListener(this._session, 'Page.webSocketCreated', this._onWebSocketCreated.bind(this)),\n      eventsHelper.addEventListener(this._session, 'Page.webSocketClosed', this._onWebSocketClosed.bind(this)),\n      eventsHelper.addEventListener(this._session, 'Page.webSocketFrameReceived', this._onWebSocketFrameReceived.bind(this)),\n      eventsHelper.addEventListener(this._session, 'Page.webSocketFrameSent', this._onWebSocketFrameSent.bind(this)),\n      eventsHelper.addEventListener(this._session, 'Page.screencastFrame', this._onScreencastFrame.bind(this)),\n\n    ];\n    this._session.once('Page.ready', async () => {\n      await this._page.initOpener(this._opener);\n      if (this._initializationFailed)\n        return;\n      // Note: it is important to call |reportAsNew| before resolving pageOrError promise,\n      // so that anyone who awaits pageOrError got a ready and reported page.\n      this._initializedPage = this._page;\n      this._page.reportAsNew();\n      this._pagePromise.resolve(this._page);\n    });\n    // Ideally, we somehow ensure that utility world is created before Page.ready arrives, but currently it is racy.\n    // Therefore, we can end up with an initialized page without utility world, although very unlikely.\n    this.addInitScript(new InitScript('', true), UTILITY_WORLD_NAME).catch(e => this._markAsError(e));\n  }\n\n  potentiallyUninitializedPage(): Page {\n    return this._page;\n  }\n\n  async _markAsError(error: Error) {\n    // Same error may be report twice: channer disconnected and session.send fails.\n    if (this._initializationFailed)\n      return;\n    this._initializationFailed = true;\n\n    if (!this._initializedPage) {\n      await this._page.initOpener(this._opener);\n      this._page.reportAsNew(error);\n      this._pagePromise.resolve(error);\n    }\n  }\n\n  async pageOrError(): Promise<Page | Error> {\n    return this._pagePromise;\n  }\n\n  _onWebSocketCreated(event: Protocol.Page.webSocketCreatedPayload) {\n    this._page._frameManager.onWebSocketCreated(webSocketId(event.frameId, event.wsid), event.requestURL);\n    this._page._frameManager.onWebSocketRequest(webSocketId(event.frameId, event.wsid));\n  }\n\n  _onWebSocketClosed(event: Protocol.Page.webSocketClosedPayload) {\n    if (event.error)\n      this._page._frameManager.webSocketError(webSocketId(event.frameId, event.wsid), event.error);\n    this._page._frameManager.webSocketClosed(webSocketId(event.frameId, event.wsid));\n  }\n\n  _onWebSocketFrameReceived(event: Protocol.Page.webSocketFrameReceivedPayload) {\n    this._page._frameManager.webSocketFrameReceived(webSocketId(event.frameId, event.wsid), event.opcode, event.data);\n  }\n\n  _onWebSocketFrameSent(event: Protocol.Page.webSocketFrameSentPayload) {\n    this._page._frameManager.onWebSocketFrameSent(webSocketId(event.frameId, event.wsid), event.opcode, event.data);\n  }\n\n  _onExecutionContextCreated(payload: Protocol.Runtime.executionContextCreatedPayload) {\n    const { executionContextId, auxData } = payload;\n    const frame = this._page._frameManager.frame(auxData.frameId!);\n    if (!frame)\n      return;\n    const delegate = new FFExecutionContext(this._session, executionContextId);\n    let worldName: types.World;\n    if (auxData.name === UTILITY_WORLD_NAME)\n      worldName = 'utility';\n    else if (!auxData.name)\n      worldName = 'main';\n    else\n      return;\n    const context = new dom.FrameExecutionContext(delegate, frame, worldName);\n    (context as any)[contextDelegateSymbol] = delegate;\n    frame._contextCreated(worldName, context);\n    this._contextIdToContext.set(executionContextId, context);\n  }\n\n  _onExecutionContextDestroyed(payload: Protocol.Runtime.executionContextDestroyedPayload) {\n    const { executionContextId } = payload;\n    const context = this._contextIdToContext.get(executionContextId);\n    if (!context)\n      return;\n    this._contextIdToContext.delete(executionContextId);\n    context.frame._contextDestroyed(context);\n  }\n\n  _onExecutionContextsCleared() {\n    for (const executionContextId of Array.from(this._contextIdToContext.keys()))\n      this._onExecutionContextDestroyed({ executionContextId });\n  }\n\n  private _removeContextsForFrame(frame: frames.Frame) {\n    for (const [contextId, context] of this._contextIdToContext) {\n      if (context.frame === frame)\n        this._contextIdToContext.delete(contextId);\n    }\n  }\n\n  _onLinkClicked(phase: 'before' | 'after') {\n    if (phase === 'before')\n      this._page._frameManager.frameWillPotentiallyRequestNavigation();\n    else\n      this._page._frameManager.frameDidPotentiallyRequestNavigation();\n  }\n\n  _onNavigationStarted(params: Protocol.Page.navigationStartedPayload) {\n    this._page._frameManager.frameRequestedNavigation(params.frameId, params.navigationId);\n  }\n\n  _onNavigationAborted(params: Protocol.Page.navigationAbortedPayload) {\n    this._page._frameManager.frameAbortedNavigation(params.frameId, params.errorText, params.navigationId);\n  }\n\n  _onNavigationCommitted(params: Protocol.Page.navigationCommittedPayload) {\n    for (const [workerId, worker] of this._workers) {\n      if (worker.frameId === params.frameId)\n        this._onWorkerDestroyed({ workerId });\n    }\n    this._page._frameManager.frameCommittedNewDocumentNavigation(params.frameId, params.url, params.name || '', params.navigationId || '', false);\n  }\n\n  _onSameDocumentNavigation(params: Protocol.Page.sameDocumentNavigationPayload) {\n    this._page._frameManager.frameCommittedSameDocumentNavigation(params.frameId, params.url);\n  }\n\n  _onFrameAttached(params: Protocol.Page.frameAttachedPayload) {\n    this._page._frameManager.frameAttached(params.frameId, params.parentFrameId);\n  }\n\n  _onFrameDetached(params: Protocol.Page.frameDetachedPayload) {\n    this._page._frameManager.frameDetached(params.frameId);\n  }\n\n  _onEventFired(payload: Protocol.Page.eventFiredPayload) {\n    const { frameId, name } = payload;\n    if (name === 'load')\n      this._page._frameManager.frameLifecycleEvent(frameId, 'load');\n    if (name === 'DOMContentLoaded')\n      this._page._frameManager.frameLifecycleEvent(frameId, 'domcontentloaded');\n  }\n\n  _onUncaughtError(params: Protocol.Page.uncaughtErrorPayload) {\n    const { name, message } = splitErrorMessage(params.message);\n    const error = new Error(message);\n    error.stack = params.message + '\\n' + params.stack.split('\\n').filter(Boolean).map(a => a.replace(/([^@]*)@(.*)/, '    at $1 ($2)')).join('\\n');\n    error.name = name;\n    this._page.emitOnContextOnceInitialized(BrowserContext.Events.PageError, error, this._page);\n  }\n\n  _onConsole(payload: Protocol.Runtime.consolePayload) {\n    const { type, args, executionContextId, location } = payload;\n    const context = this._contextIdToContext.get(executionContextId);\n    if (!context)\n      return;\n    // Juggler reports 'warn' for some internal messages generated by the browser.\n    this._page._addConsoleMessage(type === 'warn' ? 'warning' : type, args.map(arg => context.createHandle(arg)), location);\n  }\n\n  _onDialogOpened(params: Protocol.Page.dialogOpenedPayload) {\n    this._page.emitOnContext(BrowserContext.Events.Dialog, new dialog.Dialog(\n        this._page,\n        params.type,\n        params.message,\n        async (accept: boolean, promptText?: string) => {\n          await this._session.sendMayFail('Page.handleDialog', { dialogId: params.dialogId, accept, promptText });\n        },\n        params.defaultValue));\n  }\n\n  async _onBindingCalled(event: Protocol.Page.bindingCalledPayload) {\n    const pageOrError = await this.pageOrError();\n    if (!(pageOrError instanceof Error)) {\n      const context = this._contextIdToContext.get(event.executionContextId);\n      if (context)\n        await this._page._onBindingCalled(event.payload, context);\n    }\n  }\n\n  async _onFileChooserOpened(payload: Protocol.Page.fileChooserOpenedPayload) {\n    const { executionContextId, element } = payload;\n    const context = this._contextIdToContext.get(executionContextId);\n    if (!context)\n      return;\n    const handle = context.createHandle(element).asElement()!;\n    await this._page._onFileChooserOpened(handle);\n  }\n\n  async _onWorkerCreated(event: Protocol.Page.workerCreatedPayload) {\n    const workerId = event.workerId;\n    const worker = new Worker(this._page, event.url);\n    const workerSession = new FFSession(this._session._connection, workerId, (message: any) => {\n      this._session.send('Page.sendMessageToWorker', {\n        frameId: event.frameId,\n        workerId: workerId,\n        message: JSON.stringify(message)\n      }).catch(e => {\n        workerSession.dispatchMessage({ id: message.id, method: '', params: {}, error: { message: e.message, data: undefined } });\n      });\n    });\n    this._workers.set(workerId, { session: workerSession, frameId: event.frameId });\n    this._page._addWorker(workerId, worker);\n    workerSession.once('Runtime.executionContextCreated', event => {\n      worker._createExecutionContext(new FFExecutionContext(workerSession, event.executionContextId));\n    });\n    workerSession.on('Runtime.console', event => {\n      const { type, args, location } = event;\n      const context = worker._existingExecutionContext!;\n      this._page._addConsoleMessage(type, args.map(arg => context.createHandle(arg)), location);\n    });\n    // Note: we receive worker exceptions directly from the page.\n  }\n\n  _onWorkerDestroyed(event: Protocol.Page.workerDestroyedPayload) {\n    const workerId = event.workerId;\n    const worker = this._workers.get(workerId);\n    if (!worker)\n      return;\n    worker.session.dispose();\n    this._workers.delete(workerId);\n    this._page._removeWorker(workerId);\n  }\n\n  async _onDispatchMessageFromWorker(event: Protocol.Page.dispatchMessageFromWorkerPayload) {\n    const worker = this._workers.get(event.workerId);\n    if (!worker)\n      return;\n    worker.session.dispatchMessage(JSON.parse(event.message));\n  }\n\n  async _onCrashed(event: Protocol.Page.crashedPayload) {\n    this._session.markAsCrashed();\n    this._page._didCrash();\n  }\n\n  _onVideoRecordingStarted(event: Protocol.Page.videoRecordingStartedPayload) {\n    this._browserContext._browser._videoStarted(this._browserContext, event.screencastId, event.file, this.pageOrError());\n  }\n\n  didClose() {\n    this._markAsError(new TargetClosedError());\n    this._session.dispose();\n    eventsHelper.removeEventListeners(this._eventListeners);\n    this._networkManager.dispose();\n    this._page._didClose();\n  }\n\n  async navigateFrame(frame: frames.Frame, url: string, referer: string | undefined): Promise<frames.GotoResult> {\n    const response = await this._session.send('Page.navigate', { url, referer, frameId: frame._id });\n    return { newDocumentId: response.navigationId || undefined };\n  }\n\n  async updateExtraHTTPHeaders(): Promise<void> {\n    await this._session.send('Network.setExtraHTTPHeaders', { headers: this._page.extraHTTPHeaders() || [] });\n  }\n\n  async updateEmulatedViewportSize(): Promise<void> {\n    const viewportSize = this._page.viewportSize();\n    await this._session.send('Page.setViewportSize', { viewportSize });\n  }\n\n  async bringToFront(): Promise<void> {\n    await this._session.send('Page.bringToFront', {});\n  }\n\n  async updateEmulateMedia(): Promise<void> {\n    const emulatedMedia = this._page.emulatedMedia();\n    const colorScheme = emulatedMedia.colorScheme === 'no-override' ? undefined : emulatedMedia.colorScheme;\n    const reducedMotion = emulatedMedia.reducedMotion === 'no-override' ? undefined : emulatedMedia.reducedMotion;\n    const forcedColors = emulatedMedia.forcedColors === 'no-override' ? undefined : emulatedMedia.forcedColors;\n    await this._session.send('Page.setEmulatedMedia', {\n      // Empty string means reset.\n      type: emulatedMedia.media === 'no-override' ? '' : emulatedMedia.media,\n      colorScheme,\n      reducedMotion,\n      forcedColors,\n    });\n  }\n\n  async updateRequestInterception(): Promise<void> {\n    await this._networkManager.setRequestInterception(this._page.needsRequestInterception());\n  }\n\n  async updateFileChooserInterception() {\n    const enabled = this._page.fileChooserIntercepted();\n    await this._session.send('Page.setInterceptFileChooserDialog', { enabled }).catch(() => {}); // target can be closed.\n  }\n\n  async reload(): Promise<void> {\n    await this._session.send('Page.reload');\n  }\n\n  async goBack(): Promise<boolean> {\n    const { success } = await this._session.send('Page.goBack', { frameId: this._page.mainFrame()._id });\n    return success;\n  }\n\n  async goForward(): Promise<boolean> {\n    const { success } = await this._session.send('Page.goForward', { frameId: this._page.mainFrame()._id });\n    return success;\n  }\n\n  async addInitScript(initScript: InitScript, worldName?: string): Promise<void> {\n    this._initScripts.push({ initScript, worldName });\n    await this._session.send('Page.setInitScripts', { scripts: this._initScripts.map(s => ({ script: s.initScript.source, worldName: s.worldName })) });\n  }\n\n  async removeNonInternalInitScripts() {\n    this._initScripts = this._initScripts.filter(s => s.initScript.internal);\n    await this._session.send('Page.setInitScripts', { scripts: this._initScripts.map(s => ({ script: s.initScript.source, worldName: s.worldName })) });\n  }\n\n  async closePage(runBeforeUnload: boolean): Promise<void> {\n    await this._session.send('Page.close', { runBeforeUnload });\n  }\n\n  async setBackgroundColor(color?: { r: number; g: number; b: number; a: number; }): Promise<void> {\n    if (color)\n      throw new Error('Not implemented');\n  }\n\n  async takeScreenshot(progress: Progress, format: 'png' | 'jpeg', documentRect: types.Rect | undefined, viewportRect: types.Rect | undefined, quality: number | undefined, fitsViewport: boolean, scale: 'css' | 'device'): Promise<Buffer> {\n    if (!documentRect) {\n      const scrollOffset = await this._page.mainFrame().waitForFunctionValueInUtility(progress, () => ({ x: window.scrollX, y: window.scrollY }));\n      documentRect = {\n        x: viewportRect!.x + scrollOffset.x,\n        y: viewportRect!.y + scrollOffset.y,\n        width: viewportRect!.width,\n        height: viewportRect!.height,\n      };\n    }\n    progress.throwIfAborted();\n    const { data } = await this._session.send('Page.screenshot', {\n      mimeType: ('image/' + format) as ('image/png' | 'image/jpeg'),\n      clip: documentRect,\n      quality,\n      omitDeviceScaleFactor: scale === 'css',\n    });\n    return Buffer.from(data, 'base64');\n  }\n\n  async getContentFrame(handle: dom.ElementHandle): Promise<frames.Frame | null> {\n    const { contentFrameId } = await this._session.send('Page.describeNode', {\n      frameId: handle._context.frame._id,\n      objectId: handle._objectId,\n    });\n    if (!contentFrameId)\n      return null;\n    return this._page._frameManager.frame(contentFrameId);\n  }\n\n  async getOwnerFrame(handle: dom.ElementHandle): Promise<string | null> {\n    const { ownerFrameId } = await this._session.send('Page.describeNode', {\n      frameId: handle._context.frame._id,\n      objectId: handle._objectId\n    });\n    return ownerFrameId || null;\n  }\n\n  isElementHandle(remoteObject: any): boolean {\n    return remoteObject.subtype === 'node';\n  }\n\n  async getBoundingBox(handle: dom.ElementHandle): Promise<types.Rect | null> {\n    const quads = await this.getContentQuads(handle);\n    if (!quads || !quads.length)\n      return null;\n    let minX = Infinity;\n    let maxX = -Infinity;\n    let minY = Infinity;\n    let maxY = -Infinity;\n    for (const quad of quads) {\n      for (const point of quad) {\n        minX = Math.min(minX, point.x);\n        maxX = Math.max(maxX, point.x);\n        minY = Math.min(minY, point.y);\n        maxY = Math.max(maxY, point.y);\n      }\n    }\n    return { x: minX, y: minY, width: maxX - minX, height: maxY - minY };\n  }\n\n  async scrollRectIntoViewIfNeeded(handle: dom.ElementHandle, rect?: types.Rect): Promise<'error:notvisible' | 'error:notconnected' | 'done'> {\n    return await this._session.send('Page.scrollIntoViewIfNeeded', {\n      frameId: handle._context.frame._id,\n      objectId: handle._objectId,\n      rect,\n    }).then(() => 'done' as const).catch(e => {\n      if (e instanceof Error && e.message.includes('Node is detached from document'))\n        return 'error:notconnected';\n      if (e instanceof Error && e.message.includes('Node does not have a layout object'))\n        return 'error:notvisible';\n      throw e;\n    });\n  }\n\n  async setScreencastOptions(options: { width: number, height: number, quality: number } | null): Promise<void> {\n    if (options) {\n      const { screencastId } = await this._session.send('Page.startScreencast', options);\n      this._screencastId = screencastId;\n    } else {\n      await this._session.send('Page.stopScreencast');\n    }\n  }\n\n  private _onScreencastFrame(event: Protocol.Page.screencastFramePayload) {\n    if (!this._screencastId)\n      return;\n    const screencastId = this._screencastId;\n    this._page.throttleScreencastFrameAck(() => {\n      this._session.send('Page.screencastFrameAck', { screencastId }).catch(e => debugLogger.log('error', e));\n    });\n\n    const buffer = Buffer.from(event.data, 'base64');\n    this._page.emit(Page.Events.ScreencastFrame, {\n      buffer,\n      width: event.deviceWidth,\n      height: event.deviceHeight,\n    });\n  }\n\n  rafCountForStablePosition(): number {\n    return 1;\n  }\n\n  async getContentQuads(handle: dom.ElementHandle): Promise<types.Quad[] | null> {\n    const result = await this._session.sendMayFail('Page.getContentQuads', {\n      frameId: handle._context.frame._id,\n      objectId: handle._objectId,\n    });\n    if (!result)\n      return null;\n    return result.quads.map(quad => [quad.p1, quad.p2, quad.p3, quad.p4]);\n  }\n\n  async setInputFiles(handle: dom.ElementHandle<HTMLInputElement>, files: types.FilePayload[]): Promise<void> {\n    await handle.evaluateInUtility(([injected, node, files]) =>\n      injected.setInputFiles(node, files), files);\n  }\n\n  async setInputFilePaths(handle: dom.ElementHandle<HTMLInputElement>, files: string[]): Promise<void> {\n    await this._session.send('Page.setFileInputFiles', {\n      frameId: handle._context.frame._id,\n      objectId: handle._objectId,\n      files\n    });\n  }\n\n  async adoptElementHandle<T extends Node>(handle: dom.ElementHandle<T>, to: dom.FrameExecutionContext): Promise<dom.ElementHandle<T>> {\n    const result = await this._session.send('Page.adoptNode', {\n      frameId: handle._context.frame._id,\n      objectId: handle._objectId,\n      executionContextId: ((to as any)[contextDelegateSymbol] as FFExecutionContext)._executionContextId\n    });\n    if (!result.remoteObject)\n      throw new Error(dom.kUnableToAdoptErrorMessage);\n    return to.createHandle(result.remoteObject) as dom.ElementHandle<T>;\n  }\n\n  async getAccessibilityTree(needle?: dom.ElementHandle) {\n    return getAccessibilityTree(this._session, needle);\n  }\n\n  async inputActionEpilogue(): Promise<void> {\n  }\n\n  async resetForReuse(): Promise<void> {\n    // Firefox sometimes keeps the last mouse position in the page,\n    // which affects things like hovered state.\n    // See https://github.com/microsoft/playwright/issues/22432.\n    // Move mouse to (-1, -1) to avoid anything being hovered.\n    await this.rawMouse.move(-1, -1, 'none', new Set(), new Set(), false);\n  }\n\n  async getFrameElement(frame: frames.Frame): Promise<dom.ElementHandle> {\n    const parent = frame.parentFrame();\n    if (!parent)\n      throw new Error('Frame has been detached.');\n    const context = await parent._mainContext();\n    const result = await this._session.send('Page.adoptNode', {\n      frameId: frame._id,\n      executionContextId: ((context as any)[contextDelegateSymbol] as FFExecutionContext)._executionContextId\n    });\n    if (!result.remoteObject)\n      throw new Error('Frame has been detached.');\n    return context.createHandle(result.remoteObject) as dom.ElementHandle;\n  }\n\n  shouldToggleStyleSheetToSyncAnimations(): boolean {\n    return false;\n  }\n}\n\nfunction webSocketId(frameId: string, wsid: string): string {\n  return `${frameId}---${wsid}`;\n}\n\nconst contextDelegateSymbol = Symbol('delegate');\n"],"mappings":"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"}