{"version":3,"file":"ffBrowser.js","names":["_errors","require","_utils","_browser","_browserContext","network","_interopRequireWildcard","_page","_ffConnection","_ffPage","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","FFBrowser","Browser","connect","parent","transport","options","_options$originalLaun","connection","FFConnection","protocolLogger","browserLogsCollector","browser","__testHookOnConnectToBrowser","firefoxUserPrefs","originalLaunchOptions","keys","kBandaidFirefoxUserPrefs","length","promises","session","send","attachToDefaultContext","persistent","userPrefs","entries","map","name","value","_initVersion","_defaultContext","FFBrowserContext","undefined","push","_initialize","proxy","toJugglerProxyOptions","Promise","all","constructor","_connection","_ffPages","_contexts","_version","_userAgent","rootSession","Map","on","ConnectionEvents","Disconnected","_onDisconnect","_onAttachedToTarget","bind","_onDetachedFromTarget","_onDownloadCreated","_onDownloadFinished","_onVideoRecordingFinished","result","version","substring","indexOf","userAgent","isConnected","_closed","doCreateNewContext","isMobile","Error","browserContextId","removeOnDetach","context","contexts","Array","from","values","payload","ffPage","targetId","delete","didClose","openerId","type","targetInfo","assert","createSession","sessionId","opener","FFPage","pageTargetId","_frameManager","frameAbortedNavigation","frameId","originPage","_initializedPage","_markAsError","_opener","_downloadCreated","uuid","url","suggestedFileName","error","canceled","_downloadFinished","_this$_takeVideo","_takeVideo","screencastId","reportFinished","video","_idToVideo","artifact","TargetClosedError","clear","_didClose","exports","BrowserContext","_browserContextId","PageBinding","kPlaywrightBinding","script","_options","acceptDownloads","downloadOptions","behavior","downloadsDir","downloadsPath","viewport","viewportSize","width","height","deviceScaleFactor","hasTouch","bypassCSP","ignoreHTTPSErrors","javaScriptEnabled","javaScriptDisabled","locale","timezoneId","extraHTTPHeaders","setExtraHTTPHeaders","httpCredentials","setHTTPCredentials","geolocation","setGeolocation","offline","setOffline","colorScheme","reducedMotion","forcedColors","recordVideo","_ensureVideosPath","then","size","dir","filter","pages","pageOrNull","newPageDelegate","assertBrowserContextIsNotOwned","catch","message","includes","doGetCookies","urls","cookies","filterCookies","c","copy","addCookies","cc","rewriteCookies","expires","doClearCookies","doGrantPermissions","origin","permissions","webPermissionToProtocol","filtered","permission","protocolPermission","doClearPermissions","verifyGeolocation","headers","allHeaders","mergeHeaders","singleHeader","setUserAgent","override","doSetHTTPCredentials","credentials","username","password","doAddInitScript","initScript","_updateInitScripts","doRemoveNonInternalInitScripts","bindingScripts","_pageBindings","binding","source","initScripts","scripts","doUpdateRequestInterception","enabled","_requestInterceptor","cacheDisabled","onClosePersistent","clearCache","doClose","reason","close","cancelDownload","proxyServer","URL","server","port","parseInt","protocol","bypass","split","domain","trim","host","hostname"],"sources":["../../../src/server/firefox/ffBrowser.ts"],"sourcesContent":["/**\n * Copyright 2018 Google Inc. All rights reserved.\n * Modifications copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { TargetClosedError } from '../errors';\nimport { assert } from '../../utils';\nimport type { BrowserOptions } from '../browser';\nimport { Browser } from '../browser';\nimport { assertBrowserContextIsNotOwned, BrowserContext, verifyGeolocation } from '../browserContext';\nimport * as network from '../network';\nimport type { InitScript, Page, PageDelegate } from '../page';\nimport { PageBinding } from '../page';\nimport type { ConnectionTransport } from '../transport';\nimport type * as types from '../types';\nimport type * as channels from '@protocol/channels';\nimport { ConnectionEvents, FFConnection, type FFSession } from './ffConnection';\nimport { FFPage } from './ffPage';\nimport type { Protocol } from './protocol';\nimport type { SdkObject } from '../instrumentation';\n\nexport class FFBrowser extends Browser {\n  private _connection: FFConnection;\n  readonly session: FFSession;\n  readonly _ffPages: Map<string, FFPage>;\n  readonly _contexts: Map<string, FFBrowserContext>;\n  private _version = '';\n  private _userAgent: string = '';\n\n  static async connect(parent: SdkObject, transport: ConnectionTransport, options: BrowserOptions): Promise<FFBrowser> {\n    const connection = new FFConnection(transport, options.protocolLogger, options.browserLogsCollector);\n    const browser = new FFBrowser(parent, connection, options);\n    if ((options as any).__testHookOnConnectToBrowser)\n      await (options as any).__testHookOnConnectToBrowser();\n    let firefoxUserPrefs = options.originalLaunchOptions.firefoxUserPrefs ?? {};\n    if (Object.keys(kBandaidFirefoxUserPrefs).length)\n      firefoxUserPrefs = { ...kBandaidFirefoxUserPrefs, ...firefoxUserPrefs };\n    const promises: Promise<any>[] = [\n      browser.session.send('Browser.enable', {\n        attachToDefaultContext: !!options.persistent,\n        userPrefs: Object.entries(firefoxUserPrefs).map(([name, value]) => ({ name, value })),\n      }),\n      browser._initVersion(),\n    ];\n    if (options.persistent) {\n      browser._defaultContext = new FFBrowserContext(browser, undefined, options.persistent);\n      promises.push((browser._defaultContext as FFBrowserContext)._initialize());\n    }\n    if (options.proxy)\n      promises.push(browser.session.send('Browser.setBrowserProxy', toJugglerProxyOptions(options.proxy)));\n    await Promise.all(promises);\n    return browser;\n  }\n\n  constructor(parent: SdkObject, connection: FFConnection, options: BrowserOptions) {\n    super(parent, options);\n    this._connection = connection;\n    this.session = connection.rootSession;\n    this._ffPages = new Map();\n    this._contexts = new Map();\n    this._connection.on(ConnectionEvents.Disconnected, () => this._onDisconnect());\n    this.session.on('Browser.attachedToTarget', this._onAttachedToTarget.bind(this));\n    this.session.on('Browser.detachedFromTarget', this._onDetachedFromTarget.bind(this));\n    this.session.on('Browser.downloadCreated', this._onDownloadCreated.bind(this));\n    this.session.on('Browser.downloadFinished', this._onDownloadFinished.bind(this));\n    this.session.on('Browser.videoRecordingFinished', this._onVideoRecordingFinished.bind(this));\n  }\n\n  async _initVersion() {\n    const result = await this.session.send('Browser.getInfo');\n    this._version = result.version.substring(result.version.indexOf('/') + 1);\n    this._userAgent = result.userAgent;\n  }\n\n  isConnected(): boolean {\n    return !this._connection._closed;\n  }\n\n  async doCreateNewContext(options: channels.BrowserNewContextParams): Promise<BrowserContext> {\n    if (options.isMobile)\n      throw new Error('options.isMobile is not supported in Firefox');\n    const { browserContextId } = await this.session.send('Browser.createBrowserContext', { removeOnDetach: true });\n    const context = new FFBrowserContext(this, browserContextId, options);\n    await context._initialize();\n    this._contexts.set(browserContextId, context);\n    return context;\n  }\n\n  contexts(): BrowserContext[] {\n    return Array.from(this._contexts.values());\n  }\n\n  version(): string {\n    return this._version;\n  }\n\n  userAgent(): string {\n    return this._userAgent;\n  }\n\n  _onDetachedFromTarget(payload: Protocol.Browser.detachedFromTargetPayload) {\n    const ffPage = this._ffPages.get(payload.targetId)!;\n    this._ffPages.delete(payload.targetId);\n    ffPage.didClose();\n  }\n\n  _onAttachedToTarget(payload: Protocol.Browser.attachedToTargetPayload) {\n    const { targetId, browserContextId, openerId, type } = payload.targetInfo;\n    assert(type === 'page');\n    const context = browserContextId ? this._contexts.get(browserContextId)! : this._defaultContext as FFBrowserContext;\n    assert(context, `Unknown context id:${browserContextId}, _defaultContext: ${this._defaultContext}`);\n    const session = this._connection.createSession(payload.sessionId);\n    const opener = openerId ? this._ffPages.get(openerId)! : null;\n    const ffPage = new FFPage(session, context, opener);\n    this._ffPages.set(targetId, ffPage);\n  }\n\n  _onDownloadCreated(payload: Protocol.Browser.downloadCreatedPayload) {\n    const ffPage = this._ffPages.get(payload.pageTargetId);\n    if (!ffPage)\n      return;\n\n    // Abort the navigation that turned into download.\n    ffPage._page._frameManager.frameAbortedNavigation(payload.frameId, 'Download is starting');\n\n    let originPage = ffPage._initializedPage;\n    // If it's a new window download, report it on the opener page.\n    if (!originPage) {\n      // Resume the page creation with an error. The page will automatically close right\n      // after the download begins.\n      ffPage._markAsError(new Error('Starting new page download'));\n      if (ffPage._opener)\n        originPage = ffPage._opener._initializedPage;\n    }\n    if (!originPage)\n      return;\n    this._downloadCreated(originPage, payload.uuid, payload.url, payload.suggestedFileName);\n  }\n\n  _onDownloadFinished(payload: Protocol.Browser.downloadFinishedPayload) {\n    const error = payload.canceled ? 'canceled' : payload.error;\n    this._downloadFinished(payload.uuid, error);\n  }\n\n  _onVideoRecordingFinished(payload: Protocol.Browser.videoRecordingFinishedPayload) {\n    this._takeVideo(payload.screencastId)?.reportFinished();\n  }\n\n  _onDisconnect() {\n    for (const video of this._idToVideo.values())\n      video.artifact.reportFinished(new TargetClosedError());\n    this._idToVideo.clear();\n    for (const ffPage of this._ffPages.values())\n      ffPage.didClose();\n    this._ffPages.clear();\n    this._didClose();\n  }\n}\n\nexport class FFBrowserContext extends BrowserContext {\n  declare readonly _browser: FFBrowser;\n\n  constructor(browser: FFBrowser, browserContextId: string | undefined, options: channels.BrowserNewContextParams) {\n    super(browser, options, browserContextId);\n  }\n\n  override async _initialize() {\n    assert(!this._ffPages().length);\n    const browserContextId = this._browserContextId;\n    const promises: Promise<any>[] = [\n      super._initialize(),\n      this._browser.session.send('Browser.addBinding', { browserContextId: this._browserContextId, name: PageBinding.kPlaywrightBinding, script: '' }),\n    ];\n    if (this._options.acceptDownloads !== 'internal-browser-default') {\n      promises.push(this._browser.session.send('Browser.setDownloadOptions', {\n        browserContextId,\n        downloadOptions: {\n          behavior: this._options.acceptDownloads === 'accept' ? 'saveToDisk' : 'cancel',\n          downloadsDir: this._browser.options.downloadsPath,\n        },\n      }));\n    }\n    if (this._options.viewport) {\n      const viewport = {\n        viewportSize: { width: this._options.viewport.width, height: this._options.viewport.height },\n        deviceScaleFactor: this._options.deviceScaleFactor || 1,\n      };\n      promises.push(this._browser.session.send('Browser.setDefaultViewport', { browserContextId, viewport }));\n    }\n    if (this._options.hasTouch)\n      promises.push(this._browser.session.send('Browser.setTouchOverride', { browserContextId, hasTouch: true }));\n    if (this._options.userAgent)\n      promises.push(this._browser.session.send('Browser.setUserAgentOverride', { browserContextId, userAgent: this._options.userAgent }));\n    if (this._options.bypassCSP)\n      promises.push(this._browser.session.send('Browser.setBypassCSP', { browserContextId, bypassCSP: true }));\n    if (this._options.ignoreHTTPSErrors)\n      promises.push(this._browser.session.send('Browser.setIgnoreHTTPSErrors', { browserContextId, ignoreHTTPSErrors: true }));\n    if (this._options.javaScriptEnabled === false)\n      promises.push(this._browser.session.send('Browser.setJavaScriptDisabled', { browserContextId, javaScriptDisabled: true }));\n    if (this._options.locale)\n      promises.push(this._browser.session.send('Browser.setLocaleOverride', { browserContextId, locale: this._options.locale }));\n    if (this._options.timezoneId)\n      promises.push(this._browser.session.send('Browser.setTimezoneOverride', { browserContextId, timezoneId: this._options.timezoneId }));\n    if (this._options.extraHTTPHeaders || this._options.locale)\n      promises.push(this.setExtraHTTPHeaders(this._options.extraHTTPHeaders || []));\n    if (this._options.httpCredentials)\n      promises.push(this.setHTTPCredentials(this._options.httpCredentials));\n    if (this._options.geolocation)\n      promises.push(this.setGeolocation(this._options.geolocation));\n    if (this._options.offline)\n      promises.push(this.setOffline(this._options.offline));\n    if (this._options.colorScheme !== 'no-override') {\n      promises.push(this._browser.session.send('Browser.setColorScheme', {\n        browserContextId,\n        colorScheme: this._options.colorScheme !== undefined  ? this._options.colorScheme : 'light',\n      }));\n    }\n    if (this._options.reducedMotion !== 'no-override') {\n      promises.push(this._browser.session.send('Browser.setReducedMotion', {\n        browserContextId,\n        reducedMotion: this._options.reducedMotion !== undefined  ? this._options.reducedMotion : 'no-preference',\n      }));\n    }\n    if (this._options.forcedColors !== 'no-override') {\n      promises.push(this._browser.session.send('Browser.setForcedColors', {\n        browserContextId,\n        forcedColors: this._options.forcedColors !== undefined  ? this._options.forcedColors : 'none',\n      }));\n    }\n    if (this._options.recordVideo) {\n      promises.push(this._ensureVideosPath().then(() => {\n        return this._browser.session.send('Browser.setVideoRecordingOptions', {\n          // validateBrowserContextOptions ensures correct video size.\n          options: {\n            ...this._options.recordVideo!.size!,\n            dir: this._options.recordVideo!.dir,\n          },\n          browserContextId: this._browserContextId\n        });\n      }));\n    }\n    if (this._options.proxy) {\n      promises.push(this._browser.session.send('Browser.setContextProxy', {\n        browserContextId: this._browserContextId,\n        ...toJugglerProxyOptions(this._options.proxy)\n      }));\n    }\n\n    await Promise.all(promises);\n  }\n\n  _ffPages(): FFPage[] {\n    return Array.from(this._browser._ffPages.values()).filter(ffPage => ffPage._browserContext === this);\n  }\n\n  pages(): Page[] {\n    return this._ffPages().map(ffPage => ffPage._initializedPage).filter(pageOrNull => !!pageOrNull) as Page[];\n  }\n\n  async newPageDelegate(): Promise<PageDelegate> {\n    assertBrowserContextIsNotOwned(this);\n    const { targetId } = await this._browser.session.send('Browser.newPage', {\n      browserContextId: this._browserContextId\n    }).catch(e =>  {\n      if (e.message.includes('Failed to override timezone'))\n        throw new Error(`Invalid timezone ID: ${this._options.timezoneId}`);\n      throw e;\n    });\n    return this._browser._ffPages.get(targetId)!;\n  }\n\n  async doGetCookies(urls: string[]): Promise<channels.NetworkCookie[]> {\n    const { cookies } = await this._browser.session.send('Browser.getCookies', { browserContextId: this._browserContextId });\n    return network.filterCookies(cookies.map(c => {\n      const copy: any = { ... c };\n      delete copy.size;\n      delete copy.session;\n      return copy as channels.NetworkCookie;\n    }), urls);\n  }\n\n  async addCookies(cookies: channels.SetNetworkCookie[]) {\n    const cc = network.rewriteCookies(cookies).map(c => ({\n      ...c,\n      expires: c.expires === -1 ? undefined : c.expires,\n    }));\n    await this._browser.session.send('Browser.setCookies', { browserContextId: this._browserContextId, cookies: cc });\n  }\n\n  async doClearCookies() {\n    await this._browser.session.send('Browser.clearCookies', { browserContextId: this._browserContextId });\n  }\n\n  async doGrantPermissions(origin: string, permissions: string[]) {\n    const webPermissionToProtocol = new Map<string, 'geo' | 'desktop-notification' | 'persistent-storage' | 'push'>([\n      ['geolocation', 'geo'],\n      ['persistent-storage', 'persistent-storage'],\n      ['push', 'push'],\n      ['notifications', 'desktop-notification'],\n    ]);\n    const filtered = permissions.map(permission => {\n      const protocolPermission = webPermissionToProtocol.get(permission);\n      if (!protocolPermission)\n        throw new Error('Unknown permission: ' + permission);\n      return protocolPermission;\n    });\n    await this._browser.session.send('Browser.grantPermissions', { origin: origin, browserContextId: this._browserContextId, permissions: filtered });\n  }\n\n  async doClearPermissions() {\n    await this._browser.session.send('Browser.resetPermissions', { browserContextId: this._browserContextId });\n  }\n\n  async setGeolocation(geolocation?: types.Geolocation): Promise<void> {\n    verifyGeolocation(geolocation);\n    this._options.geolocation = geolocation;\n    await this._browser.session.send('Browser.setGeolocationOverride', { browserContextId: this._browserContextId, geolocation: geolocation || null });\n  }\n\n  async setExtraHTTPHeaders(headers: types.HeadersArray): Promise<void> {\n    this._options.extraHTTPHeaders = headers;\n    let allHeaders = this._options.extraHTTPHeaders;\n    if (this._options.locale)\n      allHeaders = network.mergeHeaders([allHeaders, network.singleHeader('Accept-Language', this._options.locale)]);\n    await this._browser.session.send('Browser.setExtraHTTPHeaders', { browserContextId: this._browserContextId, headers: allHeaders });\n  }\n\n  async setUserAgent(userAgent: string | undefined): Promise<void> {\n    await this._browser.session.send('Browser.setUserAgentOverride', { browserContextId: this._browserContextId, userAgent: userAgent || null });\n  }\n\n  async setOffline(offline: boolean): Promise<void> {\n    this._options.offline = offline;\n    await this._browser.session.send('Browser.setOnlineOverride', { browserContextId: this._browserContextId, override: offline ? 'offline' : 'online' });\n  }\n\n  async doSetHTTPCredentials(httpCredentials?: types.Credentials): Promise<void> {\n    this._options.httpCredentials = httpCredentials;\n    let credentials = null;\n    if (httpCredentials) {\n      const { username, password, origin } = httpCredentials;\n      credentials = { username, password, origin };\n    }\n    await this._browser.session.send('Browser.setHTTPCredentials', { browserContextId: this._browserContextId, credentials });\n  }\n\n  async doAddInitScript(initScript: InitScript) {\n    await this._updateInitScripts();\n  }\n\n  async doRemoveNonInternalInitScripts() {\n    await this._updateInitScripts();\n  }\n\n  private async _updateInitScripts() {\n    const bindingScripts = [...this._pageBindings.values()].map(binding => binding.initScript.source);\n    const initScripts = this.initScripts.map(script => script.source);\n    await this._browser.session.send('Browser.setInitScripts', { browserContextId: this._browserContextId, scripts: [...bindingScripts, ...initScripts].map(script => ({ script })) });\n  }\n\n  async doUpdateRequestInterception(): Promise<void> {\n    await Promise.all([\n      this._browser.session.send('Browser.setRequestInterception', { browserContextId: this._browserContextId, enabled: !!this._requestInterceptor }),\n      this._browser.session.send('Browser.setCacheDisabled', { browserContextId: this._browserContextId, cacheDisabled: !!this._requestInterceptor }),\n    ]);\n  }\n\n  onClosePersistent() {}\n\n  override async clearCache(): Promise<void> {\n    // Clearing only the context cache does not work: https://bugzilla.mozilla.org/show_bug.cgi?id=1819147\n    await this._browser.session.send('Browser.clearCache');\n  }\n\n  async doClose(reason: string | undefined) {\n    if (!this._browserContextId) {\n      if (this._options.recordVideo) {\n        await this._browser.session.send('Browser.setVideoRecordingOptions', {\n          options: undefined,\n          browserContextId: this._browserContextId\n        });\n      }\n      // Closing persistent context should close the browser.\n      await this._browser.close({ reason });\n    } else {\n      await this._browser.session.send('Browser.removeBrowserContext', { browserContextId: this._browserContextId });\n      this._browser._contexts.delete(this._browserContextId);\n    }\n  }\n\n  async cancelDownload(uuid: string) {\n    await this._browser.session.send('Browser.cancelDownload', { uuid });\n  }\n}\n\nfunction toJugglerProxyOptions(proxy: types.ProxySettings) {\n  const proxyServer = new URL(proxy.server);\n  let port = parseInt(proxyServer.port, 10);\n  let type: 'http' | 'https' | 'socks' | 'socks4' = 'http';\n  if (proxyServer.protocol === 'socks5:')\n    type = 'socks';\n  else if (proxyServer.protocol === 'socks4:')\n    type = 'socks4';\n  else if (proxyServer.protocol === 'https:')\n    type = 'https';\n  if (proxyServer.port === '') {\n    if (proxyServer.protocol === 'http:')\n      port = 80;\n    else if (proxyServer.protocol === 'https:')\n      port = 443;\n  }\n  return {\n    type,\n    bypass: proxy.bypass ? proxy.bypass.split(',').map(domain => domain.trim()) : [],\n    host: proxyServer.hostname,\n    port,\n    username: proxy.username,\n    password: proxy.password\n  };\n}\n\n// Prefs for quick fixes that didn't make it to the build.\n// Should all be moved to `playwright.cfg`.\nconst kBandaidFirefoxUserPrefs = {};\n\n"],"mappings":"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"}