{"version":3,"file":"ffNetworkManager.js","names":["_eventsHelper","require","network","_interopRequireWildcard","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","FFNetworkManager","constructor","session","page","_session","_requests","_page","_eventListeners","Map","eventsHelper","addEventListener","_onRequestWillBeSent","bind","_onResponseReceived","_onRequestFinished","_onRequestFailed","dispose","removeEventListeners","setRequestInterception","enabled","Promise","all","send","cacheDisabled","event","redirectedFrom","frame","request","frameId","_frameManager","delete","_id","InterceptableRequest","route","isIntercepted","FFRouteImpl","requestStarted","_event$securityDetail","_event$securityDetail2","_event$securityDetail3","_event$securityDetail4","_event$securityDetail5","requestId","getResponseBody","response","evicted","Error","method","url","Buffer","from","base64body","startTime","timing","relativeToStart","time","domainLookupStart","domainLookupEnd","connectStart","secureConnectionStart","connectEnd","requestStart","responseStart","Response","status","statusText","parseMultivalueHeaders","headers","fromServiceWorker","remoteIPAddress","remotePort","_serverAddrFinished","ipAddress","port","_securityDetailsFinished","protocol","securityDetails","subjectName","issuer","validFrom","validTo","setRawResponseHeaders","setResponseHeadersSize","requestReceivedResponse","_existingResponse","setTransferSize","transferSize","setEncodedBodySize","encodedBodySize","isRedirected","responseEndTime","_requestFinished","protocolVersion","_setHttpVersion","reportRequestFinished","_setFailureText","errorCode","requestFailed","exports","causeToResourceType","TYPE_INVALID","TYPE_OTHER","TYPE_SCRIPT","TYPE_IMAGE","TYPE_STYLESHEET","TYPE_OBJECT","TYPE_DOCUMENT","TYPE_SUBDOCUMENT","TYPE_REFRESH","TYPE_XBL","TYPE_PING","TYPE_XMLHTTPREQUEST","TYPE_OBJECT_SUBREQUEST","TYPE_DTD","TYPE_FONT","TYPE_MEDIA","TYPE_WEBSOCKET","TYPE_CSP_REPORT","TYPE_XSLT","TYPE_BEACON","TYPE_FETCH","TYPE_IMAGESET","TYPE_WEB_MANIFEST","internalCauseToResourceType","TYPE_INTERNAL_EVENTSOURCE","payload","_redirectedTo","postDataBuffer","postData","Request","_browserContext","navigationId","internalCause","cause","setRawRequestHeaders","_finalRequest","_request","continue","overrides","sendMayFail","toString","undefined","fulfill","isBase64","body","abort","result","header","separator","name","toLowerCase","tokens","value","split","map","s","trim","token","push"],"sources":["../../../src/server/firefox/ffNetworkManager.ts"],"sourcesContent":["/**\n * Copyright 2019 Google Inc. All rights reserved.\n * Modifications copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { RegisteredListener } from '../../utils/eventsHelper';\nimport { eventsHelper } from '../../utils/eventsHelper';\nimport type { FFSession } from './ffConnection';\nimport type { Page } from '../page';\nimport * as network from '../network';\nimport type * as frames from '../frames';\nimport type * as types from '../types';\nimport type { Protocol } from './protocol';\nimport type { HeadersArray } from '../../server/types';\n\nexport class FFNetworkManager {\n  private _session: FFSession;\n  private _requests: Map<string, InterceptableRequest>;\n  private _page: Page;\n  private _eventListeners: RegisteredListener[];\n\n  constructor(session: FFSession, page: Page) {\n    this._session = session;\n\n    this._requests = new Map();\n    this._page = page;\n\n    this._eventListeners = [\n      eventsHelper.addEventListener(session, 'Network.requestWillBeSent', this._onRequestWillBeSent.bind(this)),\n      eventsHelper.addEventListener(session, 'Network.responseReceived', this._onResponseReceived.bind(this)),\n      eventsHelper.addEventListener(session, 'Network.requestFinished', this._onRequestFinished.bind(this)),\n      eventsHelper.addEventListener(session, 'Network.requestFailed', this._onRequestFailed.bind(this)),\n    ];\n  }\n\n  dispose() {\n    eventsHelper.removeEventListeners(this._eventListeners);\n  }\n\n  async setRequestInterception(enabled: boolean) {\n    await Promise.all([\n      this._session.send('Network.setRequestInterception', { enabled }),\n      this._session.send('Page.setCacheDisabled', { cacheDisabled: enabled }),\n    ]);\n  }\n\n  _onRequestWillBeSent(event: Protocol.Network.requestWillBeSentPayload) {\n    const redirectedFrom = event.redirectedFrom ? (this._requests.get(event.redirectedFrom) || null) : null;\n    const frame = redirectedFrom ? redirectedFrom.request.frame() : (event.frameId ? this._page._frameManager.frame(event.frameId) : null);\n    if (!frame)\n      return;\n    if (redirectedFrom)\n      this._requests.delete(redirectedFrom._id);\n    const request = new InterceptableRequest(frame, redirectedFrom, event);\n    let route;\n    if (event.isIntercepted)\n      route = new FFRouteImpl(this._session, request);\n    this._requests.set(request._id, request);\n    this._page._frameManager.requestStarted(request.request, route);\n  }\n\n  _onResponseReceived(event: Protocol.Network.responseReceivedPayload) {\n    const request = this._requests.get(event.requestId);\n    if (!request)\n      return;\n    const getResponseBody = async () => {\n      const response = await this._session.send('Network.getResponseBody', {\n        requestId: request._id\n      });\n      if (response.evicted)\n        throw new Error(`Response body for ${request.request.method()} ${request.request.url()} was evicted!`);\n      return Buffer.from(response.base64body, 'base64');\n    };\n\n    const startTime = event.timing.startTime;\n    function relativeToStart(time: number): number {\n      if (!time)\n        return -1;\n      return (time - startTime) / 1000;\n    }\n    const timing = {\n      startTime: startTime / 1000,\n      domainLookupStart: relativeToStart(event.timing.domainLookupStart),\n      domainLookupEnd: relativeToStart(event.timing.domainLookupEnd),\n      connectStart: relativeToStart(event.timing.connectStart),\n      secureConnectionStart: relativeToStart(event.timing.secureConnectionStart),\n      connectEnd: relativeToStart(event.timing.connectEnd),\n      requestStart: relativeToStart(event.timing.requestStart),\n      responseStart: relativeToStart(event.timing.responseStart),\n    };\n    const response = new network.Response(request.request, event.status, event.statusText, parseMultivalueHeaders(event.headers), timing, getResponseBody, event.fromServiceWorker);\n    if (event?.remoteIPAddress && typeof event?.remotePort === 'number') {\n      response._serverAddrFinished({\n        ipAddress: event.remoteIPAddress,\n        port: event.remotePort,\n      });\n    } else {\n      response._serverAddrFinished();\n    }\n    response._securityDetailsFinished({\n      protocol: event?.securityDetails?.protocol,\n      subjectName: event?.securityDetails?.subjectName,\n      issuer: event?.securityDetails?.issuer,\n      validFrom: event?.securityDetails?.validFrom,\n      validTo: event?.securityDetails?.validTo,\n    });\n    // \"raw\" headers are the same as \"provisional\" headers in Firefox.\n    response.setRawResponseHeaders(null);\n    // Headers size are not available in Firefox.\n    response.setResponseHeadersSize(null);\n    this._page._frameManager.requestReceivedResponse(response);\n  }\n\n  _onRequestFinished(event: Protocol.Network.requestFinishedPayload) {\n    const request = this._requests.get(event.requestId);\n    if (!request)\n      return;\n    const response = request.request._existingResponse()!;\n    response.setTransferSize(event.transferSize);\n    response.setEncodedBodySize(event.encodedBodySize);\n\n    // Keep redirected requests in the map for future reference as redirectedFrom.\n    const isRedirected = response.status() >= 300 && response.status() <= 399;\n    const responseEndTime = event.responseEndTime ? event.responseEndTime / 1000 - response.timing().startTime : -1;\n    if (isRedirected) {\n      response._requestFinished(responseEndTime);\n    } else {\n      this._requests.delete(request._id);\n      response._requestFinished(responseEndTime);\n    }\n    if (event.protocolVersion)\n      response._setHttpVersion(event.protocolVersion);\n    this._page._frameManager.reportRequestFinished(request.request, response);\n  }\n\n  _onRequestFailed(event: Protocol.Network.requestFailedPayload) {\n    const request = this._requests.get(event.requestId);\n    if (!request)\n      return;\n    this._requests.delete(request._id);\n    const response = request.request._existingResponse();\n    if (response) {\n      response.setTransferSize(null);\n      response.setEncodedBodySize(null);\n      response._requestFinished(-1);\n    }\n    request.request._setFailureText(event.errorCode);\n    this._page._frameManager.requestFailed(request.request, event.errorCode === 'NS_BINDING_ABORTED');\n  }\n}\n\nconst causeToResourceType: {[key: string]: string} = {\n  TYPE_INVALID: 'other',\n  TYPE_OTHER: 'other',\n  TYPE_SCRIPT: 'script',\n  TYPE_IMAGE: 'image',\n  TYPE_STYLESHEET: 'stylesheet',\n  TYPE_OBJECT: 'other',\n  TYPE_DOCUMENT: 'document',\n  TYPE_SUBDOCUMENT: 'document',\n  TYPE_REFRESH: 'document',\n  TYPE_XBL: 'other',\n  TYPE_PING: 'other',\n  TYPE_XMLHTTPREQUEST: 'xhr',\n  TYPE_OBJECT_SUBREQUEST: 'other',\n  TYPE_DTD: 'other',\n  TYPE_FONT: 'font',\n  TYPE_MEDIA: 'media',\n  TYPE_WEBSOCKET: 'websocket',\n  TYPE_CSP_REPORT: 'other',\n  TYPE_XSLT: 'other',\n  TYPE_BEACON: 'other',\n  TYPE_FETCH: 'fetch',\n  TYPE_IMAGESET: 'images',\n  TYPE_WEB_MANIFEST: 'manifest',\n};\n\nconst internalCauseToResourceType: {[key: string]: string} = {\n  TYPE_INTERNAL_EVENTSOURCE: 'eventsource',\n};\n\nclass InterceptableRequest {\n  readonly request: network.Request;\n  readonly _id: string;\n  private _redirectedTo: InterceptableRequest | undefined;\n\n  constructor(frame: frames.Frame, redirectedFrom: InterceptableRequest | null, payload: Protocol.Network.requestWillBeSentPayload) {\n    this._id = payload.requestId;\n    if (redirectedFrom)\n      redirectedFrom._redirectedTo = this;\n    let postDataBuffer = null;\n    if (payload.postData)\n      postDataBuffer = Buffer.from(payload.postData, 'base64');\n    this.request = new network.Request(frame._page._browserContext, frame, null, redirectedFrom ? redirectedFrom.request : null, payload.navigationId,\n        payload.url, internalCauseToResourceType[payload.internalCause] || causeToResourceType[payload.cause] || 'other', payload.method, postDataBuffer, payload.headers);\n    // \"raw\" headers are the same as \"provisional\" headers in Firefox.\n    this.request.setRawRequestHeaders(null);\n  }\n\n  _finalRequest(): InterceptableRequest {\n    let request: InterceptableRequest = this;\n    while (request._redirectedTo)\n      request = request._redirectedTo;\n    return request;\n  }\n}\n\nclass FFRouteImpl implements network.RouteDelegate {\n  private _request: InterceptableRequest;\n  private _session: FFSession;\n\n  constructor(session: FFSession, request: InterceptableRequest) {\n    this._session = session;\n    this._request = request;\n  }\n\n  async continue(overrides: types.NormalizedContinueOverrides) {\n    await this._session.sendMayFail('Network.resumeInterceptedRequest', {\n      requestId: this._request._id,\n      url: overrides.url,\n      method: overrides.method,\n      headers: overrides.headers,\n      postData: overrides.postData ? Buffer.from(overrides.postData).toString('base64') : undefined,\n    });\n  }\n\n  async fulfill(response: types.NormalizedFulfillResponse) {\n    const base64body = response.isBase64 ? response.body : Buffer.from(response.body).toString('base64');\n\n    await this._session.sendMayFail('Network.fulfillInterceptedRequest', {\n      requestId: this._request._id,\n      status: response.status,\n      statusText: network.statusText(response.status),\n      headers: response.headers,\n      base64body,\n    });\n  }\n\n  async abort(errorCode: string) {\n    await this._session.sendMayFail('Network.abortInterceptedRequest', {\n      requestId: this._request._id,\n      errorCode,\n    });\n  }\n}\n\nfunction parseMultivalueHeaders(headers: HeadersArray) {\n  const result: HeadersArray = [];\n  for (const header of headers) {\n    const separator = header.name.toLowerCase() === 'set-cookie' ? '\\n' : ',';\n    const tokens = header.value.split(separator).map(s => s.trim());\n    for (const token of tokens)\n      result.push({ name: header.name, value: token });\n  }\n  return result;\n}\n"],"mappings":"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"}