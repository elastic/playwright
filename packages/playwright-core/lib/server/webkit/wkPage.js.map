{"version":3,"file":"wkPage.js","names":["_path","_interopRequireDefault","require","_os","_utilsBundle","_stackTrace","_utils","_hostPlatform","dialog","_interopRequireWildcard","dom","_eventsHelper","_helper","network","_page","_wkAccessibility","_wkConnection","_wkExecutionContext","_wkInput","_wkInterceptableRequest","_wkProvisionalPage","_wkWorkers","_debugLogger","_manualPromise","_browserContext","_errors","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","obj","UTILITY_WORLD_NAME","WKPage","constructor","browserContext","pageProxySession","opener","rawMouse","rawKeyboard","rawTouchscreen","_session","_provisionalPage","_pagePromise","ManualPromise","_pageProxySession","_opener","_requestIdToRequest","Map","_requestIdToRequestWillBeSentEvent","_workers","_contextIdToContext","_sessionListeners","_eventListeners","_initializedPage","_firstNonInitialNavigationCommittedPromise","_firstNonInitialNavigationCommittedFulfill","_firstNonInitialNavigationCommittedReject","_lastConsoleMessage","_requestIdToResponseReceivedPayloadEvent","_nextWindowOpenPopupFeatures","_recordingVideoFile","_screencastGeneration","RawKeyboardImpl","RawMouseImpl","RawTouchscreenImpl","Page","setPage","WKWorkers","undefined","on","Events","FrameDetached","frame","_removeContextsForFrame","eventsHelper","addEventListener","_onTargetCreated","bind","_onTargetDestroyed","_onDispatchMessageFromTarget","_onDidCommitProvisionalTarget","_onScreencastFrame","Promise","f","_options","noDefaultViewport","viewportSize","helper","getViewportSizeFromWindowFeatures","_emulatedSize","viewport","screen","potentiallyUninitializedPage","_initializePageProxySession","isSettingStorageState","promises","send","active","contextOptions","javaScriptEnabled","push","enabled","_updateViewport","updateHttpCredentials","_permissions","size","key","value","_grantPermissions","recordVideo","outputFile","path","join","dir","createGuid","_ensureVideosPath","then","_startVideo","all","_setSession","session","removeEventListeners","setSession","_addSessionListeners","_initializeSession","provisional","resourceTreeHandler","_initializeSessionMayThrow","catch","isDisposed","frameTree","name","PageBinding","kPlaywrightBinding","_","initializeSession","needsRequestInterception","disabled","url","stage","isRegex","userAgent","updateUserAgent","emulatedMedia","media","colorScheme","reducedMotion","forcedColors","_setEmulateMedia","bootstrapScript","_calculateBootstrapScript","length","source","frames","map","evaluateExpression","bypassCSP","emulatedSize","width","height","updateEmulateMedia","headers","headersArrayToObject","_calculateExtraHTTPHeaders","offline","hasTouch","timezoneId","timeZone","Error","fileChooserIntercepted","setting","isMobile","event","oldTargetId","newTargetId","assert","sessionId","newSession","commit","dispose","targetId","crashed","_maybeCancelCoopNavigationRequest","markAsCrashed","_didCrash","didClose","TargetClosedError","_didClose","dispatchMessageToSession","message","dispatchMessage","handleProvisionalLoadFailed","errorText","error","includes","_frameManager","frameAbortedNavigation","mainFrame","_id","loaderId","handleWindowOpen","debugAssert","windowFeatures","pageOrError","targetInfo","WKSession","connection","JSON","stringify","id","type","isProvisional","_handleFrameTree","isPaused","sendMayFail","initOpener","reportAsNew","resolve","WKProvisionalPage","initializationPromise","parse","_onFrameNavigated","_onFrameNavigatedWithinDocument","frameId","_onFrameAttached","parentFrameId","_onFrameDetached","_onWillCheckNavigationPolicy","_onDidCheckNavigationPolicy","cancel","_onFrameScheduledNavigation","delay","targetIsCurrentFrame","frameLifecycleEvent","_onExecutionContextCreated","context","_onBindingCalled","contextId","argument","_onConsoleMessage","_onConsoleRepeatCountUpdated","_onDialog","_onFileChooserOpened","_onRequestWillBeSent","_onRequestIntercepted","_onResponseReceived","_onLoadingFinished","_onLoadingFailed","onWebSocketCreated","requestId","onWebSocketRequest","onWebSocketResponse","response","status","statusText","payloadData","onWebSocketFrameSent","opcode","webSocketFrameReceived","webSocketClosed","webSocketError","errorMessage","_updateState","method","params","_forAllSessions","callback","sessions","frameRequestedNavigation","parentId","childFrames","child","frameAttached","framePayload","initial","clear","frameCommittedNewDocumentNavigation","frameCommittedSameDocumentNavigation","frameDetached","notifyFrame","delete","_contextDestroyed","contextPayload","delegate","WKExecutionContext","worldName","FrameExecutionContext","contextDelegateSymbol","_contextCreated","navigateFrame","referrer","pageProxyId","result","browserSession","newDocumentId","level","text","parameters","line","lineNumber","column","columnNumber","splitErrorMessage","stack","stackTrace","callFrames","callFrame","functionName","emitOnContextOnceInitialized","BrowserContext","PageError","derivedType","handles","p","objectId","injectedScriptId","values","find","c","createHandle","count","location","_addConsoleMessage","emitOnContext","Dialog","accept","promptText","defaultPrompt","handle","_mainContext","element","asElement","mediaType","appearance","reducedMotionWk","forcedColorsWk","updateExtraHTTPHeaders","locale","mergeHeaders","extraHTTPHeaders","singleHeader","updateEmulatedViewportSize","_validateEmulatedViewport","bringToFront","options","deviceSize","screenSize","fixedLayout","deviceScaleFactor","angle","useLegacySetOrientationOverrideMethod","os","platform","parseInt","release","split","updateRequestInterception","updateOffline","credentials","httpCredentials","username","password","origin","updateFileChooserInterception","reload","goBack","goForward","addInitScript","initScript","_updateBootstrapScript","removeNonInternalInitScripts","scripts","allInitScripts","script","closePage","runBeforeUnload","_stopVideo","setBackgroundColor","color","_toolbarHeight","_this$_page$_browserC","_browser","headful","hostPlatform","screencastId","file","toolbarHeight","_videoStarted","validateScreenshotDimension","side","omitDeviceScaleFactor","process","Math","ceil","takeScreenshot","progress","format","documentRect","viewportRect","quality","fitsViewport","scale","rect","coordinateSystem","prefix","buffer","Buffer","from","dataURL","substr","jpegjs","encode","PNG","sync","read","data","getContentFrame","nodeInfo","_objectId","contentFrameId","getOwnerFrame","ownerFrameId","isElementHandle","remoteObject","subtype","getBoundingBox","quads","getContentQuads","minX","Infinity","maxX","minY","maxY","quad","point","min","x","max","y","scrollRectIntoViewIfNeeded","setScreencastOptions","so","generation","throttleScreencastFrameAck","debugLogger","log","emit","ScreencastFrame","deviceWidth","deviceHeight","rafCountForStablePosition","setInputFiles","files","protocolFiles","mimeType","setInputFilePaths","paths","adoptElementHandle","to","executionContextId","_contextId","object","kUnableToAdoptErrorMessage","getAccessibilityTree","needle","inputActionEpilogue","resetForReuse","getFrameElement","parent","parentFrame","provisionalPage","navigationRequest","coopNavigationRequest","request","timestamp","_timestamp","canceled","_adoptRequestFromNewProcess","newRequestId","adoptRequestFromNewProcess","startsWith","redirectResponse","_onRequest","intercepted","redirectedFrom","_handleRequestRedirect","isNavigationRequest","documentId","WKInterceptableRequest","route","WKRouteImpl","setRawRequestHeaders","requestStarted","responsePayload","createResponse","_securityDetailsFinished","_serverAddrFinished","setResponseHeadersSize","setEncodedBodySize","_requestFinished","timing","secondsToRoundishMillis","requestReceivedResponse","reportRequestFinished","requestWillBeSentEvent","_existingResponse","_event$metrics","_event$metrics2","_responseReceivedPayl","_responseReceivedPayl2","_responseReceivedPayl3","_event$metrics3","_event$metrics$respon","_event$metrics4","_event$metrics$respon2","_event$metrics5","responseReceivedPayload","parseRemoteAddress","metrics","remoteAddress","protocol","isLoadedSecurely","securityConnection","subjectName","security","certificate","subject","validFrom","validTo","validUntil","_setHttpVersion","responseBodyBytesReceived","responseHeaderBytesReceived","_setFailureText","requestFailed","permissions","webPermissionToProtocol","filtered","permission","protocolPermission","_clearPermissions","shouldToggleStyleSheetToSyncAnimations","exports","colon","lastIndexOf","dot","ipAddress","slice","port","address","URL","secureConnectionStart","connectStart","Symbol"],"sources":["../../../src/server/webkit/wkPage.ts"],"sourcesContent":["/**\n * Copyright 2017 Google Inc. All rights reserved.\n * Modifications copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport path from 'path';\nimport os from 'os';\nimport { PNG, jpegjs } from '../../utilsBundle';\nimport { splitErrorMessage } from '../../utils/stackTrace';\nimport { assert, createGuid, debugAssert, headersArrayToObject } from '../../utils';\nimport { hostPlatform } from '../../utils/hostPlatform';\nimport type * as accessibility from '../accessibility';\nimport * as dialog from '../dialog';\nimport * as dom from '../dom';\nimport type * as frames from '../frames';\nimport type { RegisteredListener } from '../../utils/eventsHelper';\nimport { eventsHelper } from '../../utils/eventsHelper';\nimport { helper } from '../helper';\nimport type { JSHandle } from '../javascript';\nimport * as network from '../network';\nimport { type InitScript, PageBinding, type PageDelegate } from '../page';\nimport { Page } from '../page';\nimport type { Progress } from '../progress';\nimport type * as types from '../types';\nimport type { Protocol } from './protocol';\nimport { getAccessibilityTree } from './wkAccessibility';\nimport type { WKBrowserContext } from './wkBrowser';\nimport { WKSession } from './wkConnection';\nimport { WKExecutionContext } from './wkExecutionContext';\nimport { RawKeyboardImpl, RawMouseImpl, RawTouchscreenImpl } from './wkInput';\nimport { WKInterceptableRequest, WKRouteImpl } from './wkInterceptableRequest';\nimport { WKProvisionalPage } from './wkProvisionalPage';\nimport { WKWorkers } from './wkWorkers';\nimport { debugLogger } from '../../utils/debugLogger';\nimport { ManualPromise } from '../../utils/manualPromise';\nimport { BrowserContext } from '../browserContext';\nimport { TargetClosedError } from '../errors';\n\nconst UTILITY_WORLD_NAME = '__playwright_utility_world__';\n\nexport class WKPage implements PageDelegate {\n  readonly rawMouse: RawMouseImpl;\n  readonly rawKeyboard: RawKeyboardImpl;\n  readonly rawTouchscreen: RawTouchscreenImpl;\n  _session: WKSession;\n  private _provisionalPage: WKProvisionalPage | null = null;\n  readonly _page: Page;\n  private readonly _pagePromise = new ManualPromise<Page | Error>();\n  private readonly _pageProxySession: WKSession;\n  readonly _opener: WKPage | null;\n  private readonly _requestIdToRequest = new Map<string, WKInterceptableRequest>();\n  private readonly _requestIdToRequestWillBeSentEvent = new Map<string, Protocol.Network.requestWillBeSentPayload>();\n  private readonly _workers: WKWorkers;\n  private readonly _contextIdToContext: Map<number, dom.FrameExecutionContext>;\n  private _sessionListeners: RegisteredListener[] = [];\n  private _eventListeners: RegisteredListener[];\n  readonly _browserContext: WKBrowserContext;\n  _initializedPage: Page | null = null;\n  private _firstNonInitialNavigationCommittedPromise: Promise<void>;\n  private _firstNonInitialNavigationCommittedFulfill = () => {};\n  _firstNonInitialNavigationCommittedReject = (e: Error) => {};\n  private _lastConsoleMessage: { derivedType: string, text: string, handles: JSHandle[]; count: number, location: types.ConsoleMessageLocation; } | null = null;\n\n  private readonly _requestIdToResponseReceivedPayloadEvent = new Map<string, Protocol.Network.responseReceivedPayload>();\n  // Holds window features for the next popup being opened via window.open,\n  // until the popup page proxy arrives.\n  private _nextWindowOpenPopupFeatures?: string[];\n  private _recordingVideoFile: string | null = null;\n  private _screencastGeneration: number = 0;\n\n  constructor(browserContext: WKBrowserContext, pageProxySession: WKSession, opener: WKPage | null) {\n    this._pageProxySession = pageProxySession;\n    this._opener = opener;\n    this.rawKeyboard = new RawKeyboardImpl(pageProxySession);\n    this.rawMouse = new RawMouseImpl(pageProxySession);\n    this.rawTouchscreen = new RawTouchscreenImpl(pageProxySession);\n    this._contextIdToContext = new Map();\n    this._page = new Page(this, browserContext);\n    this.rawMouse.setPage(this._page);\n    this._workers = new WKWorkers(this._page);\n    this._session = undefined as any as WKSession;\n    this._browserContext = browserContext;\n    this._page.on(Page.Events.FrameDetached, (frame: frames.Frame) => this._removeContextsForFrame(frame, false));\n    this._eventListeners = [\n      eventsHelper.addEventListener(this._pageProxySession, 'Target.targetCreated', this._onTargetCreated.bind(this)),\n      eventsHelper.addEventListener(this._pageProxySession, 'Target.targetDestroyed', this._onTargetDestroyed.bind(this)),\n      eventsHelper.addEventListener(this._pageProxySession, 'Target.dispatchMessageFromTarget', this._onDispatchMessageFromTarget.bind(this)),\n      eventsHelper.addEventListener(this._pageProxySession, 'Target.didCommitProvisionalTarget', this._onDidCommitProvisionalTarget.bind(this)),\n      eventsHelper.addEventListener(this._pageProxySession, 'Screencast.screencastFrame', this._onScreencastFrame.bind(this)),\n    ];\n    this._firstNonInitialNavigationCommittedPromise = new Promise((f, r) => {\n      this._firstNonInitialNavigationCommittedFulfill = f;\n      this._firstNonInitialNavigationCommittedReject = r;\n    });\n    if (opener && !browserContext._options.noDefaultViewport && opener._nextWindowOpenPopupFeatures) {\n      const viewportSize = helper.getViewportSizeFromWindowFeatures(opener._nextWindowOpenPopupFeatures);\n      opener._nextWindowOpenPopupFeatures = undefined;\n      if (viewportSize)\n        this._page._emulatedSize = { viewport: viewportSize, screen: viewportSize };\n    }\n  }\n\n  potentiallyUninitializedPage(): Page {\n    return this._page;\n  }\n\n  private async _initializePageProxySession() {\n    if (this._page._browserContext.isSettingStorageState())\n      return;\n    const promises: Promise<any>[] = [\n      this._pageProxySession.send('Dialog.enable'),\n      this._pageProxySession.send('Emulation.setActiveAndFocused', { active: true }),\n    ];\n    const contextOptions = this._browserContext._options;\n    if (contextOptions.javaScriptEnabled === false)\n      promises.push(this._pageProxySession.send('Emulation.setJavaScriptEnabled', { enabled: false }));\n    promises.push(this._updateViewport());\n    promises.push(this.updateHttpCredentials());\n    if (this._browserContext._permissions.size) {\n      for (const [key, value] of this._browserContext._permissions)\n        promises.push(this._grantPermissions(key, value));\n    }\n    if (this._browserContext._options.recordVideo) {\n      const outputFile = path.join(this._browserContext._options.recordVideo.dir, createGuid() + '.webm');\n      promises.push(this._browserContext._ensureVideosPath().then(() => {\n        return this._startVideo({\n          // validateBrowserContextOptions ensures correct video size.\n          ...this._browserContext._options.recordVideo!.size!,\n          outputFile,\n        });\n      }));\n    }\n    await Promise.all(promises);\n  }\n\n  private _setSession(session: WKSession) {\n    eventsHelper.removeEventListeners(this._sessionListeners);\n    this._session = session;\n    this.rawKeyboard.setSession(session);\n    this.rawMouse.setSession(session);\n    this._addSessionListeners();\n    this._workers.setSession(session);\n  }\n\n  // This method is called for provisional targets as well. The session passed as the parameter\n  // may be different from the current session and may be destroyed without becoming current.\n  async _initializeSession(session: WKSession, provisional: boolean, resourceTreeHandler: (r: Protocol.Page.getResourceTreeReturnValue) => void) {\n    await this._initializeSessionMayThrow(session, resourceTreeHandler).catch(e => {\n      // Provisional session can be disposed at any time, for example due to new navigation initiating\n      // a new provisional page.\n      if (provisional && session.isDisposed())\n        return;\n      // Swallow initialization errors due to newer target swap in,\n      // since we will reinitialize again.\n      if (this._session === session)\n        throw e;\n    });\n  }\n\n  private async _initializeSessionMayThrow(session: WKSession, resourceTreeHandler: (r: Protocol.Page.getResourceTreeReturnValue) => void) {\n    const [, frameTree] = await Promise.all([\n      // Page agent must be enabled before Runtime.\n      session.send('Page.enable'),\n      session.send('Page.getResourceTree'),\n    ] as const);\n    resourceTreeHandler(frameTree);\n    const promises: Promise<any>[] = [\n      // Resource tree should be received before first execution context.\n      session.send('Runtime.enable'),\n      session.send('Runtime.addBinding', { name: PageBinding.kPlaywrightBinding }),\n      session.send('Page.createUserWorld', { name: UTILITY_WORLD_NAME }).catch(_ => {}),  // Worlds are per-process\n      session.send('Console.enable'),\n      session.send('Network.enable'),\n      this._workers.initializeSession(session)\n    ];\n    if (this._page.needsRequestInterception()) {\n      promises.push(session.send('Network.setInterceptionEnabled', { enabled: true }));\n      promises.push(session.send('Network.setResourceCachingDisabled', { disabled: true }));\n      promises.push(session.send('Network.addInterception', { url: '.*', stage: 'request', isRegex: true }));\n    }\n    if (this._page._browserContext.isSettingStorageState()) {\n      await Promise.all(promises);\n      return;\n    }\n\n    const contextOptions = this._browserContext._options;\n    if (contextOptions.userAgent)\n      promises.push(this.updateUserAgent());\n    const emulatedMedia = this._page.emulatedMedia();\n    if (emulatedMedia.media || emulatedMedia.colorScheme || emulatedMedia.reducedMotion || emulatedMedia.forcedColors)\n      promises.push(WKPage._setEmulateMedia(session, emulatedMedia.media, emulatedMedia.colorScheme, emulatedMedia.reducedMotion, emulatedMedia.forcedColors));\n    const bootstrapScript = this._calculateBootstrapScript();\n    if (bootstrapScript.length)\n      promises.push(session.send('Page.setBootstrapScript', { source: bootstrapScript }));\n    this._page.frames().map(frame => frame.evaluateExpression(bootstrapScript).catch(e => {}));\n    if (contextOptions.bypassCSP)\n      promises.push(session.send('Page.setBypassCSP', { enabled: true }));\n    const emulatedSize = this._page.emulatedSize();\n    if (emulatedSize) {\n      promises.push(session.send('Page.setScreenSizeOverride', {\n        width: emulatedSize.screen.width,\n        height: emulatedSize.screen.height,\n      }));\n    }\n    promises.push(this.updateEmulateMedia());\n    promises.push(session.send('Network.setExtraHTTPHeaders', { headers: headersArrayToObject(this._calculateExtraHTTPHeaders(), false /* lowerCase */) }));\n    if (contextOptions.offline)\n      promises.push(session.send('Network.setEmulateOfflineState', { offline: true }));\n    promises.push(session.send('Page.setTouchEmulationEnabled', { enabled: !!contextOptions.hasTouch }));\n    if (contextOptions.timezoneId) {\n      promises.push(session.send('Page.setTimeZone', { timeZone: contextOptions.timezoneId }).\n          catch(e => { throw new Error(`Invalid timezone ID: ${contextOptions.timezoneId}`); }));\n    }\n    if (this._page.fileChooserIntercepted())\n      promises.push(session.send('Page.setInterceptFileChooserDialog', { enabled: true }));\n    promises.push(session.send('Page.overrideSetting', { setting: 'DeviceOrientationEventEnabled', value: contextOptions.isMobile }));\n    promises.push(session.send('Page.overrideSetting', { setting: 'FullScreenEnabled', value: !contextOptions.isMobile }));\n    promises.push(session.send('Page.overrideSetting', { setting: 'NotificationsEnabled', value: !contextOptions.isMobile }));\n    promises.push(session.send('Page.overrideSetting', { setting: 'PointerLockEnabled', value: !contextOptions.isMobile }));\n    promises.push(session.send('Page.overrideSetting', { setting: 'InputTypeMonthEnabled', value: contextOptions.isMobile }));\n    promises.push(session.send('Page.overrideSetting', { setting: 'InputTypeWeekEnabled', value: contextOptions.isMobile }));\n    await Promise.all(promises);\n  }\n\n  private _onDidCommitProvisionalTarget(event: Protocol.Target.didCommitProvisionalTargetPayload) {\n    const { oldTargetId, newTargetId } = event;\n    assert(this._provisionalPage);\n    assert(this._provisionalPage._session.sessionId === newTargetId, 'Unknown new target: ' + newTargetId);\n    assert(this._session.sessionId === oldTargetId, 'Unknown old target: ' + oldTargetId);\n    const newSession = this._provisionalPage._session;\n    this._provisionalPage.commit();\n    this._provisionalPage.dispose();\n    this._provisionalPage = null;\n    this._setSession(newSession);\n  }\n\n  private _onTargetDestroyed(event: Protocol.Target.targetDestroyedPayload) {\n    const { targetId, crashed } = event;\n    if (this._provisionalPage && this._provisionalPage._session.sessionId === targetId) {\n      this._maybeCancelCoopNavigationRequest(this._provisionalPage);\n      this._provisionalPage._session.dispose();\n      this._provisionalPage.dispose();\n      this._provisionalPage = null;\n    } else if (this._session.sessionId === targetId) {\n      this._session.dispose();\n      eventsHelper.removeEventListeners(this._sessionListeners);\n      if (crashed) {\n        this._session.markAsCrashed();\n        this._page._didCrash();\n      }\n    }\n  }\n\n  didClose() {\n    this._pageProxySession.dispose();\n    eventsHelper.removeEventListeners(this._sessionListeners);\n    eventsHelper.removeEventListeners(this._eventListeners);\n    if (this._session)\n      this._session.dispose();\n    if (this._provisionalPage) {\n      this._provisionalPage._session.dispose();\n      this._provisionalPage.dispose();\n      this._provisionalPage = null;\n    }\n    this._firstNonInitialNavigationCommittedReject(new TargetClosedError());\n    this._page._didClose();\n  }\n\n  dispatchMessageToSession(message: any) {\n    this._pageProxySession.dispatchMessage(message);\n  }\n\n  handleProvisionalLoadFailed(event: Protocol.Playwright.provisionalLoadFailedPayload) {\n    if (!this._initializedPage) {\n      this._firstNonInitialNavigationCommittedReject(new Error('Initial load failed'));\n      return;\n    }\n    if (!this._provisionalPage)\n      return;\n    let errorText = event.error;\n    if (errorText.includes('cancelled'))\n      errorText += '; maybe frame was detached?';\n    this._page._frameManager.frameAbortedNavigation(this._page.mainFrame()._id, errorText, event.loaderId);\n  }\n\n  handleWindowOpen(event: Protocol.Playwright.windowOpenPayload) {\n    debugAssert(!this._nextWindowOpenPopupFeatures);\n    this._nextWindowOpenPopupFeatures = event.windowFeatures;\n  }\n\n  async pageOrError(): Promise<Page | Error> {\n    return this._pagePromise;\n  }\n\n  private async _onTargetCreated(event: Protocol.Target.targetCreatedPayload) {\n    const { targetInfo } = event;\n    const session = new WKSession(this._pageProxySession.connection, targetInfo.targetId, (message: any) => {\n      this._pageProxySession.send('Target.sendMessageToTarget', {\n        message: JSON.stringify(message), targetId: targetInfo.targetId\n      }).catch(e => {\n        session.dispatchMessage({ id: message.id, error: { message: e.message } });\n      });\n    });\n    assert(targetInfo.type === 'page', 'Only page targets are expected in WebKit, received: ' + targetInfo.type);\n\n    if (!targetInfo.isProvisional) {\n      assert(!this._initializedPage);\n      let pageOrError: Page | Error;\n      try {\n        this._setSession(session);\n        await Promise.all([\n          this._initializePageProxySession(),\n          this._initializeSession(session, false, ({ frameTree }) => this._handleFrameTree(frameTree)),\n        ]);\n        pageOrError = this._page;\n      } catch (e) {\n        pageOrError = e;\n      }\n      if (targetInfo.isPaused)\n        this._pageProxySession.sendMayFail('Target.resume', { targetId: targetInfo.targetId });\n      if ((pageOrError instanceof Page) && this._page.mainFrame().url() === '') {\n        try {\n          // Initial empty page has an empty url. We should wait until the first real url has been loaded,\n          // even if that url is about:blank. This is especially important for popups, where we need the\n          // actual url before interacting with it.\n          await this._firstNonInitialNavigationCommittedPromise;\n        } catch (e) {\n          pageOrError = e;\n        }\n      } else {\n        // Avoid rejection on disconnect.\n        this._firstNonInitialNavigationCommittedPromise.catch(() => {});\n      }\n      await this._page.initOpener(this._opener);\n      // Note: it is important to call |reportAsNew| before resolving pageOrError promise,\n      // so that anyone who awaits pageOrError got a ready and reported page.\n      this._initializedPage = pageOrError instanceof Page ? pageOrError : null;\n      this._page.reportAsNew(pageOrError instanceof Page ? undefined : pageOrError);\n      this._pagePromise.resolve(pageOrError);\n    } else {\n      assert(targetInfo.isProvisional);\n      assert(!this._provisionalPage);\n      this._provisionalPage = new WKProvisionalPage(session, this);\n      if (targetInfo.isPaused) {\n        this._provisionalPage.initializationPromise.then(() => {\n          this._pageProxySession.sendMayFail('Target.resume', { targetId: targetInfo.targetId });\n        });\n      }\n    }\n  }\n\n  private _onDispatchMessageFromTarget(event: Protocol.Target.dispatchMessageFromTargetPayload) {\n    const { targetId, message } = event;\n    if (this._provisionalPage && this._provisionalPage._session.sessionId === targetId)\n      this._provisionalPage._session.dispatchMessage(JSON.parse(message));\n    else if (this._session.sessionId === targetId)\n      this._session.dispatchMessage(JSON.parse(message));\n    else\n      throw new Error('Unknown target: ' + targetId);\n  }\n\n  private _addSessionListeners() {\n    this._sessionListeners = [\n      eventsHelper.addEventListener(this._session, 'Page.frameNavigated', event => this._onFrameNavigated(event.frame, false)),\n      eventsHelper.addEventListener(this._session, 'Page.navigatedWithinDocument', event => this._onFrameNavigatedWithinDocument(event.frameId, event.url)),\n      eventsHelper.addEventListener(this._session, 'Page.frameAttached', event => this._onFrameAttached(event.frameId, event.parentFrameId)),\n      eventsHelper.addEventListener(this._session, 'Page.frameDetached', event => this._onFrameDetached(event.frameId)),\n      eventsHelper.addEventListener(this._session, 'Page.willCheckNavigationPolicy', event => this._onWillCheckNavigationPolicy(event.frameId)),\n      eventsHelper.addEventListener(this._session, 'Page.didCheckNavigationPolicy', event => this._onDidCheckNavigationPolicy(event.frameId, event.cancel)),\n      eventsHelper.addEventListener(this._session, 'Page.frameScheduledNavigation', event => this._onFrameScheduledNavigation(event.frameId, event.delay, event.targetIsCurrentFrame)),\n      eventsHelper.addEventListener(this._session, 'Page.loadEventFired', event => this._page._frameManager.frameLifecycleEvent(event.frameId, 'load')),\n      eventsHelper.addEventListener(this._session, 'Page.domContentEventFired', event => this._page._frameManager.frameLifecycleEvent(event.frameId, 'domcontentloaded')),\n      eventsHelper.addEventListener(this._session, 'Runtime.executionContextCreated', event => this._onExecutionContextCreated(event.context)),\n      eventsHelper.addEventListener(this._session, 'Runtime.bindingCalled', event => this._onBindingCalled(event.contextId, event.argument)),\n      eventsHelper.addEventListener(this._session, 'Console.messageAdded', event => this._onConsoleMessage(event)),\n      eventsHelper.addEventListener(this._session, 'Console.messageRepeatCountUpdated', event => this._onConsoleRepeatCountUpdated(event)),\n      eventsHelper.addEventListener(this._pageProxySession, 'Dialog.javascriptDialogOpening', event => this._onDialog(event)),\n      eventsHelper.addEventListener(this._session, 'Page.fileChooserOpened', event => this._onFileChooserOpened(event)),\n      eventsHelper.addEventListener(this._session, 'Network.requestWillBeSent', e => this._onRequestWillBeSent(this._session, e)),\n      eventsHelper.addEventListener(this._session, 'Network.requestIntercepted', e => this._onRequestIntercepted(this._session, e)),\n      eventsHelper.addEventListener(this._session, 'Network.responseReceived', e => this._onResponseReceived(this._session, e)),\n      eventsHelper.addEventListener(this._session, 'Network.loadingFinished', e => this._onLoadingFinished(e)),\n      eventsHelper.addEventListener(this._session, 'Network.loadingFailed', e => this._onLoadingFailed(this._session, e)),\n      eventsHelper.addEventListener(this._session, 'Network.webSocketCreated', e => this._page._frameManager.onWebSocketCreated(e.requestId, e.url)),\n      eventsHelper.addEventListener(this._session, 'Network.webSocketWillSendHandshakeRequest', e => this._page._frameManager.onWebSocketRequest(e.requestId)),\n      eventsHelper.addEventListener(this._session, 'Network.webSocketHandshakeResponseReceived', e => this._page._frameManager.onWebSocketResponse(e.requestId, e.response.status, e.response.statusText)),\n      eventsHelper.addEventListener(this._session, 'Network.webSocketFrameSent', e => e.response.payloadData && this._page._frameManager.onWebSocketFrameSent(e.requestId, e.response.opcode, e.response.payloadData)),\n      eventsHelper.addEventListener(this._session, 'Network.webSocketFrameReceived', e => e.response.payloadData && this._page._frameManager.webSocketFrameReceived(e.requestId, e.response.opcode, e.response.payloadData)),\n      eventsHelper.addEventListener(this._session, 'Network.webSocketClosed', e => this._page._frameManager.webSocketClosed(e.requestId)),\n      eventsHelper.addEventListener(this._session, 'Network.webSocketFrameError', e => this._page._frameManager.webSocketError(e.requestId, e.errorMessage)),\n    ];\n  }\n  private async _updateState<T extends keyof Protocol.CommandParameters>(\n    method: T,\n    params?: Protocol.CommandParameters[T]\n  ): Promise<void> {\n    await this._forAllSessions(session => session.send(method, params).then());\n  }\n\n  private async _forAllSessions(callback: ((session: WKSession) => Promise<void>)): Promise<void> {\n    const sessions = [\n      this._session\n    ];\n    // If the state changes during provisional load, push it to the provisional page\n    // as well to always be in sync with the backend.\n    if (this._provisionalPage)\n      sessions.push(this._provisionalPage._session);\n    await Promise.all(sessions.map(session => callback(session).catch(e => {})));\n  }\n\n  private _onWillCheckNavigationPolicy(frameId: string) {\n    // It may happen that new policy check occurs while there is an ongoing\n    // provisional load, in this case it should be safe to ignore it as it will\n    // either:\n    // - end up canceled, e.g. ctrl+click opening link in new tab, having no effect\n    //   on this page\n    // - start new provisional load which we will miss in our signal trackers but\n    //   we certainly won't hang waiting for it to finish and there is high chance\n    //   that the current provisional page will commit navigation canceling the new\n    //   one.\n    if (this._provisionalPage)\n      return;\n    this._page._frameManager.frameRequestedNavigation(frameId);\n  }\n\n  private _onDidCheckNavigationPolicy(frameId: string, cancel?: boolean) {\n    if (!cancel)\n      return;\n    // This is a cross-process navigation that is canceled in the original page and continues in\n    // the provisional page. Bail out as we are tracking it.\n    if (this._provisionalPage)\n      return;\n    this._page._frameManager.frameAbortedNavigation(frameId, 'Navigation canceled by policy check');\n  }\n\n  private _onFrameScheduledNavigation(frameId: string, delay: number, targetIsCurrentFrame: boolean) {\n    if (targetIsCurrentFrame)\n      this._page._frameManager.frameRequestedNavigation(frameId);\n  }\n\n  private _handleFrameTree(frameTree: Protocol.Page.FrameResourceTree) {\n    this._onFrameAttached(frameTree.frame.id, frameTree.frame.parentId || null);\n    this._onFrameNavigated(frameTree.frame, true);\n    this._page._frameManager.frameLifecycleEvent(frameTree.frame.id, 'domcontentloaded');\n    this._page._frameManager.frameLifecycleEvent(frameTree.frame.id, 'load');\n\n    if (!frameTree.childFrames)\n      return;\n    for (const child of frameTree.childFrames)\n      this._handleFrameTree(child);\n  }\n\n  _onFrameAttached(frameId: string, parentFrameId: string | null): frames.Frame {\n    return this._page._frameManager.frameAttached(frameId, parentFrameId);\n  }\n\n  private _onFrameNavigated(framePayload: Protocol.Page.Frame, initial: boolean) {\n    const frame = this._page._frameManager.frame(framePayload.id);\n    assert(frame);\n    this._removeContextsForFrame(frame, true);\n    if (!framePayload.parentId)\n      this._workers.clear();\n    this._page._frameManager.frameCommittedNewDocumentNavigation(framePayload.id, framePayload.url, framePayload.name || '', framePayload.loaderId, initial);\n    if (!initial)\n      this._firstNonInitialNavigationCommittedFulfill();\n  }\n\n  private _onFrameNavigatedWithinDocument(frameId: string, url: string) {\n    this._page._frameManager.frameCommittedSameDocumentNavigation(frameId, url);\n  }\n\n  private _onFrameDetached(frameId: string) {\n    this._page._frameManager.frameDetached(frameId);\n  }\n\n  private _removeContextsForFrame(frame: frames.Frame, notifyFrame: boolean) {\n    for (const [contextId, context] of this._contextIdToContext) {\n      if (context.frame === frame) {\n        this._contextIdToContext.delete(contextId);\n        if (notifyFrame)\n          frame._contextDestroyed(context);\n      }\n    }\n  }\n\n  private _onExecutionContextCreated(contextPayload: Protocol.Runtime.ExecutionContextDescription) {\n    if (this._contextIdToContext.has(contextPayload.id))\n      return;\n    const frame = this._page._frameManager.frame(contextPayload.frameId);\n    if (!frame)\n      return;\n    const delegate = new WKExecutionContext(this._session, contextPayload.id);\n    let worldName: types.World;\n    if (contextPayload.type === 'normal')\n      worldName = 'main';\n    else if (contextPayload.type === 'user' && contextPayload.name === UTILITY_WORLD_NAME)\n      worldName = 'utility';\n    else\n      return;\n    const context = new dom.FrameExecutionContext(delegate, frame, worldName);\n    (context as any)[contextDelegateSymbol] = delegate;\n    frame._contextCreated(worldName, context);\n    this._contextIdToContext.set(contextPayload.id, context);\n  }\n\n  private async _onBindingCalled(contextId: Protocol.Runtime.ExecutionContextId, argument: string) {\n    const pageOrError = await this.pageOrError();\n    if (!(pageOrError instanceof Error)) {\n      const context = this._contextIdToContext.get(contextId);\n      if (context)\n        await this._page._onBindingCalled(argument, context);\n    }\n  }\n\n  async navigateFrame(frame: frames.Frame, url: string, referrer: string | undefined): Promise<frames.GotoResult> {\n    if (this._pageProxySession.isDisposed())\n      throw new TargetClosedError();\n    const pageProxyId = this._pageProxySession.sessionId;\n    const result = await this._pageProxySession.connection.browserSession.send('Playwright.navigate', { url, pageProxyId, frameId: frame._id, referrer });\n    return { newDocumentId: result.loaderId };\n  }\n\n  private _onConsoleMessage(event: Protocol.Console.messageAddedPayload) {\n    // Note: do no introduce await in this function, otherwise we lose the ordering.\n    // For example, frame.setContent relies on this.\n    const { type, level, text, parameters, url, line: lineNumber, column: columnNumber, source } = event.message;\n    if (level === 'error' && source === 'javascript') {\n      const { name, message } = splitErrorMessage(text);\n\n      let stack: string;\n      if (event.message.stackTrace) {\n        stack = text + '\\n' + event.message.stackTrace.callFrames.map(callFrame => {\n          return `    at ${callFrame.functionName || 'unknown'} (${callFrame.url}:${callFrame.lineNumber}:${callFrame.columnNumber})`;\n        }).join('\\n');\n      } else {\n        stack = '';\n      }\n\n      this._lastConsoleMessage = null;\n      const error = new Error(message);\n      error.stack = stack;\n      error.name = name;\n\n      this._page.emitOnContextOnceInitialized(BrowserContext.Events.PageError, error, this._page);\n      return;\n    }\n\n    let derivedType: string = type || '';\n    if (type === 'log')\n      derivedType = level;\n    else if (type === 'timing')\n      derivedType = 'timeEnd';\n\n    const handles: JSHandle[] = [];\n    for (const p of parameters || []) {\n      let context: dom.FrameExecutionContext | undefined;\n      if (p.objectId) {\n        const objectId = JSON.parse(p.objectId);\n        context = this._contextIdToContext.get(objectId.injectedScriptId);\n      } else {\n        // Pick any context if the parameter is a value.\n        context = [...this._contextIdToContext.values()].find(c => c.frame === this._page.mainFrame());\n      }\n      if (!context)\n        return;\n      handles.push(context.createHandle(p));\n    }\n    this._lastConsoleMessage = {\n      derivedType,\n      text,\n      handles,\n      count: 0,\n      location: {\n        url: url || '',\n        lineNumber: (lineNumber || 1) - 1,\n        columnNumber: (columnNumber || 1) - 1,\n      }\n    };\n    this._onConsoleRepeatCountUpdated({ count: 1 });\n  }\n\n  _onConsoleRepeatCountUpdated(event: Protocol.Console.messageRepeatCountUpdatedPayload) {\n    if (this._lastConsoleMessage) {\n      const {\n        derivedType,\n        text,\n        handles,\n        count,\n        location\n      } = this._lastConsoleMessage;\n      for (let i = count; i < event.count; ++i)\n        this._page._addConsoleMessage(derivedType, handles, location, handles.length ? undefined : text);\n      this._lastConsoleMessage.count = event.count;\n    }\n  }\n\n  _onDialog(event: Protocol.Dialog.javascriptDialogOpeningPayload) {\n    this._page.emitOnContext(BrowserContext.Events.Dialog, new dialog.Dialog(\n        this._page,\n        event.type as dialog.DialogType,\n        event.message,\n        async (accept: boolean, promptText?: string) => {\n          await this._pageProxySession.send('Dialog.handleJavaScriptDialog', { accept, promptText });\n        },\n        event.defaultPrompt));\n  }\n\n  private async _onFileChooserOpened(event: {frameId: Protocol.Network.FrameId, element: Protocol.Runtime.RemoteObject}) {\n    let handle;\n    try {\n      const context = await this._page._frameManager.frame(event.frameId)!._mainContext();\n      handle = context.createHandle(event.element).asElement()!;\n    } catch (e) {\n      // During async processing, frame/context may go away. We should not throw.\n      return;\n    }\n    await this._page._onFileChooserOpened(handle);\n  }\n\n  private static async _setEmulateMedia(session: WKSession, mediaType: types.MediaType, colorScheme: types.ColorScheme, reducedMotion: types.ReducedMotion, forcedColors: types.ForcedColors): Promise<void> {\n    const promises = [];\n    promises.push(session.send('Page.setEmulatedMedia', { media: mediaType === 'no-override' ? '' : mediaType }));\n    let appearance: any = undefined;\n    switch (colorScheme) {\n      case 'light': appearance = 'Light'; break;\n      case 'dark': appearance = 'Dark'; break;\n      case 'no-override': appearance = undefined; break;\n    }\n    promises.push(session.send('Page.overrideUserPreference', { name: 'PrefersColorScheme', value: appearance }));\n    let reducedMotionWk: any = undefined;\n    switch (reducedMotion) {\n      case 'reduce': reducedMotionWk = 'Reduce'; break;\n      case 'no-preference': reducedMotionWk = 'NoPreference'; break;\n      case 'no-override': reducedMotionWk = undefined; break;\n    }\n    promises.push(session.send('Page.overrideUserPreference', { name: 'PrefersReducedMotion', value: reducedMotionWk }));\n    let forcedColorsWk: any = undefined;\n    switch (forcedColors) {\n      case 'active': forcedColorsWk = 'Active'; break;\n      case 'none': forcedColorsWk = 'None'; break;\n      case 'no-override': forcedColorsWk = undefined; break;\n    }\n    promises.push(session.send('Page.setForcedColors', { forcedColors: forcedColorsWk }));\n    await Promise.all(promises);\n  }\n\n  async updateExtraHTTPHeaders(): Promise<void> {\n    await this._updateState('Network.setExtraHTTPHeaders', { headers: headersArrayToObject(this._calculateExtraHTTPHeaders(), false /* lowerCase */) });\n  }\n\n  _calculateExtraHTTPHeaders(): types.HeadersArray {\n    const locale = this._browserContext._options.locale;\n    const headers = network.mergeHeaders([\n      this._browserContext._options.extraHTTPHeaders,\n      this._page.extraHTTPHeaders(),\n      locale ? network.singleHeader('Accept-Language', locale) : undefined,\n    ]);\n    return headers;\n  }\n\n  async updateEmulateMedia(): Promise<void> {\n    const emulatedMedia = this._page.emulatedMedia();\n    const colorScheme = emulatedMedia.colorScheme;\n    const reducedMotion = emulatedMedia.reducedMotion;\n    const forcedColors = emulatedMedia.forcedColors;\n    await this._forAllSessions(session => WKPage._setEmulateMedia(session, emulatedMedia.media, colorScheme, reducedMotion, forcedColors));\n  }\n\n  async updateEmulatedViewportSize(): Promise<void> {\n    this._browserContext._validateEmulatedViewport(this._page.viewportSize());\n    await this._updateViewport();\n  }\n\n  async updateUserAgent(): Promise<void> {\n    const contextOptions = this._browserContext._options;\n    this._updateState('Page.overrideUserAgent', { value: contextOptions.userAgent });\n  }\n\n  async bringToFront(): Promise<void> {\n    this._pageProxySession.send('Target.activate', {\n      targetId: this._session.sessionId\n    });\n  }\n\n  async _updateViewport(): Promise<void> {\n    const options = this._browserContext._options;\n    const deviceSize = this._page.emulatedSize();\n    if (deviceSize === null)\n      return;\n    const viewportSize = deviceSize.viewport;\n    const screenSize = deviceSize.screen;\n    const promises: Promise<any>[] = [\n      this._pageProxySession.send('Emulation.setDeviceMetricsOverride', {\n        width: viewportSize.width,\n        height: viewportSize.height,\n        fixedLayout: !!options.isMobile,\n        deviceScaleFactor: options.deviceScaleFactor || 1\n      }),\n      this._session.send('Page.setScreenSizeOverride', {\n        width: screenSize.width,\n        height: screenSize.height,\n      }),\n    ];\n    if (options.isMobile) {\n      const angle = viewportSize.width > viewportSize.height ? 90 : 0;\n      // Special handling for macOS 12.\n      const useLegacySetOrientationOverrideMethod = os.platform() === 'darwin' && parseInt(os.release().split('.')[0], 10) <= 21;\n      if (useLegacySetOrientationOverrideMethod)\n        promises.push(this._session.send('Page.setOrientationOverride' as any, { angle }));\n      else\n        promises.push(this._pageProxySession.send('Emulation.setOrientationOverride', { angle }));\n    }\n    await Promise.all(promises);\n  }\n\n  async updateRequestInterception(): Promise<void> {\n    const enabled = this._page.needsRequestInterception();\n    await Promise.all([\n      this._updateState('Network.setInterceptionEnabled', { enabled }),\n      this._updateState('Network.setResourceCachingDisabled', { disabled: enabled }),\n      this._updateState('Network.addInterception', { url: '.*', stage: 'request', isRegex: true }),\n    ]);\n  }\n\n  async updateOffline() {\n    await this._updateState('Network.setEmulateOfflineState', { offline: !!this._browserContext._options.offline });\n  }\n\n  async updateHttpCredentials() {\n    const credentials = this._browserContext._options.httpCredentials || { username: '', password: '', origin: '' };\n    await this._pageProxySession.send('Emulation.setAuthCredentials', { username: credentials.username, password: credentials.password, origin: credentials.origin });\n  }\n\n  async updateFileChooserInterception() {\n    const enabled = this._page.fileChooserIntercepted();\n    await this._session.send('Page.setInterceptFileChooserDialog', { enabled }).catch(() => {}); // target can be closed.\n  }\n\n  async reload(): Promise<void> {\n    await this._session.send('Page.reload');\n  }\n\n  goBack(): Promise<boolean> {\n    return this._session.send('Page.goBack').then(() => true).catch(error => {\n      if (error instanceof Error && error.message.includes(`Protocol error (Page.goBack): Failed to go`))\n        return false;\n      throw error;\n    });\n  }\n\n  goForward(): Promise<boolean> {\n    return this._session.send('Page.goForward').then(() => true).catch(error => {\n      if (error instanceof Error && error.message.includes(`Protocol error (Page.goForward): Failed to go`))\n        return false;\n      throw error;\n    });\n  }\n\n  async addInitScript(initScript: InitScript): Promise<void> {\n    await this._updateBootstrapScript();\n  }\n\n  async removeNonInternalInitScripts() {\n    await this._updateBootstrapScript();\n  }\n\n  private _calculateBootstrapScript(): string {\n    const scripts: string[] = [];\n    if (!this._page.context()._options.isMobile) {\n      scripts.push('delete window.orientation');\n      scripts.push('delete window.ondevicemotion');\n      scripts.push('delete window.ondeviceorientation');\n    }\n    scripts.push('if (!window.safari) window.safari = { pushNotification: { toString() { return \"[object SafariRemoteNotification]\"; } } };');\n    scripts.push('if (!window.GestureEvent) window.GestureEvent = function GestureEvent() {};');\n    scripts.push(...this._page.allInitScripts().map(script => script.source));\n    return scripts.join(';\\n');\n  }\n\n  async _updateBootstrapScript(): Promise<void> {\n    await this._updateState('Page.setBootstrapScript', { source: this._calculateBootstrapScript() });\n  }\n\n  async closePage(runBeforeUnload: boolean): Promise<void> {\n    await this._stopVideo();\n    await this._pageProxySession.sendMayFail('Target.close', {\n      targetId: this._session.sessionId,\n      runBeforeUnload\n    });\n  }\n\n  async setBackgroundColor(color?: { r: number; g: number; b: number; a: number; }): Promise<void> {\n    await this._session.send('Page.setDefaultBackgroundColorOverride', { color });\n  }\n\n  private _toolbarHeight(): number {\n    if (this._page._browserContext._browser?.options.headful)\n      return hostPlatform === 'mac10.15' ? 55 : 59;\n    return 0;\n  }\n\n  private async _startVideo(options: types.PageScreencastOptions): Promise<void> {\n    assert(!this._recordingVideoFile);\n    const { screencastId } = await this._pageProxySession.send('Screencast.startVideo', {\n      file: options.outputFile,\n      width: options.width,\n      height: options.height,\n      toolbarHeight: this._toolbarHeight()\n    });\n    this._recordingVideoFile = options.outputFile;\n    this._browserContext._browser._videoStarted(this._browserContext, screencastId, options.outputFile, this.pageOrError());\n  }\n\n  async _stopVideo(): Promise<void> {\n    if (!this._recordingVideoFile)\n      return;\n    await this._pageProxySession.sendMayFail('Screencast.stopVideo');\n    this._recordingVideoFile = null;\n  }\n\n  private validateScreenshotDimension(side: number, omitDeviceScaleFactor: boolean) {\n    // Cairo based implementations (Linux and Windows) have hard limit of 32767\n    // (see https://github.com/microsoft/playwright/issues/16727).\n    if (process.platform === 'darwin')\n      return;\n    if (!omitDeviceScaleFactor && this._page._browserContext._options.deviceScaleFactor)\n      side = Math.ceil(side * this._page._browserContext._options.deviceScaleFactor);\n    if (side > 32767)\n      throw new Error('Cannot take screenshot larger than 32767 pixels on any dimension');\n  }\n\n  async takeScreenshot(progress: Progress, format: string, documentRect: types.Rect | undefined, viewportRect: types.Rect | undefined, quality: number | undefined, fitsViewport: boolean, scale: 'css' | 'device'): Promise<Buffer> {\n    const rect = (documentRect || viewportRect)!;\n    const omitDeviceScaleFactor = scale === 'css';\n    this.validateScreenshotDimension(rect.width, omitDeviceScaleFactor);\n    this.validateScreenshotDimension(rect.height, omitDeviceScaleFactor);\n    const result = await this._session.send('Page.snapshotRect', { ...rect, coordinateSystem: documentRect ? 'Page' : 'Viewport', omitDeviceScaleFactor });\n    const prefix = 'data:image/png;base64,';\n    let buffer = Buffer.from(result.dataURL.substr(prefix.length), 'base64');\n    if (format === 'jpeg')\n      buffer = jpegjs.encode(PNG.sync.read(buffer), quality).data;\n    return buffer;\n  }\n\n  async getContentFrame(handle: dom.ElementHandle): Promise<frames.Frame | null> {\n    const nodeInfo = await this._session.send('DOM.describeNode', {\n      objectId: handle._objectId\n    });\n    if (!nodeInfo.contentFrameId)\n      return null;\n    return this._page._frameManager.frame(nodeInfo.contentFrameId);\n  }\n\n  async getOwnerFrame(handle: dom.ElementHandle): Promise<string | null> {\n    if (!handle._objectId)\n      return null;\n    const nodeInfo = await this._session.send('DOM.describeNode', {\n      objectId: handle._objectId\n    });\n    return nodeInfo.ownerFrameId || null;\n  }\n\n  isElementHandle(remoteObject: any): boolean {\n    return (remoteObject as Protocol.Runtime.RemoteObject).subtype === 'node';\n  }\n\n  async getBoundingBox(handle: dom.ElementHandle): Promise<types.Rect | null> {\n    const quads = await this.getContentQuads(handle);\n    if (!quads || !quads.length)\n      return null;\n    let minX = Infinity;\n    let maxX = -Infinity;\n    let minY = Infinity;\n    let maxY = -Infinity;\n    for (const quad of quads) {\n      for (const point of quad) {\n        minX = Math.min(minX, point.x);\n        maxX = Math.max(maxX, point.x);\n        minY = Math.min(minY, point.y);\n        maxY = Math.max(maxY, point.y);\n      }\n    }\n    return { x: minX, y: minY, width: maxX - minX, height: maxY - minY };\n  }\n\n  async scrollRectIntoViewIfNeeded(handle: dom.ElementHandle, rect?: types.Rect): Promise<'error:notvisible' | 'error:notconnected' | 'done'> {\n    return await this._session.send('DOM.scrollIntoViewIfNeeded', {\n      objectId: handle._objectId,\n      rect,\n    }).then(() => 'done' as const).catch(e => {\n      if (e instanceof Error && e.message.includes('Node does not have a layout object'))\n        return 'error:notvisible';\n      if (e instanceof Error && e.message.includes('Node is detached from document'))\n        return 'error:notconnected';\n      throw e;\n    });\n  }\n\n  async setScreencastOptions(options: { width: number, height: number, quality: number } | null): Promise<void> {\n    if (options) {\n      const so = { ...options, toolbarHeight: this._toolbarHeight() };\n      const { generation } = await this._pageProxySession.send('Screencast.startScreencast', so);\n      this._screencastGeneration = generation;\n    } else {\n      await this._pageProxySession.send('Screencast.stopScreencast');\n    }\n  }\n\n  private _onScreencastFrame(event: Protocol.Screencast.screencastFramePayload) {\n    const generation = this._screencastGeneration;\n    this._page.throttleScreencastFrameAck(() => {\n      this._pageProxySession.send('Screencast.screencastFrameAck', { generation }).catch(e => debugLogger.log('error', e));\n    });\n    const buffer = Buffer.from(event.data, 'base64');\n    this._page.emit(Page.Events.ScreencastFrame, {\n      buffer,\n      width: event.deviceWidth,\n      height: event.deviceHeight,\n    });\n  }\n\n  rafCountForStablePosition(): number {\n    return process.platform === 'win32' ? 5 : 1;\n  }\n\n  async getContentQuads(handle: dom.ElementHandle): Promise<types.Quad[] | null> {\n    const result = await this._session.sendMayFail('DOM.getContentQuads', {\n      objectId: handle._objectId\n    });\n    if (!result)\n      return null;\n    return result.quads.map(quad => [\n      { x: quad[0], y: quad[1] },\n      { x: quad[2], y: quad[3] },\n      { x: quad[4], y: quad[5] },\n      { x: quad[6], y: quad[7] }\n    ]);\n  }\n\n  async setInputFiles(handle: dom.ElementHandle<HTMLInputElement>, files: types.FilePayload[]): Promise<void> {\n    const objectId = handle._objectId;\n    const protocolFiles = files.map(file => ({\n      name: file.name,\n      type: file.mimeType,\n      data: file.buffer,\n    }));\n    await this._session.send('DOM.setInputFiles', { objectId, files: protocolFiles });\n  }\n\n  async setInputFilePaths(handle: dom.ElementHandle<HTMLInputElement>, paths: string[]): Promise<void> {\n    const pageProxyId = this._pageProxySession.sessionId;\n    const objectId = handle._objectId;\n    await Promise.all([\n      this._pageProxySession.connection.browserSession.send('Playwright.grantFileReadAccess', { pageProxyId, paths }),\n      this._session.send('DOM.setInputFiles', { objectId, paths })\n    ]);\n  }\n\n  async adoptElementHandle<T extends Node>(handle: dom.ElementHandle<T>, to: dom.FrameExecutionContext): Promise<dom.ElementHandle<T>> {\n    const result = await this._session.sendMayFail('DOM.resolveNode', {\n      objectId: handle._objectId,\n      executionContextId: ((to as any)[contextDelegateSymbol] as WKExecutionContext)._contextId\n    });\n    if (!result || result.object.subtype === 'null')\n      throw new Error(dom.kUnableToAdoptErrorMessage);\n    return to.createHandle(result.object) as dom.ElementHandle<T>;\n  }\n\n  async getAccessibilityTree(needle?: dom.ElementHandle): Promise<{tree: accessibility.AXNode, needle: accessibility.AXNode | null}> {\n    return getAccessibilityTree(this._session, needle);\n  }\n\n  async inputActionEpilogue(): Promise<void> {\n  }\n\n  async resetForReuse(): Promise<void> {\n  }\n\n  async getFrameElement(frame: frames.Frame): Promise<dom.ElementHandle> {\n    const parent = frame.parentFrame();\n    if (!parent)\n      throw new Error('Frame has been detached.');\n    const context = await parent._mainContext();\n    const result = await this._session.send('DOM.resolveNode', {\n      frameId: frame._id,\n      executionContextId: ((context as any)[contextDelegateSymbol] as WKExecutionContext)._contextId\n    });\n    if (!result || result.object.subtype === 'null')\n      throw new Error('Frame has been detached.');\n    return context.createHandle(result.object) as dom.ElementHandle;\n  }\n\n  private _maybeCancelCoopNavigationRequest(provisionalPage: WKProvisionalPage) {\n    const navigationRequest = provisionalPage.coopNavigationRequest();\n    for (const [requestId, request] of this._requestIdToRequest) {\n      if (request.request === navigationRequest) {\n        // Make sure the request completes if the provisional navigation is canceled.\n        this._onLoadingFailed(provisionalPage._session, {\n          requestId: requestId,\n          errorText: 'Provisiolal navigation canceled.',\n          timestamp: request._timestamp,\n          canceled: true,\n        });\n        return;\n      }\n    }\n  }\n\n  _adoptRequestFromNewProcess(navigationRequest: network.Request, newSession: WKSession, newRequestId: string) {\n    for (const [requestId, request] of this._requestIdToRequest) {\n      if (request.request === navigationRequest) {\n        this._requestIdToRequest.delete(requestId);\n        request.adoptRequestFromNewProcess(newSession, newRequestId);\n        this._requestIdToRequest.set(newRequestId, request);\n        return;\n      }\n    }\n  }\n\n  _onRequestWillBeSent(session: WKSession, event: Protocol.Network.requestWillBeSentPayload) {\n    if (event.request.url.startsWith('data:'))\n      return;\n\n    // We do not support intercepting redirects.\n    if (this._page.needsRequestInterception() && !event.redirectResponse)\n      this._requestIdToRequestWillBeSentEvent.set(event.requestId, event);\n    else\n      this._onRequest(session, event, false);\n  }\n\n  private _onRequest(session: WKSession, event: Protocol.Network.requestWillBeSentPayload, intercepted: boolean) {\n    let redirectedFrom: WKInterceptableRequest | null = null;\n    if (event.redirectResponse) {\n      const request = this._requestIdToRequest.get(event.requestId);\n      // If we connect late to the target, we could have missed the requestWillBeSent event.\n      if (request) {\n        this._handleRequestRedirect(request, event.requestId, event.redirectResponse, event.timestamp);\n        redirectedFrom = request;\n      }\n    }\n    const frame = redirectedFrom ? redirectedFrom.request.frame() : this._page._frameManager.frame(event.frameId);\n    // sometimes we get stray network events for detached frames\n    // TODO(einbinder) why?\n    if (!frame)\n      return;\n\n    // TODO(einbinder) this will fail if we are an XHR document request\n    const isNavigationRequest = event.type === 'Document';\n    const documentId = isNavigationRequest ? event.loaderId : undefined;\n    const request = new WKInterceptableRequest(session, frame, event, redirectedFrom, documentId);\n    let route;\n    if (intercepted) {\n      route = new WKRouteImpl(session, event.requestId);\n      // There is no point in waiting for the raw headers in Network.responseReceived when intercepting.\n      // Use provisional headers as raw headers, so that client can call allHeaders() from the route handler.\n      request.request.setRawRequestHeaders(null);\n    }\n    this._requestIdToRequest.set(event.requestId, request);\n    this._page._frameManager.requestStarted(request.request, route);\n  }\n\n  private _handleRequestRedirect(request: WKInterceptableRequest, requestId: string, responsePayload: Protocol.Network.Response, timestamp: number) {\n    const response = request.createResponse(responsePayload);\n    response._securityDetailsFinished();\n    response._serverAddrFinished();\n    response.setResponseHeadersSize(null);\n    response.setEncodedBodySize(null);\n    response._requestFinished(responsePayload.timing ? helper.secondsToRoundishMillis(timestamp - request._timestamp) : -1);\n    this._requestIdToRequest.delete(requestId);\n    this._page._frameManager.requestReceivedResponse(response);\n    this._page._frameManager.reportRequestFinished(request.request, response);\n  }\n\n  _onRequestIntercepted(session: WKSession, event: Protocol.Network.requestInterceptedPayload) {\n    const requestWillBeSentEvent = this._requestIdToRequestWillBeSentEvent.get(event.requestId);\n    if (!requestWillBeSentEvent) {\n      // Intercepted, although we do not intend to allow interception.\n      // Just continue.\n      session.sendMayFail('Network.interceptWithRequest', { requestId: event.requestId });\n      return;\n    }\n    this._requestIdToRequestWillBeSentEvent.delete(event.requestId);\n    this._onRequest(session, requestWillBeSentEvent, true);\n  }\n\n  _onResponseReceived(session: WKSession, event: Protocol.Network.responseReceivedPayload) {\n    const requestWillBeSentEvent = this._requestIdToRequestWillBeSentEvent.get(event.requestId);\n    if (requestWillBeSentEvent) {\n      this._requestIdToRequestWillBeSentEvent.delete(event.requestId);\n      // We received a response, so the request won't be intercepted (e.g. it was handled by a\n      // service worker and we don't intercept service workers).\n      this._onRequest(session, requestWillBeSentEvent, false);\n    }\n    const request = this._requestIdToRequest.get(event.requestId);\n    // FileUpload sends a response without a matching request.\n    if (!request)\n      return;\n\n    this._requestIdToResponseReceivedPayloadEvent.set(event.requestId, event);\n    const response = request.createResponse(event.response);\n    this._page._frameManager.requestReceivedResponse(response);\n\n    if (response.status() === 204) {\n      this._onLoadingFailed(session, {\n        requestId: event.requestId,\n        errorText: 'Aborted: 204 No Content',\n        timestamp: event.timestamp\n      });\n    }\n  }\n\n  _onLoadingFinished(event: Protocol.Network.loadingFinishedPayload) {\n    const request = this._requestIdToRequest.get(event.requestId);\n    // For certain requestIds we never receive requestWillBeSent event.\n    // @see https://crbug.com/750469\n    if (!request)\n      return;\n\n    // Under certain conditions we never get the Network.responseReceived\n    // event from protocol. @see https://crbug.com/883475\n    const response = request.request._existingResponse();\n    if (response) {\n      const responseReceivedPayload = this._requestIdToResponseReceivedPayloadEvent.get(event.requestId);\n      response._serverAddrFinished(parseRemoteAddress(event?.metrics?.remoteAddress));\n      response._securityDetailsFinished({\n        protocol: isLoadedSecurely(response.url(), response.timing()) ? event.metrics?.securityConnection?.protocol : undefined,\n        subjectName: responseReceivedPayload?.response.security?.certificate?.subject,\n        validFrom: responseReceivedPayload?.response.security?.certificate?.validFrom,\n        validTo: responseReceivedPayload?.response.security?.certificate?.validUntil,\n      });\n      if (event.metrics?.protocol)\n        response._setHttpVersion(event.metrics.protocol);\n      response.setEncodedBodySize(event.metrics?.responseBodyBytesReceived ?? null);\n      response.setResponseHeadersSize(event.metrics?.responseHeaderBytesReceived ?? null);\n\n      response._requestFinished(helper.secondsToRoundishMillis(event.timestamp - request._timestamp));\n    } else {\n      // Use provisional headers if we didn't have the response with raw headers.\n      request.request.setRawRequestHeaders(null);\n    }\n\n    this._requestIdToResponseReceivedPayloadEvent.delete(event.requestId);\n    this._requestIdToRequest.delete(event.requestId);\n    this._page._frameManager.reportRequestFinished(request.request, response);\n  }\n\n  _onLoadingFailed(session: WKSession, event: Protocol.Network.loadingFailedPayload) {\n    const requestWillBeSentEvent = this._requestIdToRequestWillBeSentEvent.get(event.requestId);\n    if (requestWillBeSentEvent) {\n      this._requestIdToRequestWillBeSentEvent.delete(event.requestId);\n      // If loading failed, the request won't be intercepted (e.g. it was handled by a\n      // service worker and we don't intercept service workers).\n      this._onRequest(session, requestWillBeSentEvent, false);\n    }\n\n    const request = this._requestIdToRequest.get(event.requestId);\n    // For certain requestIds we never receive requestWillBeSent event.\n    // @see https://crbug.com/750469\n    if (!request)\n      return;\n\n    const response = request.request._existingResponse();\n    if (response) {\n      response._serverAddrFinished();\n      response._securityDetailsFinished();\n      response.setResponseHeadersSize(null);\n      response.setEncodedBodySize(null);\n      response._requestFinished(helper.secondsToRoundishMillis(event.timestamp - request._timestamp));\n    } else {\n      // Use provisional headers if we didn't have the response with raw headers.\n      request.request.setRawRequestHeaders(null);\n    }\n    this._requestIdToRequest.delete(event.requestId);\n    request.request._setFailureText(event.errorText);\n    this._page._frameManager.requestFailed(request.request, event.errorText.includes('cancelled'));\n  }\n\n  async _grantPermissions(origin: string, permissions: string[]) {\n    const webPermissionToProtocol = new Map<string, string>([\n      ['geolocation', 'geolocation'],\n      ['notifications', 'notifications'],\n      ['clipboard-read', 'clipboard-read'],\n    ]);\n    const filtered = permissions.map(permission => {\n      const protocolPermission = webPermissionToProtocol.get(permission);\n      if (!protocolPermission)\n        throw new Error('Unknown permission: ' + permission);\n      return protocolPermission;\n    });\n    await this._pageProxySession.send('Emulation.grantPermissions', { origin, permissions: filtered });\n  }\n\n  async _clearPermissions() {\n    await this._pageProxySession.send('Emulation.resetPermissions', {});\n  }\n\n  shouldToggleStyleSheetToSyncAnimations(): boolean {\n    return true;\n  }\n}\n\n/**\n * WebKit Remote Addresses look like:\n *\n * macOS:\n * ::1.8911\n * 2606:2800:220:1:248:1893:25c8:1946.443\n * 127.0.0.1:8000\n *\n * ubuntu:\n * ::1:8907\n * 127.0.0.1:8000\n *\n * NB: They look IPv4 and IPv6's with ports but use an alternative notation.\n */\nfunction parseRemoteAddress(value?: string) {\n  if (!value)\n    return;\n\n  try {\n    const colon = value.lastIndexOf(':');\n    const dot = value.lastIndexOf('.');\n    if (dot < 0) { // IPv6ish:port\n      return {\n        ipAddress: `[${value.slice(0, colon)}]`,\n        port: +value.slice(colon + 1)\n      };\n    }\n\n    if (colon > dot) { // IPv4:port\n      const [address, port] = value.split(':');\n      return {\n        ipAddress: address,\n        port: +port,\n      };\n    } else { // IPv6ish.port\n      const [address, port] = value.split('.');\n      return {\n        ipAddress: `[${address}]`,\n        port: +port,\n      };\n    }\n  } catch (_) {}\n}\n\n\n/**\n * Adapted from Source/WebInspectorUI/UserInterface/Models/Resource.js in\n * WebKit codebase.\n */\nfunction isLoadedSecurely(url: string, timing: network.ResourceTiming) {\n  try {\n    const u = new URL(url);\n    if (u.protocol !== 'https:' && u.protocol !== 'wss:' && u.protocol !== 'sftp:')\n      return false;\n    if (timing.secureConnectionStart === -1 && timing.connectStart !== -1)\n      return false;\n    return true;\n  } catch (_) {}\n}\n\nconst contextDelegateSymbol = Symbol('delegate');\n"],"mappings":"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"}