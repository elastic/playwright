{"version":3,"file":"language.js","names":["generateCode","actions","languageGenerator","options","header","generateHeader","footer","generateFooter","saveStorage","actionTexts","map","a","generateAction","filter","Boolean","text","join","sanitizeDeviceOptions","device","cleanedOptions","property","JSON","stringify","toSignalMap","action","popup","download","dialog","signal","signals","name","toKeyboardModifiers","modifiers","result","push","toClickOptions","button","length","clickCount","position"],"sources":["../../../src/server/codegen/language.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { BrowserContextOptions } from '../../..';\nimport type * as actions from '../recorder/recorderActions';\nimport type * as types from '../types';\nimport type { ActionInContext, LanguageGenerator, LanguageGeneratorOptions } from './types';\n\nexport function generateCode(actions: ActionInContext[], languageGenerator: LanguageGenerator, options: LanguageGeneratorOptions) {\n  const header = languageGenerator.generateHeader(options);\n  const footer = languageGenerator.generateFooter(options.saveStorage);\n  const actionTexts = actions.map(a => languageGenerator.generateAction(a)).filter(Boolean);\n  const text = [header, ...actionTexts, footer].join('\\n');\n  return { header, footer, actionTexts, text };\n}\n\nexport function sanitizeDeviceOptions(device: any, options: BrowserContextOptions): BrowserContextOptions {\n  // Filter out all the properties from the device descriptor.\n  const cleanedOptions: Record<string, any> = {};\n  for (const property in options) {\n    if (JSON.stringify(device[property]) !== JSON.stringify((options as any)[property]))\n      cleanedOptions[property] = (options as any)[property];\n  }\n  return cleanedOptions;\n}\n\nexport function toSignalMap(action: actions.Action) {\n  let popup: actions.PopupSignal | undefined;\n  let download: actions.DownloadSignal | undefined;\n  let dialog: actions.DialogSignal | undefined;\n  for (const signal of action.signals) {\n    if (signal.name === 'popup')\n      popup = signal;\n    else if (signal.name === 'download')\n      download = signal;\n    else if (signal.name === 'dialog')\n      dialog = signal;\n  }\n  return {\n    popup,\n    download,\n    dialog,\n  };\n}\n\nexport function toKeyboardModifiers(modifiers: number): types.SmartKeyboardModifier[] {\n  const result: types.SmartKeyboardModifier[] = [];\n  if (modifiers & 1)\n    result.push('Alt');\n  if (modifiers & 2)\n    result.push('ControlOrMeta');\n  if (modifiers & 4)\n    result.push('ControlOrMeta');\n  if (modifiers & 8)\n    result.push('Shift');\n  return result;\n}\n\nexport function toClickOptions(action: actions.ClickAction): types.MouseClickOptions {\n  const modifiers = toKeyboardModifiers(action.modifiers);\n  const options: types.MouseClickOptions = {};\n  if (action.button !== 'left')\n    options.button = action.button;\n  if (modifiers.length)\n    options.modifiers = modifiers;\n  if (action.clickCount > 2)\n    options.clickCount = action.clickCount;\n  if (action.position)\n    options.position = action.position;\n  return options;\n}\n"],"mappings":"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"}