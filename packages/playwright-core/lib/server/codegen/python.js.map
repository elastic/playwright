{"version":3,"file":"python.js","names":["_language","require","_utils","_deviceDescriptors","PythonLanguageGenerator","constructor","isAsync","isPyTest","id","groupName","name","highlighter","_awaitPrefix","_asyncPrefix","_isAsync","_isPyTest","generateAction","actionInContext","action","pageAlias","frame","formatter","PythonFormatter","add","url","quote","format","locators","framePath","map","selector","_asLocator","subject","join","signals","toSignalMap","dialog","code","_generateActionCall","popup","popupAlias","download","downloadAlias","Error","method","clickCount","options","toClickOptions","optionsString","formatOptions","text","formatValue","files","length","modifiers","toKeyboardModifiers","shortcut","key","substring","checked","assertion","value","asLocator","generateHeader","contextOptions","formatContextOptions","deviceName","fixture","browserName","launchOptions","generateFooter","saveStorage","storageStateLine","exports","undefined","Array","isArray","JSON","stringify","String","hasArguments","asDict","keys","Object","filter","sort","toSnakeCase","convertContextOptions","result","recordHar","path","content","mode","omitContent","urlFilter","device","deviceDescriptors","sanitizeDeviceOptions","offset","_baseIndent","_baseOffset","_lines","repeat","prepend","trim","split","line","concat","push","newLine","spaces","lines","forEach","endsWith","trimEnd","escapeWithQuotes"],"sources":["../../../src/server/codegen/python.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { BrowserContextOptions } from '../../../types/types';\nimport type { ActionInContext, Language, LanguageGenerator, LanguageGeneratorOptions } from './types';\nimport { sanitizeDeviceOptions, toSignalMap, toKeyboardModifiers, toClickOptions } from './language';\nimport { escapeWithQuotes, toSnakeCase, asLocator } from '../../utils';\nimport { deviceDescriptors } from '../deviceDescriptors';\n\nexport class PythonLanguageGenerator implements LanguageGenerator {\n  id: string;\n  groupName = 'Python';\n  name: string;\n  highlighter = 'python' as Language;\n\n  private _awaitPrefix: '' | 'await ';\n  private _asyncPrefix: '' | 'async ';\n  private _isAsync: boolean;\n  private _isPyTest: boolean;\n\n  constructor(isAsync: boolean, isPyTest: boolean) {\n    this.id = isPyTest ? 'python-pytest' : (isAsync ? 'python-async' : 'python');\n    this.name = isPyTest ? 'Pytest' : (isAsync ? 'Library Async' : 'Library');\n    this._isAsync = isAsync;\n    this._isPyTest = isPyTest;\n    this._awaitPrefix = isAsync ? 'await ' : '';\n    this._asyncPrefix = isAsync ? 'async ' : '';\n  }\n\n  generateAction(actionInContext: ActionInContext): string {\n    const action = actionInContext.action;\n    if (this._isPyTest && (action.name === 'openPage' || action.name === 'closePage'))\n      return '';\n\n    const pageAlias = actionInContext.frame.pageAlias;\n    const formatter = new PythonFormatter(4);\n\n    if (action.name === 'openPage') {\n      formatter.add(`${pageAlias} = ${this._awaitPrefix}context.new_page()`);\n      if (action.url && action.url !== 'about:blank' && action.url !== 'chrome://newtab/')\n        formatter.add(`${this._awaitPrefix}${pageAlias}.goto(${quote(action.url)})`);\n      return formatter.format();\n    }\n\n    const locators = actionInContext.frame.framePath.map(selector => `.${this._asLocator(selector)}.content_frame()`);\n    const subject = `${pageAlias}${locators.join('')}`;\n    const signals = toSignalMap(action);\n\n    if (signals.dialog)\n      formatter.add(`  ${pageAlias}.once(\"dialog\", lambda dialog: dialog.dismiss())`);\n\n    let code = `${this._awaitPrefix}${this._generateActionCall(subject, actionInContext)}`;\n\n    if (signals.popup) {\n      code = `${this._asyncPrefix}with ${pageAlias}.expect_popup() as ${signals.popup.popupAlias}_info {\n        ${code}\n      }\n      ${signals.popup.popupAlias} = ${this._awaitPrefix}${signals.popup.popupAlias}_info.value`;\n    }\n\n    if (signals.download) {\n      code = `${this._asyncPrefix}with ${pageAlias}.expect_download() as download${signals.download.downloadAlias}_info {\n        ${code}\n      }\n      download${signals.download.downloadAlias} = ${this._awaitPrefix}download${signals.download.downloadAlias}_info.value`;\n    }\n\n    formatter.add(code);\n\n    return formatter.format();\n  }\n\n  private _generateActionCall(subject: string, actionInContext: ActionInContext): string {\n    const action = actionInContext.action;\n    switch (action.name) {\n      case 'openPage':\n        throw Error('Not reached');\n      case 'closePage':\n        return `${subject}.close()`;\n      case 'click': {\n        let method = 'click';\n        if (action.clickCount === 2)\n          method = 'dblclick';\n        const options = toClickOptions(action);\n        const optionsString = formatOptions(options, false);\n        return `${subject}.${this._asLocator(action.selector)}.${method}(${optionsString})`;\n      }\n      case 'check':\n        return `${subject}.${this._asLocator(action.selector)}.check()`;\n      case 'uncheck':\n        return `${subject}.${this._asLocator(action.selector)}.uncheck()`;\n      case 'fill':\n        return `${subject}.${this._asLocator(action.selector)}.fill(${quote(action.text)})`;\n      case 'setInputFiles':\n        return `${subject}.${this._asLocator(action.selector)}.set_input_files(${formatValue(action.files.length === 1 ? action.files[0] : action.files)})`;\n      case 'press': {\n        const modifiers = toKeyboardModifiers(action.modifiers);\n        const shortcut = [...modifiers, action.key].join('+');\n        return `${subject}.${this._asLocator(action.selector)}.press(${quote(shortcut)})`;\n      }\n      case 'navigate':\n        return `${subject}.goto(${quote(action.url)})`;\n      case 'select':\n        return `${subject}.${this._asLocator(action.selector)}.select_option(${formatValue(action.options.length === 1 ? action.options[0] : action.options)})`;\n      case 'assertText':\n        return `expect(${subject}.${this._asLocator(action.selector)}).${action.substring ? 'to_contain_text' : 'to_have_text'}(${quote(action.text)})`;\n      case 'assertChecked':\n        return `expect(${subject}.${this._asLocator(action.selector)}).${action.checked ? 'to_be_checked()' : 'not_to_be_checked()'}`;\n      case 'assertVisible':\n        return `expect(${subject}.${this._asLocator(action.selector)}).to_be_visible()`;\n      case 'assertValue': {\n        const assertion = action.value ? `to_have_value(${quote(action.value)})` : `to_be_empty()`;\n        return `expect(${subject}.${this._asLocator(action.selector)}).${assertion};`;\n      }\n    }\n  }\n\n  private _asLocator(selector: string) {\n    return asLocator('python', selector);\n  }\n\n  generateHeader(options: LanguageGeneratorOptions): string {\n    const formatter = new PythonFormatter();\n    if (this._isPyTest) {\n      const contextOptions = formatContextOptions(options.contextOptions, options.deviceName, true /* asDict */);\n      const fixture = contextOptions ? `\n\n@pytest.fixture(scope=\"session\")\ndef browser_context_args(browser_context_args, playwright) {\n    return {${contextOptions}}\n}\n` : '';\n      formatter.add(`${options.deviceName ? 'import pytest\\n' : ''}import re\nfrom playwright.sync_api import Page, expect\n${fixture}\n\ndef test_example(page: Page) -> None {`);\n    } else if (this._isAsync) {\n      formatter.add(`\nimport asyncio\nimport re\nfrom playwright.async_api import Playwright, async_playwright, expect\n\n\nasync def run(playwright: Playwright) -> None {\n    browser = await playwright.${options.browserName}.launch(${formatOptions(options.launchOptions, false)})\n    context = await browser.new_context(${formatContextOptions(options.contextOptions, options.deviceName)})`);\n    } else {\n      formatter.add(`\nimport re\nfrom playwright.sync_api import Playwright, sync_playwright, expect\n\n\ndef run(playwright: Playwright) -> None {\n    browser = playwright.${options.browserName}.launch(${formatOptions(options.launchOptions, false)})\n    context = browser.new_context(${formatContextOptions(options.contextOptions, options.deviceName)})`);\n    }\n    return formatter.format();\n  }\n\n  generateFooter(saveStorage: string | undefined): string {\n    if (this._isPyTest) {\n      return '';\n    } else if (this._isAsync) {\n      const storageStateLine = saveStorage ? `\\n    await context.storage_state(path=${quote(saveStorage)})` : '';\n      return `\\n    # ---------------------${storageStateLine}\n    await context.close()\n    await browser.close()\n\n\nasync def main() -> None:\n    async with async_playwright() as playwright:\n        await run(playwright)\n\n\nasyncio.run(main())\n`;\n    } else {\n      const storageStateLine = saveStorage ? `\\n    context.storage_state(path=${quote(saveStorage)})` : '';\n      return `\\n    # ---------------------${storageStateLine}\n    context.close()\n    browser.close()\n\n\nwith sync_playwright() as playwright:\n    run(playwright)\n`;\n    }\n  }\n}\n\nfunction formatValue(value: any): string {\n  if (value === false)\n    return 'False';\n  if (value === true)\n    return 'True';\n  if (value === undefined)\n    return 'None';\n  if (Array.isArray(value))\n    return `[${value.map(formatValue).join(', ')}]`;\n  if (typeof value === 'string')\n    return quote(value);\n  if (typeof value === 'object')\n    return JSON.stringify(value);\n  return String(value);\n}\n\nfunction formatOptions(value: any, hasArguments: boolean, asDict?: boolean): string {\n  const keys = Object.keys(value).filter(key => value[key] !== undefined).sort();\n  if (!keys.length)\n    return '';\n  return (hasArguments ? ', ' : '') + keys.map(key => {\n    if (asDict)\n      return `\"${toSnakeCase(key)}\": ${formatValue(value[key])}`;\n    return `${toSnakeCase(key)}=${formatValue(value[key])}`;\n  }).join(', ');\n}\n\nfunction convertContextOptions(options: BrowserContextOptions): any {\n  const result: any = { ...options };\n  if (options.recordHar) {\n    result['record_har_path'] = options.recordHar.path;\n    result['record_har_content'] = options.recordHar.content;\n    result['record_har_mode'] = options.recordHar.mode;\n    result['record_har_omit_content'] = options.recordHar.omitContent;\n    result['record_har_url_filter'] = options.recordHar.urlFilter;\n    delete result.recordHar;\n  }\n  return result;\n}\n\nfunction formatContextOptions(options: BrowserContextOptions, deviceName: string | undefined, asDict?: boolean): string {\n  const device = deviceName && deviceDescriptors[deviceName];\n  if (!device)\n    return formatOptions(convertContextOptions(options), false, asDict);\n  return `**playwright.devices[${quote(deviceName!)}]` + formatOptions(convertContextOptions(sanitizeDeviceOptions(device, options)), true, asDict);\n}\n\nclass PythonFormatter {\n  private _baseIndent: string;\n  private _baseOffset: string;\n  private _lines: string[] = [];\n\n  constructor(offset = 0) {\n    this._baseIndent = ' '.repeat(4);\n    this._baseOffset = ' '.repeat(offset);\n  }\n\n  prepend(text: string) {\n    this._lines = text.trim().split('\\n').map(line => line.trim()).concat(this._lines);\n  }\n\n  add(text: string) {\n    this._lines.push(...text.trim().split('\\n').map(line => line.trim()));\n  }\n\n  newLine() {\n    this._lines.push('');\n  }\n\n  format(): string {\n    let spaces = '';\n    const lines: string[] = [];\n    this._lines.forEach((line: string) => {\n      if (line === '')\n        return lines.push(line);\n      if (line === '}') {\n        spaces = spaces.substring(this._baseIndent.length);\n        return;\n      }\n\n      line = spaces  + line;\n      if (line.endsWith('{')) {\n        spaces += this._baseIndent;\n        line = line.substring(0, line.length - 1).trimEnd() + ':';\n      }\n      return lines.push(this._baseOffset + line);\n    });\n    return lines.join('\\n');\n  }\n}\n\nfunction quote(text: string) {\n  return escapeWithQuotes(text, '\\\"');\n}\n"],"mappings":"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"}