{"version":3,"file":"page.js","names":["frames","_interopRequireWildcard","require","input","js","_screenshotter","_timeoutSettings","_browserContext","_console","accessibility","_fileChooser","_progress","_utils","_manualPromise","_debugLogger","_comparators","_instrumentation","_selectorParser","_utilityScriptSerializers","_errors","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","Page","SdkObject","constructor","delegate","browserContext","_closedState","_closedPromise","ManualPromise","_initialized","_eventsToEmitAfterInitialized","_crashed","openScope","LongStandingScope","keyboard","mouse","touchscreen","_delegate","_emulatedSize","_extraHTTPHeaders","_emulatedMedia","_interceptFileChooser","_pageBindings","Map","initScripts","_frameManager","_workers","pdf","coverage","_clientRequestInterceptor","_serverRequestInterceptor","_ownedContext","_pageIsError","_video","_opener","_isServerSideOnly","_locatorHandlers","_lastLocatorHandlerUid","_locatorHandlerRunningCounter","_frameThrottler","FrameThrottler","_closeReason","attribution","page","Accessibility","getAccessibilityTree","bind","Keyboard","rawKeyboard","Mouse","rawMouse","Touchscreen","rawTouchscreen","TimeoutSettings","Screenshotter","FrameManager","initOpener","opener","openerPage","pageOrError","isClosed","reportAsNew","error","undefined","contextEvent","BrowserContext","Events","isClosingOrClosed","_setIsError","emitOnContext","event","args","emit","Close","instrumentation","onPageOpen","initializedOrUndefined","emitOnContextOnceInitialized","push","resetForReuse","metadata","setDefaultNavigationTimeout","setDefaultTimeout","clear","_removeExposedBindings","_removeInitScripts","setClientRequestInterceptor","_setServerRequestInterceptor","setFileChooserIntercepted","mainFrame","goto","Promise","all","updateEmulatedViewportSize","updateEmulateMedia","updateFileChooserInterception","_didClose","dispose","assert","resolve","onPageClose","close","TargetClosedError","_didCrash","Crash","Error","_onFileChooserOpened","handle","multiple","evaluate","element","listenerCount","FileChooser","fileChooser","context","timeout","exposeBinding","name","needsHandle","playwrightBinding","binding","PageBinding","addInitScript","initScript","map","frame","evaluateExpression","source","catch","key","internal","delete","setExtraHTTPHeaders","headers","updateExtraHTTPHeaders","extraHTTPHeaders","_onBindingCalled","payload","dispatch","_addConsoleMessage","type","location","text","message","ConsoleMessage","intercepted","interceptConsoleMessage","forEach","arg","Console","reload","options","controller","ProgressController","run","progress","raceNavigationAction","response","_waitForNavigation","navigationTimeout","goBack","waitPromise","result","goForward","registerLocatorHandler","selector","noWaitAfter","uid","resolveLocatorHandler","remove","handler","_handler$resolved","resolved","unregisterLocatorHandler","performLocatorHandlersCheckpoint","isVisibleInternal","strict","LocatorHandlerTriggered","log","asLocator","playwright","sdkLanguage","promise","then","throwIfAborted","waitForSelectorInternal","state","race","finally","emulateMedia","media","colorScheme","reducedMotion","forcedColors","emulatedMedia","_contextOptions$color","_contextOptions$reduc","_contextOptions$force","contextOptions","_options","setViewportSize","viewportSize","viewport","screen","_this$emulatedSize","emulatedSize","bringToFront","InitScript","filter","script","removeNonInternalInitScripts","needsRequestInterception","_requestInterceptor","updateRequestInterception","expectScreenshot","locator","rafrafScreenshot","rafrafTimeoutScreenshotElementWithProgress","rafrafTimeout","screenshotPage","comparator","getComparator","expected","isNot","errorMessage","format","validateScreenshotOptions","intermediateResult","areEqualScreenshots","actual","previous","comparatorResult","diff","callTimeout","pollIntervals","apiName","isFirstIteration","_pollIntervals$shift","screenshotTimeout","shift","expectation","isJavaScriptErrorInEvaluate","isInvalidSelectorError","screenshot","reason","runBeforeUnload","closePage","debugLogger","createDummyMainFrameIfNeeded","hasCrashed","isClosedOrClosingOrCrashed","_addWorker","workerId","worker","Worker","_removeWorker","didClose","_clearWorkers","enabled","fileChooserIntercepted","frameNavigatedToNewDocument","InternalFrameNavigatedToNewDocument","origin","addVisitedOrigin","allInitScripts","bindings","values","getBinding","setScreencastOptions","setThrottlingEnabled","throttleScreencastFrameAck","ack","temporarilyDisableTracingScreencastThrottling","recharge","safeNonStallingEvaluateInAllFrames","expression","world","nonStallingEvaluateInExistingContext","throwOnJSErrors","hideHighlight","markAsServerSideOnly","exports","Download","FrameAttached","FrameDetached","ScreencastFrame","Video","WebSocket","parent","url","_url","_executionContextPromise","_executionContextCallback","_existingExecutionContext","x","_createExecutionContext","ExecutionContext","contextDestroyed","isFunction","returnByValue","evaluateExpressionHandle","playwrightFunction","addPageBinding","toString","JSON","stringify","kPlaywrightBinding","startsWith","seq","serializedArgs","parse","evaluateHandle","takeHandle","parseEvaluationResultValue","deliverResult","globalThis","callbacks","reject","bindingName","utilityScriptSerializers","me","slice","some","length","handles","serializeAsCallArgument","v","fallThrough","__installed","guid","createGuid","nonThrottledFrames","defaultInterval","throttlingInterval","_acks","_defaultInterval","_throttlingInterval","_nonThrottledFrames","_budget","_throttlingEnabled","_timeoutId","_tick","clearTimeout","setTimeout"],"sources":["../../src/server/page.ts"],"sourcesContent":["/**\n * Copyright 2017 Google Inc. All rights reserved.\n * Modifications copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type * as dom from './dom';\nimport * as frames from './frames';\nimport * as input from './input';\nimport * as js from './javascript';\nimport type * as network from './network';\nimport type * as channels from '@protocol/channels';\nimport type { ScreenshotOptions } from './screenshotter';\nimport { Screenshotter, validateScreenshotOptions } from './screenshotter';\nimport { TimeoutSettings } from '../common/timeoutSettings';\nimport type * as types from './types';\nimport { BrowserContext } from './browserContext';\nimport { ConsoleMessage } from './console';\nimport * as accessibility from './accessibility';\nimport { FileChooser } from './fileChooser';\nimport type { Progress } from './progress';\nimport { ProgressController } from './progress';\nimport { LongStandingScope, assert, createGuid } from '../utils';\nimport { ManualPromise } from '../utils/manualPromise';\nimport { debugLogger } from '../utils/debugLogger';\nimport type { ImageComparatorOptions } from '../utils/comparators';\nimport { getComparator } from '../utils/comparators';\nimport type { CallMetadata } from './instrumentation';\nimport { SdkObject } from './instrumentation';\nimport type { Artifact } from './artifact';\nimport type { TimeoutOptions } from '../common/types';\nimport { isInvalidSelectorError } from '../utils/isomorphic/selectorParser';\nimport { parseEvaluationResultValue, source } from './isomorphic/utilityScriptSerializers';\nimport type { SerializedValue } from './isomorphic/utilityScriptSerializers';\nimport { TargetClosedError } from './errors';\nimport { asLocator } from '../utils';\n\nexport interface PageDelegate {\n  readonly rawMouse: input.RawMouse;\n  readonly rawKeyboard: input.RawKeyboard;\n  readonly rawTouchscreen: input.RawTouchscreen;\n\n  reload(): Promise<void>;\n  goBack(): Promise<boolean>;\n  goForward(): Promise<boolean>;\n  addInitScript(initScript: InitScript): Promise<void>;\n  removeNonInternalInitScripts(): Promise<void>;\n  closePage(runBeforeUnload: boolean): Promise<void>;\n  potentiallyUninitializedPage(): Page;\n  pageOrError(): Promise<Page | Error>;\n\n  navigateFrame(frame: frames.Frame, url: string, referrer: string | undefined): Promise<frames.GotoResult>;\n\n  updateExtraHTTPHeaders(): Promise<void>;\n  updateEmulatedViewportSize(preserveWindowBoundaries?: boolean): Promise<void>;\n  updateEmulateMedia(): Promise<void>;\n  updateRequestInterception(): Promise<void>;\n  updateFileChooserInterception(): Promise<void>;\n  bringToFront(): Promise<void>;\n\n  setBackgroundColor(color?: { r: number; g: number; b: number; a: number; }): Promise<void>;\n  takeScreenshot(progress: Progress, format: string, documentRect: types.Rect | undefined, viewportRect: types.Rect | undefined, quality: number | undefined, fitsViewport: boolean, scale: 'css' | 'device'): Promise<Buffer>;\n\n  isElementHandle(remoteObject: any): boolean;\n  adoptElementHandle<T extends Node>(handle: dom.ElementHandle<T>, to: dom.FrameExecutionContext): Promise<dom.ElementHandle<T>>;\n  getContentFrame(handle: dom.ElementHandle): Promise<frames.Frame | null>;  // Only called for frame owner elements.\n  getOwnerFrame(handle: dom.ElementHandle): Promise<string | null>; // Returns frameId.\n  getContentQuads(handle: dom.ElementHandle): Promise<types.Quad[] | null | 'error:notconnected'>;\n  setInputFiles(handle: dom.ElementHandle<HTMLInputElement>, files: types.FilePayload[]): Promise<void>;\n  setInputFilePaths(handle: dom.ElementHandle<HTMLInputElement>, files: string[]): Promise<void>;\n  getBoundingBox(handle: dom.ElementHandle): Promise<types.Rect | null>;\n  getFrameElement(frame: frames.Frame): Promise<dom.ElementHandle>;\n  scrollRectIntoViewIfNeeded(handle: dom.ElementHandle, rect?: types.Rect): Promise<'error:notvisible' | 'error:notconnected' | 'done'>;\n  setScreencastOptions(options: { width: number, height: number, quality: number } | null): Promise<void>;\n\n  getAccessibilityTree(needle?: dom.ElementHandle): Promise<{tree: accessibility.AXNode, needle: accessibility.AXNode | null}>;\n  pdf?: (options: channels.PagePdfParams) => Promise<Buffer>;\n  coverage?: () => any;\n\n  // Work around WebKit's raf issues on Windows.\n  rafCountForStablePosition(): number;\n  // Work around Chrome's non-associated input and protocol.\n  inputActionEpilogue(): Promise<void>;\n  // Work around for asynchronously dispatched CSP errors in Firefox.\n  readonly cspErrorsAsynchronousForInlineScripts?: boolean;\n  // Work around for mouse position in Firefox.\n  resetForReuse(): Promise<void>;\n  // WebKit hack.\n  shouldToggleStyleSheetToSyncAnimations(): boolean;\n  // Bidi throws on attempt to document.open() in utility context.\n  useMainWorldForSetContent?(): boolean;\n}\n\ntype EmulatedSize = { screen: types.Size, viewport: types.Size };\n\ntype EmulatedMedia = {\n  media: types.MediaType;\n  colorScheme: types.ColorScheme;\n  reducedMotion: types.ReducedMotion;\n  forcedColors: types.ForcedColors;\n};\n\ntype ExpectScreenshotOptions = ImageComparatorOptions & ScreenshotOptions & {\n  timeout?: number,\n  expected?: Buffer,\n  isNot?: boolean,\n  locator?: {\n    frame: frames.Frame,\n    selector: string,\n  },\n};\n\nexport class Page extends SdkObject {\n  static Events = {\n    Close: 'close',\n    Crash: 'crash',\n    Download: 'download',\n    FileChooser: 'filechooser',\n    FrameAttached: 'frameattached',\n    FrameDetached: 'framedetached',\n    InternalFrameNavigatedToNewDocument: 'internalframenavigatedtonewdocument',\n    LocatorHandlerTriggered: 'locatorhandlertriggered',\n    ScreencastFrame: 'screencastframe',\n    Video: 'video',\n    WebSocket: 'websocket',\n    Worker: 'worker',\n  };\n\n  private _closedState: 'open' | 'closing' | 'closed' = 'open';\n  private _closedPromise = new ManualPromise<void>();\n  private _initialized = false;\n  private _eventsToEmitAfterInitialized: { event: string | symbol, args: any[] }[] = [];\n  private _crashed = false;\n  readonly openScope = new LongStandingScope();\n  readonly _browserContext: BrowserContext;\n  readonly keyboard: input.Keyboard;\n  readonly mouse: input.Mouse;\n  readonly touchscreen: input.Touchscreen;\n  readonly _timeoutSettings: TimeoutSettings;\n  readonly _delegate: PageDelegate;\n  _emulatedSize: EmulatedSize | undefined;\n  private _extraHTTPHeaders: types.HeadersArray | undefined;\n  private _emulatedMedia: Partial<EmulatedMedia> = {};\n  private _interceptFileChooser = false;\n  private readonly _pageBindings = new Map<string, PageBinding>();\n  initScripts: InitScript[] = [];\n  readonly _screenshotter: Screenshotter;\n  readonly _frameManager: frames.FrameManager;\n  readonly accessibility: accessibility.Accessibility;\n  private _workers = new Map<string, Worker>();\n  readonly pdf: ((options: channels.PagePdfParams) => Promise<Buffer>) | undefined;\n  readonly coverage: any;\n  _clientRequestInterceptor: network.RouteHandler | undefined;\n  _serverRequestInterceptor: network.RouteHandler | undefined;\n  _ownedContext: BrowserContext | undefined;\n  _pageIsError: Error | undefined;\n  _video: Artifact | null = null;\n  _opener: Page | undefined;\n  private _isServerSideOnly = false;\n  private _locatorHandlers = new Map<number, { selector: string, noWaitAfter?: boolean, resolved?: ManualPromise<void> }>();\n  private _lastLocatorHandlerUid = 0;\n  private _locatorHandlerRunningCounter = 0;\n\n  // Aiming at 25 fps by default - each frame is 40ms, but we give some slack with 35ms.\n  // When throttling for tracing, 200ms between frames, except for 10 frames around the action.\n  private _frameThrottler = new FrameThrottler(10, 35, 200);\n  _closeReason: string | undefined;\n\n  constructor(delegate: PageDelegate, browserContext: BrowserContext) {\n    super(browserContext, 'page');\n    this.attribution.page = this;\n    this._delegate = delegate;\n    this._browserContext = browserContext;\n    this.accessibility = new accessibility.Accessibility(delegate.getAccessibilityTree.bind(delegate));\n    this.keyboard = new input.Keyboard(delegate.rawKeyboard);\n    this.mouse = new input.Mouse(delegate.rawMouse, this);\n    this.touchscreen = new input.Touchscreen(delegate.rawTouchscreen, this);\n    this._timeoutSettings = new TimeoutSettings(browserContext._timeoutSettings);\n    this._screenshotter = new Screenshotter(this);\n    this._frameManager = new frames.FrameManager(this);\n    if (delegate.pdf)\n      this.pdf = delegate.pdf.bind(delegate);\n    this.coverage = delegate.coverage ? delegate.coverage() : null;\n  }\n\n  async initOpener(opener: PageDelegate | null) {\n    if (!opener)\n      return;\n    const openerPage = await opener.pageOrError();\n    if (openerPage instanceof Page && !openerPage.isClosed())\n      this._opener = openerPage;\n  }\n\n  reportAsNew(error: Error | undefined = undefined, contextEvent: string = BrowserContext.Events.Page) {\n    if (error) {\n      // Initialization error could have happened because of\n      // context/browser closure. Just ignore the page.\n      if (this._browserContext.isClosingOrClosed())\n        return;\n      this._setIsError(error);\n    }\n    this._initialized = true;\n    this.emitOnContext(contextEvent, this);\n\n    for (const { event, args } of this._eventsToEmitAfterInitialized)\n      this._browserContext.emit(event, ...args);\n    this._eventsToEmitAfterInitialized = [];\n\n    // It may happen that page initialization finishes after Close event has already been sent,\n    // in that case we fire another Close event to ensure that each reported Page will have\n    // corresponding Close event after it is reported on the context.\n    if (this.isClosed())\n      this.emit(Page.Events.Close);\n    else\n      this.instrumentation.onPageOpen(this);\n  }\n\n  initializedOrUndefined() {\n    return this._initialized ? this : undefined;\n  }\n\n  emitOnContext(event: string | symbol, ...args: any[]) {\n    if (this._isServerSideOnly)\n      return;\n    this._browserContext.emit(event, ...args);\n  }\n\n  emitOnContextOnceInitialized(event: string | symbol, ...args: any[]) {\n    if (this._isServerSideOnly)\n      return;\n    // Some events, like console messages, may come before page is ready.\n    // In this case, postpone the event until page is initialized,\n    // and dispatch it to the client later, either on the live Page,\n    // or on the \"errored\" Page.\n    if (this._initialized)\n      this._browserContext.emit(event, ...args);\n    else\n      this._eventsToEmitAfterInitialized.push({ event, args });\n  }\n\n  async resetForReuse(metadata: CallMetadata) {\n    this.setDefaultNavigationTimeout(undefined);\n    this.setDefaultTimeout(undefined);\n    this._locatorHandlers.clear();\n\n    await this._removeExposedBindings();\n    await this._removeInitScripts();\n    await this.setClientRequestInterceptor(undefined);\n    await this._setServerRequestInterceptor(undefined);\n    await this.setFileChooserIntercepted(false);\n    // Re-navigate once init scripts are gone.\n    await this.mainFrame().goto(metadata, 'about:blank');\n    this._emulatedSize = undefined;\n    this._emulatedMedia = {};\n    this._extraHTTPHeaders = undefined;\n    this._interceptFileChooser = false;\n\n    await Promise.all([\n      this._delegate.updateEmulatedViewportSize(),\n      this._delegate.updateEmulateMedia(),\n      this._delegate.updateFileChooserInterception(),\n    ]);\n\n    await this._delegate.resetForReuse();\n  }\n\n  _didClose() {\n    this._frameManager.dispose();\n    this._frameThrottler.dispose();\n    assert(this._closedState !== 'closed', 'Page closed twice');\n    this._closedState = 'closed';\n    this.emit(Page.Events.Close);\n    this._closedPromise.resolve();\n    this.instrumentation.onPageClose(this);\n    this.openScope.close(new TargetClosedError());\n  }\n\n  _didCrash() {\n    this._frameManager.dispose();\n    this._frameThrottler.dispose();\n    this.emit(Page.Events.Crash);\n    this._crashed = true;\n    this.instrumentation.onPageClose(this);\n    this.openScope.close(new Error('Page crashed'));\n  }\n\n  async _onFileChooserOpened(handle: dom.ElementHandle) {\n    let multiple;\n    try {\n      multiple = await handle.evaluate(element => !!(element as HTMLInputElement).multiple);\n    } catch (e) {\n      // Frame/context may be gone during async processing. Do not throw.\n      return;\n    }\n    if (!this.listenerCount(Page.Events.FileChooser)) {\n      handle.dispose();\n      return;\n    }\n    const fileChooser = new FileChooser(this, handle, multiple);\n    this.emit(Page.Events.FileChooser, fileChooser);\n  }\n\n  context(): BrowserContext {\n    return this._browserContext;\n  }\n\n  opener(): Page | undefined {\n    return this._opener;\n  }\n\n  mainFrame(): frames.Frame {\n    return this._frameManager.mainFrame();\n  }\n\n  frames(): frames.Frame[] {\n    return this._frameManager.frames();\n  }\n\n  setDefaultNavigationTimeout(timeout: number | undefined) {\n    this._timeoutSettings.setDefaultNavigationTimeout(timeout);\n  }\n\n  setDefaultTimeout(timeout: number | undefined) {\n    this._timeoutSettings.setDefaultTimeout(timeout);\n  }\n\n  async exposeBinding(name: string, needsHandle: boolean, playwrightBinding: frames.FunctionWithSource) {\n    if (this._pageBindings.has(name))\n      throw new Error(`Function \"${name}\" has been already registered`);\n    if (this._browserContext._pageBindings.has(name))\n      throw new Error(`Function \"${name}\" has been already registered in the browser context`);\n    const binding = new PageBinding(name, playwrightBinding, needsHandle);\n    this._pageBindings.set(name, binding);\n    await this._delegate.addInitScript(binding.initScript);\n    await Promise.all(this.frames().map(frame => frame.evaluateExpression(binding.initScript.source).catch(e => {})));\n  }\n\n  async _removeExposedBindings() {\n    for (const [key, binding] of this._pageBindings) {\n      if (!binding.internal)\n        this._pageBindings.delete(key);\n    }\n  }\n\n  setExtraHTTPHeaders(headers: types.HeadersArray) {\n    this._extraHTTPHeaders = headers;\n    return this._delegate.updateExtraHTTPHeaders();\n  }\n\n  extraHTTPHeaders(): types.HeadersArray | undefined {\n    return this._extraHTTPHeaders;\n  }\n\n  async _onBindingCalled(payload: string, context: dom.FrameExecutionContext) {\n    if (this._closedState === 'closed')\n      return;\n    await PageBinding.dispatch(this, payload, context);\n  }\n\n  _addConsoleMessage(type: string, args: js.JSHandle[], location: types.ConsoleMessageLocation, text?: string) {\n    const message = new ConsoleMessage(this, type, text, args, location);\n    const intercepted = this._frameManager.interceptConsoleMessage(message);\n    if (intercepted) {\n      args.forEach(arg => arg.dispose());\n      return;\n    }\n    this.emitOnContextOnceInitialized(BrowserContext.Events.Console, message);\n  }\n\n  async reload(metadata: CallMetadata, options: types.NavigateOptions): Promise<network.Response | null> {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(progress => this.mainFrame().raceNavigationAction(progress, options, async () => {\n      // Note: waitForNavigation may fail before we get response to reload(),\n      // so we should await it immediately.\n      const [response] = await Promise.all([\n        // Reload must be a new document, and should not be confused with a stray pushState.\n        this.mainFrame()._waitForNavigation(progress, true /* requiresNewDocument */, options),\n        this._delegate.reload(),\n      ]);\n      return response;\n    }), this._timeoutSettings.navigationTimeout(options));\n  }\n\n  async goBack(metadata: CallMetadata, options: types.NavigateOptions): Promise<network.Response | null> {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(progress => this.mainFrame().raceNavigationAction(progress, options, async () => {\n      // Note: waitForNavigation may fail before we get response to goBack,\n      // so we should catch it immediately.\n      let error: Error | undefined;\n      const waitPromise = this.mainFrame()._waitForNavigation(progress, false /* requiresNewDocument */, options).catch(e => {\n        error = e;\n        return null;\n      });\n      const result = await this._delegate.goBack();\n      if (!result)\n        return null;\n      const response = await waitPromise;\n      if (error)\n        throw error;\n      return response;\n    }), this._timeoutSettings.navigationTimeout(options));\n  }\n\n  async goForward(metadata: CallMetadata, options: types.NavigateOptions): Promise<network.Response | null> {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(progress => this.mainFrame().raceNavigationAction(progress, options, async () => {\n      // Note: waitForNavigation may fail before we get response to goForward,\n      // so we should catch it immediately.\n      let error: Error | undefined;\n      const waitPromise = this.mainFrame()._waitForNavigation(progress, false /* requiresNewDocument */, options).catch(e => {\n        error = e;\n        return null;\n      });\n      const result = await this._delegate.goForward();\n      if (!result)\n        return null;\n      const response = await waitPromise;\n      if (error)\n        throw error;\n      return response;\n    }), this._timeoutSettings.navigationTimeout(options));\n  }\n\n  registerLocatorHandler(selector: string, noWaitAfter: boolean | undefined) {\n    const uid = ++this._lastLocatorHandlerUid;\n    this._locatorHandlers.set(uid, { selector, noWaitAfter });\n    return uid;\n  }\n\n  resolveLocatorHandler(uid: number, remove: boolean | undefined) {\n    const handler = this._locatorHandlers.get(uid);\n    if (remove)\n      this._locatorHandlers.delete(uid);\n    if (handler) {\n      handler.resolved?.resolve();\n      handler.resolved = undefined;\n    }\n  }\n\n  unregisterLocatorHandler(uid: number) {\n    this._locatorHandlers.delete(uid);\n  }\n\n  async performLocatorHandlersCheckpoint(progress: Progress) {\n    // Do not run locator handlers from inside locator handler callbacks to avoid deadlocks.\n    if (this._locatorHandlerRunningCounter)\n      return;\n    for (const [uid, handler] of this._locatorHandlers) {\n      if (!handler.resolved) {\n        if (await this.mainFrame().isVisibleInternal(handler.selector, { strict: true })) {\n          handler.resolved = new ManualPromise();\n          this.emit(Page.Events.LocatorHandlerTriggered, uid);\n        }\n      }\n      if (handler.resolved) {\n        ++this._locatorHandlerRunningCounter;\n        progress.log(`  found ${asLocator(this.attribution.playwright.options.sdkLanguage, handler.selector)}, intercepting action to run the handler`);\n        const promise = handler.resolved.then(async () => {\n          progress.throwIfAborted();\n          if (!handler.noWaitAfter) {\n            progress.log(`  locator handler has finished, waiting for ${asLocator(this.attribution.playwright.options.sdkLanguage, handler.selector)} to be hidden`);\n            await this.mainFrame().waitForSelectorInternal(progress, handler.selector, { state: 'hidden' });\n          } else {\n            progress.log(`  locator handler has finished`);\n          }\n        });\n        await this.openScope.race(promise).finally(() => --this._locatorHandlerRunningCounter);\n        // Avoid side-effects after long-running operation.\n        progress.throwIfAborted();\n        progress.log(`  interception handler has finished, continuing`);\n      }\n    }\n  }\n\n  async emulateMedia(options: Partial<EmulatedMedia>) {\n    if (options.media !== undefined)\n      this._emulatedMedia.media = options.media;\n    if (options.colorScheme !== undefined)\n      this._emulatedMedia.colorScheme = options.colorScheme;\n    if (options.reducedMotion !== undefined)\n      this._emulatedMedia.reducedMotion = options.reducedMotion;\n    if (options.forcedColors !== undefined)\n      this._emulatedMedia.forcedColors = options.forcedColors;\n\n    await this._delegate.updateEmulateMedia();\n  }\n\n  emulatedMedia(): EmulatedMedia {\n    const contextOptions = this._browserContext._options;\n    return {\n      media: this._emulatedMedia.media || 'no-override',\n      colorScheme: this._emulatedMedia.colorScheme !== undefined ? this._emulatedMedia.colorScheme : contextOptions.colorScheme ?? 'light',\n      reducedMotion: this._emulatedMedia.reducedMotion !== undefined ? this._emulatedMedia.reducedMotion : contextOptions.reducedMotion ?? 'no-preference',\n      forcedColors: this._emulatedMedia.forcedColors !== undefined ? this._emulatedMedia.forcedColors : contextOptions.forcedColors ?? 'none',\n    };\n  }\n\n  async setViewportSize(viewportSize: types.Size) {\n    this._emulatedSize = { viewport: { ...viewportSize }, screen: { ...viewportSize } };\n    await this._delegate.updateEmulatedViewportSize();\n  }\n\n  viewportSize(): types.Size | null {\n    return this.emulatedSize()?.viewport || null;\n  }\n\n  emulatedSize(): EmulatedSize | null {\n    if (this._emulatedSize)\n      return this._emulatedSize;\n    const contextOptions = this._browserContext._options;\n    return contextOptions.viewport ? { viewport: contextOptions.viewport, screen: contextOptions.screen || contextOptions.viewport } : null;\n  }\n\n  async bringToFront(): Promise<void> {\n    await this._delegate.bringToFront();\n  }\n\n  async addInitScript(source: string) {\n    const initScript = new InitScript(source);\n    this.initScripts.push(initScript);\n    await this._delegate.addInitScript(initScript);\n  }\n\n  async _removeInitScripts() {\n    this.initScripts = this.initScripts.filter(script => script.internal);\n    await this._delegate.removeNonInternalInitScripts();\n  }\n\n  needsRequestInterception(): boolean {\n    return !!this._clientRequestInterceptor || !!this._serverRequestInterceptor || !!this._browserContext._requestInterceptor;\n  }\n\n  async setClientRequestInterceptor(handler: network.RouteHandler | undefined): Promise<void> {\n    this._clientRequestInterceptor = handler;\n    await this._delegate.updateRequestInterception();\n  }\n\n  async _setServerRequestInterceptor(handler: network.RouteHandler | undefined): Promise<void> {\n    this._serverRequestInterceptor = handler;\n    await this._delegate.updateRequestInterception();\n  }\n\n  async expectScreenshot(metadata: CallMetadata, options: ExpectScreenshotOptions = {}): Promise<{ actual?: Buffer, previous?: Buffer, diff?: Buffer, errorMessage?: string, log?: string[] }> {\n    const locator = options.locator;\n    const rafrafScreenshot = locator ? async (progress: Progress, timeout: number) => {\n      return await locator.frame.rafrafTimeoutScreenshotElementWithProgress(progress, locator.selector, timeout, options || {});\n    } : async (progress: Progress, timeout: number) => {\n      await this.performLocatorHandlersCheckpoint(progress);\n      await this.mainFrame().rafrafTimeout(timeout);\n      return await this._screenshotter.screenshotPage(progress, options || {});\n    };\n\n    const comparator = getComparator('image/png');\n    const controller = new ProgressController(metadata, this);\n    if (!options.expected && options.isNot)\n      return { errorMessage: '\"not\" matcher requires expected result' };\n    try {\n      const format = validateScreenshotOptions(options || {});\n      if (format !== 'png')\n        throw new Error('Only PNG screenshots are supported');\n    } catch (error) {\n      return { errorMessage: error.message };\n    }\n    let intermediateResult: {\n      actual?: Buffer,\n      previous?: Buffer,\n      errorMessage: string,\n      diff?: Buffer,\n    } | undefined = undefined;\n    const areEqualScreenshots = (actual: Buffer | undefined, expected: Buffer | undefined, previous: Buffer | undefined) => {\n      const comparatorResult = actual && expected ? comparator(actual, expected, options) : undefined;\n      if (comparatorResult !== undefined && !!comparatorResult === !!options.isNot)\n        return true;\n      if (comparatorResult)\n        intermediateResult = { errorMessage: comparatorResult.errorMessage, diff: comparatorResult.diff, actual, previous };\n      return false;\n    };\n    const callTimeout = this._timeoutSettings.timeout(options);\n    return controller.run(async progress => {\n      let actual: Buffer | undefined;\n      let previous: Buffer | undefined;\n      const pollIntervals = [0, 100, 250, 500];\n      progress.log(`${metadata.apiName}${callTimeout ? ` with timeout ${callTimeout}ms` : ''}`);\n      if (options.expected)\n        progress.log(`  verifying given screenshot expectation`);\n      else\n        progress.log(`  generating new stable screenshot expectation`);\n      let isFirstIteration = true;\n      while (true) {\n        progress.throwIfAborted();\n        if (this.isClosed())\n          throw new Error('The page has closed');\n        const screenshotTimeout = pollIntervals.shift() ?? 1000;\n        if (screenshotTimeout)\n          progress.log(`waiting ${screenshotTimeout}ms before taking screenshot`);\n        previous = actual;\n        actual = await rafrafScreenshot(progress, screenshotTimeout).catch(e => {\n          progress.log(`failed to take screenshot - ` + e.message);\n          return undefined;\n        });\n        if (!actual)\n          continue;\n        // Compare against expectation for the first iteration.\n        const expectation = options.expected && isFirstIteration ? options.expected : previous;\n        if (areEqualScreenshots(actual, expectation, previous))\n          break;\n        if (intermediateResult)\n          progress.log(intermediateResult.errorMessage);\n        isFirstIteration = false;\n      }\n\n      if (!isFirstIteration)\n        progress.log(`captured a stable screenshot`);\n\n      if (!options.expected)\n        return { actual };\n\n      if (isFirstIteration) {\n        progress.log(`screenshot matched expectation`);\n        return {};\n      }\n\n      if (areEqualScreenshots(actual, options.expected, previous)) {\n        progress.log(`screenshot matched expectation`);\n        return {};\n      }\n      throw new Error(intermediateResult!.errorMessage);\n    }, callTimeout).catch(e => {\n      // Q: Why not throw upon isSessionClosedError(e) as in other places?\n      // A: We want user to receive a friendly diff between actual and expected/previous.\n      if (js.isJavaScriptErrorInEvaluate(e) || isInvalidSelectorError(e))\n        throw e;\n      return {\n        log: e.message ? [...metadata.log, e.message] : metadata.log,\n        ...intermediateResult,\n        errorMessage: e.message,\n      };\n    });\n  }\n\n  async screenshot(metadata: CallMetadata, options: ScreenshotOptions & TimeoutOptions = {}): Promise<Buffer> {\n    const controller = new ProgressController(metadata, this);\n    return controller.run(\n        progress => this._screenshotter.screenshotPage(progress, options),\n        this._timeoutSettings.timeout(options));\n  }\n\n  async close(metadata: CallMetadata, options: { runBeforeUnload?: boolean, reason?: string } = {}) {\n    if (this._closedState === 'closed')\n      return;\n    if (options.reason)\n      this._closeReason = options.reason;\n    const runBeforeUnload = !!options.runBeforeUnload;\n    if (this._closedState !== 'closing') {\n      this._closedState = 'closing';\n      // This might throw if the browser context containing the page closes\n      // while we are trying to close the page.\n      await this._delegate.closePage(runBeforeUnload).catch(e => debugLogger.log('error', e));\n    }\n    if (!runBeforeUnload)\n      await this._closedPromise;\n    if (this._ownedContext)\n      await this._ownedContext.close(options);\n  }\n\n  private _setIsError(error: Error) {\n    this._pageIsError = error;\n    this._frameManager.createDummyMainFrameIfNeeded();\n  }\n\n  isClosed(): boolean {\n    return this._closedState === 'closed';\n  }\n\n  hasCrashed() {\n    return this._crashed;\n  }\n\n  isClosedOrClosingOrCrashed() {\n    return this._closedState !== 'open' || this._crashed;\n  }\n\n  _addWorker(workerId: string, worker: Worker) {\n    this._workers.set(workerId, worker);\n    this.emit(Page.Events.Worker, worker);\n  }\n\n  _removeWorker(workerId: string) {\n    const worker = this._workers.get(workerId);\n    if (!worker)\n      return;\n    worker.didClose();\n    this._workers.delete(workerId);\n  }\n\n  _clearWorkers() {\n    for (const [workerId, worker] of this._workers) {\n      worker.didClose();\n      this._workers.delete(workerId);\n    }\n  }\n\n  async setFileChooserIntercepted(enabled: boolean): Promise<void> {\n    this._interceptFileChooser = enabled;\n    await this._delegate.updateFileChooserInterception();\n  }\n\n  fileChooserIntercepted() {\n    return this._interceptFileChooser;\n  }\n\n  frameNavigatedToNewDocument(frame: frames.Frame) {\n    this.emit(Page.Events.InternalFrameNavigatedToNewDocument, frame);\n    const origin = frame.origin();\n    if (origin)\n      this._browserContext.addVisitedOrigin(origin);\n  }\n\n  allInitScripts() {\n    const bindings = [...this._browserContext._pageBindings.values(), ...this._pageBindings.values()];\n    return [...bindings.map(binding => binding.initScript), ...this._browserContext.initScripts, ...this.initScripts];\n  }\n\n  getBinding(name: string) {\n    return this._pageBindings.get(name) || this._browserContext._pageBindings.get(name);\n  }\n\n  setScreencastOptions(options: { width: number, height: number, quality: number } | null) {\n    this._delegate.setScreencastOptions(options).catch(e => debugLogger.log('error', e));\n    this._frameThrottler.setThrottlingEnabled(!!options);\n  }\n\n  throttleScreencastFrameAck(ack: () => void) {\n    // Don't ack immediately, tracing has smart throttling logic that is implemented here.\n    this._frameThrottler.ack(ack);\n  }\n\n  temporarilyDisableTracingScreencastThrottling() {\n    this._frameThrottler.recharge();\n  }\n\n  async safeNonStallingEvaluateInAllFrames(expression: string, world: types.World, options: { throwOnJSErrors?: boolean } = {}) {\n    await Promise.all(this.frames().map(async frame => {\n      try {\n        await frame.nonStallingEvaluateInExistingContext(expression, world);\n      } catch (e) {\n        if (options.throwOnJSErrors && js.isJavaScriptErrorInEvaluate(e))\n          throw e;\n      }\n    }));\n  }\n\n  async hideHighlight() {\n    await Promise.all(this.frames().map(frame => frame.hideHighlight().catch(() => {})));\n  }\n\n  markAsServerSideOnly() {\n    this._isServerSideOnly = true;\n  }\n}\n\nexport class Worker extends SdkObject {\n  static Events = {\n    Close: 'close',\n  };\n\n  private _url: string;\n  private _executionContextPromise: Promise<js.ExecutionContext>;\n  private _executionContextCallback: (value: js.ExecutionContext) => void;\n  _existingExecutionContext: js.ExecutionContext | null = null;\n  readonly openScope = new LongStandingScope();\n\n  constructor(parent: SdkObject, url: string) {\n    super(parent, 'worker');\n    this._url = url;\n    this._executionContextCallback = () => {};\n    this._executionContextPromise = new Promise(x => this._executionContextCallback = x);\n  }\n\n  _createExecutionContext(delegate: js.ExecutionContextDelegate) {\n    this._existingExecutionContext = new js.ExecutionContext(this, delegate, 'worker');\n    this._executionContextCallback(this._existingExecutionContext);\n  }\n\n  url(): string {\n    return this._url;\n  }\n\n  didClose() {\n    if (this._existingExecutionContext)\n      this._existingExecutionContext.contextDestroyed('Worker was closed');\n    this.emit(Worker.Events.Close, this);\n    this.openScope.close(new Error('Worker closed'));\n  }\n\n  async evaluateExpression(expression: string, isFunction: boolean | undefined, arg: any): Promise<any> {\n    return js.evaluateExpression(await this._executionContextPromise, expression, { returnByValue: true, isFunction }, arg);\n  }\n\n  async evaluateExpressionHandle(expression: string, isFunction: boolean | undefined, arg: any): Promise<any> {\n    return js.evaluateExpression(await this._executionContextPromise, expression, { returnByValue: false, isFunction }, arg);\n  }\n}\n\ntype BindingPayload = {\n  name: string;\n  seq: number;\n  serializedArgs?: SerializedValue[],\n};\n\nexport class PageBinding {\n  static kPlaywrightBinding = '__playwright__binding__';\n\n  readonly name: string;\n  readonly playwrightFunction: frames.FunctionWithSource;\n  readonly initScript: InitScript;\n  readonly needsHandle: boolean;\n  readonly internal: boolean;\n\n  constructor(name: string, playwrightFunction: frames.FunctionWithSource, needsHandle: boolean) {\n    this.name = name;\n    this.playwrightFunction = playwrightFunction;\n    this.initScript = new InitScript(`(${addPageBinding.toString()})(${JSON.stringify(PageBinding.kPlaywrightBinding)}, ${JSON.stringify(name)}, ${needsHandle}, (${source})())`, true /* internal */);\n    this.needsHandle = needsHandle;\n    this.internal = name.startsWith('__pw');\n  }\n\n  static async dispatch(page: Page, payload: string, context: dom.FrameExecutionContext) {\n    const { name, seq, serializedArgs } = JSON.parse(payload) as BindingPayload;\n    try {\n      assert(context.world);\n      const binding = page.getBinding(name);\n      if (!binding)\n        throw new Error(`Function \"${name}\" is not exposed`);\n      let result: any;\n      if (binding.needsHandle) {\n        const handle = await context.evaluateHandle(takeHandle, { name, seq }).catch(e => null);\n        result = await binding.playwrightFunction({ frame: context.frame, page, context: page._browserContext }, handle);\n      } else {\n        const args = serializedArgs!.map(a => parseEvaluationResultValue(a));\n        result = await binding.playwrightFunction({ frame: context.frame, page, context: page._browserContext }, ...args);\n      }\n      context.evaluate(deliverResult, { name, seq, result }).catch(e => debugLogger.log('error', e));\n    } catch (error) {\n      context.evaluate(deliverResult, { name, seq, error }).catch(e => debugLogger.log('error', e));\n    }\n\n    function takeHandle(arg: { name: string, seq: number }) {\n      const handle = (globalThis as any)[arg.name]['handles'].get(arg.seq);\n      (globalThis as any)[arg.name]['handles'].delete(arg.seq);\n      return handle;\n    }\n\n    function deliverResult(arg: { name: string, seq: number, result?: any, error?: any }) {\n      const callbacks = (globalThis as any)[arg.name]['callbacks'];\n      if ('error' in arg)\n        callbacks.get(arg.seq).reject(arg.error);\n      else\n        callbacks.get(arg.seq).resolve(arg.result);\n      callbacks.delete(arg.seq);\n    }\n  }\n}\n\nfunction addPageBinding(playwrightBinding: string, bindingName: string, needsHandle: boolean, utilityScriptSerializers: ReturnType<typeof source>) {\n  const binding = (globalThis as any)[playwrightBinding];\n  (globalThis as any)[bindingName] = (...args: any[]) => {\n    const me = (globalThis as any)[bindingName];\n    if (needsHandle && args.slice(1).some(arg => arg !== undefined))\n      throw new Error(`exposeBindingHandle supports a single argument, ${args.length} received`);\n    let callbacks = me['callbacks'];\n    if (!callbacks) {\n      callbacks = new Map();\n      me['callbacks'] = callbacks;\n    }\n    const seq: number = (me['lastSeq'] || 0) + 1;\n    me['lastSeq'] = seq;\n    let handles = me['handles'];\n    if (!handles) {\n      handles = new Map();\n      me['handles'] = handles;\n    }\n    const promise = new Promise((resolve, reject) => callbacks.set(seq, { resolve, reject }));\n    let payload: BindingPayload;\n    if (needsHandle) {\n      handles.set(seq, args[0]);\n      payload = { name: bindingName, seq };\n    } else {\n      const serializedArgs = [];\n      for (let i = 0; i < args.length; i++) {\n        serializedArgs[i] = utilityScriptSerializers.serializeAsCallArgument(args[i], v => {\n          return { fallThrough: v };\n        });\n      }\n      payload = { name: bindingName, seq, serializedArgs };\n    }\n    binding(JSON.stringify(payload));\n    return promise;\n  };\n  (globalThis as any)[bindingName].__installed = true;\n}\n\nexport class InitScript {\n  readonly source: string;\n  readonly internal: boolean;\n\n  constructor(source: string, internal?: boolean) {\n    const guid = createGuid();\n    this.source = `(() => {\n      globalThis.__pwInitScripts = globalThis.__pwInitScripts || {};\n      const hasInitScript = globalThis.__pwInitScripts[${JSON.stringify(guid)}];\n      if (hasInitScript)\n        return;\n      globalThis.__pwInitScripts[${JSON.stringify(guid)}] = true;\n      ${source}\n    })();`;\n    this.internal = !!internal;\n  }\n}\n\nclass FrameThrottler {\n  private _acks: (() => void)[] = [];\n  private _defaultInterval: number;\n  private _throttlingInterval: number;\n  private _nonThrottledFrames: number;\n  private _budget: number;\n  private _throttlingEnabled = false;\n  private _timeoutId: NodeJS.Timeout | undefined;\n\n  constructor(nonThrottledFrames: number, defaultInterval: number, throttlingInterval: number) {\n    this._nonThrottledFrames = nonThrottledFrames;\n    this._budget = nonThrottledFrames;\n    this._defaultInterval = defaultInterval;\n    this._throttlingInterval = throttlingInterval;\n    this._tick();\n  }\n\n  dispose() {\n    if (this._timeoutId) {\n      clearTimeout(this._timeoutId);\n      this._timeoutId = undefined;\n    }\n  }\n\n  setThrottlingEnabled(enabled: boolean) {\n    this._throttlingEnabled = enabled;\n  }\n\n  recharge() {\n    // Send all acks, reset budget.\n    for (const ack of this._acks)\n      ack();\n    this._acks = [];\n    this._budget = this._nonThrottledFrames;\n    if (this._timeoutId) {\n      clearTimeout(this._timeoutId);\n      this._tick();\n    }\n  }\n\n  ack(ack: () => void) {\n    if (!this._timeoutId) {\n      // Already disposed.\n      ack();\n      return;\n    }\n    this._acks.push(ack);\n  }\n\n  private _tick() {\n    const ack = this._acks.shift();\n    if (ack) {\n      --this._budget;\n      ack();\n    }\n\n    if (this._throttlingEnabled && this._budget <= 0) {\n      // Non-throttled frame budget is exceeded. Next ack will be throttled.\n      this._timeoutId = setTimeout(() => this._tick(), this._throttlingInterval);\n    } else {\n      // Either not throttling, or still under budget. Next ack will be after the default timeout.\n      this._timeoutId = setTimeout(() => this._tick(), this._defaultInterval);\n    }\n  }\n}\n"],"mappings":"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"}