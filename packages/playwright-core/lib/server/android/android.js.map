{"version":3,"file":"android.js","names":["_utilsBundle","require","_events","_fs","_interopRequireDefault","_os","_path","_utils","_fileUtils","_browserContext","_progress","_crBrowser","_helper","_transport","_debugLogger","_processLauncher","_timeoutSettings","_instrumentation","_chromiumSwitches","_registry","obj","__esModule","default","ARTIFACTS_FOLDER","path","join","os","tmpdir","Android","SdkObject","constructor","parent","backend","_backend","_devices","Map","TimeoutSettings","setDefaultTimeout","timeout","devices","options","filter","d","status","newSerials","Set","add","serial","has","device","AndroidDevice","create","set","keys","delete","values","_deviceClosed","exports","android","model","_options","_driverPromise","_lastId","_callbacks","_pollingWebViews","_webViews","_browserConnections","_android","_isClosed","init","runCommand","toString","trim","_init","_refreshWebViews","poll","setTimeout","then","catch","close","shell","command","result","open","screenshot","_driver","_installDriver","debug","omitDriverInstall","executable","registry","findExecutable","packageManagerCommand","getPackageManagerExecCommand","file","fullName","directory","fs","existsSync","Error","installApk","promises","readFile","e","socket","_waitForLocalAbstract","transport","PipeTransport","onmessage","message","response","JSON","parse","id","error","callback","get","reject","fulfill","socketName","Promise","f","send","method","params","driver","stringify","clearTimeout","connection","emit","Events","Close","launchBrowser","pkg","isUnderTest","createGuid","commandLine","_defaultArgs","Buffer","from","browserContext","_connectToBrowser","chromeArguments","chromiumSwitches","_innerDefaultArgs","args","proxy","push","server","proxyBypassRules","bypass","split","map","t","startsWith","process","env","PLAYWRIGHT_DISABLE_FORCED_CHROMIUM_PROXIED_LOOPBACK","includes","length","connectToWebView","webView","androidBrowser","AndroidBrowser","artifactsDir","mkdtemp","cleanupArtifactsDir","errors","removeFolders","i","gracefullyCloseSet","on","browserOptions","name","isChromium","slowMo","persistent","noDefaultViewport","downloadsPath","tracesDir","browserProcess","ClankBrowserProcess","protocolLogger","helper","debugProtocolLogger","browserLogsCollector","RecentLogsCollector","originalLaunchOptions","validateBrowserContextOptions","browser","CRBrowser","connect","attribution","playwright","controller","ProgressController","serverSideCallMetadata","defaultContext","_defaultContext","run","progress","_loadDefaultContextAsIs","webViews","content","installSocket","write","success","mode","sendHeader","buffer","alloc","writeUInt32LE","data","maxChunk","slice","Date","now","once","code","sockets","socketNames","line","matchSocketName","match","pid","_extractPkg","WebViewAdded","p","WebViewRemoved","procs","proc","substring","lastIndexOf","EventEmitter","_socket","_receiver","_waitForNextTask","makeWaitForNextTask","onclose","setMaxListeners","wsReceiver","_write","s","encodeWebFrame","wsSender","frame","opcode","mask","fin","readOnly","_browser","kill"],"sources":["../../../src/server/android/android.ts"],"sourcesContent":["/**\n * Copyright Microsoft Corporation. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { debug } from '../../utilsBundle';\nimport { EventEmitter } from 'events';\nimport fs from 'fs';\nimport os from 'os';\nimport path from 'path';\nimport type * as stream from 'stream';\nimport { wsReceiver, wsSender } from '../../utilsBundle';\nimport { createGuid, makeWaitForNextTask, isUnderTest, getPackageManagerExecCommand } from '../../utils';\nimport { removeFolders } from '../../utils/fileUtils';\nimport type { BrowserOptions, BrowserProcess } from '../browser';\nimport type { BrowserContext } from '../browserContext';\nimport { validateBrowserContextOptions } from '../browserContext';\nimport { ProgressController } from '../progress';\nimport { CRBrowser } from '../chromium/crBrowser';\nimport { helper } from '../helper';\nimport { PipeTransport } from '../../protocol/transport';\nimport { RecentLogsCollector } from '../../utils/debugLogger';\nimport { gracefullyCloseSet } from '../../utils/processLauncher';\nimport { TimeoutSettings } from '../../common/timeoutSettings';\nimport type * as channels from '@protocol/channels';\nimport { SdkObject, serverSideCallMetadata } from '../instrumentation';\nimport { chromiumSwitches } from '../chromium/chromiumSwitches';\nimport { registry } from '../registry';\n\nconst ARTIFACTS_FOLDER = path.join(os.tmpdir(), 'playwright-artifacts-');\n\nexport interface Backend {\n  devices(options: channels.AndroidDevicesOptions): Promise<DeviceBackend[]>;\n}\n\nexport interface DeviceBackend {\n  serial: string;\n  status: string;\n  close(): Promise<void>;\n  init(): Promise<void>;\n  runCommand(command: string): Promise<Buffer>;\n  open(command: string): Promise<SocketBackend>;\n}\n\nexport interface SocketBackend extends EventEmitter {\n  guid: string;\n  write(data: Buffer): Promise<void>;\n  close(): void;\n}\n\nexport class Android extends SdkObject {\n  private _backend: Backend;\n  private _devices = new Map<string, AndroidDevice>();\n  readonly _timeoutSettings: TimeoutSettings;\n\n  constructor(parent: SdkObject, backend: Backend) {\n    super(parent, 'android');\n    this._backend = backend;\n    this._timeoutSettings = new TimeoutSettings();\n  }\n\n  setDefaultTimeout(timeout: number) {\n    this._timeoutSettings.setDefaultTimeout(timeout);\n  }\n\n  async devices(options: channels.AndroidDevicesOptions): Promise<AndroidDevice[]> {\n    const devices = (await this._backend.devices(options)).filter(d => d.status === 'device');\n    const newSerials = new Set<string>();\n    for (const d of devices) {\n      newSerials.add(d.serial);\n      if (this._devices.has(d.serial))\n        continue;\n      const device = await AndroidDevice.create(this, d, options);\n      this._devices.set(d.serial, device);\n    }\n    for (const d of this._devices.keys()) {\n      if (!newSerials.has(d))\n        this._devices.delete(d);\n    }\n    return [...this._devices.values()];\n  }\n\n  _deviceClosed(device: AndroidDevice) {\n    this._devices.delete(device.serial);\n  }\n}\n\nexport class AndroidDevice extends SdkObject {\n  readonly _backend: DeviceBackend;\n  readonly model: string;\n  readonly serial: string;\n  private _options: channels.AndroidDevicesOptions;\n  private _driverPromise: Promise<PipeTransport> | undefined;\n  private _lastId = 0;\n  private _callbacks = new Map<number, { fulfill: (result: any) => void, reject: (error: Error) => void }>();\n  private _pollingWebViews: NodeJS.Timeout | undefined;\n  readonly _timeoutSettings: TimeoutSettings;\n  private _webViews = new Map<string, channels.AndroidWebView>();\n\n  static Events = {\n    WebViewAdded: 'webViewAdded',\n    WebViewRemoved: 'webViewRemoved',\n    Close: 'close',\n  };\n\n  private _browserConnections = new Set<AndroidBrowser>();\n  readonly _android: Android;\n  private _isClosed = false;\n\n  constructor(android: Android, backend: DeviceBackend, model: string, options: channels.AndroidDevicesOptions) {\n    super(android, 'android-device');\n    this._android = android;\n    this._backend = backend;\n    this.model = model;\n    this.serial = backend.serial;\n    this._options = options;\n    this._timeoutSettings = new TimeoutSettings(android._timeoutSettings);\n  }\n\n  static async create(android: Android, backend: DeviceBackend, options: channels.AndroidDevicesOptions): Promise<AndroidDevice> {\n    await backend.init();\n    const model = await backend.runCommand('shell:getprop ro.product.model');\n    const device = new AndroidDevice(android, backend, model.toString().trim(), options);\n    await device._init();\n    return device;\n  }\n\n  async _init() {\n    await this._refreshWebViews();\n    const poll = () => {\n      this._pollingWebViews = setTimeout(() => this._refreshWebViews()\n          .then(poll)\n          .catch(() => {\n            this.close().catch(() => {});\n          }), 500);\n    };\n    poll();\n  }\n\n  setDefaultTimeout(timeout: number) {\n    this._timeoutSettings.setDefaultTimeout(timeout);\n  }\n\n  async shell(command: string): Promise<Buffer> {\n    const result = await this._backend.runCommand(`shell:${command}`);\n    await this._refreshWebViews();\n    return result;\n  }\n\n  async open(command: string): Promise<SocketBackend> {\n    return await this._backend.open(`${command}`);\n  }\n\n  async screenshot(): Promise<Buffer> {\n    return await this._backend.runCommand(`shell:screencap -p`);\n  }\n\n  private async _driver(): Promise<PipeTransport | undefined> {\n    if (this._isClosed)\n      return;\n    if (!this._driverPromise)\n      this._driverPromise = this._installDriver();\n    return this._driverPromise;\n  }\n\n  private async _installDriver(): Promise<PipeTransport> {\n    debug('pw:android')('Stopping the old driver');\n    await this.shell(`am force-stop com.microsoft.playwright.androiddriver`);\n\n    // uninstall and install driver on every execution\n    if (!this._options.omitDriverInstall) {\n      debug('pw:android')('Uninstalling the old driver');\n      await this.shell(`cmd package uninstall com.microsoft.playwright.androiddriver`);\n      await this.shell(`cmd package uninstall com.microsoft.playwright.androiddriver.test`);\n\n      debug('pw:android')('Installing the new driver');\n      const executable = registry.findExecutable('android')!;\n      const packageManagerCommand = getPackageManagerExecCommand();\n      for (const file of ['android-driver.apk', 'android-driver-target.apk']) {\n        const fullName = path.join(executable.directory!, file);\n        if (!fs.existsSync(fullName))\n          throw new Error(`Please install Android driver apk using '${packageManagerCommand} playwright install android'`);\n        await this.installApk(await fs.promises.readFile(fullName));\n      }\n    } else {\n      debug('pw:android')('Skipping the driver installation');\n    }\n\n    debug('pw:android')('Starting the new driver');\n    this.shell('am instrument -w com.microsoft.playwright.androiddriver.test/androidx.test.runner.AndroidJUnitRunner').catch(e => debug('pw:android')(e));\n    const socket = await this._waitForLocalAbstract('playwright_android_driver_socket');\n    const transport = new PipeTransport(socket, socket, socket, 'be');\n    transport.onmessage = message => {\n      const response = JSON.parse(message);\n      const { id, result, error } = response;\n      const callback = this._callbacks.get(id);\n      if (!callback)\n        return;\n      if (error)\n        callback.reject(new Error(error));\n      else\n        callback.fulfill(result);\n      this._callbacks.delete(id);\n    };\n    return transport;\n  }\n\n  private async _waitForLocalAbstract(socketName: string): Promise<SocketBackend> {\n    let socket: SocketBackend | undefined;\n    debug('pw:android')(`Polling the socket localabstract:${socketName}`);\n    while (!socket) {\n      try {\n        socket = await this._backend.open(`localabstract:${socketName}`);\n      } catch (e) {\n        await new Promise(f => setTimeout(f, 250));\n      }\n    }\n    debug('pw:android')(`Connected to localabstract:${socketName}`);\n    return socket;\n  }\n\n  async send(method: string, params: any = {}): Promise<any> {\n    // Patch the timeout in!\n    params.timeout = this._timeoutSettings.timeout(params);\n    const driver = await this._driver();\n    if (!driver)\n      throw new Error('Device is closed');\n    const id = ++this._lastId;\n    const result = new Promise((fulfill, reject) => this._callbacks.set(id, { fulfill, reject }));\n    driver.send(JSON.stringify({ id, method, params }));\n    return result;\n  }\n\n  async close() {\n    if (this._isClosed)\n      return;\n    this._isClosed = true;\n    if (this._pollingWebViews)\n      clearTimeout(this._pollingWebViews);\n    for (const connection of this._browserConnections)\n      await connection.close();\n    if (this._driverPromise) {\n      const driver = await this._driver();\n      driver?.close();\n    }\n    await this._backend.close();\n    this._android._deviceClosed(this);\n    this.emit(AndroidDevice.Events.Close);\n  }\n\n  async launchBrowser(pkg: string = 'com.android.chrome', options: channels.AndroidDeviceLaunchBrowserParams): Promise<BrowserContext> {\n    debug('pw:android')('Force-stopping', pkg);\n    await this._backend.runCommand(`shell:am force-stop ${pkg}`);\n    const socketName = isUnderTest() ? 'webview_devtools_remote_playwright_test' : ('playwright_' + createGuid() + '_devtools_remote');\n    const commandLine = this._defaultArgs(options, socketName).join(' ');\n    debug('pw:android')('Starting', pkg, commandLine);\n    // encode commandLine to base64 to avoid issues (bash encoding) with special characters\n    await this._backend.runCommand(`shell:echo \"${Buffer.from(commandLine).toString('base64')}\" | base64 -d > /data/local/tmp/chrome-command-line`);\n    await this._backend.runCommand(`shell:am start -a android.intent.action.VIEW -d about:blank ${pkg}`);\n    const browserContext = await this._connectToBrowser(socketName, options);\n    await this._backend.runCommand(`shell:rm /data/local/tmp/chrome-command-line`);\n    return browserContext;\n  }\n\n  private _defaultArgs(options: channels.AndroidDeviceLaunchBrowserParams, socketName: string): string[] {\n    const chromeArguments = [\n      '_',\n      '--disable-fre',\n      '--no-default-browser-check',\n      `--remote-debugging-socket-name=${socketName}`,\n      ...chromiumSwitches,\n      ...this._innerDefaultArgs(options)\n    ];\n    return chromeArguments;\n  }\n\n  private _innerDefaultArgs(options: channels.AndroidDeviceLaunchBrowserParams): string[] {\n    const { args = [], proxy } = options;\n    const chromeArguments = [];\n    if (proxy) {\n      chromeArguments.push(`--proxy-server=${proxy.server}`);\n      const proxyBypassRules = [];\n      if (proxy.bypass)\n        proxyBypassRules.push(...proxy.bypass.split(',').map(t => t.trim()).map(t => t.startsWith('.') ? '*' + t : t));\n      if (!process.env.PLAYWRIGHT_DISABLE_FORCED_CHROMIUM_PROXIED_LOOPBACK && !proxyBypassRules.includes('<-loopback>'))\n        proxyBypassRules.push('<-loopback>');\n      if (proxyBypassRules.length > 0)\n        chromeArguments.push(`--proxy-bypass-list=${proxyBypassRules.join(';')}`);\n    }\n    chromeArguments.push(...args);\n    return chromeArguments;\n  }\n\n  async connectToWebView(socketName: string): Promise<BrowserContext> {\n    const webView = this._webViews.get(socketName);\n    if (!webView)\n      throw new Error('WebView has been closed');\n    return await this._connectToBrowser(socketName);\n  }\n\n  private async _connectToBrowser(socketName: string, options: channels.BrowserNewContextParams = {}): Promise<BrowserContext> {\n    const socket = await this._waitForLocalAbstract(socketName);\n    const androidBrowser = new AndroidBrowser(this, socket);\n    await androidBrowser._init();\n    this._browserConnections.add(androidBrowser);\n\n    const artifactsDir = await fs.promises.mkdtemp(ARTIFACTS_FOLDER);\n    const cleanupArtifactsDir = async () => {\n      const errors = await removeFolders([artifactsDir]);\n      for (let i = 0; i < (errors || []).length; ++i)\n        debug('pw:android')(`exception while removing ${artifactsDir}: ${errors[i]}`);\n    };\n    gracefullyCloseSet.add(cleanupArtifactsDir);\n    socket.on('close', async () => {\n      gracefullyCloseSet.delete(cleanupArtifactsDir);\n      cleanupArtifactsDir().catch(e => debug('pw:android')(`could not cleanup artifacts dir: ${e}`));\n    });\n    const browserOptions: BrowserOptions = {\n      name: 'clank',\n      isChromium: true,\n      slowMo: 0,\n      persistent: { ...options, noDefaultViewport: true },\n      artifactsDir,\n      downloadsPath: artifactsDir,\n      tracesDir: artifactsDir,\n      browserProcess: new ClankBrowserProcess(androidBrowser),\n      proxy: options.proxy,\n      protocolLogger: helper.debugProtocolLogger(),\n      browserLogsCollector: new RecentLogsCollector(),\n      originalLaunchOptions: {},\n    };\n    validateBrowserContextOptions(options, browserOptions);\n\n    const browser = await CRBrowser.connect(this.attribution.playwright, androidBrowser, browserOptions);\n    const controller = new ProgressController(serverSideCallMetadata(), this);\n    const defaultContext = browser._defaultContext!;\n    await controller.run(async progress => {\n      await defaultContext._loadDefaultContextAsIs(progress);\n    });\n    return defaultContext;\n  }\n\n  webViews(): channels.AndroidWebView[] {\n    return [...this._webViews.values()];\n  }\n\n  async installApk(content: Buffer, options?: { args?: string[] }): Promise<void> {\n    const args = options && options.args ? options.args : ['-r', '-t', '-S'];\n    debug('pw:android')('Opening install socket');\n    const installSocket = await this._backend.open(`shell:cmd package install ${args.join(' ')} ${content.length}`);\n    debug('pw:android')('Writing driver bytes: ' + content.length);\n    await installSocket.write(content);\n    const success = await new Promise(f => installSocket.on('data', f));\n    debug('pw:android')('Written driver bytes: ' + success);\n    installSocket.close();\n  }\n\n  async push(content: Buffer, path: string, mode = 0o644): Promise<void> {\n    const socket = await this._backend.open(`sync:`);\n    const sendHeader = async (command: string, length: number) => {\n      const buffer = Buffer.alloc(command.length + 4);\n      buffer.write(command, 0);\n      buffer.writeUInt32LE(length, command.length);\n      await socket.write(buffer);\n    };\n    const send = async (command: string, data: Buffer) => {\n      await sendHeader(command, data.length);\n      await socket.write(data);\n    };\n    await send('SEND', Buffer.from(`${path},${mode}`));\n    const maxChunk = 65535;\n    for (let i = 0; i < content.length; i += maxChunk)\n      await send('DATA', content.slice(i, i + maxChunk));\n    await sendHeader('DONE', (Date.now() / 1000) | 0);\n    const result = await new Promise<Buffer>(f => socket.once('data', f));\n    const code = result.slice(0, 4).toString();\n    if (code !== 'OKAY')\n      throw new Error('Could not push: ' + code);\n    socket.close();\n  }\n\n  private async _refreshWebViews() {\n    // possible socketName, eg: webview_devtools_remote_32327, webview_devtools_remote_32327_zeus, webview_devtools_remote_zeus\n    const sockets = (await this._backend.runCommand(`shell:cat /proc/net/unix | grep webview_devtools_remote`)).toString().split('\\n');\n    if (this._isClosed)\n      return;\n\n    const socketNames = new Set<string>();\n    for (const line of sockets) {\n      const matchSocketName = line.match(/[^@]+@(.*?webview_devtools_remote_?.*)/);\n      if (!matchSocketName)\n        continue;\n\n      const socketName = matchSocketName[1];\n      socketNames.add(socketName);\n      if (this._webViews.has(socketName))\n        continue;\n\n      // possible line: 0000000000000000: 00000002 00000000 00010000 0001 01 5841881 @webview_devtools_remote_zeus\n      // the result: match[1] = ''\n      const match = line.match(/[^@]+@.*?webview_devtools_remote_?(\\d*)/);\n      let pid = -1;\n      if (match && match[1])\n        pid = +match[1];\n\n      const pkg = await this._extractPkg(pid);\n      if (this._isClosed)\n        return;\n\n      const webView = { pid, pkg, socketName };\n      this._webViews.set(socketName, webView);\n      this.emit(AndroidDevice.Events.WebViewAdded, webView);\n    }\n    for (const p of this._webViews.keys()) {\n      if (!socketNames.has(p)) {\n        this._webViews.delete(p);\n        this.emit(AndroidDevice.Events.WebViewRemoved, p);\n      }\n    }\n  }\n\n  private async _extractPkg(pid: number) {\n    let pkg = '';\n    if (pid === -1)\n      return pkg;\n\n    const procs = (await this._backend.runCommand(`shell:ps -A | grep ${pid}`)).toString().split('\\n');\n    for (const proc of procs) {\n      const match = proc.match(/[^\\s]+\\s+(\\d+).*$/);\n      if (!match)\n        continue;\n      pkg = proc.substring(proc.lastIndexOf(' ') + 1);\n    }\n    return pkg;\n  }\n}\n\nclass AndroidBrowser extends EventEmitter {\n  readonly device: AndroidDevice;\n  private _socket: SocketBackend;\n  private _receiver: stream.Writable;\n  private _waitForNextTask = makeWaitForNextTask();\n  onmessage?: (message: any) => void;\n  onclose?: () => void;\n\n  constructor(device: AndroidDevice, socket: SocketBackend) {\n    super();\n    this.setMaxListeners(0);\n    this.device = device;\n    this._socket = socket;\n    this._socket.on('close', () => {\n      this._waitForNextTask(() => {\n        if (this.onclose)\n          this.onclose();\n      });\n    });\n    this._receiver = new wsReceiver() as stream.Writable;\n    this._receiver.on('message', message => {\n      this._waitForNextTask(() => {\n        if (this.onmessage)\n          this.onmessage(JSON.parse(message));\n      });\n    });\n  }\n\n  async _init() {\n    await this._socket.write(Buffer.from(`GET /devtools/browser HTTP/1.1\\r\nUpgrade: WebSocket\\r\nConnection: Upgrade\\r\nSec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==\\r\nSec-WebSocket-Version: 13\\r\n\\r\n`));\n    // HTTP Upgrade response.\n    await new Promise(f => this._socket!.once('data', f));\n\n    // Start sending web frame to receiver.\n    this._socket.on('data', data => this._receiver._write(data, 'binary', () => {}));\n  }\n\n  async send(s: any) {\n    await this._socket!.write(encodeWebFrame(JSON.stringify(s)));\n  }\n\n  async close() {\n    this._socket!.close();\n  }\n}\n\nfunction encodeWebFrame(data: string): Buffer {\n  return wsSender.frame(Buffer.from(data), {\n    opcode: 1,\n    mask: true,\n    fin: true,\n    readOnly: true\n  })[0];\n}\n\nclass ClankBrowserProcess implements BrowserProcess {\n  private _browser: AndroidBrowser;\n\n  constructor(browser: AndroidBrowser) {\n    this._browser = browser;\n  }\n\n  onclose: ((exitCode: number | null, signal: string | null) => void) | undefined;\n\n  async kill(): Promise<void> {\n  }\n\n  async close(): Promise<void> {\n    await this._browser.close();\n  }\n}\n\n\n"],"mappings":"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"}