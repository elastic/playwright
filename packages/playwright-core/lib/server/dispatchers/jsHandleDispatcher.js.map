{"version":3,"file":"jsHandleDispatcher.js","names":["_dispatcher","require","_elementHandlerDispatcher","_serializers","JSHandleDispatcher","Dispatcher","constructor","scope","jsHandle","asElement","preview","toString","_type_JSHandle","_setPreviewCallback","_dispatchEvent","evaluateExpression","params","value","serializeResult","_object","expression","isFunction","parseArgument","arg","evaluateExpressionHandle","handle","ElementHandleDispatcher","fromJSHandle","parentScope","getProperty","name","getPropertyList","map","getProperties","properties","push","jsonValue","objectCount","count","dispose","_","metadata","potentiallyClosesScope","_dispose","exports","parseSerializedValue","handles","a","parseValue","v","serializeValue","fallThrough"],"sources":["../../../src/server/dispatchers/jsHandleDispatcher.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type * as js from '../javascript';\nimport type * as channels from '@protocol/channels';\nimport { Dispatcher } from './dispatcher';\nimport { ElementHandleDispatcher } from './elementHandlerDispatcher';\nimport { parseSerializedValue, serializeValue } from '../../protocol/serializers';\nimport type { PageDispatcher, WorkerDispatcher } from './pageDispatcher';\nimport type { ElectronApplicationDispatcher } from './electronDispatcher';\nimport type { FrameDispatcher } from './frameDispatcher';\nimport type { CallMetadata } from '../instrumentation';\n\nexport type JSHandleDispatcherParentScope = PageDispatcher | FrameDispatcher | WorkerDispatcher | ElectronApplicationDispatcher;\n\nexport class JSHandleDispatcher extends Dispatcher<js.JSHandle, channels.JSHandleChannel, JSHandleDispatcherParentScope> implements channels.JSHandleChannel {\n  _type_JSHandle = true;\n\n  protected constructor(scope: JSHandleDispatcherParentScope, jsHandle: js.JSHandle) {\n    // Do not call this directly, use createHandle() instead.\n    super(scope, jsHandle, jsHandle.asElement() ? 'ElementHandle' : 'JSHandle', {\n      preview: jsHandle.toString(),\n    });\n    jsHandle._setPreviewCallback(preview => this._dispatchEvent('previewUpdated', { preview }));\n  }\n\n  async evaluateExpression(params: channels.JSHandleEvaluateExpressionParams): Promise<channels.JSHandleEvaluateExpressionResult> {\n    return { value: serializeResult(await this._object.evaluateExpression(params.expression, { isFunction: params.isFunction }, parseArgument(params.arg))) };\n  }\n\n  async evaluateExpressionHandle(params: channels.JSHandleEvaluateExpressionHandleParams): Promise<channels.JSHandleEvaluateExpressionHandleResult> {\n    const jsHandle = await this._object.evaluateExpressionHandle(params.expression, { isFunction: params.isFunction }, parseArgument(params.arg));\n    return { handle: ElementHandleDispatcher.fromJSHandle(this.parentScope(), jsHandle) };\n  }\n\n  async getProperty(params: channels.JSHandleGetPropertyParams): Promise<channels.JSHandleGetPropertyResult> {\n    const jsHandle = await this._object.getProperty(params.name);\n    return { handle: ElementHandleDispatcher.fromJSHandle(this.parentScope(), jsHandle) };\n  }\n\n  async getPropertyList(): Promise<channels.JSHandleGetPropertyListResult> {\n    const map = await this._object.getProperties();\n    const properties = [];\n    for (const [name, value] of map)\n      properties.push({ name, value: ElementHandleDispatcher.fromJSHandle(this.parentScope(), value) });\n    return { properties };\n  }\n\n  async jsonValue(): Promise<channels.JSHandleJsonValueResult> {\n    return { value: serializeResult(await this._object.jsonValue()) };\n  }\n\n  async objectCount(params?: channels.JSHandleObjectCountParams | undefined): Promise<channels.JSHandleObjectCountResult> {\n    return { count: await this._object.objectCount() };\n  }\n\n  async dispose(_: any, metadata: CallMetadata) {\n    metadata.potentiallyClosesScope = true;\n    this._object.dispose();\n    this._dispose();\n  }\n}\n\n// Generic channel parser converts guids to JSHandleDispatchers,\n// and this function takes care of converting them into underlying JSHandles.\nexport function parseArgument(arg: channels.SerializedArgument): any {\n  return parseSerializedValue(arg.value, arg.handles.map(a => (a as JSHandleDispatcher)._object));\n}\n\nexport function parseValue(v: channels.SerializedValue): any {\n  return parseSerializedValue(v, []);\n}\n\nexport function serializeResult(arg: any): channels.SerializedValue {\n  return serializeValue(arg, value => ({ fallThrough: value }));\n}\n"],"mappings":"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"}