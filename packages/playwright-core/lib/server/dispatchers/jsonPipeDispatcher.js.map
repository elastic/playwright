{"version":3,"file":"jsonPipeDispatcher.js","names":["_dispatcher","require","_utils","JsonPipeDispatcher","Dispatcher","constructor","scope","guid","createGuid","_type_JsonPipe","send","params","emit","message","close","_disposed","_dispatchEvent","_dispose","dispatch","wasClosed","reason","dispose","exports"],"sources":["../../../src/server/dispatchers/jsonPipeDispatcher.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type * as channels from '@protocol/channels';\nimport { Dispatcher } from './dispatcher';\nimport { createGuid } from '../../utils';\nimport type { LocalUtilsDispatcher } from './localUtilsDispatcher';\n\nexport class JsonPipeDispatcher extends Dispatcher<{ guid: string }, channels.JsonPipeChannel, LocalUtilsDispatcher> implements channels.JsonPipeChannel {\n  _type_JsonPipe = true;\n  constructor(scope: LocalUtilsDispatcher) {\n    super(scope, { guid: 'jsonPipe@' + createGuid() }, 'JsonPipe', {});\n  }\n\n  async send(params: channels.JsonPipeSendParams): Promise<channels.JsonPipeSendResult> {\n    this.emit('message', params.message);\n  }\n\n  async close(): Promise<void> {\n    this.emit('close');\n    if (!this._disposed) {\n      this._dispatchEvent('closed', {});\n      this._dispose();\n    }\n  }\n\n  dispatch(message: Object) {\n    if (!this._disposed)\n      this._dispatchEvent('message', { message });\n  }\n\n  wasClosed(reason?: string): void {\n    if (!this._disposed) {\n      this._dispatchEvent('closed', { reason });\n      this._dispose();\n    }\n  }\n\n  dispose() {\n    this._dispose();\n  }\n}\n"],"mappings":";;;;;;AAiBA,IAAAA,WAAA,GAAAC,OAAA;AACA,IAAAC,MAAA,GAAAD,OAAA;AAlBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAOO,MAAME,kBAAkB,SAASC,sBAAU,CAAuG;EAEvJC,WAAWA,CAACC,KAA2B,EAAE;IACvC,KAAK,CAACA,KAAK,EAAE;MAAEC,IAAI,EAAE,WAAW,GAAG,IAAAC,iBAAU,EAAC;IAAE,CAAC,EAAE,UAAU,EAAE,CAAC,CAAC,CAAC;IAAC,KAFrEC,cAAc,GAAG,IAAI;EAGrB;EAEA,MAAMC,IAAIA,CAACC,MAAmC,EAAwC;IACpF,IAAI,CAACC,IAAI,CAAC,SAAS,EAAED,MAAM,CAACE,OAAO,CAAC;EACtC;EAEA,MAAMC,KAAKA,CAAA,EAAkB;IAC3B,IAAI,CAACF,IAAI,CAAC,OAAO,CAAC;IAClB,IAAI,CAAC,IAAI,CAACG,SAAS,EAAE;MACnB,IAAI,CAACC,cAAc,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC;MACjC,IAAI,CAACC,QAAQ,CAAC,CAAC;IACjB;EACF;EAEAC,QAAQA,CAACL,OAAe,EAAE;IACxB,IAAI,CAAC,IAAI,CAACE,SAAS,EACjB,IAAI,CAACC,cAAc,CAAC,SAAS,EAAE;MAAEH;IAAQ,CAAC,CAAC;EAC/C;EAEAM,SAASA,CAACC,MAAe,EAAQ;IAC/B,IAAI,CAAC,IAAI,CAACL,SAAS,EAAE;MACnB,IAAI,CAACC,cAAc,CAAC,QAAQ,EAAE;QAAEI;MAAO,CAAC,CAAC;MACzC,IAAI,CAACH,QAAQ,CAAC,CAAC;IACjB;EACF;EAEAI,OAAOA,CAAA,EAAG;IACR,IAAI,CAACJ,QAAQ,CAAC,CAAC;EACjB;AACF;AAACK,OAAA,CAAAnB,kBAAA,GAAAA,kBAAA"}