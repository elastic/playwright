{"version":3,"file":"electronDispatcher.js","names":["_dispatcher","require","_electron","_browserContextDispatcher","_jsHandleDispatcher","_elementHandlerDispatcher","ElectronDispatcher","Dispatcher","constructor","scope","electron","_type_Electron","launch","params","electronApplication","_object","ElectronApplicationDispatcher","exports","context","BrowserContextDispatcher","_type_EventTarget","_type_ElectronApplication","_subscriptions","Set","addObjectListener","ElectronApplication","Events","Close","_dispatchEvent","_dispose","Console","message","has","type","text","args","map","a","ElementHandleDispatcher","fromJSHandle","location","browserWindow","handle","page","evaluateExpression","_nodeElectronHandlePromise","value","serializeResult","expression","isFunction","parseArgument","arg","evaluateExpressionHandle","result","updateSubscription","enabled","add","event","delete","close"],"sources":["../../../src/server/dispatchers/electronDispatcher.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { RootDispatcher } from './dispatcher';\nimport { Dispatcher } from './dispatcher';\nimport type { Electron } from '../electron/electron';\nimport { ElectronApplication } from '../electron/electron';\nimport type * as channels from '@protocol/channels';\nimport { BrowserContextDispatcher } from './browserContextDispatcher';\nimport type { PageDispatcher } from './pageDispatcher';\nimport type { ConsoleMessage } from '../console';\nimport { parseArgument, serializeResult } from './jsHandleDispatcher';\nimport { ElementHandleDispatcher } from './elementHandlerDispatcher';\n\nexport class ElectronDispatcher extends Dispatcher<Electron, channels.ElectronChannel, RootDispatcher> implements channels.ElectronChannel {\n  _type_Electron = true;\n\n  constructor(scope: RootDispatcher, electron: Electron) {\n    super(scope, electron, 'Electron', {});\n  }\n\n  async launch(params: channels.ElectronLaunchParams): Promise<channels.ElectronLaunchResult> {\n    const electronApplication = await this._object.launch(params);\n    return { electronApplication: new ElectronApplicationDispatcher(this, electronApplication) };\n  }\n}\n\nexport class ElectronApplicationDispatcher extends Dispatcher<ElectronApplication, channels.ElectronApplicationChannel, ElectronDispatcher> implements channels.ElectronApplicationChannel {\n  _type_EventTarget = true;\n  _type_ElectronApplication = true;\n  private readonly _subscriptions = new Set<channels.ElectronApplicationUpdateSubscriptionParams['event']>();\n\n  constructor(scope: ElectronDispatcher, electronApplication: ElectronApplication) {\n    super(scope, electronApplication, 'ElectronApplication', {\n      context: new BrowserContextDispatcher(scope, electronApplication.context())\n    });\n    this.addObjectListener(ElectronApplication.Events.Close, () => {\n      this._dispatchEvent('close');\n      this._dispose();\n    });\n    this.addObjectListener(ElectronApplication.Events.Console, (message: ConsoleMessage) => {\n      if (!this._subscriptions.has('console'))\n        return;\n      this._dispatchEvent('console', {\n        type: message.type(),\n        text: message.text(),\n        args: message.args().map(a => ElementHandleDispatcher.fromJSHandle(this, a)),\n        location: message.location()\n      });\n    });\n  }\n\n  async browserWindow(params: channels.ElectronApplicationBrowserWindowParams): Promise<channels.ElectronApplicationBrowserWindowResult> {\n    const handle = await this._object.browserWindow((params.page as PageDispatcher).page());\n    return { handle: ElementHandleDispatcher.fromJSHandle(this, handle) };\n  }\n\n  async evaluateExpression(params: channels.ElectronApplicationEvaluateExpressionParams): Promise<channels.ElectronApplicationEvaluateExpressionResult> {\n    const handle = await this._object._nodeElectronHandlePromise;\n    return { value: serializeResult(await handle.evaluateExpression(params.expression, { isFunction: params.isFunction }, parseArgument(params.arg))) };\n  }\n\n  async evaluateExpressionHandle(params: channels.ElectronApplicationEvaluateExpressionHandleParams): Promise<channels.ElectronApplicationEvaluateExpressionHandleResult> {\n    const handle = await this._object._nodeElectronHandlePromise;\n    const result = await handle.evaluateExpressionHandle(params.expression, { isFunction: params.isFunction }, parseArgument(params.arg));\n    return { handle: ElementHandleDispatcher.fromJSHandle(this, result) };\n  }\n\n  async updateSubscription(params: channels.ElectronApplicationUpdateSubscriptionParams): Promise<void> {\n    if (params.enabled)\n      this._subscriptions.add(params.event);\n    else\n      this._subscriptions.delete(params.event);\n  }\n\n  async close(): Promise<void> {\n    await this._object.close();\n  }\n}\n"],"mappings":"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"}