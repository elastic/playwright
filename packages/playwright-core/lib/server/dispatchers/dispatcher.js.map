{"version":3,"file":"dispatcher.js","names":["_events","require","_validator","_utils","_errors","_instrumentation","_eventsHelper","_protocolError","dispatcherSymbol","exports","Symbol","metadataValidator","createMetadataValidator","existingDispatcher","object","maxDispatchersOverride","setMaxDispatchersForTest","value","maxDispatchersForBucket","gcBucket","_ref","_maxDispatchersOverri","Dispatcher","EventEmitter","constructor","parent","type","initializer","_connection","_parent","_dispatchers","Map","_disposed","_eventListeners","_guid","_type","_gcBucket","_object","_openScope","LongStandingScope","DispatcherConnection","undefined","guid","registerDispatcher","assert","has","set","sendCreate","maybeDisposeStaleDispatchers","parentScope","addObjectListener","eventName","handler","push","eventsHelper","addEventListener","adopt","child","oldParent","delete","sendAdopt","_handleCommand","callMetadata","method","validParams","commandPromise","race","e","potentiallyClosesScope","isTargetClosedError","_dispatchEvent","params","isUnderTest","Error","String","sendEvent","_dispose","reason","_disposeRecursively","TargetClosedError","sendDispose","_onDispose","error","_this$_parent","removeEventListeners","list","_dispatchersByBucket","get","dispatcher","values","clear","close","_debugScopeState","objects","Array","from","map","o","waitForEventInfo","RootDispatcher","connection","createPlaywright","_initialized","initialize","playwright","isLocal","onmessage","message","_waitOperations","_isLocal","event","validator","findValidator","tChannelImpl","_tChannelImplToWire","bind","binary","_tChannelImplFromWire","names","arg","path","context","ValidationError","includes","toString","Set","add","maxDispatchers","size","dispatchersArray","disposeCount","slice","i","d","dispatch","_sdkObject$attributio","_sdkObject$attributio2","_params$info","id","metadata","serializeError","validMetadata","sdkObject","SdkObject","location","apiName","internal","stepId","objectId","pageId","attribution","page","frameId","frame","startTime","monotonicTime","endTime","log","info","waitId","phase","instrumentation","onBeforeCall","originalMetadata","onCallLog","name","onAfterCall","response","result","closeReason","rewriteErrorMessage","isProtocolError","browserLogMessage","_sdkObject$attributio3","_sdkObject$attributio4","_sdkObject$attributio5","_closeReason","browser"],"sources":["../../../src/server/dispatchers/dispatcher.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { EventEmitter } from 'events';\nimport type * as channels from '@protocol/channels';\nimport { findValidator, ValidationError, createMetadataValidator, type ValidatorContext } from '../../protocol/validator';\nimport { LongStandingScope, assert, isUnderTest, monotonicTime, rewriteErrorMessage } from '../../utils';\nimport { TargetClosedError, isTargetClosedError, serializeError } from '../errors';\nimport type { CallMetadata } from '../instrumentation';\nimport { SdkObject } from '../instrumentation';\nimport type { PlaywrightDispatcher } from './playwrightDispatcher';\nimport { eventsHelper } from '../..//utils/eventsHelper';\nimport type { RegisteredListener } from '../..//utils/eventsHelper';\nimport { isProtocolError } from '../protocolError';\n\nexport const dispatcherSymbol = Symbol('dispatcher');\nconst metadataValidator = createMetadataValidator();\n\nexport function existingDispatcher<DispatcherType>(object: any): DispatcherType | undefined {\n  return object[dispatcherSymbol];\n}\n\nlet maxDispatchersOverride: number | undefined;\nexport function setMaxDispatchersForTest(value: number | undefined) {\n  maxDispatchersOverride = value;\n}\nfunction maxDispatchersForBucket(gcBucket: string) {\n  return maxDispatchersOverride ?? {\n    'JSHandle': 100000,\n    'ElementHandle': 100000,\n  }[gcBucket] ?? 10000;\n}\n\nexport class Dispatcher<Type extends { guid: string }, ChannelType, ParentScopeType extends DispatcherScope> extends EventEmitter implements channels.Channel {\n  private _connection: DispatcherConnection;\n  // Parent is always \"isScope\".\n  private _parent: ParentScopeType | undefined;\n  // Only \"isScope\" channel owners have registered dispatchers inside.\n  private _dispatchers = new Map<string, DispatcherScope>();\n  protected _disposed = false;\n  protected _eventListeners: RegisteredListener[] = [];\n\n  readonly _guid: string;\n  readonly _type: string;\n  readonly _gcBucket: string;\n  _object: Type;\n  private _openScope = new LongStandingScope();\n\n  constructor(parent: ParentScopeType | DispatcherConnection, object: Type, type: string, initializer: channels.InitializerTraits<Type>, gcBucket?: string) {\n    super();\n\n    this._connection = parent instanceof DispatcherConnection ? parent : parent._connection;\n    this._parent = parent instanceof DispatcherConnection ? undefined : parent;\n\n    const guid = object.guid;\n    this._guid = guid;\n    this._type = type;\n    this._object = object;\n    this._gcBucket = gcBucket ?? type;\n\n    (object as any)[dispatcherSymbol] = this;\n\n    this._connection.registerDispatcher(this);\n    if (this._parent) {\n      assert(!this._parent._dispatchers.has(guid));\n      this._parent._dispatchers.set(guid, this);\n    }\n\n    if (this._parent)\n      this._connection.sendCreate(this._parent, type, guid, initializer);\n    this._connection.maybeDisposeStaleDispatchers(this._gcBucket);\n  }\n\n  parentScope(): ParentScopeType {\n    return this._parent!;\n  }\n\n  addObjectListener(eventName: (string | symbol), handler: (...args: any[]) => void) {\n    this._eventListeners.push(eventsHelper.addEventListener(this._object as unknown as EventEmitter, eventName, handler));\n  }\n\n  adopt(child: DispatcherScope) {\n    if (child._parent === this)\n      return;\n    const oldParent = child._parent!;\n    oldParent._dispatchers.delete(child._guid);\n    this._dispatchers.set(child._guid, child);\n    child._parent = this;\n    this._connection.sendAdopt(this, child);\n  }\n\n  async _handleCommand(callMetadata: CallMetadata, method: string, validParams: any) {\n    const commandPromise = (this as any)[method](validParams, callMetadata);\n    try {\n      return await this._openScope.race(commandPromise);\n    } catch (e) {\n      if (callMetadata.potentiallyClosesScope && isTargetClosedError(e))\n        return await commandPromise;\n      throw e;\n    }\n  }\n\n  _dispatchEvent<T extends keyof channels.EventsTraits<ChannelType>>(method: T, params?: channels.EventsTraits<ChannelType>[T]) {\n    if (this._disposed) {\n      if (isUnderTest())\n        throw new Error(`${this._guid} is sending \"${String(method)}\" event after being disposed`);\n      // Just ignore this event outside of tests.\n      return;\n    }\n    this._connection.sendEvent(this, method as string, params);\n  }\n\n  _dispose(reason?: 'gc') {\n    this._disposeRecursively(new TargetClosedError());\n    this._connection.sendDispose(this, reason);\n  }\n\n  protected _onDispose() {\n  }\n\n  private _disposeRecursively(error: Error) {\n    assert(!this._disposed, `${this._guid} is disposed more than once`);\n    this._onDispose();\n    this._disposed = true;\n    eventsHelper.removeEventListeners(this._eventListeners);\n\n    // Clean up from parent and connection.\n    this._parent?._dispatchers.delete(this._guid);\n    const list = this._connection._dispatchersByBucket.get(this._gcBucket);\n    list?.delete(this._guid);\n    this._connection._dispatchers.delete(this._guid);\n\n    // Dispose all children.\n    for (const dispatcher of [...this._dispatchers.values()])\n      dispatcher._disposeRecursively(error);\n    this._dispatchers.clear();\n    delete (this._object as any)[dispatcherSymbol];\n    this._openScope.close(error);\n  }\n\n  _debugScopeState(): any {\n    return {\n      _guid: this._guid,\n      objects: Array.from(this._dispatchers.values()).map(o => o._debugScopeState()),\n    };\n  }\n\n  async waitForEventInfo(): Promise<void> {\n    // Instrumentation takes care of this.\n  }\n}\n\nexport type DispatcherScope = Dispatcher<any, any, any>;\n\nexport class RootDispatcher extends Dispatcher<{ guid: '' }, any, any> {\n  private _initialized = false;\n\n  constructor(connection: DispatcherConnection, private readonly createPlaywright?: (scope: RootDispatcher, options: channels.RootInitializeParams) => Promise<PlaywrightDispatcher>) {\n    super(connection, { guid: '' }, 'Root', {});\n  }\n\n  async initialize(params: channels.RootInitializeParams): Promise<channels.RootInitializeResult> {\n    assert(this.createPlaywright);\n    assert(!this._initialized);\n    this._initialized = true;\n    return {\n      playwright: await this.createPlaywright(this, params),\n    };\n  }\n}\n\nexport class DispatcherConnection {\n  readonly _dispatchers = new Map<string, DispatcherScope>();\n  readonly _dispatchersByBucket = new Map<string, Set<string>>();\n  onmessage = (message: object) => {};\n  private _waitOperations = new Map<string, CallMetadata>();\n  private _isLocal: boolean;\n\n  constructor(isLocal?: boolean) {\n    this._isLocal = !!isLocal;\n  }\n\n  sendEvent(dispatcher: DispatcherScope, event: string, params: any) {\n    const validator = findValidator(dispatcher._type, event, 'Event');\n    params = validator(params, '', { tChannelImpl: this._tChannelImplToWire.bind(this), binary: this._isLocal ? 'buffer' : 'toBase64' });\n    this.onmessage({ guid: dispatcher._guid, method: event, params });\n  }\n\n  sendCreate(parent: DispatcherScope, type: string, guid: string, initializer: any) {\n    const validator = findValidator(type, '', 'Initializer');\n    initializer = validator(initializer, '', { tChannelImpl: this._tChannelImplToWire.bind(this), binary: this._isLocal ? 'buffer' : 'toBase64' });\n    this.onmessage({ guid: parent._guid, method: '__create__', params: { type, initializer, guid } });\n  }\n\n  sendAdopt(parent: DispatcherScope, dispatcher: DispatcherScope) {\n    this.onmessage({ guid: parent._guid, method: '__adopt__', params: { guid: dispatcher._guid } });\n  }\n\n  sendDispose(dispatcher: DispatcherScope, reason?: 'gc') {\n    this.onmessage({ guid: dispatcher._guid, method: '__dispose__', params: { reason } });\n  }\n\n  private _tChannelImplFromWire(names: '*' | string[], arg: any, path: string, context: ValidatorContext): any {\n    if (arg && typeof arg === 'object' && typeof arg.guid === 'string') {\n      const guid = arg.guid;\n      const dispatcher = this._dispatchers.get(guid);\n      if (!dispatcher)\n        throw new ValidationError(`${path}: no object with guid ${guid}`);\n      if (names !== '*' && !names.includes(dispatcher._type))\n        throw new ValidationError(`${path}: object with guid ${guid} has type ${dispatcher._type}, expected ${names.toString()}`);\n      return dispatcher;\n    }\n    throw new ValidationError(`${path}: expected guid for ${names.toString()}`);\n  }\n\n  private _tChannelImplToWire(names: '*' | string[], arg: any, path: string, context: ValidatorContext): any {\n    if (arg instanceof Dispatcher)  {\n      if (names !== '*' && !names.includes(arg._type))\n        throw new ValidationError(`${path}: dispatcher with guid ${arg._guid} has type ${arg._type}, expected ${names.toString()}`);\n      return { guid: arg._guid };\n    }\n    throw new ValidationError(`${path}: expected dispatcher ${names.toString()}`);\n  }\n\n  registerDispatcher(dispatcher: DispatcherScope) {\n    assert(!this._dispatchers.has(dispatcher._guid));\n    this._dispatchers.set(dispatcher._guid, dispatcher);\n    let list = this._dispatchersByBucket.get(dispatcher._gcBucket);\n    if (!list) {\n      list = new Set();\n      this._dispatchersByBucket.set(dispatcher._gcBucket, list);\n    }\n    list.add(dispatcher._guid);\n  }\n\n  maybeDisposeStaleDispatchers(gcBucket: string) {\n    const maxDispatchers = maxDispatchersForBucket(gcBucket);\n    const list = this._dispatchersByBucket.get(gcBucket);\n    if (!list || list.size <= maxDispatchers)\n      return;\n    const dispatchersArray = [...list];\n    const disposeCount = (maxDispatchers / 10) | 0;\n    this._dispatchersByBucket.set(gcBucket, new Set(dispatchersArray.slice(disposeCount)));\n    for (let i = 0; i < disposeCount; ++i) {\n      const d = this._dispatchers.get(dispatchersArray[i]);\n      if (!d)\n        continue;\n      d._dispose('gc');\n    }\n  }\n\n  async dispatch(message: object) {\n    const { id, guid, method, params, metadata } = message as any;\n    const dispatcher = this._dispatchers.get(guid);\n    if (!dispatcher) {\n      this.onmessage({ id, error: serializeError(new TargetClosedError()) });\n      return;\n    }\n\n    let validParams: any;\n    let validMetadata: channels.Metadata;\n    try {\n      const validator = findValidator(dispatcher._type, method, 'Params');\n      validParams = validator(params, '', { tChannelImpl: this._tChannelImplFromWire.bind(this), binary: this._isLocal ? 'buffer' : 'fromBase64' });\n      validMetadata = metadataValidator(metadata, '', { tChannelImpl: this._tChannelImplFromWire.bind(this), binary: this._isLocal ? 'buffer' : 'fromBase64' });\n      if (typeof (dispatcher as any)[method] !== 'function')\n        throw new Error(`Mismatching dispatcher: \"${dispatcher._type}\" does not implement \"${method}\"`);\n    } catch (e) {\n      this.onmessage({ id, error: serializeError(e) });\n      return;\n    }\n\n    const sdkObject = dispatcher._object instanceof SdkObject ? dispatcher._object : undefined;\n    const callMetadata: CallMetadata = {\n      id: `call@${id}`,\n      location: validMetadata.location,\n      apiName: validMetadata.apiName,\n      internal: validMetadata.internal,\n      stepId: validMetadata.stepId,\n      objectId: sdkObject?.guid,\n      pageId: sdkObject?.attribution?.page?.guid,\n      frameId: sdkObject?.attribution?.frame?.guid,\n      startTime: monotonicTime(),\n      endTime: 0,\n      type: dispatcher._type,\n      method,\n      params: params || {},\n      log: [],\n    };\n\n    if (sdkObject && params?.info?.waitId) {\n      // Process logs for waitForNavigation/waitForLoadState/etc.\n      const info = params.info;\n      switch (info.phase) {\n        case 'before': {\n          this._waitOperations.set(info.waitId, callMetadata);\n          await sdkObject.instrumentation.onBeforeCall(sdkObject, callMetadata);\n          this.onmessage({ id });\n          return;\n        } case 'log': {\n          const originalMetadata = this._waitOperations.get(info.waitId)!;\n          originalMetadata.log.push(info.message);\n          sdkObject.instrumentation.onCallLog(sdkObject, originalMetadata, 'api', info.message);\n          this.onmessage({ id });\n          return;\n        } case 'after': {\n          const originalMetadata = this._waitOperations.get(info.waitId)!;\n          originalMetadata.endTime = monotonicTime();\n          originalMetadata.error = info.error ? { error: { name: 'Error', message: info.error } } : undefined;\n          this._waitOperations.delete(info.waitId);\n          await sdkObject.instrumentation.onAfterCall(sdkObject, originalMetadata);\n          this.onmessage({ id });\n          return;\n        }\n      }\n    }\n\n    await sdkObject?.instrumentation.onBeforeCall(sdkObject, callMetadata);\n    const response: any = { id };\n    try {\n      const result = await dispatcher._handleCommand(callMetadata, method, validParams);\n      const validator = findValidator(dispatcher._type, method, 'Result');\n      response.result = validator(result, '', { tChannelImpl: this._tChannelImplToWire.bind(this), binary: this._isLocal ? 'buffer' : 'toBase64' });\n      callMetadata.result = result;\n    } catch (e) {\n      if (isTargetClosedError(e) && sdkObject) {\n        const reason = closeReason(sdkObject);\n        if (reason)\n          rewriteErrorMessage(e, reason);\n      } else if (isProtocolError(e)) {\n        if (e.type === 'closed') {\n          const reason = sdkObject ? closeReason(sdkObject) : undefined;\n          e = new TargetClosedError(reason, e.browserLogMessage());\n        } else if (e.type === 'crashed') {\n          rewriteErrorMessage(e, 'Target crashed ' + e.browserLogMessage());\n        }\n      }\n      response.error = serializeError(e);\n      // The command handler could have set error in the metadata, do not reset it if there was no exception.\n      callMetadata.error = response.error;\n    } finally {\n      callMetadata.endTime = monotonicTime();\n      await sdkObject?.instrumentation.onAfterCall(sdkObject, callMetadata);\n    }\n\n    if (response.error)\n      response.log = callMetadata.log;\n    this.onmessage(response);\n  }\n}\n\nfunction closeReason(sdkObject: SdkObject): string | undefined {\n  return sdkObject.attribution.page?._closeReason ||\n    sdkObject.attribution.context?._closeReason ||\n    sdkObject.attribution.browser?._closeReason;\n}\n"],"mappings":";;;;;;;;AAgBA,IAAAA,OAAA,GAAAC,OAAA;AAEA,IAAAC,UAAA,GAAAD,OAAA;AACA,IAAAE,MAAA,GAAAF,OAAA;AACA,IAAAG,OAAA,GAAAH,OAAA;AAEA,IAAAI,gBAAA,GAAAJ,OAAA;AAEA,IAAAK,aAAA,GAAAL,OAAA;AAEA,IAAAM,cAAA,GAAAN,OAAA;AA1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAcO,MAAMO,gBAAgB,GAAAC,OAAA,CAAAD,gBAAA,GAAGE,MAAM,CAAC,YAAY,CAAC;AACpD,MAAMC,iBAAiB,GAAG,IAAAC,kCAAuB,EAAC,CAAC;AAE5C,SAASC,kBAAkBA,CAAiBC,MAAW,EAA8B;EAC1F,OAAOA,MAAM,CAACN,gBAAgB,CAAC;AACjC;AAEA,IAAIO,sBAA0C;AACvC,SAASC,wBAAwBA,CAACC,KAAyB,EAAE;EAClEF,sBAAsB,GAAGE,KAAK;AAChC;AACA,SAASC,uBAAuBA,CAACC,QAAgB,EAAE;EAAA,IAAAC,IAAA,EAAAC,qBAAA;EACjD,QAAAD,IAAA,IAAAC,qBAAA,GAAON,sBAAsB,cAAAM,qBAAA,cAAAA,qBAAA,GAAI;IAC/B,UAAU,EAAE,MAAM;IAClB,eAAe,EAAE;EACnB,CAAC,CAACF,QAAQ,CAAC,cAAAC,IAAA,cAAAA,IAAA,GAAI,KAAK;AACtB;AAEO,MAAME,UAAU,SAA8FC,oBAAY,CAA6B;EAe5JC,WAAWA,CAACC,MAA8C,EAAEX,MAAY,EAAEY,IAAY,EAAEC,WAA6C,EAAER,QAAiB,EAAE;IACxJ,KAAK,CAAC,CAAC;IAAC,KAfFS,WAAW;IACnB;IAAA,KACQC,OAAO;IACf;IAAA,KACQC,YAAY,GAAG,IAAIC,GAAG,CAA0B,CAAC;IAAA,KAC/CC,SAAS,GAAG,KAAK;IAAA,KACjBC,eAAe,GAAyB,EAAE;IAAA,KAE3CC,KAAK;IAAA,KACLC,KAAK;IAAA,KACLC,SAAS;IAAA,KAClBC,OAAO;IAAA,KACCC,UAAU,GAAG,IAAIC,wBAAiB,CAAC,CAAC;IAK1C,IAAI,CAACX,WAAW,GAAGH,MAAM,YAAYe,oBAAoB,GAAGf,MAAM,GAAGA,MAAM,CAACG,WAAW;IACvF,IAAI,CAACC,OAAO,GAAGJ,MAAM,YAAYe,oBAAoB,GAAGC,SAAS,GAAGhB,MAAM;IAE1E,MAAMiB,IAAI,GAAG5B,MAAM,CAAC4B,IAAI;IACxB,IAAI,CAACR,KAAK,GAAGQ,IAAI;IACjB,IAAI,CAACP,KAAK,GAAGT,IAAI;IACjB,IAAI,CAACW,OAAO,GAAGvB,MAAM;IACrB,IAAI,CAACsB,SAAS,GAAGjB,QAAQ,aAARA,QAAQ,cAARA,QAAQ,GAAIO,IAAI;IAEhCZ,MAAM,CAASN,gBAAgB,CAAC,GAAG,IAAI;IAExC,IAAI,CAACoB,WAAW,CAACe,kBAAkB,CAAC,IAAI,CAAC;IACzC,IAAI,IAAI,CAACd,OAAO,EAAE;MAChB,IAAAe,aAAM,EAAC,CAAC,IAAI,CAACf,OAAO,CAACC,YAAY,CAACe,GAAG,CAACH,IAAI,CAAC,CAAC;MAC5C,IAAI,CAACb,OAAO,CAACC,YAAY,CAACgB,GAAG,CAACJ,IAAI,EAAE,IAAI,CAAC;IAC3C;IAEA,IAAI,IAAI,CAACb,OAAO,EACd,IAAI,CAACD,WAAW,CAACmB,UAAU,CAAC,IAAI,CAAClB,OAAO,EAAEH,IAAI,EAAEgB,IAAI,EAAEf,WAAW,CAAC;IACpE,IAAI,CAACC,WAAW,CAACoB,4BAA4B,CAAC,IAAI,CAACZ,SAAS,CAAC;EAC/D;EAEAa,WAAWA,CAAA,EAAoB;IAC7B,OAAO,IAAI,CAACpB,OAAO;EACrB;EAEAqB,iBAAiBA,CAACC,SAA4B,EAAEC,OAAiC,EAAE;IACjF,IAAI,CAACnB,eAAe,CAACoB,IAAI,CAACC,0BAAY,CAACC,gBAAgB,CAAC,IAAI,CAAClB,OAAO,EAA6Bc,SAAS,EAAEC,OAAO,CAAC,CAAC;EACvH;EAEAI,KAAKA,CAACC,KAAsB,EAAE;IAC5B,IAAIA,KAAK,CAAC5B,OAAO,KAAK,IAAI,EACxB;IACF,MAAM6B,SAAS,GAAGD,KAAK,CAAC5B,OAAQ;IAChC6B,SAAS,CAAC5B,YAAY,CAAC6B,MAAM,CAACF,KAAK,CAACvB,KAAK,CAAC;IAC1C,IAAI,CAACJ,YAAY,CAACgB,GAAG,CAACW,KAAK,CAACvB,KAAK,EAAEuB,KAAK,CAAC;IACzCA,KAAK,CAAC5B,OAAO,GAAG,IAAI;IACpB,IAAI,CAACD,WAAW,CAACgC,SAAS,CAAC,IAAI,EAAEH,KAAK,CAAC;EACzC;EAEA,MAAMI,cAAcA,CAACC,YAA0B,EAAEC,MAAc,EAAEC,WAAgB,EAAE;IACjF,MAAMC,cAAc,GAAI,IAAI,CAASF,MAAM,CAAC,CAACC,WAAW,EAAEF,YAAY,CAAC;IACvE,IAAI;MACF,OAAO,MAAM,IAAI,CAACxB,UAAU,CAAC4B,IAAI,CAACD,cAAc,CAAC;IACnD,CAAC,CAAC,OAAOE,CAAC,EAAE;MACV,IAAIL,YAAY,CAACM,sBAAsB,IAAI,IAAAC,2BAAmB,EAACF,CAAC,CAAC,EAC/D,OAAO,MAAMF,cAAc;MAC7B,MAAME,CAAC;IACT;EACF;EAEAG,cAAcA,CAAqDP,MAAS,EAAEQ,MAA8C,EAAE;IAC5H,IAAI,IAAI,CAACvC,SAAS,EAAE;MAClB,IAAI,IAAAwC,kBAAW,EAAC,CAAC,EACf,MAAM,IAAIC,KAAK,CAAE,GAAE,IAAI,CAACvC,KAAM,gBAAewC,MAAM,CAACX,MAAM,CAAE,8BAA6B,CAAC;MAC5F;MACA;IACF;IACA,IAAI,CAACnC,WAAW,CAAC+C,SAAS,CAAC,IAAI,EAAEZ,MAAM,EAAYQ,MAAM,CAAC;EAC5D;EAEAK,QAAQA,CAACC,MAAa,EAAE;IACtB,IAAI,CAACC,mBAAmB,CAAC,IAAIC,yBAAiB,CAAC,CAAC,CAAC;IACjD,IAAI,CAACnD,WAAW,CAACoD,WAAW,CAAC,IAAI,EAAEH,MAAM,CAAC;EAC5C;EAEUI,UAAUA,CAAA,EAAG,CACvB;EAEQH,mBAAmBA,CAACI,KAAY,EAAE;IAAA,IAAAC,aAAA;IACxC,IAAAvC,aAAM,EAAC,CAAC,IAAI,CAACZ,SAAS,EAAG,GAAE,IAAI,CAACE,KAAM,6BAA4B,CAAC;IACnE,IAAI,CAAC+C,UAAU,CAAC,CAAC;IACjB,IAAI,CAACjD,SAAS,GAAG,IAAI;IACrBsB,0BAAY,CAAC8B,oBAAoB,CAAC,IAAI,CAACnD,eAAe,CAAC;;IAEvD;IACA,CAAAkD,aAAA,OAAI,CAACtD,OAAO,cAAAsD,aAAA,eAAZA,aAAA,CAAcrD,YAAY,CAAC6B,MAAM,CAAC,IAAI,CAACzB,KAAK,CAAC;IAC7C,MAAMmD,IAAI,GAAG,IAAI,CAACzD,WAAW,CAAC0D,oBAAoB,CAACC,GAAG,CAAC,IAAI,CAACnD,SAAS,CAAC;IACtEiD,IAAI,aAAJA,IAAI,eAAJA,IAAI,CAAE1B,MAAM,CAAC,IAAI,CAACzB,KAAK,CAAC;IACxB,IAAI,CAACN,WAAW,CAACE,YAAY,CAAC6B,MAAM,CAAC,IAAI,CAACzB,KAAK,CAAC;;IAEhD;IACA,KAAK,MAAMsD,UAAU,IAAI,CAAC,GAAG,IAAI,CAAC1D,YAAY,CAAC2D,MAAM,CAAC,CAAC,CAAC,EACtDD,UAAU,CAACV,mBAAmB,CAACI,KAAK,CAAC;IACvC,IAAI,CAACpD,YAAY,CAAC4D,KAAK,CAAC,CAAC;IACzB,OAAQ,IAAI,CAACrD,OAAO,CAAS7B,gBAAgB,CAAC;IAC9C,IAAI,CAAC8B,UAAU,CAACqD,KAAK,CAACT,KAAK,CAAC;EAC9B;EAEAU,gBAAgBA,CAAA,EAAQ;IACtB,OAAO;MACL1D,KAAK,EAAE,IAAI,CAACA,KAAK;MACjB2D,OAAO,EAAEC,KAAK,CAACC,IAAI,CAAC,IAAI,CAACjE,YAAY,CAAC2D,MAAM,CAAC,CAAC,CAAC,CAACO,GAAG,CAACC,CAAC,IAAIA,CAAC,CAACL,gBAAgB,CAAC,CAAC;IAC/E,CAAC;EACH;EAEA,MAAMM,gBAAgBA,CAAA,EAAkB;IACtC;EAAA;AAEJ;AAACzF,OAAA,CAAAa,UAAA,GAAAA,UAAA;AAIM,MAAM6E,cAAc,SAAS7E,UAAU,CAAyB;EAGrEE,WAAWA,CAAC4E,UAAgC,EAAmBC,gBAAmH,EAAE;IAClL,KAAK,CAACD,UAAU,EAAE;MAAE1D,IAAI,EAAE;IAAG,CAAC,EAAE,MAAM,EAAE,CAAC,CAAC,CAAC;IAAC,KAHtC4D,YAAY,GAAG,KAAK;IAAA,KAEmCD,gBAAmH,GAAnHA,gBAAmH;EAElL;EAEA,MAAME,UAAUA,CAAChC,MAAqC,EAA0C;IAC9F,IAAA3B,aAAM,EAAC,IAAI,CAACyD,gBAAgB,CAAC;IAC7B,IAAAzD,aAAM,EAAC,CAAC,IAAI,CAAC0D,YAAY,CAAC;IAC1B,IAAI,CAACA,YAAY,GAAG,IAAI;IACxB,OAAO;MACLE,UAAU,EAAE,MAAM,IAAI,CAACH,gBAAgB,CAAC,IAAI,EAAE9B,MAAM;IACtD,CAAC;EACH;AACF;AAAC9D,OAAA,CAAA0F,cAAA,GAAAA,cAAA;AAEM,MAAM3D,oBAAoB,CAAC;EAOhChB,WAAWA,CAACiF,OAAiB,EAAE;IAAA,KANtB3E,YAAY,GAAG,IAAIC,GAAG,CAA0B,CAAC;IAAA,KACjDuD,oBAAoB,GAAG,IAAIvD,GAAG,CAAsB,CAAC;IAAA,KAC9D2E,SAAS,GAAIC,OAAe,IAAK,CAAC,CAAC;IAAA,KAC3BC,eAAe,GAAG,IAAI7E,GAAG,CAAuB,CAAC;IAAA,KACjD8E,QAAQ;IAGd,IAAI,CAACA,QAAQ,GAAG,CAAC,CAACJ,OAAO;EAC3B;EAEA9B,SAASA,CAACa,UAA2B,EAAEsB,KAAa,EAAEvC,MAAW,EAAE;IACjE,MAAMwC,SAAS,GAAG,IAAAC,wBAAa,EAACxB,UAAU,CAACrD,KAAK,EAAE2E,KAAK,EAAE,OAAO,CAAC;IACjEvC,MAAM,GAAGwC,SAAS,CAACxC,MAAM,EAAE,EAAE,EAAE;MAAE0C,YAAY,EAAE,IAAI,CAACC,mBAAmB,CAACC,IAAI,CAAC,IAAI,CAAC;MAAEC,MAAM,EAAE,IAAI,CAACP,QAAQ,GAAG,QAAQ,GAAG;IAAW,CAAC,CAAC;IACpI,IAAI,CAACH,SAAS,CAAC;MAAEhE,IAAI,EAAE8C,UAAU,CAACtD,KAAK;MAAE6B,MAAM,EAAE+C,KAAK;MAAEvC;IAAO,CAAC,CAAC;EACnE;EAEAxB,UAAUA,CAACtB,MAAuB,EAAEC,IAAY,EAAEgB,IAAY,EAAEf,WAAgB,EAAE;IAChF,MAAMoF,SAAS,GAAG,IAAAC,wBAAa,EAACtF,IAAI,EAAE,EAAE,EAAE,aAAa,CAAC;IACxDC,WAAW,GAAGoF,SAAS,CAACpF,WAAW,EAAE,EAAE,EAAE;MAAEsF,YAAY,EAAE,IAAI,CAACC,mBAAmB,CAACC,IAAI,CAAC,IAAI,CAAC;MAAEC,MAAM,EAAE,IAAI,CAACP,QAAQ,GAAG,QAAQ,GAAG;IAAW,CAAC,CAAC;IAC9I,IAAI,CAACH,SAAS,CAAC;MAAEhE,IAAI,EAAEjB,MAAM,CAACS,KAAK;MAAE6B,MAAM,EAAE,YAAY;MAAEQ,MAAM,EAAE;QAAE7C,IAAI;QAAEC,WAAW;QAAEe;MAAK;IAAE,CAAC,CAAC;EACnG;EAEAkB,SAASA,CAACnC,MAAuB,EAAE+D,UAA2B,EAAE;IAC9D,IAAI,CAACkB,SAAS,CAAC;MAAEhE,IAAI,EAAEjB,MAAM,CAACS,KAAK;MAAE6B,MAAM,EAAE,WAAW;MAAEQ,MAAM,EAAE;QAAE7B,IAAI,EAAE8C,UAAU,CAACtD;MAAM;IAAE,CAAC,CAAC;EACjG;EAEA8C,WAAWA,CAACQ,UAA2B,EAAEX,MAAa,EAAE;IACtD,IAAI,CAAC6B,SAAS,CAAC;MAAEhE,IAAI,EAAE8C,UAAU,CAACtD,KAAK;MAAE6B,MAAM,EAAE,aAAa;MAAEQ,MAAM,EAAE;QAAEM;MAAO;IAAE,CAAC,CAAC;EACvF;EAEQwC,qBAAqBA,CAACC,KAAqB,EAAEC,GAAQ,EAAEC,IAAY,EAAEC,OAAyB,EAAO;IAC3G,IAAIF,GAAG,IAAI,OAAOA,GAAG,KAAK,QAAQ,IAAI,OAAOA,GAAG,CAAC7E,IAAI,KAAK,QAAQ,EAAE;MAClE,MAAMA,IAAI,GAAG6E,GAAG,CAAC7E,IAAI;MACrB,MAAM8C,UAAU,GAAG,IAAI,CAAC1D,YAAY,CAACyD,GAAG,CAAC7C,IAAI,CAAC;MAC9C,IAAI,CAAC8C,UAAU,EACb,MAAM,IAAIkC,0BAAe,CAAE,GAAEF,IAAK,yBAAwB9E,IAAK,EAAC,CAAC;MACnE,IAAI4E,KAAK,KAAK,GAAG,IAAI,CAACA,KAAK,CAACK,QAAQ,CAACnC,UAAU,CAACrD,KAAK,CAAC,EACpD,MAAM,IAAIuF,0BAAe,CAAE,GAAEF,IAAK,sBAAqB9E,IAAK,aAAY8C,UAAU,CAACrD,KAAM,cAAamF,KAAK,CAACM,QAAQ,CAAC,CAAE,EAAC,CAAC;MAC3H,OAAOpC,UAAU;IACnB;IACA,MAAM,IAAIkC,0BAAe,CAAE,GAAEF,IAAK,uBAAsBF,KAAK,CAACM,QAAQ,CAAC,CAAE,EAAC,CAAC;EAC7E;EAEQV,mBAAmBA,CAACI,KAAqB,EAAEC,GAAQ,EAAEC,IAAY,EAAEC,OAAyB,EAAO;IACzG,IAAIF,GAAG,YAAYjG,UAAU,EAAG;MAC9B,IAAIgG,KAAK,KAAK,GAAG,IAAI,CAACA,KAAK,CAACK,QAAQ,CAACJ,GAAG,CAACpF,KAAK,CAAC,EAC7C,MAAM,IAAIuF,0BAAe,CAAE,GAAEF,IAAK,0BAAyBD,GAAG,CAACrF,KAAM,aAAYqF,GAAG,CAACpF,KAAM,cAAamF,KAAK,CAACM,QAAQ,CAAC,CAAE,EAAC,CAAC;MAC7H,OAAO;QAAElF,IAAI,EAAE6E,GAAG,CAACrF;MAAM,CAAC;IAC5B;IACA,MAAM,IAAIwF,0BAAe,CAAE,GAAEF,IAAK,yBAAwBF,KAAK,CAACM,QAAQ,CAAC,CAAE,EAAC,CAAC;EAC/E;EAEAjF,kBAAkBA,CAAC6C,UAA2B,EAAE;IAC9C,IAAA5C,aAAM,EAAC,CAAC,IAAI,CAACd,YAAY,CAACe,GAAG,CAAC2C,UAAU,CAACtD,KAAK,CAAC,CAAC;IAChD,IAAI,CAACJ,YAAY,CAACgB,GAAG,CAAC0C,UAAU,CAACtD,KAAK,EAAEsD,UAAU,CAAC;IACnD,IAAIH,IAAI,GAAG,IAAI,CAACC,oBAAoB,CAACC,GAAG,CAACC,UAAU,CAACpD,SAAS,CAAC;IAC9D,IAAI,CAACiD,IAAI,EAAE;MACTA,IAAI,GAAG,IAAIwC,GAAG,CAAC,CAAC;MAChB,IAAI,CAACvC,oBAAoB,CAACxC,GAAG,CAAC0C,UAAU,CAACpD,SAAS,EAAEiD,IAAI,CAAC;IAC3D;IACAA,IAAI,CAACyC,GAAG,CAACtC,UAAU,CAACtD,KAAK,CAAC;EAC5B;EAEAc,4BAA4BA,CAAC7B,QAAgB,EAAE;IAC7C,MAAM4G,cAAc,GAAG7G,uBAAuB,CAACC,QAAQ,CAAC;IACxD,MAAMkE,IAAI,GAAG,IAAI,CAACC,oBAAoB,CAACC,GAAG,CAACpE,QAAQ,CAAC;IACpD,IAAI,CAACkE,IAAI,IAAIA,IAAI,CAAC2C,IAAI,IAAID,cAAc,EACtC;IACF,MAAME,gBAAgB,GAAG,CAAC,GAAG5C,IAAI,CAAC;IAClC,MAAM6C,YAAY,GAAIH,cAAc,GAAG,EAAE,GAAI,CAAC;IAC9C,IAAI,CAACzC,oBAAoB,CAACxC,GAAG,CAAC3B,QAAQ,EAAE,IAAI0G,GAAG,CAACI,gBAAgB,CAACE,KAAK,CAACD,YAAY,CAAC,CAAC,CAAC;IACtF,KAAK,IAAIE,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,YAAY,EAAE,EAAEE,CAAC,EAAE;MACrC,MAAMC,CAAC,GAAG,IAAI,CAACvG,YAAY,CAACyD,GAAG,CAAC0C,gBAAgB,CAACG,CAAC,CAAC,CAAC;MACpD,IAAI,CAACC,CAAC,EACJ;MACFA,CAAC,CAACzD,QAAQ,CAAC,IAAI,CAAC;IAClB;EACF;EAEA,MAAM0D,QAAQA,CAAC3B,OAAe,EAAE;IAAA,IAAA4B,qBAAA,EAAAC,sBAAA,EAAAC,YAAA;IAC9B,MAAM;MAAEC,EAAE;MAAEhG,IAAI;MAAEqB,MAAM;MAAEQ,MAAM;MAAEoE;IAAS,CAAC,GAAGhC,OAAc;IAC7D,MAAMnB,UAAU,GAAG,IAAI,CAAC1D,YAAY,CAACyD,GAAG,CAAC7C,IAAI,CAAC;IAC9C,IAAI,CAAC8C,UAAU,EAAE;MACf,IAAI,CAACkB,SAAS,CAAC;QAAEgC,EAAE;QAAExD,KAAK,EAAE,IAAA0D,sBAAc,EAAC,IAAI7D,yBAAiB,CAAC,CAAC;MAAE,CAAC,CAAC;MACtE;IACF;IAEA,IAAIf,WAAgB;IACpB,IAAI6E,aAAgC;IACpC,IAAI;MACF,MAAM9B,SAAS,GAAG,IAAAC,wBAAa,EAACxB,UAAU,CAACrD,KAAK,EAAE4B,MAAM,EAAE,QAAQ,CAAC;MACnEC,WAAW,GAAG+C,SAAS,CAACxC,MAAM,EAAE,EAAE,EAAE;QAAE0C,YAAY,EAAE,IAAI,CAACI,qBAAqB,CAACF,IAAI,CAAC,IAAI,CAAC;QAAEC,MAAM,EAAE,IAAI,CAACP,QAAQ,GAAG,QAAQ,GAAG;MAAa,CAAC,CAAC;MAC7IgC,aAAa,GAAGlI,iBAAiB,CAACgI,QAAQ,EAAE,EAAE,EAAE;QAAE1B,YAAY,EAAE,IAAI,CAACI,qBAAqB,CAACF,IAAI,CAAC,IAAI,CAAC;QAAEC,MAAM,EAAE,IAAI,CAACP,QAAQ,GAAG,QAAQ,GAAG;MAAa,CAAC,CAAC;MACzJ,IAAI,OAAQrB,UAAU,CAASzB,MAAM,CAAC,KAAK,UAAU,EACnD,MAAM,IAAIU,KAAK,CAAE,4BAA2Be,UAAU,CAACrD,KAAM,yBAAwB4B,MAAO,GAAE,CAAC;IACnG,CAAC,CAAC,OAAOI,CAAC,EAAE;MACV,IAAI,CAACuC,SAAS,CAAC;QAAEgC,EAAE;QAAExD,KAAK,EAAE,IAAA0D,sBAAc,EAACzE,CAAC;MAAE,CAAC,CAAC;MAChD;IACF;IAEA,MAAM2E,SAAS,GAAGtD,UAAU,CAACnD,OAAO,YAAY0G,0BAAS,GAAGvD,UAAU,CAACnD,OAAO,GAAGI,SAAS;IAC1F,MAAMqB,YAA0B,GAAG;MACjC4E,EAAE,EAAG,QAAOA,EAAG,EAAC;MAChBM,QAAQ,EAAEH,aAAa,CAACG,QAAQ;MAChCC,OAAO,EAAEJ,aAAa,CAACI,OAAO;MAC9BC,QAAQ,EAAEL,aAAa,CAACK,QAAQ;MAChCC,MAAM,EAAEN,aAAa,CAACM,MAAM;MAC5BC,QAAQ,EAAEN,SAAS,aAATA,SAAS,uBAATA,SAAS,CAAEpG,IAAI;MACzB2G,MAAM,EAAEP,SAAS,aAATA,SAAS,gBAAAP,qBAAA,GAATO,SAAS,CAAEQ,WAAW,cAAAf,qBAAA,gBAAAA,qBAAA,GAAtBA,qBAAA,CAAwBgB,IAAI,cAAAhB,qBAAA,uBAA5BA,qBAAA,CAA8B7F,IAAI;MAC1C8G,OAAO,EAAEV,SAAS,aAATA,SAAS,gBAAAN,sBAAA,GAATM,SAAS,CAAEQ,WAAW,cAAAd,sBAAA,gBAAAA,sBAAA,GAAtBA,sBAAA,CAAwBiB,KAAK,cAAAjB,sBAAA,uBAA7BA,sBAAA,CAA+B9F,IAAI;MAC5CgH,SAAS,EAAE,IAAAC,oBAAa,EAAC,CAAC;MAC1BC,OAAO,EAAE,CAAC;MACVlI,IAAI,EAAE8D,UAAU,CAACrD,KAAK;MACtB4B,MAAM;MACNQ,MAAM,EAAEA,MAAM,IAAI,CAAC,CAAC;MACpBsF,GAAG,EAAE;IACP,CAAC;IAED,IAAIf,SAAS,IAAIvE,MAAM,aAANA,MAAM,gBAAAkE,YAAA,GAANlE,MAAM,CAAEuF,IAAI,cAAArB,YAAA,eAAZA,YAAA,CAAcsB,MAAM,EAAE;MACrC;MACA,MAAMD,IAAI,GAAGvF,MAAM,CAACuF,IAAI;MACxB,QAAQA,IAAI,CAACE,KAAK;QAChB,KAAK,QAAQ;UAAE;YACb,IAAI,CAACpD,eAAe,CAAC9D,GAAG,CAACgH,IAAI,CAACC,MAAM,EAAEjG,YAAY,CAAC;YACnD,MAAMgF,SAAS,CAACmB,eAAe,CAACC,YAAY,CAACpB,SAAS,EAAEhF,YAAY,CAAC;YACrE,IAAI,CAAC4C,SAAS,CAAC;cAAEgC;YAAG,CAAC,CAAC;YACtB;UACF;QAAE,KAAK,KAAK;UAAE;YACZ,MAAMyB,gBAAgB,GAAG,IAAI,CAACvD,eAAe,CAACrB,GAAG,CAACuE,IAAI,CAACC,MAAM,CAAE;YAC/DI,gBAAgB,CAACN,GAAG,CAACxG,IAAI,CAACyG,IAAI,CAACnD,OAAO,CAAC;YACvCmC,SAAS,CAACmB,eAAe,CAACG,SAAS,CAACtB,SAAS,EAAEqB,gBAAgB,EAAE,KAAK,EAAEL,IAAI,CAACnD,OAAO,CAAC;YACrF,IAAI,CAACD,SAAS,CAAC;cAAEgC;YAAG,CAAC,CAAC;YACtB;UACF;QAAE,KAAK,OAAO;UAAE;YACd,MAAMyB,gBAAgB,GAAG,IAAI,CAACvD,eAAe,CAACrB,GAAG,CAACuE,IAAI,CAACC,MAAM,CAAE;YAC/DI,gBAAgB,CAACP,OAAO,GAAG,IAAAD,oBAAa,EAAC,CAAC;YAC1CQ,gBAAgB,CAACjF,KAAK,GAAG4E,IAAI,CAAC5E,KAAK,GAAG;cAAEA,KAAK,EAAE;gBAAEmF,IAAI,EAAE,OAAO;gBAAE1D,OAAO,EAAEmD,IAAI,CAAC5E;cAAM;YAAE,CAAC,GAAGzC,SAAS;YACnG,IAAI,CAACmE,eAAe,CAACjD,MAAM,CAACmG,IAAI,CAACC,MAAM,CAAC;YACxC,MAAMjB,SAAS,CAACmB,eAAe,CAACK,WAAW,CAACxB,SAAS,EAAEqB,gBAAgB,CAAC;YACxE,IAAI,CAACzD,SAAS,CAAC;cAAEgC;YAAG,CAAC,CAAC;YACtB;UACF;MACF;IACF;IAEA,OAAMI,SAAS,aAATA,SAAS,uBAATA,SAAS,CAAEmB,eAAe,CAACC,YAAY,CAACpB,SAAS,EAAEhF,YAAY,CAAC;IACtE,MAAMyG,QAAa,GAAG;MAAE7B;IAAG,CAAC;IAC5B,IAAI;MACF,MAAM8B,MAAM,GAAG,MAAMhF,UAAU,CAAC3B,cAAc,CAACC,YAAY,EAAEC,MAAM,EAAEC,WAAW,CAAC;MACjF,MAAM+C,SAAS,GAAG,IAAAC,wBAAa,EAACxB,UAAU,CAACrD,KAAK,EAAE4B,MAAM,EAAE,QAAQ,CAAC;MACnEwG,QAAQ,CAACC,MAAM,GAAGzD,SAAS,CAACyD,MAAM,EAAE,EAAE,EAAE;QAAEvD,YAAY,EAAE,IAAI,CAACC,mBAAmB,CAACC,IAAI,CAAC,IAAI,CAAC;QAAEC,MAAM,EAAE,IAAI,CAACP,QAAQ,GAAG,QAAQ,GAAG;MAAW,CAAC,CAAC;MAC7I/C,YAAY,CAAC0G,MAAM,GAAGA,MAAM;IAC9B,CAAC,CAAC,OAAOrG,CAAC,EAAE;MACV,IAAI,IAAAE,2BAAmB,EAACF,CAAC,CAAC,IAAI2E,SAAS,EAAE;QACvC,MAAMjE,MAAM,GAAG4F,WAAW,CAAC3B,SAAS,CAAC;QACrC,IAAIjE,MAAM,EACR,IAAA6F,0BAAmB,EAACvG,CAAC,EAAEU,MAAM,CAAC;MAClC,CAAC,MAAM,IAAI,IAAA8F,8BAAe,EAACxG,CAAC,CAAC,EAAE;QAC7B,IAAIA,CAAC,CAACzC,IAAI,KAAK,QAAQ,EAAE;UACvB,MAAMmD,MAAM,GAAGiE,SAAS,GAAG2B,WAAW,CAAC3B,SAAS,CAAC,GAAGrG,SAAS;UAC7D0B,CAAC,GAAG,IAAIY,yBAAiB,CAACF,MAAM,EAAEV,CAAC,CAACyG,iBAAiB,CAAC,CAAC,CAAC;QAC1D,CAAC,MAAM,IAAIzG,CAAC,CAACzC,IAAI,KAAK,SAAS,EAAE;UAC/B,IAAAgJ,0BAAmB,EAACvG,CAAC,EAAE,iBAAiB,GAAGA,CAAC,CAACyG,iBAAiB,CAAC,CAAC,CAAC;QACnE;MACF;MACAL,QAAQ,CAACrF,KAAK,GAAG,IAAA0D,sBAAc,EAACzE,CAAC,CAAC;MAClC;MACAL,YAAY,CAACoB,KAAK,GAAGqF,QAAQ,CAACrF,KAAK;IACrC,CAAC,SAAS;MACRpB,YAAY,CAAC8F,OAAO,GAAG,IAAAD,oBAAa,EAAC,CAAC;MACtC,OAAMb,SAAS,aAATA,SAAS,uBAATA,SAAS,CAAEmB,eAAe,CAACK,WAAW,CAACxB,SAAS,EAAEhF,YAAY,CAAC;IACvE;IAEA,IAAIyG,QAAQ,CAACrF,KAAK,EAChBqF,QAAQ,CAACV,GAAG,GAAG/F,YAAY,CAAC+F,GAAG;IACjC,IAAI,CAACnD,SAAS,CAAC6D,QAAQ,CAAC;EAC1B;AACF;AAAC9J,OAAA,CAAA+B,oBAAA,GAAAA,oBAAA;AAED,SAASiI,WAAWA,CAAC3B,SAAoB,EAAsB;EAAA,IAAA+B,sBAAA,EAAAC,sBAAA,EAAAC,sBAAA;EAC7D,OAAO,EAAAF,sBAAA,GAAA/B,SAAS,CAACQ,WAAW,CAACC,IAAI,cAAAsB,sBAAA,uBAA1BA,sBAAA,CAA4BG,YAAY,OAAAF,sBAAA,GAC7ChC,SAAS,CAACQ,WAAW,CAAC7B,OAAO,cAAAqD,sBAAA,uBAA7BA,sBAAA,CAA+BE,YAAY,OAAAD,sBAAA,GAC3CjC,SAAS,CAACQ,WAAW,CAAC2B,OAAO,cAAAF,sBAAA,uBAA7BA,sBAAA,CAA+BC,YAAY;AAC/C"}