{"version":3,"file":"chromium.js","names":["_fs","_interopRequireDefault","require","_os","_path","_crBrowser","_processLauncher","_crConnection","_browserType","_transport","_crDevTools","_browser","_network","_userAgent","_ascii","_utils","_fileUtils","_debugLogger","_progress","_timeoutSettings","_helper","_registry","_manualPromise","_browserContext","_chromiumSwitches","obj","__esModule","default","ARTIFACTS_FOLDER","path","join","os","tmpdir","Chromium","BrowserType","constructor","parent","_devtools","debugMode","_createDevTools","connectOverCDP","metadata","endpointURL","options","timeout","controller","ProgressController","setLogName","run","progress","_connectOverCDPInternal","TimeoutSettings","onClose","headersMap","headers","headersArrayToObject","getUserAgent","Object","keys","some","key","toLowerCase","artifactsDir","fs","promises","mkdtemp","wsEndpoint","urlToWSEndpoint","throwIfAborted","chromeTransport","WebSocketTransport","connect","cleanedUp","ManualPromise","doCleanup","removeFolders","resolve","doClose","closeAndWait","browserProcess","close","kill","persistent","noDefaultViewport","browserOptions","slowMo","name","isChromium","protocolLogger","helper","debugProtocolLogger","browserLogsCollector","RecentLogsCollector","downloadsPath","tracesDir","originalLaunchOptions","validateBrowserContextOptions","browser","CRBrowser","attribution","playwright","_isCollocatedWithServer","on","Browser","Events","Disconnected","directory","registry","findExecutable","CRDevTools","undefined","connectToTransport","transport","devtools","__testHookForDevTools","doRewriteStartupLog","error","logs","includes","wrapInASCIIBox","kNoXServerRunningError","amendEnvironment","env","userDataDir","executable","browserArguments","attemptToGracefullyCloseBrowser","message","method","id","kBrowserCloseMessageId","params","send","_launchWithSeleniumHub","hubUrl","_createArtifactDirs","endsWith","args","_innerDefaultArgs","push","isEdge","channel","startsWith","desiredCapabilities","process","SELENIUM_REMOTE_CAPABILITIES","remoteCapabilities","parseSeleniumRemoteParams","value","SELENIUM_REMOTE_HEADERS","remoteHeaders","log","response","fetchData","url","data","JSON","stringify","capabilities","alwaysMatch","timeUntilDeadline","seleniumErrorHandler","parse","sessionId","disconnectFromSelenium","catch","gracefullyCloseSet","delete","add","endpointURLString","addProtocol","URL","hostname","toString","maybeChromeOptions","chromeOptions","debuggerAddress","chromeOptionsURL","replace","sessionInfoUrl","origin","sessionResponse","proxyId","e","headersObjectToArray","defaultArgs","isPersistent","chromeArguments","useWebSocket","proxy","userDataDirArg","find","arg","_createUserDataDirArgMisuseError","Error","chromiumSwitches","platform","headless","PLAYWRIGHT_CHROMIUM_USE_HEADLESS_NEW","chromiumSandbox","proxyURL","server","isSocks","protocol","socksProxyPort","proxyBypassRules","bypass","split","map","t","trim","PLAYWRIGHT_DISABLE_FORCED_CHROMIUM_PROXIED_LOOPBACK","length","readyState","_options$args","a","ChromiumReadyState","exports","_wsEndpoint","onBrowserOutput","match","onBrowserExit","waitUntilReady","httpURL","json","_","resp","statusCode","webSocketDebuggerUrl","body","streamToString","localizedMessage","stream","Promise","reject","chunks","chunk","Buffer","from","concat","parsed"],"sources":["../../../src/server/chromium/chromium.ts"],"sourcesContent":["/**\n * Copyright 2017 Google Inc. All rights reserved.\n * Modifications copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport fs from 'fs';\nimport os from 'os';\nimport path from 'path';\nimport type stream from 'stream';\nimport { CRBrowser } from './crBrowser';\nimport type { Env } from '../../utils/processLauncher';\nimport { gracefullyCloseSet } from '../../utils/processLauncher';\nimport { kBrowserCloseMessageId } from './crConnection';\nimport { BrowserType, kNoXServerRunningError } from '../browserType';\nimport type { BrowserReadyState } from '../browserType';\nimport type { ConnectionTransport, ProtocolRequest } from '../transport';\nimport { WebSocketTransport } from '../transport';\nimport { CRDevTools } from './crDevTools';\nimport type { BrowserOptions, BrowserProcess } from '../browser';\nimport { Browser } from '../browser';\nimport type * as types from '../types';\nimport type * as channels from '@protocol/channels';\nimport type { HTTPRequestParams } from '../../utils/network';\nimport { fetchData } from '../../utils/network';\nimport { getUserAgent } from '../../utils/userAgent';\nimport { wrapInASCIIBox } from '../../utils/ascii';\nimport { debugMode, headersArrayToObject, headersObjectToArray, } from '../../utils';\nimport { removeFolders } from '../../utils/fileUtils';\nimport { RecentLogsCollector } from '../../utils/debugLogger';\nimport type { Progress } from '../progress';\nimport { ProgressController } from '../progress';\nimport { TimeoutSettings } from '../../common/timeoutSettings';\nimport { helper } from '../helper';\nimport type { CallMetadata, SdkObject } from '../instrumentation';\nimport type http from 'http';\nimport { registry } from '../registry';\nimport { ManualPromise } from '../../utils/manualPromise';\nimport { validateBrowserContextOptions } from '../browserContext';\nimport { chromiumSwitches } from './chromiumSwitches';\nimport type { ProtocolError } from '../protocolError';\n\nconst ARTIFACTS_FOLDER = path.join(os.tmpdir(), 'playwright-artifacts-');\n\nexport class Chromium extends BrowserType {\n  private _devtools: CRDevTools | undefined;\n\n  constructor(parent: SdkObject) {\n    super(parent, 'chromium');\n\n    if (debugMode())\n      this._devtools = this._createDevTools();\n  }\n\n  override async connectOverCDP(metadata: CallMetadata, endpointURL: string, options: { slowMo?: number, headers?: types.HeadersArray }, timeout?: number) {\n    const controller = new ProgressController(metadata, this);\n    controller.setLogName('browser');\n    return controller.run(async progress => {\n      return await this._connectOverCDPInternal(progress, endpointURL, options);\n    }, TimeoutSettings.timeout({ timeout }));\n  }\n\n  async _connectOverCDPInternal(progress: Progress, endpointURL: string, options: types.LaunchOptions & { headers?: types.HeadersArray }, onClose?: () => Promise<void>) {\n    let headersMap: { [key: string]: string; } | undefined;\n    if (options.headers)\n      headersMap = headersArrayToObject(options.headers, false);\n\n    if (!headersMap)\n      headersMap = { 'User-Agent': getUserAgent() };\n    else if (headersMap && !Object.keys(headersMap).some(key => key.toLowerCase() === 'user-agent'))\n      headersMap['User-Agent'] = getUserAgent();\n\n    const artifactsDir = await fs.promises.mkdtemp(ARTIFACTS_FOLDER);\n\n    const wsEndpoint = await urlToWSEndpoint(progress, endpointURL, headersMap);\n    progress.throwIfAborted();\n\n    const chromeTransport = await WebSocketTransport.connect(progress, wsEndpoint, headersMap);\n    const cleanedUp = new ManualPromise<void>();\n    const doCleanup = async () => {\n      await removeFolders([artifactsDir]);\n      await onClose?.();\n      cleanedUp.resolve();\n    };\n    const doClose = async () => {\n      await chromeTransport.closeAndWait();\n      await cleanedUp;\n    };\n    const browserProcess: BrowserProcess = { close: doClose, kill: doClose };\n    const persistent: channels.BrowserNewContextParams = { noDefaultViewport: true };\n    const browserOptions: BrowserOptions = {\n      slowMo: options.slowMo,\n      name: 'chromium',\n      isChromium: true,\n      persistent,\n      browserProcess,\n      protocolLogger: helper.debugProtocolLogger(),\n      browserLogsCollector: new RecentLogsCollector(),\n      artifactsDir,\n      downloadsPath: options.downloadsPath || artifactsDir,\n      tracesDir: options.tracesDir || artifactsDir,\n      originalLaunchOptions: {},\n    };\n    validateBrowserContextOptions(persistent, browserOptions);\n    progress.throwIfAborted();\n    const browser = await CRBrowser.connect(this.attribution.playwright, chromeTransport, browserOptions);\n    browser._isCollocatedWithServer = false;\n    browser.on(Browser.Events.Disconnected, doCleanup);\n    return browser;\n  }\n\n  private _createDevTools() {\n    // TODO: this is totally wrong when using channels.\n    const directory = registry.findExecutable('chromium').directory;\n    return directory ? new CRDevTools(path.join(directory, 'devtools-preferences.json')) : undefined;\n  }\n\n  override async connectToTransport(transport: ConnectionTransport, options: BrowserOptions): Promise<CRBrowser> {\n    let devtools = this._devtools;\n    if ((options as any).__testHookForDevTools) {\n      devtools = this._createDevTools();\n      await (options as any).__testHookForDevTools(devtools);\n    }\n    return CRBrowser.connect(this.attribution.playwright, transport, options, devtools);\n  }\n\n  override doRewriteStartupLog(error: ProtocolError): ProtocolError {\n    if (!error.logs)\n      return error;\n    if (error.logs.includes('Missing X server'))\n      error.logs = '\\n' + wrapInASCIIBox(kNoXServerRunningError, 1);\n    // These error messages are taken from Chromium source code as of July, 2020:\n    // https://github.com/chromium/chromium/blob/70565f67e79f79e17663ad1337dc6e63ee207ce9/content/browser/zygote_host/zygote_host_impl_linux.cc\n    if (!error.logs.includes('crbug.com/357670') && !error.logs.includes('No usable sandbox!') && !error.logs.includes('crbug.com/638180'))\n      return error;\n    error.logs = [\n      `Chromium sandboxing failed!`,\n      `================================`,\n      `To avoid the sandboxing issue, do either of the following:`,\n      `  - (preferred): Configure your environment to support sandboxing`,\n      `  - (alternative): Launch Chromium without sandbox using 'chromiumSandbox: false' option`,\n      `================================`,\n      ``,\n    ].join('\\n');\n    return error;\n  }\n\n  override amendEnvironment(env: Env, userDataDir: string, executable: string, browserArguments: string[]): Env {\n    return env;\n  }\n\n  override attemptToGracefullyCloseBrowser(transport: ConnectionTransport): void {\n    const message: ProtocolRequest = { method: 'Browser.close', id: kBrowserCloseMessageId, params: {} };\n    transport.send(message);\n  }\n\n  override async _launchWithSeleniumHub(progress: Progress, hubUrl: string, options: types.LaunchOptions): Promise<CRBrowser> {\n    await this._createArtifactDirs(options);\n\n    if (!hubUrl.endsWith('/'))\n      hubUrl = hubUrl + '/';\n\n    const args = this._innerDefaultArgs(options);\n    args.push('--remote-debugging-port=0');\n    const isEdge = options.channel && options.channel.startsWith('msedge');\n    let desiredCapabilities = {\n      'browserName': isEdge ? 'MicrosoftEdge' : 'chrome',\n      [isEdge ? 'ms:edgeOptions' : 'goog:chromeOptions']: { args }\n    };\n\n    if (process.env.SELENIUM_REMOTE_CAPABILITIES) {\n      const remoteCapabilities = parseSeleniumRemoteParams({ name: 'capabilities', value: process.env.SELENIUM_REMOTE_CAPABILITIES }, progress);\n      if (remoteCapabilities)\n        desiredCapabilities = { ...desiredCapabilities, ...remoteCapabilities };\n    }\n\n    let headers: { [key: string]: string } = {};\n    if (process.env.SELENIUM_REMOTE_HEADERS) {\n      const remoteHeaders = parseSeleniumRemoteParams({ name: 'headers', value: process.env.SELENIUM_REMOTE_HEADERS }, progress);\n      if (remoteHeaders)\n        headers = remoteHeaders;\n    }\n\n    progress.log(`<selenium> connecting to ${hubUrl}`);\n    const response = await fetchData({\n      url: hubUrl + 'session',\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json; charset=utf-8',\n        ...headers,\n      },\n      data: JSON.stringify({\n        capabilities: { alwaysMatch: desiredCapabilities }\n      }),\n      timeout: progress.timeUntilDeadline(),\n    }, seleniumErrorHandler);\n    const value = JSON.parse(response).value;\n    const sessionId = value.sessionId;\n    progress.log(`<selenium> connected to sessionId=${sessionId}`);\n\n    const disconnectFromSelenium = async () => {\n      progress.log(`<selenium> disconnecting from sessionId=${sessionId}`);\n      await fetchData({\n        url: hubUrl + 'session/' + sessionId,\n        method: 'DELETE',\n        headers,\n      }).catch(error => progress.log(`<error disconnecting from selenium>: ${error}`));\n      progress.log(`<selenium> disconnected from sessionId=${sessionId}`);\n      gracefullyCloseSet.delete(disconnectFromSelenium);\n    };\n    gracefullyCloseSet.add(disconnectFromSelenium);\n\n    try {\n      const capabilities = value.capabilities;\n      let endpointURL: URL;\n\n      if (capabilities['se:cdp']) {\n        // Selenium 4 - use built-in CDP websocket proxy.\n        progress.log(`<selenium> using selenium v4`);\n        const endpointURLString = addProtocol(capabilities['se:cdp']);\n        endpointURL = new URL(endpointURLString);\n        if (endpointURL.hostname === 'localhost' || endpointURL.hostname === '127.0.0.1')\n          endpointURL.hostname = new URL(hubUrl).hostname;\n        progress.log(`<selenium> retrieved endpoint ${endpointURL.toString()} for sessionId=${sessionId}`);\n      } else {\n        // Selenium 3 - resolve target node IP to use instead of localhost ws url.\n        progress.log(`<selenium> using selenium v3`);\n        const maybeChromeOptions = capabilities['goog:chromeOptions'];\n        const chromeOptions = maybeChromeOptions && typeof maybeChromeOptions === 'object' ? maybeChromeOptions : undefined;\n        const debuggerAddress = chromeOptions && typeof chromeOptions.debuggerAddress === 'string' ? chromeOptions.debuggerAddress : undefined;\n        const chromeOptionsURL = typeof maybeChromeOptions === 'string' ? maybeChromeOptions : undefined;\n        // TODO(dgozman): figure out if we can make ChromeDriver to return 127.0.0.1 instead of localhost.\n        const endpointURLString = addProtocol(debuggerAddress || chromeOptionsURL).replace('localhost', '127.0.0.1');\n        progress.log(`<selenium> retrieved endpoint ${endpointURLString} for sessionId=${sessionId}`);\n        endpointURL = new URL(endpointURLString);\n        if (endpointURL.hostname === 'localhost' || endpointURL.hostname === '127.0.0.1') {\n          const sessionInfoUrl = new URL(hubUrl).origin + '/grid/api/testsession?session=' + sessionId;\n          try {\n            const sessionResponse = await fetchData({\n              url: sessionInfoUrl,\n              method: 'GET',\n              timeout: progress.timeUntilDeadline(),\n              headers,\n            }, seleniumErrorHandler);\n            const proxyId = JSON.parse(sessionResponse).proxyId;\n            endpointURL.hostname = new URL(proxyId).hostname;\n            progress.log(`<selenium> resolved endpoint ip ${endpointURL.toString()} for sessionId=${sessionId}`);\n          } catch (e) {\n            progress.log(`<selenium> unable to resolve endpoint ip for sessionId=${sessionId}, running in standalone?`);\n          }\n        }\n      }\n\n      return await this._connectOverCDPInternal(progress, endpointURL.toString(), {\n        ...options,\n        headers: headersObjectToArray(headers),\n      }, disconnectFromSelenium);\n    } catch (e) {\n      await disconnectFromSelenium();\n      throw e;\n    }\n  }\n\n  override defaultArgs(options: types.LaunchOptions, isPersistent: boolean, userDataDir: string): string[] {\n    const chromeArguments = this._innerDefaultArgs(options);\n    chromeArguments.push(`--user-data-dir=${userDataDir}`);\n    if (options.useWebSocket)\n      chromeArguments.push('--remote-debugging-port=0');\n    else\n      chromeArguments.push('--remote-debugging-pipe');\n    if (isPersistent)\n      chromeArguments.push('about:blank');\n    else\n      chromeArguments.push('--no-startup-window');\n    return chromeArguments;\n  }\n\n  private _innerDefaultArgs(options: types.LaunchOptions): string[] {\n    const { args = [], proxy } = options;\n    const userDataDirArg = args.find(arg => arg.startsWith('--user-data-dir'));\n    if (userDataDirArg)\n      throw this._createUserDataDirArgMisuseError('--user-data-dir');\n    if (args.find(arg => arg.startsWith('--remote-debugging-pipe')))\n      throw new Error('Playwright manages remote debugging connection itself.');\n    if (args.find(arg => !arg.startsWith('-')))\n      throw new Error('Arguments can not specify page to be opened');\n    const chromeArguments = [...chromiumSwitches];\n\n    if (os.platform() === 'darwin') {\n      // See https://github.com/microsoft/playwright/issues/7362\n      chromeArguments.push('--enable-use-zoom-for-dsf=false');\n      // See https://bugs.chromium.org/p/chromium/issues/detail?id=1407025.\n      if (options.headless)\n        chromeArguments.push('--use-angle');\n    }\n\n    if (options.devtools)\n      chromeArguments.push('--auto-open-devtools-for-tabs');\n    if (options.headless) {\n      if (process.env.PLAYWRIGHT_CHROMIUM_USE_HEADLESS_NEW)\n        chromeArguments.push('--headless=new');\n      else\n        chromeArguments.push('--headless=old');\n\n      chromeArguments.push(\n          '--hide-scrollbars',\n          '--mute-audio',\n          '--blink-settings=primaryHoverType=2,availableHoverTypes=2,primaryPointerType=4,availablePointerTypes=4',\n      );\n    }\n    if (options.chromiumSandbox !== true)\n      chromeArguments.push('--no-sandbox');\n    if (proxy) {\n      const proxyURL = new URL(proxy.server);\n      const isSocks = proxyURL.protocol === 'socks5:';\n      // https://www.chromium.org/developers/design-documents/network-settings\n      if (isSocks && !this.attribution.playwright.options.socksProxyPort) {\n        // https://www.chromium.org/developers/design-documents/network-stack/socks-proxy\n        chromeArguments.push(`--host-resolver-rules=\"MAP * ~NOTFOUND , EXCLUDE ${proxyURL.hostname}\"`);\n      }\n      chromeArguments.push(`--proxy-server=${proxy.server}`);\n      const proxyBypassRules = [];\n      // https://source.chromium.org/chromium/chromium/src/+/master:net/docs/proxy.md;l=548;drc=71698e610121078e0d1a811054dcf9fd89b49578\n      if (this.attribution.playwright.options.socksProxyPort)\n        proxyBypassRules.push('<-loopback>');\n      if (proxy.bypass)\n        proxyBypassRules.push(...proxy.bypass.split(',').map(t => t.trim()).map(t => t.startsWith('.') ? '*' + t : t));\n      if (!process.env.PLAYWRIGHT_DISABLE_FORCED_CHROMIUM_PROXIED_LOOPBACK && !proxyBypassRules.includes('<-loopback>'))\n        proxyBypassRules.push('<-loopback>');\n      if (proxyBypassRules.length > 0)\n        chromeArguments.push(`--proxy-bypass-list=${proxyBypassRules.join(';')}`);\n    }\n    chromeArguments.push(...args);\n    return chromeArguments;\n  }\n\n  override readyState(options: types.LaunchOptions): BrowserReadyState | undefined {\n    if (options.useWebSocket || options.args?.some(a => a.startsWith('--remote-debugging-port')))\n      return new ChromiumReadyState();\n    return undefined;\n  }\n}\n\nclass ChromiumReadyState implements BrowserReadyState {\n  private readonly _wsEndpoint = new ManualPromise<string|undefined>();\n\n  onBrowserOutput(message: string): void {\n    const match = message.match(/DevTools listening on (.*)/);\n    if (match)\n      this._wsEndpoint.resolve(match[1]);\n  }\n  onBrowserExit(): void {\n    this._wsEndpoint.resolve(undefined);\n  }\n  async waitUntilReady(): Promise<{ wsEndpoint?: string }> {\n    const wsEndpoint = await this._wsEndpoint;\n    return { wsEndpoint };\n  }\n}\n\nasync function urlToWSEndpoint(progress: Progress, endpointURL: string, headers: { [key: string]: string; }) {\n  if (endpointURL.startsWith('ws'))\n    return endpointURL;\n  progress.log(`<ws preparing> retrieving websocket url from ${endpointURL}`);\n  const httpURL = endpointURL.endsWith('/') ? `${endpointURL}json/version/` : `${endpointURL}/json/version/`;\n  const json = await fetchData({\n    url: httpURL,\n    headers,\n  }, async (_, resp) => new Error(`Unexpected status ${resp.statusCode} when connecting to ${httpURL}.\\n` +\n    `This does not look like a DevTools server, try connecting via ws://.`)\n  );\n  return JSON.parse(json).webSocketDebuggerUrl;\n}\n\nasync function seleniumErrorHandler(params: HTTPRequestParams, response: http.IncomingMessage) {\n  const body = await streamToString(response);\n  let message = body;\n  try {\n    const json = JSON.parse(body);\n    message = json.value.localizedMessage || json.value.message;\n  } catch (e) {\n  }\n  return new Error(`Error connecting to Selenium at ${params.url}: ${message}`);\n}\n\nfunction addProtocol(url: string) {\n  if (!['ws://', 'wss://', 'http://', 'https://'].some(protocol => url.startsWith(protocol)))\n    return 'http://' + url;\n  return url;\n}\n\nfunction streamToString(stream: stream.Readable): Promise<string> {\n  return new Promise<string>((resolve, reject) => {\n    const chunks: Buffer[] = [];\n    stream.on('data', chunk => chunks.push(Buffer.from(chunk)));\n    stream.on('error', reject);\n    stream.on('end', () => resolve(Buffer.concat(chunks).toString('utf8')));\n  });\n}\n\nfunction parseSeleniumRemoteParams(env: {name: string, value: string}, progress: Progress) {\n  try {\n    const parsed = JSON.parse(env.value);\n    progress.log(`<selenium> using additional ${env.name} \"${env.value}\"`);\n    return parsed;\n  } catch (e) {\n    progress.log(`<selenium> ignoring additional ${env.name} \"${env.value}\": ${e}`);\n  }\n}\n"],"mappings":"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"}