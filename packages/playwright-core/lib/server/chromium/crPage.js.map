{"version":3,"file":"crPage.js","names":["_path","_interopRequireDefault","require","_eventsHelper","_registry","_stackTrace","_utils","dialog","_interopRequireWildcard","dom","frames","_helper","network","_page","_crAccessibility","_crBrowser","_crCoverage","_crDragDrop","_crExecutionContext","_crInput","_crNetworkManager","_crPdf","_crProtocolHelper","_defaultFontFamilies","_videoRecorder","_browserContext","_errors","_protocolError","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","obj","UTILITY_WORLD_NAME","CRPage","mainFrameSession","page","crPage","_delegate","_mainFrameSession","constructor","client","targetId","browserContext","opener","bits","_sessions","Map","rawMouse","rawKeyboard","rawTouchscreen","_targetId","_opener","_networkManager","_pdf","_coverage","_pagePromise","_initializedPage","_isBackgroundPage","_nextWindowOpenPopupFeatures","isBackgroundPage","dragManager","DragManager","RawKeyboardImpl","_browser","_platform","RawMouseImpl","RawTouchscreenImpl","CRPDF","CRCoverage","Page","CRNetworkManager","updateOffline","updateExtraHTTPHeaders","updateHttpCredentials","updateRequestInterception","FrameSession","_options","noDefaultViewport","features","shift","viewportSize","helper","getViewportSizeFromWindowFeatures","_emulatedSize","viewport","screen","_initialize","hasUIWindow","then","initOpener","catch","_reportAsNew","potentiallyUninitializedPage","error","reportAsNew","CRBrowserContext","CREvents","BackgroundPage","BrowserContext","Events","_forAllFrameSessions","cb","frameSessions","Array","from","values","Promise","all","map","frameSession","_isMainFrame","isSessionClosedError","_sessionForFrame","frame","_id","parent","parentFrame","Error","_sessionForHandle","handle","_context","willBeginDownload","_willBeginDownload","pageOrError","didClose","session","dispose","_didClose","navigateFrame","url","referrer","_navigate","headers","mergeHeaders","extraHTTPHeaders","setExtraHTTPHeaders","updateGeolocation","_updateGeolocation","setOffline","offline","authenticate","httpCredentials","updateEmulatedViewportSize","preserveWindowBoundaries","_updateViewport","bringToFront","_client","send","updateEmulateMedia","_updateEmulateMedia","updateUserAgent","_updateUserAgent","setRequestInterception","needsRequestInterception","updateFileChooserInterception","_updateFileChooserInterception","reload","_go","delta","history","entry","entries","currentIndex","entryId","id","goBack","goForward","addInitScript","initScript","world","_evaluateOnNewDocument","removeNonInternalInitScripts","_removeEvaluatesOnNewDocument","closePage","runBeforeUnload","_closePage","setBackgroundColor","color","takeScreenshot","progress","format","documentRect","viewportRect","quality","fitsViewport","scale","visualViewport","x","pageX","y","pageY","enclosingIntSize","width","height","clip","deviceScaleFactor","throwIfAborted","result","captureBeyondViewport","Buffer","data","getContentFrame","_getContentFrame","getOwnerFrame","_getOwnerFrame","isElementHandle","remoteObject","subtype","getBoundingBox","_getBoundingBox","scrollRectIntoViewIfNeeded","rect","_scrollRectIntoViewIfNeeded","setScreencastOptions","options","_startScreencast","maxWidth","maxHeight","_stopScreencast","rafCountForStablePosition","getContentQuads","_getContentQuads","setInputFiles","files","evaluateInUtility","injected","node","setInputFilePaths","ownerFrame","parentSession","objectId","_objectId","adoptElementHandle","to","_adoptElementHandle","getAccessibilityTree","needle","inputActionEpilogue","resetForReuse","pdf","generate","coverage","getFrameElement","backendNodeId","frameId","message","includes","rewriteErrorMessage","_adoptBackendNodeId","_mainContext","shouldToggleStyleSheetToSyncAnimations","exports","_crPage","_parentSession","_childSessions","Set","_contextIdToContext","_eventListeners","_firstNonInitialNavigationCommittedPromise","_firstNonInitialNavigationCommittedFulfill","_firstNonInitialNavigationCommittedReject","_windowId","_swappedIn","_screencastId","_screencastClients","_evaluateOnNewDocumentIdentifiers","_metricsOverride","_workerSessions","add","f","_addRendererListeners","push","eventsHelper","addEventListener","event","_onLogEntryAdded","_onFileChooserOpened","_onFrameAttached","parentFrameId","_onFrameDetached","reason","_onFrameNavigated","_onFrameRequestedNavigation","_onDialog","_onFrameNavigatedWithinDocument","_onBindingCalled","_onConsoleAPI","exception","_handleException","exceptionDetails","_onExecutionContextCreated","context","_onExecutionContextDestroyed","executionContextId","_onExecutionContextsCleared","_onAttachedToTarget","_onDetachedFromTarget","_addBrowserListeners","_onTargetCrashed","_onScreencastFrame","_onWindowOpen","isSettingStorageState","isClank","windowId","screencastOptions","recordVideo","screencastId","createGuid","outputFile","path","join","dir","size","_ensureVideosPath","_createVideoRecorder","p","_stopVideoRecording","lifecycleEventsEnabled","promises","frameTree","_handleFrameTree","localFrames","_frameManager","_sendMayFail","grantUniveralAccess","worldName","allInitScripts","evaluateExpression","source","isInitialEmptyPage","mainFrame","_onLifecycleEvent","enabled","name","PageBinding","kPlaywrightBinding","addSession","undefined","autoAttach","waitForDebuggerOnStart","flatten","bypassCSP","ignoreHTTPSErrors","ignore","hasTouch","javaScriptEnabled","value","userAgent","locale","emulateLocale","timezoneId","emulateTimezone","headful","_setDefaultFontFamilies","_startVideoRecording","TargetClosedError","childSession","delete","removeEventListeners","removeSession","response","referrerPolicy","errorText","NavigationAbortedError","loaderId","newDocumentId","_eventBelongsToStaleFrame","frameLifecycleEvent","parentId","childFrames","child","removeChildFramesRecursively","frameAttached","framePayload","initial","frameCommittedNewDocumentNavigation","urlFragment","payload","disposition","frameRequestedNavigation","frameCommittedSameDocumentNavigation","frameDetached","contextPayload","auxData","delegate","CRExecutionContext","isDefault","FrameExecutionContext","contextDelegateSymbol","_contextCreated","_contextDestroyed","contextId","keys","_this$_page$_frameMan","createChildSession","sessionId","targetInfo","type","detach","worker","Worker","_addWorker","once","_createExecutionContext","on","args","o","_existingExecutionContext","createHandle","_addConsoleMessage","toConsoleMessageLocation","stackTrace","emitOnContextOnceInitialized","PageError","exceptionToError","workerSession","_removeWorker","childFrameSession","windowFeatures","arg","emitOnContext","Dialog","accept","promptText","defaultPrompt","_markAsCrashed","_didCrash","level","text","lineNumber","releaseObject","location","columnNumber","utilityContext","_utilityContext","originPage","throttleScreencastFrameAck","buffer","emit","ScreencastFrame","timestamp","metadata","deviceWidth","deviceHeight","assert","ffmpegPath","registry","findExecutable","executablePathOrDie","attribution","playwright","sdkLanguage","VideoRecorder","launch","Close","gotFirstFrame","_videoStarted","recorder","stop","video","_takeVideo","reportFinished","geolocation","emulatedSize","screenSize","isLandscape","metricsOverride","mobile","isMobile","screenWidth","screenHeight","screenOrientation","angle","dontSetVisibleSize","JSON","stringify","insets","process","platform","isPersistentContext","setWindowBounds","windowBounds","bounds","emulatedMedia","media","colorScheme","reducedMotion","forcedColors","acceptLanguage","userAgentMetadata","calculateUserAgentMetadata","fontFamilies","platformToFontFamilies","fileChooserIntercepted","identifier","internal","identifiers","nodeInfo","documentElement","evaluateHandle","doc","ownerDocument","quad","model","border","Math","min","max","position","_framePosition","element","frameElement","box","boundingBox","quads","_contextId","object","kUnableToAdoptErrorMessage","asElement","Symbol","ua","architecture","platformVersion","androidMatch","match","iPhoneMatch","iPadMatch","macOSMatch","windowsMatch","toLowerCase"],"sources":["../../../src/server/chromium/crPage.ts"],"sourcesContent":["/**\n * Copyright 2017 Google Inc. All rights reserved.\n * Modifications copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport path from 'path';\nimport type { RegisteredListener } from '../../utils/eventsHelper';\nimport { eventsHelper } from '../../utils/eventsHelper';\nimport { registry } from '../registry';\nimport { rewriteErrorMessage } from '../../utils/stackTrace';\nimport { assert, createGuid } from '../../utils';\nimport * as dialog from '../dialog';\nimport * as dom from '../dom';\nimport * as frames from '../frames';\nimport { helper } from '../helper';\nimport * as network from '../network';\nimport { type InitScript, PageBinding, type PageDelegate } from '../page';\nimport { Page, Worker } from '../page';\nimport type { Progress } from '../progress';\nimport type * as types from '../types';\nimport type * as channels from '@protocol/channels';\nimport { getAccessibilityTree } from './crAccessibility';\nimport { CRBrowserContext } from './crBrowser';\nimport type { CRSession } from './crConnection';\nimport { CRCoverage } from './crCoverage';\nimport { DragManager } from './crDragDrop';\nimport { CRExecutionContext } from './crExecutionContext';\nimport { RawKeyboardImpl, RawMouseImpl, RawTouchscreenImpl } from './crInput';\nimport { CRNetworkManager } from './crNetworkManager';\nimport { CRPDF } from './crPdf';\nimport { exceptionToError, releaseObject, toConsoleMessageLocation } from './crProtocolHelper';\nimport { platformToFontFamilies } from './defaultFontFamilies';\nimport type { Protocol } from './protocol';\nimport { VideoRecorder } from './videoRecorder';\nimport { BrowserContext } from '../browserContext';\nimport { TargetClosedError } from '../errors';\nimport { isSessionClosedError } from '../protocolError';\n\n\nconst UTILITY_WORLD_NAME = '__playwright_utility_world__';\nexport type WindowBounds = { top?: number, left?: number, width?: number, height?: number };\n\nexport class CRPage implements PageDelegate {\n  readonly _mainFrameSession: FrameSession;\n  readonly _sessions = new Map<Protocol.Target.TargetID, FrameSession>();\n  readonly _page: Page;\n  readonly rawMouse: RawMouseImpl;\n  readonly rawKeyboard: RawKeyboardImpl;\n  readonly rawTouchscreen: RawTouchscreenImpl;\n  readonly _targetId: string;\n  readonly _opener: CRPage | null;\n  readonly _networkManager: CRNetworkManager;\n  private readonly _pdf: CRPDF;\n  private readonly _coverage: CRCoverage;\n  readonly _browserContext: CRBrowserContext;\n  private readonly _pagePromise: Promise<Page | Error>;\n  _initializedPage: Page | null = null;\n  private _isBackgroundPage: boolean;\n\n  // Holds window features for the next popup being opened via window.open,\n  // until the popup target arrives. This could be racy if two oopifs\n  // simultaneously call window.open with window features: the order\n  // of their Page.windowOpen events is not guaranteed to match the order\n  // of new popup targets.\n  readonly _nextWindowOpenPopupFeatures: string[][] = [];\n\n  static mainFrameSession(page: Page): FrameSession {\n    const crPage = page._delegate as CRPage;\n    return crPage._mainFrameSession;\n  }\n\n  constructor(client: CRSession, targetId: string, browserContext: CRBrowserContext, opener: CRPage | null, bits: { hasUIWindow: boolean, isBackgroundPage: boolean }) {\n    this._targetId = targetId;\n    this._opener = opener;\n    this._isBackgroundPage = bits.isBackgroundPage;\n    const dragManager = new DragManager(this);\n    this.rawKeyboard = new RawKeyboardImpl(client, browserContext._browser._platform() === 'mac', dragManager);\n    this.rawMouse = new RawMouseImpl(this, client, dragManager);\n    this.rawTouchscreen = new RawTouchscreenImpl(client);\n    this._pdf = new CRPDF(client);\n    this._coverage = new CRCoverage(client);\n    this._browserContext = browserContext;\n    this._page = new Page(this, browserContext);\n    this._networkManager = new CRNetworkManager(this._page, null);\n    // Sync any browser context state to the network manager. This does not talk over CDP because\n    // we have not connected any sessions to the network manager yet.\n    this.updateOffline();\n    this.updateExtraHTTPHeaders();\n    this.updateHttpCredentials();\n    this.updateRequestInterception();\n    this._mainFrameSession = new FrameSession(this, client, targetId, null);\n    this._sessions.set(targetId, this._mainFrameSession);\n    if (opener && !browserContext._options.noDefaultViewport) {\n      const features = opener._nextWindowOpenPopupFeatures.shift() || [];\n      const viewportSize = helper.getViewportSizeFromWindowFeatures(features);\n      if (viewportSize)\n        this._page._emulatedSize = { viewport: viewportSize, screen: viewportSize };\n    }\n    // Note: it is important to call |reportAsNew| before resolving pageOrError promise,\n    // so that anyone who awaits pageOrError got a ready and reported page.\n    this._pagePromise = this._mainFrameSession._initialize(bits.hasUIWindow).then(async r => {\n      await this._page.initOpener(this._opener);\n      return r;\n    }).catch(async e => {\n      await this._page.initOpener(this._opener);\n      throw e;\n    }).then(() => {\n      this._initializedPage = this._page;\n      this._reportAsNew();\n      return this._page;\n    }).catch(e => {\n      this._reportAsNew(e);\n      return e;\n    });\n  }\n\n  potentiallyUninitializedPage(): Page {\n    return this._page;\n  }\n\n  private _reportAsNew(error?: Error) {\n    this._page.reportAsNew(error, this._isBackgroundPage ? CRBrowserContext.CREvents.BackgroundPage : BrowserContext.Events.Page);\n  }\n\n  private async _forAllFrameSessions(cb: (frame: FrameSession) => Promise<any>) {\n    const frameSessions = Array.from(this._sessions.values());\n    await Promise.all(frameSessions.map(frameSession => {\n      if (frameSession._isMainFrame())\n        return cb(frameSession);\n      return cb(frameSession).catch(e => {\n        // Broadcasting a message to the closed iframe should be a noop.\n        if (isSessionClosedError(e))\n          return;\n        throw e;\n      });\n    }));\n  }\n\n  _sessionForFrame(frame: frames.Frame): FrameSession {\n    // Frame id equals target id.\n    while (!this._sessions.has(frame._id)) {\n      const parent = frame.parentFrame();\n      if (!parent)\n        throw new Error(`Frame has been detached.`);\n      frame = parent;\n    }\n    return this._sessions.get(frame._id)!;\n  }\n\n  private _sessionForHandle(handle: dom.ElementHandle): FrameSession {\n    const frame = handle._context.frame;\n    return this._sessionForFrame(frame);\n  }\n\n  willBeginDownload() {\n    this._mainFrameSession._willBeginDownload();\n  }\n\n  async pageOrError(): Promise<Page | Error> {\n    return this._pagePromise;\n  }\n\n  didClose() {\n    for (const session of this._sessions.values())\n      session.dispose();\n    this._page._didClose();\n  }\n\n  async navigateFrame(frame: frames.Frame, url: string, referrer: string | undefined): Promise<frames.GotoResult> {\n    return this._sessionForFrame(frame)._navigate(frame, url, referrer);\n  }\n\n  async updateExtraHTTPHeaders(): Promise<void> {\n    const headers = network.mergeHeaders([\n      this._browserContext._options.extraHTTPHeaders,\n      this._page.extraHTTPHeaders()\n    ]);\n    await this._networkManager.setExtraHTTPHeaders(headers);\n  }\n\n  async updateGeolocation(): Promise<void> {\n    await this._forAllFrameSessions(frame => frame._updateGeolocation(false));\n  }\n\n  async updateOffline(): Promise<void> {\n    await this._networkManager.setOffline(!!this._browserContext._options.offline);\n  }\n\n  async updateHttpCredentials(): Promise<void> {\n    await this._networkManager.authenticate(this._browserContext._options.httpCredentials || null);\n  }\n\n  async updateEmulatedViewportSize(preserveWindowBoundaries?: boolean): Promise<void> {\n    await this._mainFrameSession._updateViewport(preserveWindowBoundaries);\n  }\n\n  async bringToFront(): Promise<void> {\n    await this._mainFrameSession._client.send('Page.bringToFront');\n  }\n\n  async updateEmulateMedia(): Promise<void> {\n    await this._forAllFrameSessions(frame => frame._updateEmulateMedia());\n  }\n\n  async updateUserAgent(): Promise<void> {\n    await this._forAllFrameSessions(frame => frame._updateUserAgent());\n  }\n\n  async updateRequestInterception(): Promise<void> {\n    await this._networkManager.setRequestInterception(this._page.needsRequestInterception());\n  }\n\n  async updateFileChooserInterception() {\n    await this._forAllFrameSessions(frame => frame._updateFileChooserInterception(false));\n  }\n\n  async reload(): Promise<void> {\n    await this._mainFrameSession._client.send('Page.reload');\n  }\n\n  private async _go(delta: number): Promise<boolean> {\n    const history = await this._mainFrameSession._client.send('Page.getNavigationHistory');\n    const entry = history.entries[history.currentIndex + delta];\n    if (!entry)\n      return false;\n    await this._mainFrameSession._client.send('Page.navigateToHistoryEntry', { entryId: entry.id });\n    return true;\n  }\n\n  goBack(): Promise<boolean> {\n    return this._go(-1);\n  }\n\n  goForward(): Promise<boolean> {\n    return this._go(+1);\n  }\n\n  async addInitScript(initScript: InitScript, world: types.World = 'main'): Promise<void> {\n    await this._forAllFrameSessions(frame => frame._evaluateOnNewDocument(initScript, world));\n  }\n\n  async removeNonInternalInitScripts() {\n    await this._forAllFrameSessions(frame => frame._removeEvaluatesOnNewDocument());\n  }\n\n  async closePage(runBeforeUnload: boolean): Promise<void> {\n    if (runBeforeUnload)\n      await this._mainFrameSession._client.send('Page.close');\n    else\n      await this._browserContext._browser._closePage(this);\n  }\n\n  async setBackgroundColor(color?: { r: number; g: number; b: number; a: number; }): Promise<void> {\n    await this._mainFrameSession._client.send('Emulation.setDefaultBackgroundColorOverride', { color });\n  }\n\n  async takeScreenshot(progress: Progress, format: 'png' | 'jpeg', documentRect: types.Rect | undefined, viewportRect: types.Rect | undefined, quality: number | undefined, fitsViewport: boolean, scale: 'css' | 'device'): Promise<Buffer> {\n    const { visualViewport } = await this._mainFrameSession._client.send('Page.getLayoutMetrics');\n    if (!documentRect) {\n      documentRect = {\n        x: visualViewport.pageX + viewportRect!.x,\n        y: visualViewport.pageY + viewportRect!.y,\n        ...helper.enclosingIntSize({\n          width: viewportRect!.width / visualViewport.scale,\n          height: viewportRect!.height / visualViewport.scale,\n        })\n      };\n    }\n    // When taking screenshots with documentRect (based on the page content, not viewport),\n    // ignore current page scale.\n    const clip = { ...documentRect, scale: viewportRect ? visualViewport.scale : 1 };\n    if (scale === 'css') {\n      const deviceScaleFactor = this._browserContext._options.deviceScaleFactor || 1;\n      clip.scale /= deviceScaleFactor;\n    }\n    progress.throwIfAborted();\n    const result = await this._mainFrameSession._client.send('Page.captureScreenshot', { format, quality, clip, captureBeyondViewport: !fitsViewport });\n    return Buffer.from(result.data, 'base64');\n  }\n\n  async getContentFrame(handle: dom.ElementHandle): Promise<frames.Frame | null> {\n    return this._sessionForHandle(handle)._getContentFrame(handle);\n  }\n\n  async getOwnerFrame(handle: dom.ElementHandle): Promise<string | null> {\n    return this._sessionForHandle(handle)._getOwnerFrame(handle);\n  }\n\n  isElementHandle(remoteObject: any): boolean {\n    return (remoteObject as Protocol.Runtime.RemoteObject).subtype === 'node';\n  }\n\n  async getBoundingBox(handle: dom.ElementHandle): Promise<types.Rect | null> {\n    return this._sessionForHandle(handle)._getBoundingBox(handle);\n  }\n\n  async scrollRectIntoViewIfNeeded(handle: dom.ElementHandle, rect?: types.Rect): Promise<'error:notvisible' | 'error:notconnected' | 'done'> {\n    return this._sessionForHandle(handle)._scrollRectIntoViewIfNeeded(handle, rect);\n  }\n\n  async setScreencastOptions(options: { width: number, height: number, quality: number } | null): Promise<void> {\n    if (options) {\n      await this._mainFrameSession._startScreencast(this, {\n        format: 'jpeg',\n        quality: options.quality,\n        maxWidth: options.width,\n        maxHeight: options.height\n      });\n    } else {\n      await this._mainFrameSession._stopScreencast(this);\n    }\n  }\n\n  rafCountForStablePosition(): number {\n    return 1;\n  }\n\n  async getContentQuads(handle: dom.ElementHandle): Promise<types.Quad[] | null> {\n    return this._sessionForHandle(handle)._getContentQuads(handle);\n  }\n\n  async setInputFiles(handle: dom.ElementHandle<HTMLInputElement>, files: types.FilePayload[]): Promise<void> {\n    await handle.evaluateInUtility(([injected, node, files]) =>\n      injected.setInputFiles(node, files), files);\n  }\n\n  async setInputFilePaths(handle: dom.ElementHandle<HTMLInputElement>, files: string[]): Promise<void> {\n    const frame = await handle.ownerFrame();\n    if (!frame)\n      throw new Error('Cannot set input files to detached input element');\n    const parentSession = this._sessionForFrame(frame);\n    await parentSession._client.send('DOM.setFileInputFiles', {\n      objectId: handle._objectId,\n      files\n    });\n  }\n\n  async adoptElementHandle<T extends Node>(handle: dom.ElementHandle<T>, to: dom.FrameExecutionContext): Promise<dom.ElementHandle<T>> {\n    return this._sessionForHandle(handle)._adoptElementHandle<T>(handle, to);\n  }\n\n  async getAccessibilityTree(needle?: dom.ElementHandle) {\n    return getAccessibilityTree(this._mainFrameSession._client, needle);\n  }\n\n  async inputActionEpilogue(): Promise<void> {\n    await this._mainFrameSession._client.send('Page.enable').catch(e => {});\n  }\n\n  async resetForReuse(): Promise<void> {\n  }\n\n  async pdf(options: channels.PagePdfParams): Promise<Buffer> {\n    return this._pdf.generate(options);\n  }\n\n  coverage(): CRCoverage {\n    return this._coverage;\n  }\n\n  async getFrameElement(frame: frames.Frame): Promise<dom.ElementHandle> {\n    let parent = frame.parentFrame();\n    if (!parent)\n      throw new Error('Frame has been detached.');\n    const parentSession = this._sessionForFrame(parent);\n    const { backendNodeId } = await parentSession._client.send('DOM.getFrameOwner', { frameId: frame._id }).catch(e => {\n      if (e instanceof Error && e.message.includes('Frame with the given id was not found.'))\n        rewriteErrorMessage(e, 'Frame has been detached.');\n      throw e;\n    });\n    parent = frame.parentFrame();\n    if (!parent)\n      throw new Error('Frame has been detached.');\n    return parentSession._adoptBackendNodeId(backendNodeId, await parent._mainContext());\n  }\n\n  shouldToggleStyleSheetToSyncAnimations(): boolean {\n    return false;\n  }\n}\n\nclass FrameSession {\n  readonly _client: CRSession;\n  readonly _crPage: CRPage;\n  readonly _page: Page;\n  private readonly _parentSession: FrameSession | null;\n  private readonly _childSessions = new Set<FrameSession>();\n  private readonly _contextIdToContext = new Map<number, dom.FrameExecutionContext>();\n  private _eventListeners: RegisteredListener[] = [];\n  readonly _targetId: string;\n  private _firstNonInitialNavigationCommittedPromise: Promise<void>;\n  private _firstNonInitialNavigationCommittedFulfill = () => {};\n  private _firstNonInitialNavigationCommittedReject = (e: Error) => {};\n  private _windowId: number | undefined;\n  // Marks the oopif session that remote -> local transition has happened in the parent.\n  // See Target.detachedFromTarget handler for details.\n  private _swappedIn = false;\n  private _videoRecorder: VideoRecorder | null = null;\n  private _screencastId: string | null = null;\n  private _screencastClients = new Set<any>();\n  private _evaluateOnNewDocumentIdentifiers: string[] = [];\n  private _metricsOverride: Protocol.Emulation.setDeviceMetricsOverrideParameters | undefined;\n  private _workerSessions = new Map<string, CRSession>();\n\n  constructor(crPage: CRPage, client: CRSession, targetId: string, parentSession: FrameSession | null) {\n    this._client = client;\n    this._crPage = crPage;\n    this._page = crPage._page;\n    this._targetId = targetId;\n    this._parentSession = parentSession;\n    if (parentSession)\n      parentSession._childSessions.add(this);\n    this._firstNonInitialNavigationCommittedPromise = new Promise((f, r) => {\n      this._firstNonInitialNavigationCommittedFulfill = f;\n      this._firstNonInitialNavigationCommittedReject = r;\n    });\n  }\n\n  _isMainFrame(): boolean {\n    return this._targetId === this._crPage._targetId;\n  }\n\n  private _addRendererListeners() {\n    this._eventListeners.push(...[\n      eventsHelper.addEventListener(this._client, 'Log.entryAdded', event => this._onLogEntryAdded(event)),\n      eventsHelper.addEventListener(this._client, 'Page.fileChooserOpened', event => this._onFileChooserOpened(event)),\n      eventsHelper.addEventListener(this._client, 'Page.frameAttached', event => this._onFrameAttached(event.frameId, event.parentFrameId)),\n      eventsHelper.addEventListener(this._client, 'Page.frameDetached', event => this._onFrameDetached(event.frameId, event.reason)),\n      eventsHelper.addEventListener(this._client, 'Page.frameNavigated', event => this._onFrameNavigated(event.frame, false)),\n      eventsHelper.addEventListener(this._client, 'Page.frameRequestedNavigation', event => this._onFrameRequestedNavigation(event)),\n      eventsHelper.addEventListener(this._client, 'Page.javascriptDialogOpening', event => this._onDialog(event)),\n      eventsHelper.addEventListener(this._client, 'Page.navigatedWithinDocument', event => this._onFrameNavigatedWithinDocument(event.frameId, event.url)),\n      eventsHelper.addEventListener(this._client, 'Runtime.bindingCalled', event => this._onBindingCalled(event)),\n      eventsHelper.addEventListener(this._client, 'Runtime.consoleAPICalled', event => this._onConsoleAPI(event)),\n      eventsHelper.addEventListener(this._client, 'Runtime.exceptionThrown', exception => this._handleException(exception.exceptionDetails)),\n      eventsHelper.addEventListener(this._client, 'Runtime.executionContextCreated', event => this._onExecutionContextCreated(event.context)),\n      eventsHelper.addEventListener(this._client, 'Runtime.executionContextDestroyed', event => this._onExecutionContextDestroyed(event.executionContextId)),\n      eventsHelper.addEventListener(this._client, 'Runtime.executionContextsCleared', event => this._onExecutionContextsCleared()),\n      eventsHelper.addEventListener(this._client, 'Target.attachedToTarget', event => this._onAttachedToTarget(event)),\n      eventsHelper.addEventListener(this._client, 'Target.detachedFromTarget', event => this._onDetachedFromTarget(event)),\n    ]);\n  }\n\n  private _addBrowserListeners() {\n    this._eventListeners.push(...[\n      eventsHelper.addEventListener(this._client, 'Inspector.targetCrashed', event => this._onTargetCrashed()),\n      eventsHelper.addEventListener(this._client, 'Page.screencastFrame', event => this._onScreencastFrame(event)),\n      eventsHelper.addEventListener(this._client, 'Page.windowOpen', event => this._onWindowOpen(event)),\n    ]);\n  }\n\n  async _initialize(hasUIWindow: boolean) {\n    const isSettingStorageState = this._page._browserContext.isSettingStorageState();\n    if (!isSettingStorageState && hasUIWindow &&\n      !this._crPage._browserContext._browser.isClank() &&\n      !this._crPage._browserContext._options.noDefaultViewport) {\n      const { windowId } = await this._client.send('Browser.getWindowForTarget');\n      this._windowId = windowId;\n    }\n\n    let screencastOptions: types.PageScreencastOptions | undefined;\n    if (!isSettingStorageState && this._isMainFrame() && this._crPage._browserContext._options.recordVideo && hasUIWindow) {\n      const screencastId = createGuid();\n      const outputFile = path.join(this._crPage._browserContext._options.recordVideo.dir, screencastId + '.webm');\n      screencastOptions = {\n        // validateBrowserContextOptions ensures correct video size.\n        ...this._crPage._browserContext._options.recordVideo.size!,\n        outputFile,\n      };\n      await this._crPage._browserContext._ensureVideosPath();\n      // Note: it is important to start video recorder before sending Page.startScreencast,\n      // and it is equally important to send Page.startScreencast before sending Runtime.runIfWaitingForDebugger.\n      await this._createVideoRecorder(screencastId, screencastOptions);\n      this._crPage.pageOrError().then(p => {\n        if (p instanceof Error)\n          this._stopVideoRecording().catch(() => {});\n      });\n    }\n\n    let lifecycleEventsEnabled: Promise<any>;\n    if (!this._isMainFrame())\n      this._addRendererListeners();\n    this._addBrowserListeners();\n    const promises: Promise<any>[] = [\n      this._client.send('Page.enable'),\n      this._client.send('Page.getFrameTree').then(({ frameTree }) => {\n        if (this._isMainFrame()) {\n          this._handleFrameTree(frameTree);\n          this._addRendererListeners();\n        }\n\n        const localFrames = this._isMainFrame() ? this._page.frames() : [this._page._frameManager.frame(this._targetId)!];\n        for (const frame of localFrames) {\n          // Note: frames might be removed before we send these.\n          this._client._sendMayFail('Page.createIsolatedWorld', {\n            frameId: frame._id,\n            grantUniveralAccess: true,\n            worldName: UTILITY_WORLD_NAME,\n          });\n          for (const initScript of this._crPage._page.allInitScripts())\n            frame.evaluateExpression(initScript.source).catch(e => {});\n        }\n\n        const isInitialEmptyPage = this._isMainFrame() && this._page.mainFrame().url() === ':';\n        if (isInitialEmptyPage) {\n          // Ignore lifecycle events, worlds and bindings for the initial empty page. It is never the final page\n          // hence we are going to get more lifecycle updates after the actual navigation has\n          // started (even if the target url is about:blank).\n          lifecycleEventsEnabled.catch(e => {}).then(() => {\n            this._eventListeners.push(eventsHelper.addEventListener(this._client, 'Page.lifecycleEvent', event => this._onLifecycleEvent(event)));\n          });\n        } else {\n          this._firstNonInitialNavigationCommittedFulfill();\n          this._eventListeners.push(eventsHelper.addEventListener(this._client, 'Page.lifecycleEvent', event => this._onLifecycleEvent(event)));\n        }\n      }),\n      this._client.send('Log.enable', {}),\n      lifecycleEventsEnabled = this._client.send('Page.setLifecycleEventsEnabled', { enabled: true }),\n      this._client.send('Runtime.enable', {}),\n      this._client.send('Runtime.addBinding', { name: PageBinding.kPlaywrightBinding }),\n      this._client.send('Page.addScriptToEvaluateOnNewDocument', {\n        source: '',\n        worldName: UTILITY_WORLD_NAME,\n      }),\n      this._crPage._networkManager.addSession(this._client, undefined, this._isMainFrame()),\n      this._client.send('Target.setAutoAttach', { autoAttach: true, waitForDebuggerOnStart: true, flatten: true }),\n    ];\n    if (!isSettingStorageState) {\n      if (this._isMainFrame())\n        promises.push(this._client.send('Emulation.setFocusEmulationEnabled', { enabled: true }));\n      const options = this._crPage._browserContext._options;\n      if (options.bypassCSP)\n        promises.push(this._client.send('Page.setBypassCSP', { enabled: true }));\n      if (options.ignoreHTTPSErrors)\n        promises.push(this._client.send('Security.setIgnoreCertificateErrors', { ignore: true }));\n      if (this._isMainFrame())\n        promises.push(this._updateViewport());\n      if (options.hasTouch)\n        promises.push(this._client.send('Emulation.setTouchEmulationEnabled', { enabled: true }));\n      if (options.javaScriptEnabled === false)\n        promises.push(this._client.send('Emulation.setScriptExecutionDisabled', { value: true }));\n      if (options.userAgent || options.locale)\n        promises.push(this._updateUserAgent());\n      if (options.locale)\n        promises.push(emulateLocale(this._client, options.locale));\n      if (options.timezoneId)\n        promises.push(emulateTimezone(this._client, options.timezoneId));\n      if (!this._crPage._browserContext._browser.options.headful)\n        promises.push(this._setDefaultFontFamilies(this._client));\n      promises.push(this._updateGeolocation(true));\n      promises.push(this._updateEmulateMedia());\n      promises.push(this._updateFileChooserInterception(true));\n      for (const initScript of this._crPage._page.allInitScripts())\n        promises.push(this._evaluateOnNewDocument(initScript, 'main'));\n      if (screencastOptions)\n        promises.push(this._startVideoRecording(screencastOptions));\n    }\n    promises.push(this._client.send('Runtime.runIfWaitingForDebugger'));\n    promises.push(this._firstNonInitialNavigationCommittedPromise);\n    await Promise.all(promises);\n  }\n\n  dispose() {\n    this._firstNonInitialNavigationCommittedReject(new TargetClosedError());\n    for (const childSession of this._childSessions)\n      childSession.dispose();\n    if (this._parentSession)\n      this._parentSession._childSessions.delete(this);\n    eventsHelper.removeEventListeners(this._eventListeners);\n    this._crPage._networkManager.removeSession(this._client);\n    this._crPage._sessions.delete(this._targetId);\n    this._client.dispose();\n  }\n\n  async _navigate(frame: frames.Frame, url: string, referrer: string | undefined): Promise<frames.GotoResult> {\n    const response = await this._client.send('Page.navigate', { url, referrer, frameId: frame._id, referrerPolicy: 'unsafeUrl' });\n    if (response.errorText)\n      throw new frames.NavigationAbortedError(response.loaderId, `${response.errorText} at ${url}`);\n    return { newDocumentId: response.loaderId };\n  }\n\n  _onLifecycleEvent(event: Protocol.Page.lifecycleEventPayload) {\n    if (this._eventBelongsToStaleFrame(event.frameId))\n      return;\n    if (event.name === 'load')\n      this._page._frameManager.frameLifecycleEvent(event.frameId, 'load');\n    else if (event.name === 'DOMContentLoaded')\n      this._page._frameManager.frameLifecycleEvent(event.frameId, 'domcontentloaded');\n  }\n\n  _handleFrameTree(frameTree: Protocol.Page.FrameTree) {\n    this._onFrameAttached(frameTree.frame.id, frameTree.frame.parentId || null);\n    this._onFrameNavigated(frameTree.frame, true);\n    if (!frameTree.childFrames)\n      return;\n\n    for (const child of frameTree.childFrames)\n      this._handleFrameTree(child);\n  }\n\n  private _eventBelongsToStaleFrame(frameId: string)  {\n    const frame = this._page._frameManager.frame(frameId);\n    // Subtree may be already gone because some ancestor navigation destroyed the oopif.\n    if (!frame)\n      return true;\n    // When frame goes remote, parent process may still send some events\n    // related to the local frame before it sends frameDetached.\n    // In this case, we already have a new session for this frame, so events\n    // in the old session should be ignored.\n    const session = this._crPage._sessionForFrame(frame);\n    return session && session !== this && !session._swappedIn;\n  }\n\n  _onFrameAttached(frameId: string, parentFrameId: string | null) {\n    const frameSession = this._crPage._sessions.get(frameId);\n    if (frameSession && frameId !== this._targetId) {\n      // This is a remote -> local frame transition.\n      frameSession._swappedIn = true;\n      const frame = this._page._frameManager.frame(frameId);\n      // Frame or even a whole subtree may be already gone, because some ancestor did navigate.\n      if (frame)\n        this._page._frameManager.removeChildFramesRecursively(frame);\n      return;\n    }\n    if (parentFrameId && !this._page._frameManager.frame(parentFrameId)) {\n      // Parent frame may be gone already because some ancestor frame navigated and\n      // destroyed the whole subtree of some oopif, while oopif's process is still sending us events.\n      // Be careful to not confuse this with \"main frame navigated cross-process\" scenario\n      // where parentFrameId is null.\n      return;\n    }\n    this._page._frameManager.frameAttached(frameId, parentFrameId);\n  }\n\n  _onFrameNavigated(framePayload: Protocol.Page.Frame, initial: boolean) {\n    if (this._eventBelongsToStaleFrame(framePayload.id))\n      return;\n    this._page._frameManager.frameCommittedNewDocumentNavigation(framePayload.id, framePayload.url + (framePayload.urlFragment || ''), framePayload.name || '', framePayload.loaderId, initial);\n    if (!initial)\n      this._firstNonInitialNavigationCommittedFulfill();\n  }\n\n  _onFrameRequestedNavigation(payload: Protocol.Page.frameRequestedNavigationPayload) {\n    if (this._eventBelongsToStaleFrame(payload.frameId))\n      return;\n    if (payload.disposition === 'currentTab')\n      this._page._frameManager.frameRequestedNavigation(payload.frameId);\n  }\n\n  _onFrameNavigatedWithinDocument(frameId: string, url: string) {\n    if (this._eventBelongsToStaleFrame(frameId))\n      return;\n    this._page._frameManager.frameCommittedSameDocumentNavigation(frameId, url);\n  }\n\n  _onFrameDetached(frameId: string, reason: 'remove' | 'swap') {\n    if (this._crPage._sessions.has(frameId)) {\n      // This is a local -> remote frame transition, where\n      // Page.frameDetached arrives after Target.attachedToTarget.\n      // We've already handled the new target and frame reattach - nothing to do here.\n      return;\n    }\n    if (reason === 'swap') {\n      // This is a local -> remote frame transition, where\n      // Page.frameDetached arrives before Target.attachedToTarget.\n      // We should keep the frame in the tree, and it will be used for the new target.\n      const frame = this._page._frameManager.frame(frameId);\n      if (frame)\n        this._page._frameManager.removeChildFramesRecursively(frame);\n      return;\n    }\n    // Just a regular frame detach.\n    this._page._frameManager.frameDetached(frameId);\n  }\n\n  _onExecutionContextCreated(contextPayload: Protocol.Runtime.ExecutionContextDescription) {\n    const frame = contextPayload.auxData ? this._page._frameManager.frame(contextPayload.auxData.frameId) : null;\n    if (!frame || this._eventBelongsToStaleFrame(frame._id))\n      return;\n    const delegate = new CRExecutionContext(this._client, contextPayload);\n    let worldName: types.World;\n    if (contextPayload.auxData && !!contextPayload.auxData.isDefault)\n      worldName = 'main';\n    else if (contextPayload.name === UTILITY_WORLD_NAME)\n      worldName = 'utility';\n    else\n      return;\n    const context = new dom.FrameExecutionContext(delegate, frame, worldName);\n    (context as any)[contextDelegateSymbol] = delegate;\n    frame._contextCreated(worldName, context);\n    this._contextIdToContext.set(contextPayload.id, context);\n  }\n\n  _onExecutionContextDestroyed(executionContextId: number) {\n    const context = this._contextIdToContext.get(executionContextId);\n    if (!context)\n      return;\n    this._contextIdToContext.delete(executionContextId);\n    context.frame._contextDestroyed(context);\n  }\n\n  _onExecutionContextsCleared() {\n    for (const contextId of Array.from(this._contextIdToContext.keys()))\n      this._onExecutionContextDestroyed(contextId);\n  }\n\n  _onAttachedToTarget(event: Protocol.Target.attachedToTargetPayload) {\n    const session = this._client.createChildSession(event.sessionId);\n\n    if (event.targetInfo.type === 'iframe') {\n      // Frame id equals target id.\n      const targetId = event.targetInfo.targetId;\n      const frame = this._page._frameManager.frame(targetId);\n      if (!frame)\n        return; // Subtree may be already gone due to renderer/browser race.\n      this._page._frameManager.removeChildFramesRecursively(frame);\n      const frameSession = new FrameSession(this._crPage, session, targetId, this);\n      this._crPage._sessions.set(targetId, frameSession);\n      frameSession._initialize(false).catch(e => e);\n      return;\n    }\n\n    if (event.targetInfo.type !== 'worker') {\n      session.detach().catch(() => {});\n      return;\n    }\n\n    const url = event.targetInfo.url;\n    const worker = new Worker(this._page, url);\n    this._page._addWorker(event.sessionId, worker);\n    this._workerSessions.set(event.sessionId, session);\n    session.once('Runtime.executionContextCreated', async event => {\n      worker._createExecutionContext(new CRExecutionContext(session, event.context));\n    });\n    // This might fail if the target is closed before we initialize.\n    session._sendMayFail('Runtime.enable');\n    // TODO: attribute workers to the right frame.\n    this._crPage._networkManager.addSession(session, this._page._frameManager.frame(this._targetId) ?? undefined).catch(() => {});\n    session._sendMayFail('Runtime.runIfWaitingForDebugger');\n    session._sendMayFail('Target.setAutoAttach', { autoAttach: true, waitForDebuggerOnStart: true, flatten: true });\n    session.on('Target.attachedToTarget', event => this._onAttachedToTarget(event));\n    session.on('Target.detachedFromTarget', event => this._onDetachedFromTarget(event));\n    session.on('Runtime.consoleAPICalled', event => {\n      const args = event.args.map(o => worker._existingExecutionContext!.createHandle(o));\n      this._page._addConsoleMessage(event.type, args, toConsoleMessageLocation(event.stackTrace));\n    });\n    session.on('Runtime.exceptionThrown', exception => this._page.emitOnContextOnceInitialized(BrowserContext.Events.PageError, exceptionToError(exception.exceptionDetails), this._page));\n  }\n\n  _onDetachedFromTarget(event: Protocol.Target.detachedFromTargetPayload) {\n    // This might be a worker...\n    const workerSession = this._workerSessions.get(event.sessionId);\n    if (workerSession) {\n      workerSession.dispose();\n      this._page._removeWorker(event.sessionId);\n      return;\n    }\n\n    // ... or an oopif.\n    const childFrameSession = this._crPage._sessions.get(event.targetId!);\n    if (!childFrameSession)\n      return;\n\n    // Usually, we get frameAttached in this session first and mark child as swappedIn.\n    if (childFrameSession._swappedIn) {\n      childFrameSession.dispose();\n      return;\n    }\n\n    // However, sometimes we get detachedFromTarget before frameAttached.\n    // In this case we don't know whether this is a remote frame detach,\n    // or just a remote -> local transition. In the latter case, frameAttached\n    // is already inflight, so let's make a safe roundtrip to ensure it arrives.\n    this._client.send('Page.enable').catch(e => null).then(() => {\n      // Child was not swapped in - that means frameAttached did not happen and\n      // this is remote detach rather than remote -> local swap.\n      if (!childFrameSession._swappedIn)\n        this._page._frameManager.frameDetached(event.targetId!);\n      childFrameSession.dispose();\n    });\n  }\n\n  _onWindowOpen(event: Protocol.Page.windowOpenPayload) {\n    this._crPage._nextWindowOpenPopupFeatures.push(event.windowFeatures);\n  }\n\n  async _onConsoleAPI(event: Protocol.Runtime.consoleAPICalledPayload) {\n    if (event.executionContextId === 0) {\n      // DevTools protocol stores the last 1000 console messages. These\n      // messages are always reported even for removed execution contexts. In\n      // this case, they are marked with executionContextId = 0 and are\n      // reported upon enabling Runtime agent.\n      //\n      // Ignore these messages since:\n      // - there's no execution context we can use to operate with message\n      //   arguments\n      // - these messages are reported before Playwright clients can subscribe\n      //   to the 'console'\n      //   page event.\n      //\n      // @see https://github.com/GoogleChrome/puppeteer/issues/3865\n      return;\n    }\n    const context = this._contextIdToContext.get(event.executionContextId);\n    if (!context)\n      return;\n    const values = event.args.map(arg => context.createHandle(arg));\n    this._page._addConsoleMessage(event.type, values, toConsoleMessageLocation(event.stackTrace));\n  }\n\n  async _onBindingCalled(event: Protocol.Runtime.bindingCalledPayload) {\n    const pageOrError = await this._crPage.pageOrError();\n    if (!(pageOrError instanceof Error)) {\n      const context = this._contextIdToContext.get(event.executionContextId);\n      if (context)\n        await this._page._onBindingCalled(event.payload, context);\n    }\n  }\n\n  _onDialog(event: Protocol.Page.javascriptDialogOpeningPayload) {\n    if (!this._page._frameManager.frame(this._targetId))\n      return; // Our frame/subtree may be gone already.\n    this._page.emitOnContext(BrowserContext.Events.Dialog, new dialog.Dialog(\n        this._page,\n        event.type,\n        event.message,\n        async (accept: boolean, promptText?: string) => {\n          await this._client.send('Page.handleJavaScriptDialog', { accept, promptText });\n        },\n        event.defaultPrompt));\n  }\n\n  _handleException(exceptionDetails: Protocol.Runtime.ExceptionDetails) {\n    this._page.emitOnContextOnceInitialized(BrowserContext.Events.PageError, exceptionToError(exceptionDetails), this._page);\n  }\n\n  async _onTargetCrashed() {\n    this._client._markAsCrashed();\n    this._page._didCrash();\n  }\n\n  _onLogEntryAdded(event: Protocol.Log.entryAddedPayload) {\n    const { level, text, args, source, url, lineNumber } = event.entry;\n    if (args)\n      args.map(arg => releaseObject(this._client, arg.objectId!));\n    if (source !== 'worker') {\n      const location: types.ConsoleMessageLocation = {\n        url: url || '',\n        lineNumber: lineNumber || 0,\n        columnNumber: 0,\n      };\n      this._page._addConsoleMessage(level, [], location, text);\n    }\n  }\n\n  async _onFileChooserOpened(event: Protocol.Page.fileChooserOpenedPayload) {\n    if (!event.backendNodeId)\n      return;\n    const frame = this._page._frameManager.frame(event.frameId);\n    if (!frame)\n      return;\n    let handle;\n    try {\n      const utilityContext = await frame._utilityContext();\n      handle = await this._adoptBackendNodeId(event.backendNodeId, utilityContext);\n    } catch (e) {\n      // During async processing, frame/context may go away. We should not throw.\n      return;\n    }\n    await this._page._onFileChooserOpened(handle);\n  }\n\n  _willBeginDownload() {\n    const originPage = this._crPage._initializedPage;\n    if (!originPage) {\n      // Resume the page creation with an error. The page will automatically close right\n      // after the download begins.\n      this._firstNonInitialNavigationCommittedReject(new Error('Starting new page download'));\n    }\n  }\n\n  _onScreencastFrame(payload: Protocol.Page.screencastFramePayload) {\n    this._page.throttleScreencastFrameAck(() => {\n      this._client.send('Page.screencastFrameAck', { sessionId: payload.sessionId }).catch(() => {});\n    });\n    const buffer = Buffer.from(payload.data, 'base64');\n    this._page.emit(Page.Events.ScreencastFrame, {\n      buffer,\n      timestamp: payload.metadata.timestamp,\n      width: payload.metadata.deviceWidth,\n      height: payload.metadata.deviceHeight,\n    });\n  }\n\n  async _createVideoRecorder(screencastId: string, options: types.PageScreencastOptions): Promise<void> {\n    assert(!this._screencastId);\n    const ffmpegPath = registry.findExecutable('ffmpeg')!.executablePathOrDie(this._page.attribution.playwright.options.sdkLanguage);\n    this._videoRecorder = await VideoRecorder.launch(this._crPage._page, ffmpegPath, options);\n    this._screencastId = screencastId;\n  }\n\n  async _startVideoRecording(options: types.PageScreencastOptions) {\n    const screencastId = this._screencastId;\n    assert(screencastId);\n    this._page.once(Page.Events.Close, () => this._stopVideoRecording().catch(() => {}));\n    const gotFirstFrame = new Promise(f => this._client.once('Page.screencastFrame', f));\n    await this._startScreencast(this._videoRecorder, {\n      format: 'jpeg',\n      quality: 90,\n      maxWidth: options.width,\n      maxHeight: options.height,\n    });\n    // Wait for the first frame before reporting video to the client.\n    gotFirstFrame.then(() => {\n      this._crPage._browserContext._browser._videoStarted(this._crPage._browserContext, screencastId, options.outputFile, this._crPage.pageOrError());\n    });\n  }\n\n  async _stopVideoRecording(): Promise<void> {\n    if (!this._screencastId)\n      return;\n    const screencastId = this._screencastId;\n    this._screencastId = null;\n    const recorder = this._videoRecorder!;\n    this._videoRecorder = null;\n    await this._stopScreencast(recorder);\n    await recorder.stop().catch(() => {});\n    // Keep the video artifact in the map until encoding is fully finished, if the context\n    // starts closing before the video is fully written to disk it will wait for it.\n    const video = this._crPage._browserContext._browser._takeVideo(screencastId);\n    video?.reportFinished();\n  }\n\n  async _startScreencast(client: any, options: Protocol.Page.startScreencastParameters = {}) {\n    this._screencastClients.add(client);\n    if (this._screencastClients.size === 1)\n      await this._client.send('Page.startScreencast', options);\n  }\n\n  async _stopScreencast(client: any) {\n    this._screencastClients.delete(client);\n    if (!this._screencastClients.size)\n      await this._client._sendMayFail('Page.stopScreencast');\n  }\n\n  async _updateGeolocation(initial: boolean): Promise<void> {\n    const geolocation = this._crPage._browserContext._options.geolocation;\n    if (!initial || geolocation)\n      await this._client.send('Emulation.setGeolocationOverride', geolocation || {});\n  }\n\n  async _updateViewport(preserveWindowBoundaries?: boolean): Promise<void> {\n    if (this._crPage._browserContext._browser.isClank())\n      return;\n    assert(this._isMainFrame());\n    const options = this._crPage._browserContext._options;\n    const emulatedSize = this._page.emulatedSize();\n    if (emulatedSize === null)\n      return;\n    const viewportSize = emulatedSize.viewport;\n    const screenSize = emulatedSize.screen;\n    const isLandscape = screenSize.width > screenSize.height;\n    const metricsOverride: Protocol.Emulation.setDeviceMetricsOverrideParameters = {\n      mobile: !!options.isMobile,\n      width: viewportSize.width,\n      height: viewportSize.height,\n      screenWidth: screenSize.width,\n      screenHeight: screenSize.height,\n      deviceScaleFactor: options.deviceScaleFactor || 1,\n      screenOrientation: !!options.isMobile ? (\n        isLandscape ? { angle: 90, type: 'landscapePrimary' } : { angle: 0, type: 'portraitPrimary' }\n      ) : { angle: 0, type: 'landscapePrimary' },\n      dontSetVisibleSize: preserveWindowBoundaries\n    };\n    if (JSON.stringify(this._metricsOverride) === JSON.stringify(metricsOverride))\n      return;\n    const promises = [\n      this._client.send('Emulation.setDeviceMetricsOverride', metricsOverride),\n    ];\n    if (!preserveWindowBoundaries && this._windowId) {\n      let insets = { width: 0, height: 0 };\n      if (this._crPage._browserContext._browser.options.headful) {\n        // TODO: popup windows have their own insets.\n        insets = { width: 24, height: 88 };\n        if (process.platform === 'win32')\n          insets = { width: 16, height: 88 };\n        else if (process.platform === 'linux')\n          insets = { width: 8, height: 85 };\n        else if (process.platform === 'darwin')\n          insets = { width: 2, height: 80 };\n        if (this._crPage._browserContext.isPersistentContext()) {\n          // FIXME: Chrome bug: OOPIF router is confused when hit target is\n          // outside browser window.\n          // Account for the infobar here to work around the bug.\n          insets.height += 46;\n        }\n      }\n      promises.push(this.setWindowBounds({\n        width: viewportSize.width + insets.width,\n        height: viewportSize.height + insets.height\n      }));\n    }\n    await Promise.all(promises);\n    this._metricsOverride = metricsOverride;\n  }\n\n  async windowBounds(): Promise<WindowBounds> {\n    const { bounds } = await this._client.send('Browser.getWindowBounds', {\n      windowId: this._windowId!\n    });\n    return bounds;\n  }\n\n  async setWindowBounds(bounds: WindowBounds) {\n    return await this._client.send('Browser.setWindowBounds', {\n      windowId: this._windowId!,\n      bounds\n    });\n  }\n\n  async _updateEmulateMedia(): Promise<void> {\n    const emulatedMedia = this._page.emulatedMedia();\n    // Empty string disables the override.\n    const media = emulatedMedia.media === 'no-override' ? '' : emulatedMedia.media;\n    const colorScheme = emulatedMedia.colorScheme === 'no-override' ? '' : emulatedMedia.colorScheme;\n    const reducedMotion = emulatedMedia.reducedMotion === 'no-override' ? '' : emulatedMedia.reducedMotion;\n    const forcedColors = emulatedMedia.forcedColors === 'no-override' ? '' : emulatedMedia.forcedColors;\n    const features = [\n      { name: 'prefers-color-scheme', value: colorScheme },\n      { name: 'prefers-reduced-motion', value: reducedMotion },\n      { name: 'forced-colors', value: forcedColors },\n    ];\n    await this._client.send('Emulation.setEmulatedMedia', { media, features });\n  }\n\n  async _updateUserAgent(): Promise<void> {\n    const options = this._crPage._browserContext._options;\n    await this._client.send('Emulation.setUserAgentOverride', {\n      userAgent: options.userAgent || '',\n      acceptLanguage: options.locale,\n      userAgentMetadata: calculateUserAgentMetadata(options),\n    });\n  }\n\n  private async _setDefaultFontFamilies(session: CRSession) {\n    const fontFamilies = platformToFontFamilies[this._crPage._browserContext._browser._platform()];\n    await session.send('Page.setFontFamilies', fontFamilies);\n  }\n\n  async _updateFileChooserInterception(initial: boolean) {\n    const enabled = this._page.fileChooserIntercepted();\n    if (initial && !enabled)\n      return;\n    await this._client.send('Page.setInterceptFileChooserDialog', { enabled }).catch(() => {}); // target can be closed.\n  }\n\n  async _evaluateOnNewDocument(initScript: InitScript, world: types.World): Promise<void> {\n    const worldName = world === 'utility' ? UTILITY_WORLD_NAME : undefined;\n    const { identifier } = await this._client.send('Page.addScriptToEvaluateOnNewDocument', { source: initScript.source, worldName });\n    if (!initScript.internal)\n      this._evaluateOnNewDocumentIdentifiers.push(identifier);\n  }\n\n  async _removeEvaluatesOnNewDocument(): Promise<void> {\n    const identifiers = this._evaluateOnNewDocumentIdentifiers;\n    this._evaluateOnNewDocumentIdentifiers = [];\n    await Promise.all(identifiers.map(identifier => this._client.send('Page.removeScriptToEvaluateOnNewDocument', { identifier })));\n  }\n\n  async _getContentFrame(handle: dom.ElementHandle): Promise<frames.Frame | null> {\n    const nodeInfo = await this._client.send('DOM.describeNode', {\n      objectId: handle._objectId\n    });\n    if (!nodeInfo || typeof nodeInfo.node.frameId !== 'string')\n      return null;\n    return this._page._frameManager.frame(nodeInfo.node.frameId);\n  }\n\n  async _getOwnerFrame(handle: dom.ElementHandle): Promise<string | null> {\n    // document.documentElement has frameId of the owner frame.\n    const documentElement = await handle.evaluateHandle(node => {\n      const doc = node as Document;\n      if (doc.documentElement && doc.documentElement.ownerDocument === doc)\n        return doc.documentElement;\n      return node.ownerDocument ? node.ownerDocument.documentElement : null;\n    });\n    if (!documentElement)\n      return null;\n    if (!documentElement._objectId)\n      return null;\n    const nodeInfo = await this._client.send('DOM.describeNode', {\n      objectId: documentElement._objectId\n    });\n    const frameId = nodeInfo && typeof nodeInfo.node.frameId === 'string' ?\n      nodeInfo.node.frameId : null;\n    documentElement.dispose();\n    return frameId;\n  }\n\n  async _getBoundingBox(handle: dom.ElementHandle): Promise<types.Rect | null> {\n    const result = await this._client._sendMayFail('DOM.getBoxModel', {\n      objectId: handle._objectId\n    });\n    if (!result)\n      return null;\n    const quad = result.model.border;\n    const x = Math.min(quad[0], quad[2], quad[4], quad[6]);\n    const y = Math.min(quad[1], quad[3], quad[5], quad[7]);\n    const width = Math.max(quad[0], quad[2], quad[4], quad[6]) - x;\n    const height = Math.max(quad[1], quad[3], quad[5], quad[7]) - y;\n    const position = await this._framePosition();\n    if (!position)\n      return null;\n    return { x: x + position.x, y: y + position.y, width, height };\n  }\n\n  private async _framePosition(): Promise<types.Point | null> {\n    const frame = this._page._frameManager.frame(this._targetId);\n    if (!frame)\n      return null;\n    if (frame === this._page.mainFrame())\n      return { x: 0, y: 0 };\n    const element = await frame.frameElement();\n    const box = await element.boundingBox();\n    return box;\n  }\n\n  async _scrollRectIntoViewIfNeeded(handle: dom.ElementHandle, rect?: types.Rect): Promise<'error:notvisible' | 'error:notconnected' | 'done'> {\n    return await this._client.send('DOM.scrollIntoViewIfNeeded', {\n      objectId: handle._objectId,\n      rect,\n    }).then(() => 'done' as const).catch(e => {\n      if (e instanceof Error && e.message.includes('Node does not have a layout object'))\n        return 'error:notvisible';\n      if (e instanceof Error && e.message.includes('Node is detached from document'))\n        return 'error:notconnected';\n      throw e;\n    });\n  }\n\n  async _getContentQuads(handle: dom.ElementHandle): Promise<types.Quad[] | null> {\n    const result = await this._client._sendMayFail('DOM.getContentQuads', {\n      objectId: handle._objectId\n    });\n    if (!result)\n      return null;\n    const position = await this._framePosition();\n    if (!position)\n      return null;\n    return result.quads.map(quad => [\n      { x: quad[0] + position.x, y: quad[1] + position.y },\n      { x: quad[2] + position.x, y: quad[3] + position.y },\n      { x: quad[4] + position.x, y: quad[5] + position.y },\n      { x: quad[6] + position.x, y: quad[7] + position.y }\n    ]);\n  }\n\n  async _adoptElementHandle<T extends Node>(handle: dom.ElementHandle<T>, to: dom.FrameExecutionContext): Promise<dom.ElementHandle<T>> {\n    const nodeInfo = await this._client.send('DOM.describeNode', {\n      objectId: handle._objectId,\n    });\n    return this._adoptBackendNodeId(nodeInfo.node.backendNodeId, to) as Promise<dom.ElementHandle<T>>;\n  }\n\n  async _adoptBackendNodeId(backendNodeId: Protocol.DOM.BackendNodeId, to: dom.FrameExecutionContext): Promise<dom.ElementHandle> {\n    const result = await this._client._sendMayFail('DOM.resolveNode', {\n      backendNodeId,\n      executionContextId: ((to as any)[contextDelegateSymbol] as CRExecutionContext)._contextId,\n    });\n    if (!result || result.object.subtype === 'null')\n      throw new Error(dom.kUnableToAdoptErrorMessage);\n    return to.createHandle(result.object).asElement()!;\n  }\n}\n\nasync function emulateLocale(session: CRSession, locale: string) {\n  try {\n    await session.send('Emulation.setLocaleOverride', { locale });\n  } catch (exception) {\n    // All pages in the same renderer share locale. All such pages belong to the same\n    // context and if locale is overridden for one of them its value is the same as\n    // we are trying to set so it's not a problem.\n    if (exception.message.includes('Another locale override is already in effect'))\n      return;\n    throw exception;\n  }\n}\n\nasync function emulateTimezone(session: CRSession, timezoneId: string) {\n  try {\n    await session.send('Emulation.setTimezoneOverride', { timezoneId: timezoneId });\n  } catch (exception) {\n    if (exception.message.includes('Timezone override is already in effect'))\n      return;\n    if (exception.message.includes('Invalid timezone'))\n      throw new Error(`Invalid timezone ID: ${timezoneId}`);\n    throw exception;\n  }\n}\n\nconst contextDelegateSymbol = Symbol('delegate');\n\n// Chromium reference: https://source.chromium.org/chromium/chromium/src/+/main:components/embedder_support/user_agent_utils.cc;l=434;drc=70a6711e08e9f9e0d8e4c48e9ba5cab62eb010c2\nfunction calculateUserAgentMetadata(options: channels.BrowserNewContextParams) {\n  const ua = options.userAgent;\n  if (!ua)\n    return undefined;\n  const metadata: Protocol.Emulation.UserAgentMetadata = {\n    mobile: !!options.isMobile,\n    model: '',\n    architecture: 'x64',\n    platform: 'Windows',\n    platformVersion: '',\n  };\n  const androidMatch = ua.match(/Android (\\d+(\\.\\d+)?(\\.\\d+)?)/);\n  const iPhoneMatch = ua.match(/iPhone OS (\\d+(_\\d+)?)/);\n  const iPadMatch = ua.match(/iPad; CPU OS (\\d+(_\\d+)?)/);\n  const macOSMatch = ua.match(/Mac OS X (\\d+(_\\d+)?(_\\d+)?)/);\n  const windowsMatch = ua.match(/Windows\\D+(\\d+(\\.\\d+)?(\\.\\d+)?)/);\n  if (androidMatch) {\n    metadata.platform = 'Android';\n    metadata.platformVersion = androidMatch[1];\n    metadata.architecture = 'arm';\n  } else if (iPhoneMatch) {\n    metadata.platform = 'iOS';\n    metadata.platformVersion = iPhoneMatch[1];\n    metadata.architecture = 'arm';\n  } else if (iPadMatch) {\n    metadata.platform = 'iOS';\n    metadata.platformVersion = iPadMatch[1];\n    metadata.architecture = 'arm';\n  } else if (macOSMatch) {\n    metadata.platform = 'macOS';\n    metadata.platformVersion = macOSMatch[1];\n    if (!ua.includes('Intel'))\n      metadata.architecture = 'arm';\n  } else if (windowsMatch) {\n    metadata.platform = 'Windows';\n    metadata.platformVersion = windowsMatch[1];\n  } else if (ua.toLowerCase().includes('linux')) {\n    metadata.platform = 'Linux';\n  }\n  if (ua.includes('ARM'))\n    metadata.architecture = 'arm';\n  return metadata;\n}\n"],"mappings":"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"}