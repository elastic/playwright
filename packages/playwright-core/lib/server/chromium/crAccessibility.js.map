{"version":3,"file":"crAccessibility.js","names":["getAccessibilityTree","client","needle","nodes","send","tree","CRAXNode","createTree","_findElement","constructor","payload","_payload","_children","_richlyEditable","_editable","_focusable","_expanded","_hidden","_name","_role","_cachedHasFocusableChild","_client","name","value","role","property","properties","_isPlainTextField","_isTextOnlyObject","_hasFocusableChild","undefined","child","children","element","objectId","_objectId","node","backendNodeId","find","backendDOMNodeId","predicate","result","isLeafNode","length","isControl","isInteresting","insideControl","normalizedRole","serialize","Map","set","toLowerCase","description","userStringProperties","userStringProperty","has","get","booleanProperties","booleanProperty","numericalProperties","numericalProperty","tokenProperties","tokenProperty","axNode","valueString","valueNumber","checked","pressed","payloads","nodeById","nodeId","values","childId","childIds","push","next"],"sources":["../../../src/server/chromium/crAccessibility.ts"],"sourcesContent":["/**\n * Copyright 2018 Google Inc. All rights reserved.\n * Modifications copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { CRSession } from './crConnection';\nimport type { Protocol } from './protocol';\nimport type * as dom from '../dom';\nimport type * as accessibility from '../accessibility';\nimport type * as channels from '@protocol/channels';\n\nexport async function getAccessibilityTree(client: CRSession, needle?: dom.ElementHandle): Promise<{tree: accessibility.AXNode, needle: accessibility.AXNode | null}> {\n  const { nodes } = await client.send('Accessibility.getFullAXTree');\n  const tree = CRAXNode.createTree(client, nodes);\n  return {\n    tree,\n    needle: needle ? await tree._findElement(needle) : null\n  };\n}\n\nclass CRAXNode implements accessibility.AXNode {\n  _payload: Protocol.Accessibility.AXNode;\n  _children: CRAXNode[] = [];\n  private _richlyEditable = false;\n  private _editable = false;\n  private _focusable = false;\n  private _expanded = false;\n  private _hidden = false;\n  private _name: string;\n  private _role: string;\n  private _cachedHasFocusableChild: boolean | undefined;\n  private _client: CRSession;\n\n  constructor(client: CRSession, payload: Protocol.Accessibility.AXNode) {\n    this._client = client;\n    this._payload = payload;\n\n    this._name = this._payload.name ? this._payload.name.value : '';\n    this._role = this._payload.role ? this._payload.role.value : 'Unknown';\n\n    for (const property of this._payload.properties || []) {\n      if (property.name === 'editable') {\n        this._richlyEditable = property.value.value === 'richtext';\n        this._editable = true;\n      }\n      if (property.name === 'focusable')\n        this._focusable = property.value.value;\n      if (property.name === 'expanded')\n        this._expanded = property.value.value;\n      if (property.name === 'hidden')\n        this._hidden = property.value.value;\n    }\n  }\n\n  private _isPlainTextField(): boolean {\n    if (this._richlyEditable)\n      return false;\n    if (this._editable)\n      return true;\n    return this._role === 'textbox' || this._role === 'ComboBox' || this._role === 'searchbox';\n  }\n\n  private _isTextOnlyObject(): boolean {\n    const role = this._role;\n    return (role === 'LineBreak' || role === 'text' ||\n            role === 'InlineTextBox' || role === 'StaticText');\n  }\n\n  private _hasFocusableChild(): boolean {\n    if (this._cachedHasFocusableChild === undefined) {\n      this._cachedHasFocusableChild = false;\n      for (const child of this._children) {\n        if (child._focusable || child._hasFocusableChild()) {\n          this._cachedHasFocusableChild = true;\n          break;\n        }\n      }\n    }\n    return this._cachedHasFocusableChild;\n  }\n\n  children() {\n    return this._children;\n  }\n\n  async _findElement(element: dom.ElementHandle): Promise<CRAXNode | null> {\n    const objectId = element._objectId;\n    const { node: { backendNodeId } } = await this._client.send('DOM.describeNode', { objectId });\n    const needle = this.find(node => node._payload.backendDOMNodeId === backendNodeId);\n    return needle || null;\n  }\n\n  find(predicate: (arg0: CRAXNode) => boolean): CRAXNode | null {\n    if (predicate(this))\n      return this;\n    for (const child of this._children) {\n      const result = child.find(predicate);\n      if (result)\n        return result;\n    }\n    return null;\n  }\n\n  isLeafNode(): boolean {\n    if (!this._children.length)\n      return true;\n\n    // These types of objects may have children that we use as internal\n    // implementation details, but we want to expose them as leaves to platform\n    // accessibility APIs because screen readers might be confused if they find\n    // any children.\n    if (this._isPlainTextField() || this._isTextOnlyObject())\n      return true;\n\n    // Roles whose children are only presentational according to the ARIA and\n    // HTML5 Specs should be hidden from screen readers.\n    // (Note that whilst ARIA buttons can have only presentational children, HTML5\n    // buttons are allowed to have content.)\n    switch (this._role) {\n      case 'doc-cover':\n      case 'graphics-symbol':\n      case 'img':\n      case 'Meter':\n      case 'scrollbar':\n      case 'slider':\n      case 'separator':\n      case 'progressbar':\n        return true;\n      default:\n        break;\n    }\n\n    // Here and below: Android heuristics\n    if (this._hasFocusableChild())\n      return false;\n    if (this._focusable && this._role !== 'WebArea' && this._role !== 'RootWebArea' && this._name)\n      return true;\n    if (this._role === 'heading' && this._name)\n      return true;\n    return false;\n  }\n\n  isControl(): boolean {\n    switch (this._role) {\n      case 'button':\n      case 'checkbox':\n      case 'ColorWell':\n      case 'combobox':\n      case 'DisclosureTriangle':\n      case 'listbox':\n      case 'menu':\n      case 'menubar':\n      case 'menuitem':\n      case 'menuitemcheckbox':\n      case 'menuitemradio':\n      case 'radio':\n      case 'scrollbar':\n      case 'searchbox':\n      case 'slider':\n      case 'spinbutton':\n      case 'switch':\n      case 'tab':\n      case 'textbox':\n      case 'tree':\n        return true;\n      default:\n        return false;\n    }\n  }\n\n  isInteresting(insideControl: boolean): boolean {\n    const role = this._role;\n    if (role === 'Ignored' || this._hidden)\n      return false;\n\n    if (this._focusable || this._richlyEditable)\n      return true;\n\n    // If it's not focusable but has a control role, then it's interesting.\n    if (this.isControl())\n      return true;\n\n    // A non focusable child of a control is not interesting\n    if (insideControl)\n      return false;\n\n    return this.isLeafNode() && !!this._name;\n  }\n\n  normalizedRole() {\n    switch (this._role) {\n      case 'RootWebArea':\n        return 'WebArea';\n      case 'StaticText':\n        return 'text';\n      default:\n        return this._role;\n    }\n  }\n\n  serialize(): channels.AXNode {\n    const properties: Map<string, number | string | boolean> = new Map();\n    for (const property of this._payload.properties || [])\n      properties.set(property.name.toLowerCase(), property.value.value);\n    if (this._payload.description)\n      properties.set('description', this._payload.description.value);\n\n    const node: {[x in keyof channels.AXNode]: any} = {\n      role: this.normalizedRole(),\n      name: this._payload.name ? (this._payload.name.value || '') : '',\n    };\n\n    const userStringProperties: Array<keyof channels.AXNode> = [\n      'description',\n      'keyshortcuts',\n      'roledescription',\n      'valuetext',\n    ];\n    for (const userStringProperty of userStringProperties) {\n      if (!properties.has(userStringProperty))\n        continue;\n      node[userStringProperty] = properties.get(userStringProperty);\n    }\n    const booleanProperties: Array<keyof channels.AXNode> = [\n      'disabled',\n      'expanded',\n      'focused',\n      'modal',\n      'multiline',\n      'multiselectable',\n      'readonly',\n      'required',\n      'selected',\n    ];\n    for (const booleanProperty of booleanProperties) {\n      // WebArea's treat focus differently than other nodes. They report whether their frame  has focus,\n      // not whether focus is specifically on the root node.\n      if (booleanProperty === 'focused' && (this._role === 'WebArea' || this._role === 'RootWebArea'))\n        continue;\n      const value = properties.get(booleanProperty);\n      if (!value)\n        continue;\n      node[booleanProperty] = value;\n    }\n    const numericalProperties: Array<keyof channels.AXNode> = [\n      'level',\n      'valuemax',\n      'valuemin',\n    ];\n    for (const numericalProperty of numericalProperties) {\n      if (!properties.has(numericalProperty))\n        continue;\n      node[numericalProperty] = properties.get(numericalProperty);\n    }\n    const tokenProperties: Array<keyof channels.AXNode> = [\n      'autocomplete',\n      'haspopup',\n      'invalid',\n      'orientation',\n    ];\n    for (const tokenProperty of tokenProperties) {\n      const value = properties.get(tokenProperty);\n      if (!value || value === 'false')\n        continue;\n      node[tokenProperty] = value;\n    }\n\n    const axNode = node as channels.AXNode;\n    if (this._payload.value) {\n      if (typeof this._payload.value.value === 'string')\n        axNode.valueString = this._payload.value.value;\n      if (typeof this._payload.value.value === 'number')\n        axNode.valueNumber = this._payload.value.value;\n    }\n    if (properties.has('checked'))\n      axNode.checked = properties.get('checked') === 'true' ? 'checked' : properties.get('checked') === 'false' ? 'unchecked' : 'mixed';\n    if (properties.has('pressed'))\n      axNode.pressed = properties.get('pressed') === 'true' ? 'pressed' : properties.get('pressed') === 'false' ? 'released' : 'mixed';\n    return axNode;\n  }\n\n  static createTree(client: CRSession, payloads: Protocol.Accessibility.AXNode[]): CRAXNode {\n    const nodeById: Map<string, CRAXNode> = new Map();\n    for (const payload of payloads)\n      nodeById.set(payload.nodeId, new CRAXNode(client, payload));\n    for (const node of nodeById.values()) {\n      for (const childId of node._payload.childIds || [])\n        node._children.push(nodeById.get(childId)!);\n    }\n    return nodeById.values().next().value;\n  }\n}\n"],"mappings":"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"}