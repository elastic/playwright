{"version":3,"file":"download.js","names":["_path","_interopRequireDefault","require","_page","_utils","_artifact","obj","__esModule","default","Download","constructor","page","downloadsPath","uuid","url","suggestedFilename","artifact","_suggestedFilename","unaccessibleErrorMessage","_browserContext","_options","acceptDownloads","undefined","Artifact","path","join","cancelDownload","_downloads","add","emit","Page","Events","_filenameSuggested","assert","exports"],"sources":["../../src/server/download.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport path from 'path';\nimport { Page } from './page';\nimport { assert } from '../utils';\nimport { Artifact } from './artifact';\n\nexport class Download {\n  readonly artifact: Artifact;\n  readonly url: string;\n  private _page: Page;\n  private _suggestedFilename: string | undefined;\n\n  constructor(page: Page, downloadsPath: string, uuid: string, url: string, suggestedFilename?: string) {\n    const unaccessibleErrorMessage = page._browserContext._options.acceptDownloads === 'deny' ? 'Pass { acceptDownloads: true } when you are creating your browser context.' : undefined;\n    this.artifact = new Artifact(page, path.join(downloadsPath, uuid), unaccessibleErrorMessage, () => {\n      return this._page._browserContext.cancelDownload(uuid);\n    });\n    this._page = page;\n    this.url = url;\n    this._suggestedFilename = suggestedFilename;\n    page._browserContext._downloads.add(this);\n    if (suggestedFilename !== undefined)\n      this._page.emit(Page.Events.Download, this);\n  }\n\n  _filenameSuggested(suggestedFilename: string) {\n    assert(this._suggestedFilename === undefined);\n    this._suggestedFilename = suggestedFilename;\n    this._page.emit(Page.Events.Download, this);\n  }\n\n  suggestedFilename(): string {\n    return this._suggestedFilename!;\n  }\n}\n"],"mappings":";;;;;;AAgBA,IAAAA,KAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,KAAA,GAAAD,OAAA;AACA,IAAAE,MAAA,GAAAF,OAAA;AACA,IAAAG,SAAA,GAAAH,OAAA;AAAsC,SAAAD,uBAAAK,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAnBtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAOO,MAAMG,QAAQ,CAAC;EAMpBC,WAAWA,CAACC,IAAU,EAAEC,aAAqB,EAAEC,IAAY,EAAEC,GAAW,EAAEC,iBAA0B,EAAE;IAAA,KAL7FC,QAAQ;IAAA,KACRF,GAAG;IAAA,KACJX,KAAK;IAAA,KACLc,kBAAkB;IAGxB,MAAMC,wBAAwB,GAAGP,IAAI,CAACQ,eAAe,CAACC,QAAQ,CAACC,eAAe,KAAK,MAAM,GAAG,4EAA4E,GAAGC,SAAS;IACpL,IAAI,CAACN,QAAQ,GAAG,IAAIO,kBAAQ,CAACZ,IAAI,EAAEa,aAAI,CAACC,IAAI,CAACb,aAAa,EAAEC,IAAI,CAAC,EAAEK,wBAAwB,EAAE,MAAM;MACjG,OAAO,IAAI,CAACf,KAAK,CAACgB,eAAe,CAACO,cAAc,CAACb,IAAI,CAAC;IACxD,CAAC,CAAC;IACF,IAAI,CAACV,KAAK,GAAGQ,IAAI;IACjB,IAAI,CAACG,GAAG,GAAGA,GAAG;IACd,IAAI,CAACG,kBAAkB,GAAGF,iBAAiB;IAC3CJ,IAAI,CAACQ,eAAe,CAACQ,UAAU,CAACC,GAAG,CAAC,IAAI,CAAC;IACzC,IAAIb,iBAAiB,KAAKO,SAAS,EACjC,IAAI,CAACnB,KAAK,CAAC0B,IAAI,CAACC,UAAI,CAACC,MAAM,CAACtB,QAAQ,EAAE,IAAI,CAAC;EAC/C;EAEAuB,kBAAkBA,CAACjB,iBAAyB,EAAE;IAC5C,IAAAkB,aAAM,EAAC,IAAI,CAAChB,kBAAkB,KAAKK,SAAS,CAAC;IAC7C,IAAI,CAACL,kBAAkB,GAAGF,iBAAiB;IAC3C,IAAI,CAACZ,KAAK,CAAC0B,IAAI,CAACC,UAAI,CAACC,MAAM,CAACtB,QAAQ,EAAE,IAAI,CAAC;EAC7C;EAEAM,iBAAiBA,CAAA,EAAW;IAC1B,OAAO,IAAI,CAACE,kBAAkB;EAChC;AACF;AAACiB,OAAA,CAAAzB,QAAA,GAAAA,QAAA"}