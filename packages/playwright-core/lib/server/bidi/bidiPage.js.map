{"version":3,"file":"bidiPage.js","names":["_eventsHelper","require","_utils","dom","_interopRequireWildcard","dialog","_page","_bidiInput","bidi","_bidiExecutionContext","_bidiNetworkManager","_browserContext","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","UTILITY_WORLD_NAME","BidiPage","constructor","browserContext","bidiSession","opener","rawMouse","rawKeyboard","rawTouchscreen","_pagePromise","_session","_opener","_realmToContext","_sessionListeners","_networkManager","_initializedPage","RawKeyboardImpl","RawMouseImpl","RawTouchscreenImpl","Map","Page","BidiNetworkManager","_onNavigationResponseStarted","bind","on","Events","FrameDetached","frame","_removeContextsForFrame","eventsHelper","addEventListener","_onRealmCreated","_onBrowsingContextDestroyed","_onNavigationStarted","_onNavigationAborted","_onNavigationFailed","_onFragmentNavigated","_onDomContentLoaded","_onLoad","_onUserPromptOpened","_onLogEntryAdded","_initialize","finally","initOpener","then","reportAsNew","catch","contexts","send","root","sessionId","_handleFrameTree","Promise","all","updateHttpCredentials","updateRequestInterception","_updateViewport","frameTree","_onFrameAttached","context","parent","children","child","potentiallyUninitializedPage","didClose","dispose","removeEventListeners","_didClose","pageOrError","frameId","parentFrameId","_frameManager","frameAttached","notifyFrame","contextId","delete","_contextDestroyed","realmInfo","realm","type","delegate","BidiExecutionContext","worldName","sandbox","_touchUtilityWorld","FrameExecutionContext","contextDelegateSymbol","_contextCreated","sendMayFail","expression","target","serializationOptions","maxObjectDepth","maxDomDepth","awaitPromise","userActivation","_onRealmDestroyed","params","_browser","frameRequestedNavigation","navigation","url","toLowerCase","startsWith","frameCommittedNewDocumentNavigation","assert","response","frameLifecycleEvent","frameAbortedNavigation","undefined","frameCommittedSameDocumentNavigation","event","emitOnContext","BrowserContext","Dialog","message","accept","userText","defaultValue","_params$stackTrace","entry","source","callFrame","stackTrace","callFrames","location","lineNumber","columnNumber","_addConsoleMessage","method","args","map","arg","createHandle","objectId","handle","text","navigateFrame","referrer","_id","newDocumentId","updateExtraHTTPHeaders","updateEmulateMedia","updateEmulatedViewportSize","updateUserAgent","bringToFront","options","_options","deviceSize","emulatedSize","viewportSize","viewport","width","height","devicePixelRatio","deviceScaleFactor","setRequestInterception","needsRequestInterception","updateOffline","setCredentials","httpCredentials","updateFileChooserInterception","reload","wait","BrowsingContext","ReadinessState","Interactive","goBack","Error","goForward","addInitScript","initScript","_updateBootstrapScript","removeNonInternalInitScripts","closePage","runBeforeUnload","promptUnload","setBackgroundColor","color","takeScreenshot","progress","format","documentRect","viewportRect","quality","fitsViewport","scale","getContentFrame","executionContext","toBidiExecutionContext","_context","contentWindow","rawCallFunction","_objectId","value","result","getOwnerFrame","isElementHandle","remoteObject","getBoundingBox","box","evaluate","element","Element","rect","getBoundingClientRect","x","y","position","_framePosition","_frame","mainFrame","frameElement","boundingBox","style","evaluateInUtility","injected","iframe","describeIFrameStyle","left","top","scrollRectIntoViewIfNeeded","node","scrollIntoView","block","inline","behavior","includes","setScreencastOptions","rafCountForStablePosition","getContentQuads","quads","isConnected","rects","getClientRects","right","bottom","forEach","quad","point","setInputFiles","files","setInputFilePaths","paths","adoptElementHandle","to","fromContext","shared","sharedId","getAccessibilityTree","needle","inputActionEpilogue","resetForReuse","getFrameElement","parentFrame","parentContext","_mainContext","list","evaluateHandle","document","querySelectorAll","length","foundElement","candidate","contentFrame","shouldToggleStyleSheetToSyncAnimations","useMainWorldForSetContent","exports","Symbol"],"sources":["../../../src/server/bidi/bidiPage.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { RegisteredListener } from '../../utils/eventsHelper';\nimport { eventsHelper } from '../../utils/eventsHelper';\nimport { assert } from '../../utils';\nimport type * as accessibility from '../accessibility';\nimport * as dom from '../dom';\nimport * as dialog from '../dialog';\nimport type * as frames from '../frames';\nimport { type InitScript, Page, type PageDelegate } from '../page';\nimport type { Progress } from '../progress';\nimport type * as types from '../types';\nimport type { BidiBrowserContext } from './bidiBrowser';\nimport type { BidiSession } from './bidiConnection';\nimport { RawKeyboardImpl, RawMouseImpl, RawTouchscreenImpl } from './bidiInput';\nimport * as bidi from './third_party/bidiProtocol';\nimport { BidiExecutionContext } from './bidiExecutionContext';\nimport { BidiNetworkManager } from './bidiNetworkManager';\nimport { BrowserContext } from '../browserContext';\n\nconst UTILITY_WORLD_NAME = '__playwright_utility_world__';\n\nexport class BidiPage implements PageDelegate {\n  readonly rawMouse: RawMouseImpl;\n  readonly rawKeyboard: RawKeyboardImpl;\n  readonly rawTouchscreen: RawTouchscreenImpl;\n  readonly _page: Page;\n  private readonly _pagePromise: Promise<Page | Error>;\n  readonly _session: BidiSession;\n  readonly _opener: BidiPage | null;\n  private readonly _realmToContext: Map<string, dom.FrameExecutionContext>;\n  private _sessionListeners: RegisteredListener[] = [];\n  readonly _browserContext: BidiBrowserContext;\n  readonly _networkManager: BidiNetworkManager;\n  _initializedPage: Page | null = null;\n\n  constructor(browserContext: BidiBrowserContext, bidiSession: BidiSession, opener: BidiPage | null) {\n    this._session = bidiSession;\n    this._opener = opener;\n    this.rawKeyboard = new RawKeyboardImpl(bidiSession);\n    this.rawMouse = new RawMouseImpl(bidiSession);\n    this.rawTouchscreen = new RawTouchscreenImpl(bidiSession);\n    this._realmToContext = new Map();\n    this._page = new Page(this, browserContext);\n    this._browserContext = browserContext;\n    this._networkManager = new BidiNetworkManager(this._session, this._page, this._onNavigationResponseStarted.bind(this));\n    this._page.on(Page.Events.FrameDetached, (frame: frames.Frame) => this._removeContextsForFrame(frame, false));\n    this._sessionListeners = [\n      eventsHelper.addEventListener(bidiSession, 'script.realmCreated', this._onRealmCreated.bind(this)),\n      eventsHelper.addEventListener(bidiSession, 'browsingContext.contextDestroyed', this._onBrowsingContextDestroyed.bind(this)),\n      eventsHelper.addEventListener(bidiSession, 'browsingContext.navigationStarted', this._onNavigationStarted.bind(this)),\n      eventsHelper.addEventListener(bidiSession, 'browsingContext.navigationAborted', this._onNavigationAborted.bind(this)),\n      eventsHelper.addEventListener(bidiSession, 'browsingContext.navigationFailed', this._onNavigationFailed.bind(this)),\n      eventsHelper.addEventListener(bidiSession, 'browsingContext.fragmentNavigated', this._onFragmentNavigated.bind(this)),\n      eventsHelper.addEventListener(bidiSession, 'browsingContext.domContentLoaded', this._onDomContentLoaded.bind(this)),\n      eventsHelper.addEventListener(bidiSession, 'browsingContext.load', this._onLoad.bind(this)),\n      eventsHelper.addEventListener(bidiSession, 'browsingContext.userPromptOpened', this._onUserPromptOpened.bind(this)),\n      eventsHelper.addEventListener(bidiSession, 'log.entryAdded', this._onLogEntryAdded.bind(this)),\n    ];\n\n    // Initialize main frame.\n    this._pagePromise = this._initialize().finally(async () => {\n      await this._page.initOpener(this._opener);\n    }).then(() => {\n      this._initializedPage = this._page;\n      this._page.reportAsNew();\n      return this._page;\n    }).catch(e => {\n      this._page.reportAsNew(e);\n      return e;\n    });\n  }\n\n  private async _initialize() {\n    const { contexts } = await this._session.send('browsingContext.getTree', { root: this._session.sessionId });\n    this._handleFrameTree(contexts[0]);\n    await Promise.all([\n      this.updateHttpCredentials(),\n      this.updateRequestInterception(),\n      this._updateViewport(),\n    ]);\n  }\n\n  private _handleFrameTree(frameTree: bidi.BrowsingContext.Info) {\n    this._onFrameAttached(frameTree.context, frameTree.parent || null);\n    if (!frameTree.children)\n      return;\n\n    for (const child of frameTree.children)\n      this._handleFrameTree(child);\n  }\n\n  potentiallyUninitializedPage(): Page {\n    return this._page;\n  }\n\n  didClose() {\n    this._session.dispose();\n    eventsHelper.removeEventListeners(this._sessionListeners);\n    this._page._didClose();\n  }\n\n  async pageOrError(): Promise<Page | Error> {\n    // TODO: Wait for first execution context to be created and maybe about:blank navigated.\n    return this._pagePromise;\n  }\n\n  private _onFrameAttached(frameId: string, parentFrameId: string | null): frames.Frame {\n    return this._page._frameManager.frameAttached(frameId, parentFrameId);\n  }\n\n  private _removeContextsForFrame(frame: frames.Frame, notifyFrame: boolean) {\n    for (const [contextId, context] of this._realmToContext) {\n      if (context.frame === frame) {\n        this._realmToContext.delete(contextId);\n        if (notifyFrame)\n          frame._contextDestroyed(context);\n      }\n    }\n  }\n\n  private _onRealmCreated(realmInfo: bidi.Script.RealmInfo) {\n    if (this._realmToContext.has(realmInfo.realm))\n      return;\n    if (realmInfo.type !== 'window')\n      return;\n    const frame = this._page._frameManager.frame(realmInfo.context);\n    if (!frame)\n      return;\n    const delegate = new BidiExecutionContext(this._session, realmInfo);\n    let worldName: types.World;\n    if (!realmInfo.sandbox) {\n      worldName = 'main';\n      // Force creating utility world every time the main world is created (e.g. due to navigation).\n      this._touchUtilityWorld(realmInfo.context);\n    } else if (realmInfo.sandbox === UTILITY_WORLD_NAME) {\n      worldName = 'utility';\n    } else {\n      return;\n    }\n    const context = new dom.FrameExecutionContext(delegate, frame, worldName);\n    (context as any)[contextDelegateSymbol] = delegate;\n    frame._contextCreated(worldName, context);\n    this._realmToContext.set(realmInfo.realm, context);\n  }\n\n  private async _touchUtilityWorld(context: bidi.BrowsingContext.BrowsingContext) {\n    await this._session.sendMayFail('script.evaluate', {\n      expression: '1 + 1',\n      target: {\n        context,\n        sandbox: UTILITY_WORLD_NAME,\n      },\n      serializationOptions: {\n        maxObjectDepth: 10,\n        maxDomDepth: 10,\n      },\n      awaitPromise: true,\n      userActivation: true,\n    });\n  }\n\n  _onRealmDestroyed(params: bidi.Script.RealmDestroyedParameters): boolean {\n    const context = this._realmToContext.get(params.realm);\n    if (!context)\n      return false;\n    this._realmToContext.delete(params.realm);\n    context.frame._contextDestroyed(context);\n    return true;\n  }\n\n  // TODO: route the message directly to the browser\n  private _onBrowsingContextDestroyed(params: bidi.BrowsingContext.Info) {\n    this._browserContext._browser._onBrowsingContextDestroyed(params);\n  }\n\n  private _onNavigationStarted(params: bidi.BrowsingContext.NavigationInfo) {\n    const frameId = params.context;\n    this._page._frameManager.frameRequestedNavigation(frameId, params.navigation!);\n\n    const url = params.url.toLowerCase();\n    if (url.startsWith('file:') || url.startsWith('data:') || url === 'about:blank') {\n      // Navigation to file urls doesn't emit network events, so we fire 'commit' event right when navigation is started.\n      // Doing it in domcontentload would be too late as we'd clear frame tree.\n      const frame = this._page._frameManager.frame(frameId)!;\n      if (frame)\n        this._page._frameManager.frameCommittedNewDocumentNavigation(frameId, params.url, '', params.navigation!, /* initial */ false);\n    }\n  }\n\n  // TODO: there is no separate event for committed navigation, so we approximate it with responseStarted.\n  private _onNavigationResponseStarted(params: bidi.Network.ResponseStartedParameters) {\n    const frameId = params.context!;\n    const frame = this._page._frameManager.frame(frameId);\n    assert(frame);\n    this._page._frameManager.frameCommittedNewDocumentNavigation(frameId, params.response.url, '', params.navigation!, /* initial */ false);\n    // if (!initial)\n    //   this._firstNonInitialNavigationCommittedFulfill();\n  }\n\n  private _onDomContentLoaded(params: bidi.BrowsingContext.NavigationInfo) {\n    const frameId = params.context;\n    this._page._frameManager.frameLifecycleEvent(frameId, 'domcontentloaded');\n  }\n\n  private _onLoad(params: bidi.BrowsingContext.NavigationInfo) {\n    this._page._frameManager.frameLifecycleEvent(params.context, 'load');\n  }\n\n  private _onNavigationAborted(params: bidi.BrowsingContext.NavigationInfo) {\n    this._page._frameManager.frameAbortedNavigation(params.context, 'Navigation aborted', params.navigation || undefined);\n  }\n\n  private _onNavigationFailed(params: bidi.BrowsingContext.NavigationInfo) {\n    this._page._frameManager.frameAbortedNavigation(params.context, 'Navigation failed', params.navigation || undefined);\n  }\n\n  private _onFragmentNavigated(params: bidi.BrowsingContext.NavigationInfo) {\n    this._page._frameManager.frameCommittedSameDocumentNavigation(params.context, params.url);\n  }\n\n  private _onUserPromptOpened(event: bidi.BrowsingContext.UserPromptOpenedParameters) {\n    this._page.emitOnContext(BrowserContext.Events.Dialog, new dialog.Dialog(\n        this._page,\n        event.type as dialog.DialogType,\n        event.message,\n        async (accept: boolean, userText?: string) => {\n          await this._session.send('browsingContext.handleUserPrompt', { context: event.context, accept, userText });\n        },\n        event.defaultValue));\n  }\n\n  private _onLogEntryAdded(params: bidi.Log.Entry) {\n    if (params.type !== 'console')\n      return;\n    const entry: bidi.Log.ConsoleLogEntry = params as bidi.Log.ConsoleLogEntry;\n    const context = this._realmToContext.get(params.source.realm);\n    if (!context)\n      return;\n    const callFrame = params.stackTrace?.callFrames[0];\n    const location = callFrame ?? { url: '', lineNumber: 1, columnNumber: 1 };\n    this._page._addConsoleMessage(entry.method, entry.args.map(arg => context.createHandle({ objectId: (arg as any).handle, ...arg })), location, params.text || undefined);\n  }\n\n  async navigateFrame(frame: frames.Frame, url: string, referrer: string | undefined): Promise<frames.GotoResult> {\n    const { navigation } = await this._session.send('browsingContext.navigate', {\n      context: frame._id,\n      url,\n    });\n    return { newDocumentId: navigation || undefined };\n  }\n\n  async updateExtraHTTPHeaders(): Promise<void> {\n  }\n\n  async updateEmulateMedia(): Promise<void> {\n  }\n\n  async updateEmulatedViewportSize(): Promise<void> {\n    await this._updateViewport();\n  }\n\n  async updateUserAgent(): Promise<void> {\n  }\n\n  async bringToFront(): Promise<void> {\n  }\n\n  private async _updateViewport(): Promise<void> {\n    const options = this._browserContext._options;\n    const deviceSize = this._page.emulatedSize();\n    if (deviceSize === null)\n      return;\n    const viewportSize = deviceSize.viewport;\n    await this._session.send('browsingContext.setViewport', {\n      context: this._session.sessionId,\n      viewport: {\n        width: viewportSize.width,\n        height: viewportSize.height,\n      },\n      devicePixelRatio: options.deviceScaleFactor || 1\n    });\n  }\n\n  async updateRequestInterception(): Promise<void> {\n    await this._networkManager.setRequestInterception(this._page.needsRequestInterception());\n  }\n\n  async updateOffline() {\n  }\n\n  async updateHttpCredentials() {\n    await this._networkManager.setCredentials(this._browserContext._options.httpCredentials);\n  }\n\n  async updateFileChooserInterception() {\n  }\n\n  async reload(): Promise<void> {\n    await this._session.send('browsingContext.reload', {\n      context: this._session.sessionId,\n      // ignoreCache: true,\n      wait: bidi.BrowsingContext.ReadinessState.Interactive,\n    });\n  }\n\n  goBack(): Promise<boolean> {\n    throw new Error('Method not implemented.');\n  }\n\n  goForward(): Promise<boolean> {\n    throw new Error('Method not implemented.');\n  }\n\n  async addInitScript(initScript: InitScript): Promise<void> {\n    await this._updateBootstrapScript();\n  }\n\n  async removeNonInternalInitScripts() {\n    await this._updateBootstrapScript();\n  }\n\n  async _updateBootstrapScript(): Promise<void> {\n    throw new Error('Method not implemented.');\n  }\n\n  async closePage(runBeforeUnload: boolean): Promise<void> {\n    await this._session.send('browsingContext.close', {\n      context: this._session.sessionId,\n      promptUnload: runBeforeUnload,\n    });\n  }\n\n  async setBackgroundColor(color?: { r: number; g: number; b: number; a: number; }): Promise<void> {\n  }\n\n  async takeScreenshot(progress: Progress, format: string, documentRect: types.Rect | undefined, viewportRect: types.Rect | undefined, quality: number | undefined, fitsViewport: boolean, scale: 'css' | 'device'): Promise<Buffer> {\n    throw new Error('Method not implemented.');\n  }\n\n  async getContentFrame(handle: dom.ElementHandle): Promise<frames.Frame | null> {\n    const executionContext = toBidiExecutionContext(handle._context);\n    const contentWindow = await executionContext.rawCallFunction('e => e.contentWindow', { handle: handle._objectId });\n    if (contentWindow.type === 'window') {\n      const frameId = contentWindow.value.context;\n      const result = this._page._frameManager.frame(frameId);\n      return result;\n    }\n    return null;\n  }\n\n  async getOwnerFrame(handle: dom.ElementHandle): Promise<string | null> {\n    throw new Error('Method not implemented.');\n  }\n\n  isElementHandle(remoteObject: bidi.Script.RemoteValue): boolean {\n    return remoteObject.type === 'node';\n  }\n\n  async getBoundingBox(handle: dom.ElementHandle): Promise<types.Rect | null> {\n    const box = await handle.evaluate(element => {\n      if (!(element instanceof Element))\n        return null;\n      const rect = element.getBoundingClientRect();\n      return { x: rect.x, y: rect.y, width: rect.width, height: rect.height };\n    });\n    if (!box)\n      return null;\n    const position = await this._framePosition(handle._frame);\n    if (!position)\n      return null;\n    box.x += position.x;\n    box.y += position.y;\n    return box;\n  }\n\n  // TODO: move to Frame.\n  private async _framePosition(frame: frames.Frame): Promise<types.Point | null> {\n    if (frame === this._page.mainFrame())\n      return { x: 0, y: 0 };\n    const element = await frame.frameElement();\n    const box = await element.boundingBox();\n    if (!box)\n      return null;\n    const style = await element.evaluateInUtility(([injected, iframe]) => injected.describeIFrameStyle(iframe as Element), {}).catch(e => 'error:notconnected' as const);\n    if (style === 'error:notconnected' || style === 'transformed')\n      return null;\n    // Content box is offset by border and padding widths.\n    box.x += style.left;\n    box.y += style.top;\n    return box;\n  }\n\n  async scrollRectIntoViewIfNeeded(handle: dom.ElementHandle<Element>, rect?: types.Rect): Promise<'error:notvisible' | 'error:notconnected' | 'done'> {\n    return await handle.evaluateInUtility(([injected, node]) => {\n      node.scrollIntoView({\n        block: 'center',\n        inline: 'center',\n        behavior: 'instant',\n      });\n    }, null).then(() => 'done' as const).catch(e => {\n      if (e instanceof Error && e.message.includes('Node is detached from document'))\n        return 'error:notconnected';\n      if (e instanceof Error && e.message.includes('Node does not have a layout object'))\n        return 'error:notvisible';\n      throw e;\n    });\n  }\n\n  async setScreencastOptions(options: { width: number, height: number, quality: number } | null): Promise<void> {\n  }\n\n  rafCountForStablePosition(): number {\n    return 1;\n  }\n\n  async getContentQuads(handle: dom.ElementHandle<Element>): Promise<types.Quad[] | null | 'error:notconnected'> {\n    const quads = await handle.evaluateInUtility(([injected, node]) => {\n      if (!node.isConnected)\n        return 'error:notconnected';\n      const rects = node.getClientRects();\n      if (!rects)\n        return null;\n      return [...rects].map(rect => [\n        { x: rect.left, y: rect.top },\n        { x: rect.right, y: rect.top },\n        { x: rect.right, y: rect.bottom },\n        { x: rect.left, y: rect.bottom },\n      ]);\n    }, null);\n    if (!quads || quads === 'error:notconnected')\n      return quads;\n    // TODO: consider transforming quads to support clicks in iframes.\n    const position = await this._framePosition(handle._frame);\n    if (!position)\n      return null;\n    quads.forEach(quad => quad.forEach(point => {\n      point.x += position.x;\n      point.y += position.y;\n    }));\n    return quads as types.Quad[];\n  }\n\n  async setInputFiles(handle: dom.ElementHandle<HTMLInputElement>, files: types.FilePayload[]): Promise<void> {\n    throw new Error('Method not implemented.');\n  }\n\n  async setInputFilePaths(handle: dom.ElementHandle<HTMLInputElement>, paths: string[]): Promise<void> {\n    throw new Error('Method not implemented.');\n  }\n\n  async adoptElementHandle<T extends Node>(handle: dom.ElementHandle<T>, to: dom.FrameExecutionContext): Promise<dom.ElementHandle<T>> {\n    const fromContext = toBidiExecutionContext(handle._context);\n    const shared = await fromContext.rawCallFunction('x => x',  { handle: handle._objectId });\n    // TODO: store sharedId in the handle.\n    if (!('sharedId' in shared))\n      throw new Error('Element is not a node');\n    const sharedId = shared.sharedId!;\n    const executionContext = toBidiExecutionContext(to);\n    const result = await executionContext.rawCallFunction('x => x',  { sharedId });\n    if ('handle' in result)\n      return to.createHandle({ objectId: result.handle!, ...result }) as dom.ElementHandle<T>;\n    throw new Error('Failed to adopt element handle.');\n  }\n\n  async getAccessibilityTree(needle?: dom.ElementHandle): Promise<{tree: accessibility.AXNode, needle: accessibility.AXNode | null}> {\n    throw new Error('Method not implemented.');\n  }\n\n  async inputActionEpilogue(): Promise<void> {\n  }\n\n  async resetForReuse(): Promise<void> {\n  }\n\n  async getFrameElement(frame: frames.Frame): Promise<dom.ElementHandle> {\n    const parent = frame.parentFrame();\n    if (!parent)\n      throw new Error('Frame has been detached.');\n    const parentContext = await parent._mainContext();\n    const list = await parentContext.evaluateHandle(() => { return [...document.querySelectorAll('iframe,frame')]; });\n    const length = await list.evaluate(list => list.length);\n    let foundElement = null;\n    for (let i = 0; i < length; i++) {\n      const element = await list.evaluateHandle((list, i) => list[i], i);\n      const candidate = await element.contentFrame();\n      if (frame === candidate) {\n        foundElement = element;\n        break;\n      } else {\n        element.dispose();\n      }\n    }\n    list.dispose();\n    if (!foundElement)\n      throw new Error('Frame has been detached.');\n    return foundElement;\n  }\n\n  shouldToggleStyleSheetToSyncAnimations(): boolean {\n    return true;\n  }\n\n  useMainWorldForSetContent(): boolean {\n    return true;\n  }\n}\n\nfunction toBidiExecutionContext(executionContext: dom.FrameExecutionContext): BidiExecutionContext {\n  return (executionContext as any)[contextDelegateSymbol] as BidiExecutionContext;\n}\n\nconst contextDelegateSymbol = Symbol('delegate');\n"],"mappings":"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"}