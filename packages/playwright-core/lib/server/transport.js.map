{"version":3,"file":"transport.js","names":["_utilsBundle","require","_utils","_happyEyeballs","perMessageDeflate","exports","zlibDeflateOptions","level","zlibInflateOptions","chunkSize","threshold","WebSocketTransport","connect","progress","url","headers","followRedirects","debugLogHeader","_connect","follow","hadRedirects","redirect","logUrl","stripQueryParams","log","transport","success","cleanupWhenAborted","closeAndWait","catch","e","result","Promise","fulfill","reject","_ws","on","event","message","Error","close","request","response","statusCode","i","rawHeaders","length","chunks","errorPrefix","statusMessage","chunk","push","error","Buffer","concat","newHeaders","Object","fromEntries","entries","filter","name","includes","toLowerCase","location","constructor","_progress$timeUntilDe","_progress","_logUrl","onmessage","onclose","wsEndpoint","ws","maxPayload","handshakeTimeout","Math","max","timeUntilDeadline","agent","test","httpsHappyEyeballsAgent","httpHappyEyeballsAgent","value","messageWrap","makeWaitForNextTask","addEventListener","eventData","data","parsedJson","JSON","parse","_this$_progress","call","_this$_progress2","_this$_progress3","code","reason","_this$_progress4","type","send","stringify","_this$_progress5","readyState","CLOSED","promise","f","once","u","URL","search","hash","toString"],"sources":["../../src/server/transport.ts"],"sourcesContent":["/**\n * Copyright 2018 Google Inc. All rights reserved.\n * Modifications copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ws } from '../utilsBundle';\nimport type { WebSocket } from '../utilsBundle';\nimport type { ClientRequest, IncomingMessage } from 'http';\nimport type { Progress } from './progress';\nimport { makeWaitForNextTask } from '../utils';\nimport { httpHappyEyeballsAgent, httpsHappyEyeballsAgent } from '../utils/happy-eyeballs';\nimport type { HeadersArray } from './types';\n\nexport const perMessageDeflate = {\n  zlibDeflateOptions: {\n    level: 3,\n  },\n  zlibInflateOptions: {\n    chunkSize: 10 * 1024\n  },\n  threshold: 10 * 1024,\n};\n\nexport type ProtocolRequest = {\n  id: number;\n  method: string;\n  params: any;\n  sessionId?: string;\n};\n\nexport type ProtocolResponse = {\n  id?: number;\n  method?: string;\n  sessionId?: string;\n  error?: { message: string; data: any; code?: number };\n  params?: any;\n  result?: any;\n  pageProxyId?: string;\n  browserContextId?: string;\n};\n\nexport interface ConnectionTransport {\n  send(s: ProtocolRequest): void;\n  close(): void;  // Note: calling close is expected to issue onclose at some point.\n  onmessage?: (message: ProtocolResponse) => void,\n  onclose?: (reason?: string) => void,\n}\n\nexport class WebSocketTransport implements ConnectionTransport {\n  private _ws: WebSocket;\n  private _progress?: Progress;\n  private _logUrl: string;\n\n  onmessage?: (message: ProtocolResponse) => void;\n  onclose?: (reason?: string) => void;\n  readonly wsEndpoint: string;\n  readonly headers: HeadersArray = [];\n\n  static async connect(progress: (Progress|undefined), url: string, headers?: { [key: string]: string; }, followRedirects?: boolean, debugLogHeader?: string): Promise<WebSocketTransport> {\n    return await WebSocketTransport._connect(progress, url, headers || {}, { follow: !!followRedirects, hadRedirects: false }, debugLogHeader);\n  }\n\n  static async _connect(progress: (Progress|undefined), url: string, headers: { [key: string]: string; }, redirect: { follow: boolean, hadRedirects: boolean }, debugLogHeader?: string): Promise<WebSocketTransport> {\n    const logUrl = stripQueryParams(url);\n    progress?.log(`<ws connecting> ${logUrl}`);\n    const transport = new WebSocketTransport(progress, url, logUrl, headers, redirect.follow && redirect.hadRedirects, debugLogHeader);\n    let success = false;\n    progress?.cleanupWhenAborted(async () => {\n      if (!success)\n        await transport.closeAndWait().catch(e => null);\n    });\n    const result = await new Promise<{ transport?: WebSocketTransport, redirect?: IncomingMessage }>((fulfill, reject) => {\n      transport._ws.on('open', async () => {\n        progress?.log(`<ws connected> ${logUrl}`);\n        fulfill({ transport });\n      });\n      transport._ws.on('error', event => {\n        progress?.log(`<ws connect error> ${logUrl} ${event.message}`);\n        reject(new Error('WebSocket error: ' + event.message));\n        transport._ws.close();\n      });\n      transport._ws.on('unexpected-response', (request: ClientRequest, response: IncomingMessage) => {\n        if (redirect.follow && !redirect.hadRedirects && (response.statusCode === 301 || response.statusCode === 302 || response.statusCode === 307 || response.statusCode === 308)) {\n          fulfill({ redirect: response });\n          transport._ws.close();\n          return;\n        }\n        for (let i = 0; i < response.rawHeaders.length; i += 2) {\n          if (debugLogHeader && response.rawHeaders[i] === debugLogHeader)\n            progress?.log(response.rawHeaders[i + 1]);\n        }\n        const chunks: Buffer[] = [];\n        const errorPrefix = `${logUrl} ${response.statusCode} ${response.statusMessage}`;\n        response.on('data', chunk => chunks.push(chunk));\n        response.on('close', () => {\n          const error = chunks.length ? `${errorPrefix}\\n${Buffer.concat(chunks)}` : errorPrefix;\n          progress?.log(`<ws unexpected response> ${error}`);\n          reject(new Error('WebSocket error: ' + error));\n          transport._ws.close();\n        });\n      });\n    });\n\n    if (result.redirect) {\n      // Strip authorization headers from the redirected request.\n      const newHeaders = Object.fromEntries(Object.entries(headers || {}).filter(([name]) => {\n        return !name.includes('access-key') && name.toLowerCase() !== 'authorization';\n      }));\n      return WebSocketTransport._connect(progress, result.redirect.headers.location!, newHeaders, { follow: true, hadRedirects: true }, debugLogHeader);\n    }\n\n    success = true;\n    return transport;\n  }\n\n  constructor(progress: Progress|undefined, url: string, logUrl: string, headers?: { [key: string]: string; }, followRedirects?: boolean, debugLogHeader?: string) {\n    this.wsEndpoint = url;\n    this._logUrl = logUrl;\n    this._ws = new ws(url, [], {\n      maxPayload: 256 * 1024 * 1024, // 256Mb,\n      // Prevent internal http client error when passing negative timeout.\n      handshakeTimeout: Math.max(progress?.timeUntilDeadline() ?? 30_000, 1),\n      headers,\n      followRedirects,\n      agent: (/^(https|wss):\\/\\//.test(url)) ? httpsHappyEyeballsAgent : httpHappyEyeballsAgent,\n      perMessageDeflate,\n    });\n    this._ws.on('upgrade', response => {\n      for (let i = 0; i < response.rawHeaders.length; i += 2) {\n        this.headers.push({ name: response.rawHeaders[i], value: response.rawHeaders[i + 1] });\n        if (debugLogHeader && response.rawHeaders[i] === debugLogHeader)\n          progress?.log(response.rawHeaders[i + 1]);\n      }\n    });\n    this._progress = progress;\n    // The 'ws' module in node sometimes sends us multiple messages in a single task.\n    // In Web, all IO callbacks (e.g. WebSocket callbacks)\n    // are dispatched into separate tasks, so there's no need\n    // to do anything extra.\n    const messageWrap: (cb: () => void) => void = makeWaitForNextTask();\n\n    this._ws.addEventListener('message', event => {\n      messageWrap(() => {\n        const eventData = event.data as string;\n        let parsedJson;\n        try {\n          parsedJson = JSON.parse(eventData);\n        } catch (e) {\n          this._progress?.log(`<closing ws> Closing websocket due to malformed JSON. eventData=${eventData} e=${e?.message}`);\n          this._ws.close();\n          return;\n        }\n        try {\n          if (this.onmessage)\n            this.onmessage.call(null, parsedJson);\n        } catch (e) {\n          this._progress?.log(`<closing ws> Closing websocket due to failed onmessage callback. eventData=${eventData} e=${e?.message}`);\n          this._ws.close();\n        }\n      });\n    });\n\n    this._ws.addEventListener('close', event => {\n      this._progress?.log(`<ws disconnected> ${logUrl} code=${event.code} reason=${event.reason}`);\n      if (this.onclose)\n        this.onclose.call(null, event.reason);\n    });\n    // Prevent Error: read ECONNRESET.\n    this._ws.addEventListener('error', error => this._progress?.log(`<ws error> ${logUrl} ${error.type} ${error.message}`));\n  }\n\n  send(message: ProtocolRequest) {\n    this._ws.send(JSON.stringify(message));\n  }\n\n  close() {\n    this._progress?.log(`<ws disconnecting> ${this._logUrl}`);\n    this._ws.close();\n  }\n\n  async closeAndWait() {\n    if (this._ws.readyState === ws.CLOSED)\n      return;\n    const promise = new Promise(f => this._ws.once('close', f));\n    this.close();\n    await promise; // Make sure to await the actual disconnect.\n  }\n}\n\nfunction stripQueryParams(url: string): string {\n  try {\n    const u = new URL(url);\n    u.search = '';\n    u.hash = '';\n    return u.toString();\n  } catch {\n    return url;\n  }\n}\n"],"mappings":";;;;;;AAiBA,IAAAA,YAAA,GAAAC,OAAA;AAIA,IAAAC,MAAA,GAAAD,OAAA;AACA,IAAAE,cAAA,GAAAF,OAAA;AAtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAUO,MAAMG,iBAAiB,GAAAC,OAAA,CAAAD,iBAAA,GAAG;EAC/BE,kBAAkB,EAAE;IAClBC,KAAK,EAAE;EACT,CAAC;EACDC,kBAAkB,EAAE;IAClBC,SAAS,EAAE,EAAE,GAAG;EAClB,CAAC;EACDC,SAAS,EAAE,EAAE,GAAG;AAClB,CAAC;AA2BM,MAAMC,kBAAkB,CAAgC;EAU7D,aAAaC,OAAOA,CAACC,QAA8B,EAAEC,GAAW,EAAEC,OAAoC,EAAEC,eAAyB,EAAEC,cAAuB,EAA+B;IACvL,OAAO,MAAMN,kBAAkB,CAACO,QAAQ,CAACL,QAAQ,EAAEC,GAAG,EAAEC,OAAO,IAAI,CAAC,CAAC,EAAE;MAAEI,MAAM,EAAE,CAAC,CAACH,eAAe;MAAEI,YAAY,EAAE;IAAM,CAAC,EAAEH,cAAc,CAAC;EAC5I;EAEA,aAAaC,QAAQA,CAACL,QAA8B,EAAEC,GAAW,EAAEC,OAAmC,EAAEM,QAAoD,EAAEJ,cAAuB,EAA+B;IAClN,MAAMK,MAAM,GAAGC,gBAAgB,CAACT,GAAG,CAAC;IACpCD,QAAQ,aAARA,QAAQ,eAARA,QAAQ,CAAEW,GAAG,CAAE,mBAAkBF,MAAO,EAAC,CAAC;IAC1C,MAAMG,SAAS,GAAG,IAAId,kBAAkB,CAACE,QAAQ,EAAEC,GAAG,EAAEQ,MAAM,EAAEP,OAAO,EAAEM,QAAQ,CAACF,MAAM,IAAIE,QAAQ,CAACD,YAAY,EAAEH,cAAc,CAAC;IAClI,IAAIS,OAAO,GAAG,KAAK;IACnBb,QAAQ,aAARA,QAAQ,eAARA,QAAQ,CAAEc,kBAAkB,CAAC,YAAY;MACvC,IAAI,CAACD,OAAO,EACV,MAAMD,SAAS,CAACG,YAAY,CAAC,CAAC,CAACC,KAAK,CAACC,CAAC,IAAI,IAAI,CAAC;IACnD,CAAC,CAAC;IACF,MAAMC,MAAM,GAAG,MAAM,IAAIC,OAAO,CAAiE,CAACC,OAAO,EAAEC,MAAM,KAAK;MACpHT,SAAS,CAACU,GAAG,CAACC,EAAE,CAAC,MAAM,EAAE,YAAY;QACnCvB,QAAQ,aAARA,QAAQ,eAARA,QAAQ,CAAEW,GAAG,CAAE,kBAAiBF,MAAO,EAAC,CAAC;QACzCW,OAAO,CAAC;UAAER;QAAU,CAAC,CAAC;MACxB,CAAC,CAAC;MACFA,SAAS,CAACU,GAAG,CAACC,EAAE,CAAC,OAAO,EAAEC,KAAK,IAAI;QACjCxB,QAAQ,aAARA,QAAQ,eAARA,QAAQ,CAAEW,GAAG,CAAE,sBAAqBF,MAAO,IAAGe,KAAK,CAACC,OAAQ,EAAC,CAAC;QAC9DJ,MAAM,CAAC,IAAIK,KAAK,CAAC,mBAAmB,GAAGF,KAAK,CAACC,OAAO,CAAC,CAAC;QACtDb,SAAS,CAACU,GAAG,CAACK,KAAK,CAAC,CAAC;MACvB,CAAC,CAAC;MACFf,SAAS,CAACU,GAAG,CAACC,EAAE,CAAC,qBAAqB,EAAE,CAACK,OAAsB,EAAEC,QAAyB,KAAK;QAC7F,IAAIrB,QAAQ,CAACF,MAAM,IAAI,CAACE,QAAQ,CAACD,YAAY,KAAKsB,QAAQ,CAACC,UAAU,KAAK,GAAG,IAAID,QAAQ,CAACC,UAAU,KAAK,GAAG,IAAID,QAAQ,CAACC,UAAU,KAAK,GAAG,IAAID,QAAQ,CAACC,UAAU,KAAK,GAAG,CAAC,EAAE;UAC3KV,OAAO,CAAC;YAAEZ,QAAQ,EAAEqB;UAAS,CAAC,CAAC;UAC/BjB,SAAS,CAACU,GAAG,CAACK,KAAK,CAAC,CAAC;UACrB;QACF;QACA,KAAK,IAAII,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,QAAQ,CAACG,UAAU,CAACC,MAAM,EAAEF,CAAC,IAAI,CAAC,EAAE;UACtD,IAAI3B,cAAc,IAAIyB,QAAQ,CAACG,UAAU,CAACD,CAAC,CAAC,KAAK3B,cAAc,EAC7DJ,QAAQ,aAARA,QAAQ,eAARA,QAAQ,CAAEW,GAAG,CAACkB,QAAQ,CAACG,UAAU,CAACD,CAAC,GAAG,CAAC,CAAC,CAAC;QAC7C;QACA,MAAMG,MAAgB,GAAG,EAAE;QAC3B,MAAMC,WAAW,GAAI,GAAE1B,MAAO,IAAGoB,QAAQ,CAACC,UAAW,IAAGD,QAAQ,CAACO,aAAc,EAAC;QAChFP,QAAQ,CAACN,EAAE,CAAC,MAAM,EAAEc,KAAK,IAAIH,MAAM,CAACI,IAAI,CAACD,KAAK,CAAC,CAAC;QAChDR,QAAQ,CAACN,EAAE,CAAC,OAAO,EAAE,MAAM;UACzB,MAAMgB,KAAK,GAAGL,MAAM,CAACD,MAAM,GAAI,GAAEE,WAAY,KAAIK,MAAM,CAACC,MAAM,CAACP,MAAM,CAAE,EAAC,GAAGC,WAAW;UACtFnC,QAAQ,aAARA,QAAQ,eAARA,QAAQ,CAAEW,GAAG,CAAE,4BAA2B4B,KAAM,EAAC,CAAC;UAClDlB,MAAM,CAAC,IAAIK,KAAK,CAAC,mBAAmB,GAAGa,KAAK,CAAC,CAAC;UAC9C3B,SAAS,CAACU,GAAG,CAACK,KAAK,CAAC,CAAC;QACvB,CAAC,CAAC;MACJ,CAAC,CAAC;IACJ,CAAC,CAAC;IAEF,IAAIT,MAAM,CAACV,QAAQ,EAAE;MACnB;MACA,MAAMkC,UAAU,GAAGC,MAAM,CAACC,WAAW,CAACD,MAAM,CAACE,OAAO,CAAC3C,OAAO,IAAI,CAAC,CAAC,CAAC,CAAC4C,MAAM,CAAC,CAAC,CAACC,IAAI,CAAC,KAAK;QACrF,OAAO,CAACA,IAAI,CAACC,QAAQ,CAAC,YAAY,CAAC,IAAID,IAAI,CAACE,WAAW,CAAC,CAAC,KAAK,eAAe;MAC/E,CAAC,CAAC,CAAC;MACH,OAAOnD,kBAAkB,CAACO,QAAQ,CAACL,QAAQ,EAAEkB,MAAM,CAACV,QAAQ,CAACN,OAAO,CAACgD,QAAQ,EAAGR,UAAU,EAAE;QAAEpC,MAAM,EAAE,IAAI;QAAEC,YAAY,EAAE;MAAK,CAAC,EAAEH,cAAc,CAAC;IACnJ;IAEAS,OAAO,GAAG,IAAI;IACd,OAAOD,SAAS;EAClB;EAEAuC,WAAWA,CAACnD,QAA4B,EAAEC,GAAW,EAAEQ,MAAc,EAAEP,OAAoC,EAAEC,eAAyB,EAAEC,cAAuB,EAAE;IAAA,IAAAgD,qBAAA;IAAA,KAlEzJ9B,GAAG;IAAA,KACH+B,SAAS;IAAA,KACTC,OAAO;IAAA,KAEfC,SAAS;IAAA,KACTC,OAAO;IAAA,KACEC,UAAU;IAAA,KACVvD,OAAO,GAAiB,EAAE;IA4DjC,IAAI,CAACuD,UAAU,GAAGxD,GAAG;IACrB,IAAI,CAACqD,OAAO,GAAG7C,MAAM;IACrB,IAAI,CAACa,GAAG,GAAG,IAAIoC,eAAE,CAACzD,GAAG,EAAE,EAAE,EAAE;MACzB0D,UAAU,EAAE,GAAG,GAAG,IAAI,GAAG,IAAI;MAAE;MAC/B;MACAC,gBAAgB,EAAEC,IAAI,CAACC,GAAG,EAAAV,qBAAA,GAACpD,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAE+D,iBAAiB,CAAC,CAAC,cAAAX,qBAAA,cAAAA,qBAAA,GAAI,MAAM,EAAE,CAAC,CAAC;MACtElD,OAAO;MACPC,eAAe;MACf6D,KAAK,EAAG,mBAAmB,CAACC,IAAI,CAAChE,GAAG,CAAC,GAAIiE,sCAAuB,GAAGC,qCAAsB;MACzF5E;IACF,CAAC,CAAC;IACF,IAAI,CAAC+B,GAAG,CAACC,EAAE,CAAC,SAAS,EAAEM,QAAQ,IAAI;MACjC,KAAK,IAAIE,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,QAAQ,CAACG,UAAU,CAACC,MAAM,EAAEF,CAAC,IAAI,CAAC,EAAE;QACtD,IAAI,CAAC7B,OAAO,CAACoC,IAAI,CAAC;UAAES,IAAI,EAAElB,QAAQ,CAACG,UAAU,CAACD,CAAC,CAAC;UAAEqC,KAAK,EAAEvC,QAAQ,CAACG,UAAU,CAACD,CAAC,GAAG,CAAC;QAAE,CAAC,CAAC;QACtF,IAAI3B,cAAc,IAAIyB,QAAQ,CAACG,UAAU,CAACD,CAAC,CAAC,KAAK3B,cAAc,EAC7DJ,QAAQ,aAARA,QAAQ,eAARA,QAAQ,CAAEW,GAAG,CAACkB,QAAQ,CAACG,UAAU,CAACD,CAAC,GAAG,CAAC,CAAC,CAAC;MAC7C;IACF,CAAC,CAAC;IACF,IAAI,CAACsB,SAAS,GAAGrD,QAAQ;IACzB;IACA;IACA;IACA;IACA,MAAMqE,WAAqC,GAAG,IAAAC,0BAAmB,EAAC,CAAC;IAEnE,IAAI,CAAChD,GAAG,CAACiD,gBAAgB,CAAC,SAAS,EAAE/C,KAAK,IAAI;MAC5C6C,WAAW,CAAC,MAAM;QAChB,MAAMG,SAAS,GAAGhD,KAAK,CAACiD,IAAc;QACtC,IAAIC,UAAU;QACd,IAAI;UACFA,UAAU,GAAGC,IAAI,CAACC,KAAK,CAACJ,SAAS,CAAC;QACpC,CAAC,CAAC,OAAOvD,CAAC,EAAE;UAAA,IAAA4D,eAAA;UACV,CAAAA,eAAA,OAAI,CAACxB,SAAS,cAAAwB,eAAA,eAAdA,eAAA,CAAgBlE,GAAG,CAAE,mEAAkE6D,SAAU,MAAKvD,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEQ,OAAQ,EAAC,CAAC;UACnH,IAAI,CAACH,GAAG,CAACK,KAAK,CAAC,CAAC;UAChB;QACF;QACA,IAAI;UACF,IAAI,IAAI,CAAC4B,SAAS,EAChB,IAAI,CAACA,SAAS,CAACuB,IAAI,CAAC,IAAI,EAAEJ,UAAU,CAAC;QACzC,CAAC,CAAC,OAAOzD,CAAC,EAAE;UAAA,IAAA8D,gBAAA;UACV,CAAAA,gBAAA,OAAI,CAAC1B,SAAS,cAAA0B,gBAAA,eAAdA,gBAAA,CAAgBpE,GAAG,CAAE,8EAA6E6D,SAAU,MAAKvD,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEQ,OAAQ,EAAC,CAAC;UAC9H,IAAI,CAACH,GAAG,CAACK,KAAK,CAAC,CAAC;QAClB;MACF,CAAC,CAAC;IACJ,CAAC,CAAC;IAEF,IAAI,CAACL,GAAG,CAACiD,gBAAgB,CAAC,OAAO,EAAE/C,KAAK,IAAI;MAAA,IAAAwD,gBAAA;MAC1C,CAAAA,gBAAA,OAAI,CAAC3B,SAAS,cAAA2B,gBAAA,eAAdA,gBAAA,CAAgBrE,GAAG,CAAE,qBAAoBF,MAAO,SAAQe,KAAK,CAACyD,IAAK,WAAUzD,KAAK,CAAC0D,MAAO,EAAC,CAAC;MAC5F,IAAI,IAAI,CAAC1B,OAAO,EACd,IAAI,CAACA,OAAO,CAACsB,IAAI,CAAC,IAAI,EAAEtD,KAAK,CAAC0D,MAAM,CAAC;IACzC,CAAC,CAAC;IACF;IACA,IAAI,CAAC5D,GAAG,CAACiD,gBAAgB,CAAC,OAAO,EAAEhC,KAAK;MAAA,IAAA4C,gBAAA;MAAA,QAAAA,gBAAA,GAAI,IAAI,CAAC9B,SAAS,cAAA8B,gBAAA,uBAAdA,gBAAA,CAAgBxE,GAAG,CAAE,cAAaF,MAAO,IAAG8B,KAAK,CAAC6C,IAAK,IAAG7C,KAAK,CAACd,OAAQ,EAAC,CAAC;IAAA,EAAC;EACzH;EAEA4D,IAAIA,CAAC5D,OAAwB,EAAE;IAC7B,IAAI,CAACH,GAAG,CAAC+D,IAAI,CAACV,IAAI,CAACW,SAAS,CAAC7D,OAAO,CAAC,CAAC;EACxC;EAEAE,KAAKA,CAAA,EAAG;IAAA,IAAA4D,gBAAA;IACN,CAAAA,gBAAA,OAAI,CAAClC,SAAS,cAAAkC,gBAAA,eAAdA,gBAAA,CAAgB5E,GAAG,CAAE,sBAAqB,IAAI,CAAC2C,OAAQ,EAAC,CAAC;IACzD,IAAI,CAAChC,GAAG,CAACK,KAAK,CAAC,CAAC;EAClB;EAEA,MAAMZ,YAAYA,CAAA,EAAG;IACnB,IAAI,IAAI,CAACO,GAAG,CAACkE,UAAU,KAAK9B,eAAE,CAAC+B,MAAM,EACnC;IACF,MAAMC,OAAO,GAAG,IAAIvE,OAAO,CAACwE,CAAC,IAAI,IAAI,CAACrE,GAAG,CAACsE,IAAI,CAAC,OAAO,EAAED,CAAC,CAAC,CAAC;IAC3D,IAAI,CAAChE,KAAK,CAAC,CAAC;IACZ,MAAM+D,OAAO,CAAC,CAAC;EACjB;AACF;AAAClG,OAAA,CAAAM,kBAAA,GAAAA,kBAAA;AAED,SAASY,gBAAgBA,CAACT,GAAW,EAAU;EAC7C,IAAI;IACF,MAAM4F,CAAC,GAAG,IAAIC,GAAG,CAAC7F,GAAG,CAAC;IACtB4F,CAAC,CAACE,MAAM,GAAG,EAAE;IACbF,CAAC,CAACG,IAAI,GAAG,EAAE;IACX,OAAOH,CAAC,CAACI,QAAQ,CAAC,CAAC;EACrB,CAAC,CAAC,MAAM;IACN,OAAOhG,GAAG;EACZ;AACF"}