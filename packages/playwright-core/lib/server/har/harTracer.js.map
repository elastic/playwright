{"version":3,"file":"harTracer.js","names":["_browserContext","require","_fetch","_helper","network","_interopRequireWildcard","_utils","_eventsHelper","_utilsBundle","_manualPromise","_frames","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","FALLBACK_HTTP_VERSION","HarTracer","constructor","context","page","delegate","options","_context","_barrierPromises","Set","_delegate","_options","_pageEntries","Map","_eventListeners","_started","_entrySymbol","_baseURL","_page","slimMode","omitSecurityDetails","omitCookies","omitTiming","omitServerIP","omitSizes","omitPages","Symbol","APIRequestContext","_defaultOptions","baseURL","start","omitScripts","apiRequest","fetchRequest","eventsHelper","addEventListener","Events","Request","event","_onAPIRequest","RequestFinished","_onAPIRequestFinished","BrowserContext","push","Page","_createPageEntryIfNeeded","request","_onRequest","response","_onRequestFinished","catch","RequestFailed","_onRequestFailed","Response","_onResponse","RequestAborted","_onRequestAborted","RequestFulfilled","_onRequestFulfilled","RequestContinued","_onRequestContinued","_shouldIncludeEntryWithUrl","urlString","urlFilter","urlMatches","_entryForRequest","pageEntry","date","Date","startedDateTime","toISOString","id","guid","title","pageTimings","onContentLoad","onLoad","startedDateSymbol","mainFrame","on","Frame","AddLifecycle","_onLoad","_onDOMContentLoaded","promise","evaluateExpression","String","document","domContentLoaded","performance","timing","domContentLoadedEventStart","isFunction","world","then","result","_addBarrier","loaded","loadEventStart","target","waitForContentOnStop","race","openScope","safeRace","add","delete","_event$postData","url","toString","harEntry","createHarEntry","method","undefined","_apiRequest","cookies","headers","entries","map","name","value","postData","_postDataForBuffer","content","bodySize","length","onEntryStarted","requestEvent","status","statusCode","statusText","statusMessage","httpVersion","redirectURL","location","rawHeaders","c","expires","safeDateToISOString","contentType","mimeType","_storeResponseContent","body","onEntryFinished","_request$frame","_request$frame2","frame","parsedURL","pageref","_recordRequestHeadersAndCookies","_postDataForRequest","redirectedFrom","fromEntry","assert","header","filter","toLowerCase","split","parseCookie","_recordRequestOverrides","_hasOverrides","recordRequestOverrides","_request$frame3","serviceWorker","serverAddr","server","ipAddress","serverIPAddress","port","_serverPort","securityDetails","details","_securityDetails","compressionCalculationBarrier","_encodedBodySize","_decodedBodySize","barrier","ManualPromise","_check","compression","Math","max","resolve","setEncodedBodySize","encodedBodySize","setDecodedBodySize","decodedBodySize","buffer","resourceType","timings","receive","_responseEndTiming","helper","millisToRoundishMillis","responseStart","_computeHarEntryTotalTime","sizes","responseBodySize","headersSize","responseHeadersSize","_transferSize","transferSize","requestHeadersSize","_failureText","_wasAborted","_wasFulfilled","_wasContinued","size","isTextualMimeType","text","encoding","sha1","calculateSha1","mime","getExtension","includeTraceInfo","_sha1","_file","onContentBlob","_response$frame","startDateTime","valueOf","startTime","dns","domainLookupEnd","domainLookupStart","connect","connectEnd","connectStart","ssl","secureConnectionStart","wait","requestStart","send","rawRequestHeaders","_recordResponseHeaders","rawResponseHeaders","find","time","reduce","pre","cur","flush","Promise","all","stop","removeEventListeners","clear","log","version","creator","getPlaywrightVersion","browser","_browser","pages","Array","from","values","postDataBuffer","headerValue","_contentType","params","parsed","URLSearchParams","exports","frameref","_frameref","_monotonicTime","monotonicTime","queryString","searchParams","cache","cookie","first","pair","indexOfEquals","indexOf","substr","trim","domain","httpOnly","now","path","sameSite","secure"],"sources":["../../../src/server/har/harTracer.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { BrowserContext } from '../browserContext';\nimport type { APIRequestEvent, APIRequestFinishedEvent } from '../fetch';\nimport { APIRequestContext } from '../fetch';\nimport { helper } from '../helper';\nimport * as network from '../network';\nimport type { Worker } from '../page';\nimport type { Page } from '../page';\nimport type * as har from '@trace/har';\nimport { assert, calculateSha1, monotonicTime } from '../../utils';\nimport type { RegisteredListener } from '../../utils/eventsHelper';\nimport { eventsHelper } from '../../utils/eventsHelper';\nimport { mime } from '../../utilsBundle';\nimport { ManualPromise } from '../../utils/manualPromise';\nimport { getPlaywrightVersion, isTextualMimeType, urlMatches } from '../../utils';\nimport { Frame } from '../frames';\nimport type { HeadersArray, LifecycleEvent } from '../types';\n\nconst FALLBACK_HTTP_VERSION = 'HTTP/1.1';\n\nexport interface HarTracerDelegate {\n  onEntryStarted(entry: har.Entry): void;\n  onEntryFinished(entry: har.Entry): void;\n  onContentBlob(sha1: string, buffer: Buffer): void;\n}\n\ntype HarTracerOptions = {\n  content: 'omit' | 'attach' | 'embed';\n  includeTraceInfo: boolean;\n  recordRequestOverrides: boolean;\n  waitForContentOnStop: boolean;\n  urlFilter?: string | RegExp;\n  slimMode?: boolean;\n  omitSecurityDetails?: boolean;\n  omitCookies?: boolean;\n  omitTiming?: boolean;\n  omitServerIP?: boolean;\n  omitPages?: boolean;\n  omitSizes?: boolean;\n  omitScripts?: boolean;\n};\n\nexport class HarTracer {\n  private _context: BrowserContext | APIRequestContext;\n  private _barrierPromises = new Set<Promise<void>>();\n  private _delegate: HarTracerDelegate;\n  private _options: HarTracerOptions;\n  private _pageEntries = new Map<Page, har.Page>();\n  private _eventListeners: RegisteredListener[] = [];\n  private _started = false;\n  private _entrySymbol: symbol;\n  private _baseURL: string | undefined;\n  private _page: Page | null;\n\n  constructor(context: BrowserContext | APIRequestContext, page: Page | null, delegate: HarTracerDelegate, options: HarTracerOptions) {\n    this._context = context;\n    this._page = page;\n    this._delegate = delegate;\n    this._options = options;\n    if (options.slimMode) {\n      options.omitSecurityDetails = true;\n      options.omitCookies = true;\n      options.omitTiming = true;\n      options.omitServerIP = true;\n      options.omitSizes = true;\n      options.omitPages = true;\n    }\n    this._entrySymbol = Symbol('requestHarEntry');\n    this._baseURL = context instanceof APIRequestContext ? context._defaultOptions().baseURL : context._options.baseURL;\n  }\n\n  start(options: { omitScripts: boolean }) {\n    if (this._started)\n      return;\n    this._options.omitScripts = options.omitScripts;\n    this._started = true;\n    const apiRequest = this._context instanceof APIRequestContext ? this._context : this._context.fetchRequest;\n    this._eventListeners = [\n      eventsHelper.addEventListener(apiRequest, APIRequestContext.Events.Request, (event: APIRequestEvent) => this._onAPIRequest(event)),\n      eventsHelper.addEventListener(apiRequest, APIRequestContext.Events.RequestFinished, (event: APIRequestFinishedEvent) => this._onAPIRequestFinished(event)),\n    ];\n    if (this._context instanceof BrowserContext) {\n      this._eventListeners.push(\n          eventsHelper.addEventListener(this._context, BrowserContext.Events.Page, (page: Page) => this._createPageEntryIfNeeded(page)),\n          eventsHelper.addEventListener(this._context, BrowserContext.Events.Request, (request: network.Request) => this._onRequest(request)),\n          eventsHelper.addEventListener(this._context, BrowserContext.Events.RequestFinished, ({ request, response }) => this._onRequestFinished(request, response).catch(() => {})),\n          eventsHelper.addEventListener(this._context, BrowserContext.Events.RequestFailed, request => this._onRequestFailed(request)),\n          eventsHelper.addEventListener(this._context, BrowserContext.Events.Response, (response: network.Response) => this._onResponse(response)),\n          eventsHelper.addEventListener(this._context, BrowserContext.Events.RequestAborted, request => this._onRequestAborted(request)),\n          eventsHelper.addEventListener(this._context, BrowserContext.Events.RequestFulfilled, request => this._onRequestFulfilled(request)),\n          eventsHelper.addEventListener(this._context, BrowserContext.Events.RequestContinued, request => this._onRequestContinued(request)),\n      );\n    }\n  }\n\n  private _shouldIncludeEntryWithUrl(urlString: string) {\n    return !this._options.urlFilter || urlMatches(this._baseURL, urlString, this._options.urlFilter);\n  }\n\n  private _entryForRequest(request: network.Request | APIRequestEvent): har.Entry | undefined {\n    return (request as any)[this._entrySymbol];\n  }\n\n  private _createPageEntryIfNeeded(page?: Page): har.Page | undefined {\n    if (!page)\n      return;\n    if (this._options.omitPages)\n      return;\n    if (this._page && page !== this._page)\n      return;\n    let pageEntry = this._pageEntries.get(page);\n    if (!pageEntry) {\n      const date = new Date();\n      pageEntry = {\n        startedDateTime: date.toISOString(),\n        id: page.guid,\n        title: '',\n        pageTimings: this._options.omitTiming ? {} : {\n          onContentLoad: -1,\n          onLoad: -1,\n        },\n      };\n      (pageEntry as any)[startedDateSymbol] = date;\n\n      page.mainFrame().on(Frame.Events.AddLifecycle, (event: LifecycleEvent) => {\n        if (event === 'load')\n          this._onLoad(page, pageEntry!);\n        if (event === 'domcontentloaded')\n          this._onDOMContentLoaded(page, pageEntry!);\n      });\n\n      this._pageEntries.set(page, pageEntry);\n    }\n    return pageEntry;\n  }\n\n  private _onDOMContentLoaded(page: Page, pageEntry: har.Page) {\n    const promise = page.mainFrame().evaluateExpression(String(() => {\n      return {\n        title: document.title,\n        domContentLoaded: performance.timing.domContentLoadedEventStart,\n      };\n    }), { isFunction: true, world: 'utility' }).then(result => {\n      pageEntry.title = result.title;\n      if (!this._options.omitTiming)\n        pageEntry.pageTimings.onContentLoad = result.domContentLoaded;\n    }).catch(() => {});\n    this._addBarrier(page, promise);\n  }\n\n  private _onLoad(page: Page, pageEntry: har.Page) {\n    const promise = page.mainFrame().evaluateExpression(String(() => {\n      return {\n        title: document.title,\n        loaded: performance.timing.loadEventStart,\n      };\n    }), { isFunction: true, world: 'utility' }).then(result => {\n      pageEntry.title = result.title;\n      if (!this._options.omitTiming)\n        pageEntry.pageTimings.onLoad = result.loaded;\n    }).catch(() => {});\n    this._addBarrier(page, promise);\n  }\n\n  private _addBarrier(target: Page | Worker | null, promise: Promise<void>) {\n    if (!target)\n      return null;\n    if (!this._options.waitForContentOnStop)\n      return;\n    const race = target.openScope.safeRace(promise);\n    this._barrierPromises.add(race);\n    race.then(() => this._barrierPromises.delete(race));\n  }\n\n  private _onAPIRequest(event: APIRequestEvent) {\n    if (!this._shouldIncludeEntryWithUrl(event.url.toString()))\n      return;\n    const harEntry = createHarEntry(event.method, event.url, undefined, this._options);\n    harEntry._apiRequest = true;\n    if (!this._options.omitCookies)\n      harEntry.request.cookies = event.cookies;\n    harEntry.request.headers = Object.entries(event.headers).map(([name, value]) => ({ name, value }));\n    harEntry.request.postData = this._postDataForBuffer(event.postData || null, event.headers['content-type'],  this._options.content);\n    if (!this._options.omitSizes)\n      harEntry.request.bodySize = event.postData?.length || 0;\n    (event as any)[this._entrySymbol] = harEntry;\n    if (this._started)\n      this._delegate.onEntryStarted(harEntry);\n  }\n\n  private _onAPIRequestFinished(event: APIRequestFinishedEvent): void {\n    const harEntry = this._entryForRequest(event.requestEvent);\n    if (!harEntry)\n      return;\n\n    harEntry.response.status = event.statusCode;\n    harEntry.response.statusText = event.statusMessage;\n    harEntry.response.httpVersion = event.httpVersion;\n    harEntry.response.redirectURL = event.headers.location || '';\n    for (let i = 0; i < event.rawHeaders.length; i += 2) {\n      harEntry.response.headers.push({\n        name: event.rawHeaders[i],\n        value: event.rawHeaders[i + 1]\n      });\n    }\n    harEntry.response.cookies = this._options.omitCookies ? [] : event.cookies.map(c => {\n      return {\n        ...c,\n        expires: c.expires === -1 ? undefined : safeDateToISOString(c.expires)\n      };\n    });\n\n    const content = harEntry.response.content;\n    const contentType = event.headers['content-type'];\n    if (contentType)\n      content.mimeType = contentType;\n    this._storeResponseContent(event.body, content, 'other');\n\n    if (this._started)\n      this._delegate.onEntryFinished(harEntry);\n  }\n\n  private _onRequest(request: network.Request) {\n    if (!this._shouldIncludeEntryWithUrl(request.url()))\n      return;\n    const page = request.frame()?._page;\n    if (this._page && page !== this._page)\n      return;\n    const url = network.parsedURL(request.url());\n    if (!url)\n      return;\n\n    const pageEntry = this._createPageEntryIfNeeded(page);\n    const harEntry = createHarEntry(request.method(), url, request.frame()?.guid, this._options);\n    if (pageEntry)\n      harEntry.pageref = pageEntry.id;\n    this._recordRequestHeadersAndCookies(harEntry, request.headers());\n    harEntry.request.postData = this._postDataForRequest(request, this._options.content);\n    if (!this._options.omitSizes)\n      harEntry.request.bodySize = request.bodySize();\n    if (request.redirectedFrom()) {\n      const fromEntry = this._entryForRequest(request.redirectedFrom()!);\n      if (fromEntry)\n        fromEntry.response.redirectURL = request.url();\n    }\n    (request as any)[this._entrySymbol] = harEntry;\n    assert(this._started);\n    this._delegate.onEntryStarted(harEntry);\n  }\n\n  private _recordRequestHeadersAndCookies(harEntry: har.Entry, headers: HeadersArray) {\n    if (!this._options.omitCookies) {\n      harEntry.request.cookies = [];\n      for (const header of headers.filter(header => header.name.toLowerCase() === 'cookie'))\n        harEntry.request.cookies.push(...header.value.split(';').map(parseCookie));\n    }\n    harEntry.request.headers = headers;\n  }\n\n  private _recordRequestOverrides(harEntry: har.Entry, request: network.Request) {\n    if (!request._hasOverrides() || !this._options.recordRequestOverrides)\n      return;\n    harEntry.request.method = request.method();\n    harEntry.request.url = request.url();\n    harEntry.request.postData = this._postDataForRequest(request, this._options.content);\n    this._recordRequestHeadersAndCookies(harEntry, request.headers());\n  }\n\n  private async _onRequestFinished(request: network.Request, response: network.Response | null) {\n    if (!response)\n      return;\n    const harEntry = this._entryForRequest(request);\n    if (!harEntry)\n      return;\n    const page = request.frame()?._page;\n\n    // In WebKit security details and server ip are reported in Network.loadingFinished, so we populate\n    // it here to not hang in case of long chunked responses, see https://github.com/microsoft/playwright/issues/21182.\n    if (!this._options.omitServerIP) {\n      this._addBarrier(page || request.serviceWorker(), response.serverAddr().then(server => {\n        if (server?.ipAddress)\n          harEntry.serverIPAddress = server.ipAddress;\n        if (server?.port)\n          harEntry._serverPort = server.port;\n      }));\n    }\n    if (!this._options.omitSecurityDetails) {\n      this._addBarrier(page || request.serviceWorker(), response.securityDetails().then(details => {\n        if (details)\n          harEntry._securityDetails = details;\n      }));\n    }\n\n    const httpVersion = response.httpVersion();\n    harEntry.request.httpVersion = httpVersion;\n    harEntry.response.httpVersion = httpVersion;\n\n    const compressionCalculationBarrier = this._options.omitSizes ? undefined : {\n      _encodedBodySize: -1,\n      _decodedBodySize: -1,\n      barrier: new ManualPromise<void>(),\n      _check: function() {\n        if (this._encodedBodySize !== -1 && this._decodedBodySize !== -1) {\n          harEntry.response.content.compression = Math.max(0, this._decodedBodySize - this._encodedBodySize);\n          this.barrier.resolve();\n        }\n      },\n      setEncodedBodySize: function(encodedBodySize: number){\n        this._encodedBodySize = encodedBodySize;\n        this._check();\n      },\n      setDecodedBodySize: function(decodedBodySize: number) {\n        this._decodedBodySize = decodedBodySize;\n        this._check();\n      }\n    };\n    if (compressionCalculationBarrier)\n      this._addBarrier(page || request.serviceWorker(), compressionCalculationBarrier.barrier);\n\n    const promise = response.body().then(buffer => {\n      if (this._options.omitScripts && request.resourceType() === 'script') {\n        compressionCalculationBarrier?.setDecodedBodySize(0);\n        return;\n      }\n\n      const content = harEntry.response.content;\n      compressionCalculationBarrier?.setDecodedBodySize(buffer.length);\n      this._storeResponseContent(buffer, content, request.resourceType());\n    }).catch(() => {\n      compressionCalculationBarrier?.setDecodedBodySize(0);\n    }).then(() => {\n      if (this._started)\n        this._delegate.onEntryFinished(harEntry);\n    });\n    this._addBarrier(page || request.serviceWorker(), promise);\n\n    // Response end timing is only available after the response event was received.\n    const timing = response.timing();\n    harEntry.timings.receive = response.request()._responseEndTiming !== -1 ? helper.millisToRoundishMillis(response.request()._responseEndTiming - timing.responseStart) : -1;\n    this._computeHarEntryTotalTime(harEntry);\n\n    if (!this._options.omitSizes) {\n      this._addBarrier(page || request.serviceWorker(), response.sizes().then(sizes => {\n        harEntry.response.bodySize = sizes.responseBodySize;\n        harEntry.response.headersSize = sizes.responseHeadersSize;\n        harEntry.response._transferSize = sizes.transferSize;\n        harEntry.request.headersSize = sizes.requestHeadersSize;\n        compressionCalculationBarrier?.setEncodedBodySize(sizes.responseBodySize);\n      }));\n    }\n  }\n\n  private async _onRequestFailed(request: network.Request) {\n    const harEntry = this._entryForRequest(request);\n    if (!harEntry)\n      return;\n\n    if (request._failureText !== null)\n      harEntry.response._failureText = request._failureText;\n    this._recordRequestOverrides(harEntry, request);\n    if (this._started)\n      this._delegate.onEntryFinished(harEntry);\n  }\n\n  private _onRequestAborted(request: network.Request) {\n    const harEntry = this._entryForRequest(request);\n    if (harEntry)\n      harEntry._wasAborted = true;\n  }\n\n  private _onRequestFulfilled(request: network.Request) {\n    const harEntry = this._entryForRequest(request);\n    if (harEntry)\n      harEntry._wasFulfilled = true;\n  }\n\n  private _onRequestContinued(request: network.Request) {\n    const harEntry = this._entryForRequest(request);\n    if (harEntry)\n      harEntry._wasContinued = true;\n  }\n\n  private _storeResponseContent(buffer: Buffer | undefined, content: har.Content, resourceType: string) {\n    if (!buffer) {\n      content.size = 0;\n      return;\n    }\n\n    if (!this._options.omitSizes)\n      content.size = buffer.length;\n\n    if (this._options.content === 'embed') {\n      // Sometimes, we can receive a font/media file with textual mime type. Browser\n      // still interprets them correctly, but the 'content-type' header is obviously wrong.\n      if (isTextualMimeType(content.mimeType) && resourceType !== 'font') {\n        content.text = buffer.toString();\n      } else {\n        content.text = buffer.toString('base64');\n        content.encoding = 'base64';\n      }\n    } else if (this._options.content === 'attach') {\n      const sha1 = calculateSha1(buffer) + '.' + (mime.getExtension(content.mimeType) || 'dat');\n      if (this._options.includeTraceInfo)\n        content._sha1 = sha1;\n      else\n        content._file = sha1;\n      if (this._started)\n        this._delegate.onContentBlob(sha1, buffer);\n    }\n  }\n\n  private _onResponse(response: network.Response) {\n    const harEntry = this._entryForRequest(response.request());\n    if (!harEntry)\n      return;\n    const page = response.frame()?._page;\n    const pageEntry = this._createPageEntryIfNeeded(page);\n    const request = response.request();\n\n    harEntry.response = {\n      status: response.status(),\n      statusText: response.statusText(),\n      httpVersion: response.httpVersion(),\n      // These are bad values that will be overwritten bellow.\n      cookies: [],\n      headers: [],\n      content: {\n        size: -1,\n        mimeType: 'x-unknown',\n      },\n      headersSize: -1,\n      bodySize: -1,\n      redirectURL: '',\n      _transferSize: this._options.omitSizes ? undefined : -1\n    };\n\n    if (!this._options.omitTiming) {\n      const startDateTime = pageEntry ? ((pageEntry as any)[startedDateSymbol] as Date).valueOf() : 0;\n      const timing = response.timing();\n      if (pageEntry && startDateTime > timing.startTime)\n        pageEntry.startedDateTime = new Date(timing.startTime).toISOString();\n      const dns = timing.domainLookupEnd !== -1 ? helper.millisToRoundishMillis(timing.domainLookupEnd - timing.domainLookupStart) : -1;\n      const connect = timing.connectEnd !== -1 ? helper.millisToRoundishMillis(timing.connectEnd - timing.connectStart) : -1;\n      const ssl = timing.connectEnd !== -1 ? helper.millisToRoundishMillis(timing.connectEnd - timing.secureConnectionStart) : -1;\n      const wait = timing.responseStart !== -1 ? helper.millisToRoundishMillis(timing.responseStart - timing.requestStart) : -1;\n      const receive = -1;\n\n      harEntry.timings = {\n        dns,\n        connect,\n        ssl,\n        send: 0,\n        wait,\n        receive,\n      };\n      this._computeHarEntryTotalTime(harEntry);\n    }\n\n    this._recordRequestOverrides(harEntry, request);\n    this._addBarrier(page || request.serviceWorker(), request.rawRequestHeaders().then(headers => {\n      this._recordRequestHeadersAndCookies(harEntry, headers);\n    }));\n    // Record available headers including redirect location in case the tracing is stopped before\n    // response extra info is received (in Chromium).\n    this._recordResponseHeaders(harEntry, response.headers());\n    this._addBarrier(page || request.serviceWorker(), response.rawResponseHeaders().then(headers => {\n      this._recordResponseHeaders(harEntry, headers);\n    }));\n  }\n\n  private _recordResponseHeaders(harEntry: har.Entry, headers: HeadersArray) {\n    if (!this._options.omitCookies) {\n      harEntry.response.cookies = headers\n          .filter(header => header.name.toLowerCase() === 'set-cookie')\n          .map(header => parseCookie(header.value));\n    }\n    harEntry.response.headers = headers;\n    const contentType = headers.find(header => header.name.toLowerCase() === 'content-type');\n    if (contentType)\n      harEntry.response.content.mimeType = contentType.value;\n  }\n\n  private _computeHarEntryTotalTime(harEntry: har.Entry) {\n    harEntry.time = [\n      harEntry.timings.dns,\n      harEntry.timings.connect,\n      harEntry.timings.ssl,\n      harEntry.timings.wait,\n      harEntry.timings.receive\n    ].reduce((pre, cur) => (cur || -1) > 0 ? cur! + pre! : pre, 0)!;\n  }\n\n  async flush() {\n    await Promise.all(this._barrierPromises);\n  }\n\n  stop() {\n    this._started = false;\n    eventsHelper.removeEventListeners(this._eventListeners);\n    this._barrierPromises.clear();\n\n    const context = this._context instanceof BrowserContext ? this._context : undefined;\n    const log: har.Log = {\n      version: '1.2',\n      creator: {\n        name: 'Playwright',\n        version: getPlaywrightVersion(),\n      },\n      browser: {\n        name: context?._browser.options.name || '',\n        version: context?._browser.version() || ''\n      },\n      pages: this._pageEntries.size ? Array.from(this._pageEntries.values()) : undefined,\n      entries: [],\n    };\n    if (!this._options.omitTiming) {\n      for (const pageEntry of log.pages || []) {\n        const startDateTime = ((pageEntry as any)[startedDateSymbol] as Date).valueOf();\n        if (typeof pageEntry.pageTimings.onContentLoad === 'number' && pageEntry.pageTimings.onContentLoad >= 0)\n          pageEntry.pageTimings.onContentLoad -= startDateTime;\n        else\n          pageEntry.pageTimings.onContentLoad = -1;\n        if (typeof pageEntry.pageTimings.onLoad === 'number' && pageEntry.pageTimings.onLoad >= 0)\n          pageEntry.pageTimings.onLoad -= startDateTime;\n        else\n          pageEntry.pageTimings.onLoad = -1;\n      }\n    }\n    this._pageEntries.clear();\n    return log;\n  }\n\n  private _postDataForRequest(request: network.Request, content: 'omit' | 'attach' | 'embed'): har.PostData | undefined {\n    const postData = request.postDataBuffer();\n    if (!postData)\n      return;\n\n    const contentType = request.headerValue('content-type');\n    return this._postDataForBuffer(postData, contentType, content);\n  }\n\n  private  _postDataForBuffer(postData: Buffer | null, contentType: string | undefined, content: 'omit' | 'attach' | 'embed'): har.PostData | undefined {\n    if (!postData)\n      return;\n\n    contentType ??= 'application/octet-stream';\n\n    const result: har.PostData = {\n      mimeType: contentType,\n      text: '',\n      params: []\n    };\n\n    if (content === 'embed' && contentType !== 'application/octet-stream')\n      result.text = postData.toString();\n\n    if (content === 'attach') {\n      const sha1 = calculateSha1(postData) + '.' + (mime.getExtension(contentType) || 'dat');\n      if (this._options.includeTraceInfo)\n        result._sha1 = sha1;\n      else\n        result._file = sha1;\n      this._delegate.onContentBlob(sha1, postData);\n    }\n\n    if (contentType === 'application/x-www-form-urlencoded') {\n      const parsed = new URLSearchParams(postData.toString());\n      for (const [name, value] of parsed.entries())\n        result.params.push({ name, value });\n    }\n\n    return result;\n  }\n\n}\n\nfunction createHarEntry(method: string, url: URL, frameref: string | undefined, options: HarTracerOptions): har.Entry {\n  const harEntry: har.Entry = {\n    _frameref: options.includeTraceInfo ? frameref : undefined,\n    _monotonicTime: options.includeTraceInfo ? monotonicTime() : undefined,\n    startedDateTime: new Date().toISOString(),\n    time: -1,\n    request: {\n      method: method,\n      url: url.toString(),\n      httpVersion: FALLBACK_HTTP_VERSION,\n      cookies: [],\n      headers: [],\n      queryString: [...url.searchParams].map(e => ({ name: e[0], value: e[1] })),\n      headersSize: -1,\n      bodySize: -1,\n    },\n    response: {\n      status: -1,\n      statusText: '',\n      httpVersion: FALLBACK_HTTP_VERSION,\n      cookies: [],\n      headers: [],\n      content: {\n        size: -1,\n        mimeType: 'x-unknown',\n      },\n      headersSize: -1,\n      bodySize: -1,\n      redirectURL: '',\n      _transferSize: options.omitSizes ? undefined : -1\n    },\n    cache: {},\n    timings: {\n      send: -1,\n      wait: -1,\n      receive: -1\n    },\n  };\n  return harEntry;\n}\n\nfunction parseCookie(c: string): har.Cookie {\n  const cookie: har.Cookie = {\n    name: '',\n    value: ''\n  };\n  let first = true;\n  for (const pair of c.split(/; */)) {\n    const indexOfEquals = pair.indexOf('=');\n    const name = indexOfEquals !== -1 ? pair.substr(0, indexOfEquals).trim() : pair.trim();\n    const value = indexOfEquals !== -1 ? pair.substr(indexOfEquals + 1, pair.length).trim() : '';\n    if (first) {\n      first = false;\n      cookie.name = name;\n      cookie.value = value;\n      continue;\n    }\n\n    if (name === 'Domain')\n      cookie.domain = value;\n    if (name === 'Expires')\n      cookie.expires = safeDateToISOString(value);\n    if (name === 'HttpOnly')\n      cookie.httpOnly = true;\n    if (name === 'Max-Age')\n      cookie.expires = safeDateToISOString(Date.now() + (+value) * 1000);\n    if (name === 'Path')\n      cookie.path = value;\n    if (name === 'SameSite')\n      cookie.sameSite = value;\n    if (name === 'Secure')\n      cookie.secure = true;\n  }\n  return cookie;\n}\n\nfunction safeDateToISOString(value: string | number) {\n  try {\n    return new Date(value).toISOString();\n  } catch (e) {\n  }\n}\n\nconst startedDateSymbol = Symbol('startedDate');\n"],"mappings":"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"}