{"version":3,"file":"utilsBundle.js","names":["_url","_interopRequireDefault","require","_path","obj","__esModule","default","colors","exports","debug","dotenv","getProxyForUrl","HttpsProxyAgent","jpegjs","lockfile","mime","minimatch","open","PNG","program","progress","SocksProxyAgent","ws","wsServer","wsReceiver","wsSender","StackUtils","stackUtils","internals","nodeInternals","nodeMajorVersion","process","versions","node","split","parseStackTraceLine","line","_frame$file","_frame$file2","env","PWDEBUGIMPL","some","internal","test","frame","parseLine","file","startsWith","url","fileURLToPath","path","resolve","cwd","column","function","ms","isFinite","toFixed","seconds","minutes","hours","days"],"sources":["../src/utilsBundle.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport url from 'url';\nimport path from 'path';\n\nexport const colors: typeof import('../bundles/utils/node_modules/colors/safe') = require('./utilsBundleImpl').colors;\nexport const debug: typeof import('../bundles/utils/node_modules/@types/debug') = require('./utilsBundleImpl').debug;\nexport const dotenv: typeof import('../bundles/utils/node_modules/dotenv') = require('./utilsBundleImpl').dotenv;\nexport const getProxyForUrl: typeof import('../bundles/utils/node_modules/@types/proxy-from-env').getProxyForUrl = require('./utilsBundleImpl').getProxyForUrl;\nexport const HttpsProxyAgent: typeof import('../bundles/utils/node_modules/https-proxy-agent').HttpsProxyAgent = require('./utilsBundleImpl').HttpsProxyAgent;\nexport const jpegjs: typeof import('../bundles/utils/node_modules/jpeg-js') = require('./utilsBundleImpl').jpegjs;\nexport const lockfile: typeof import('../bundles/utils/node_modules/@types/proper-lockfile') = require('./utilsBundleImpl').lockfile;\nexport const mime: typeof import('../bundles/utils/node_modules/@types/mime') = require('./utilsBundleImpl').mime;\nexport const minimatch: typeof import('../bundles/utils/node_modules/@types/minimatch') = require('./utilsBundleImpl').minimatch;\nexport const open: typeof import('../bundles/utils/node_modules/open') = require('./utilsBundleImpl').open;\nexport const PNG: typeof import('../bundles/utils/node_modules/@types/pngjs').PNG = require('./utilsBundleImpl').PNG;\nexport const program: typeof import('../bundles/utils/node_modules/commander').program = require('./utilsBundleImpl').program;\nexport const progress: typeof import('../bundles/utils/node_modules/@types/progress') = require('./utilsBundleImpl').progress;\nexport const SocksProxyAgent: typeof import('../bundles/utils/node_modules/socks-proxy-agent').SocksProxyAgent = require('./utilsBundleImpl').SocksProxyAgent;\nexport const ws: typeof import('../bundles/utils/node_modules/@types/ws') = require('./utilsBundleImpl').ws;\nexport const wsServer: typeof import('../bundles/utils/node_modules/@types/ws').WebSocketServer = require('./utilsBundleImpl').wsServer;\nexport const wsReceiver = require('./utilsBundleImpl').wsReceiver;\nexport const wsSender = require('./utilsBundleImpl').wsSender;\nexport type { Command } from '../bundles/utils/node_modules/commander';\nexport type { WebSocket, WebSocketServer, RawData as WebSocketRawData, EventEmitter as WebSocketEventEmitter } from '../bundles/utils/node_modules/@types/ws';\nimport type { StackFrame } from '@protocol/channels';\n\nconst StackUtils: typeof import('../bundles/utils/node_modules/@types/stack-utils') = require('./utilsBundleImpl').StackUtils;\nconst stackUtils = new StackUtils({ internals: StackUtils.nodeInternals() });\nconst nodeInternals = StackUtils.nodeInternals();\nconst nodeMajorVersion = +process.versions.node.split('.')[0];\n\nexport function parseStackTraceLine(line: string): StackFrame | null {\n  if (!process.env.PWDEBUGIMPL && nodeMajorVersion < 16 && nodeInternals.some(internal => internal.test(line)))\n    return null;\n  const frame = stackUtils.parseLine(line);\n  if (!frame)\n    return null;\n  if (!process.env.PWDEBUGIMPL && (frame.file?.startsWith('internal') || frame.file?.startsWith('node:')))\n    return null;\n  if (!frame.file)\n    return null;\n  // ESM files return file:// URLs, see here: https://github.com/tapjs/stack-utils/issues/60\n  const file = frame.file.startsWith('file://') ? url.fileURLToPath(frame.file) : path.resolve(process.cwd(), frame.file);\n  return {\n    file,\n    line: frame.line || 0,\n    column: frame.column || 0,\n    function: frame.function,\n  };\n}\n\nexport function ms(ms: number): string {\n  if (!isFinite(ms))\n    return '-';\n\n  if (ms === 0)\n    return '0ms';\n\n  if (ms < 1000)\n    return ms.toFixed(0) + 'ms';\n\n  const seconds = ms / 1000;\n  if (seconds < 60)\n    return seconds.toFixed(1) + 's';\n\n  const minutes = seconds / 60;\n  if (minutes < 60)\n    return minutes.toFixed(1) + 'm';\n\n  const hours = minutes / 60;\n  if (hours < 24)\n    return hours.toFixed(1) + 'h';\n\n  const days = hours / 24;\n  return days.toFixed(1) + 'd';\n}\n"],"mappings":"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"}