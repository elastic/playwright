{"version":3,"file":"cssParser.js","names":["css","_interopRequireWildcard","require","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","InvalidSelectorError","Error","exports","isInvalidSelectorError","error","parseCSS","selector","customNames","tokens","tokenize","length","EOFToken","push","newMessage","message","index","stack","indexOf","substring","unsupportedToken","find","token","AtKeywordToken","BadStringToken","BadURLToken","ColumnToken","CDOToken","CDCToken","SemicolonToken","OpenCurlyToken","CloseCurlyToken","URLToken","PercentageToken","toSource","pos","names","Set","unexpected","skipWhitespace","WhitespaceToken","isIdent","p","IdentToken","isString","StringToken","isNumber","NumberToken","isComma","CommaToken","isOpenParen","OpenParenToken","isCloseParen","CloseParenToken","isFunction","FunctionToken","isStar","DelimToken","value","isEOF","isClauseCombinator","includes","isSelectorClauseEnd","consumeFunctionArguments","result","consumeArgument","consumeComplexSelector","simples","functions","name","args","combinator","consumeSimpleSelector","rawCSSString","HashToken","ColonToken","toLowerCase","add","consumeBuiltinFunctionArguments","OpenSquareToken","CloseSquareToken","undefined","s","balance","some","arg","Array","from","serializeSelector","map","String","func","join"],"sources":["../../../src/utils/isomorphic/cssParser.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as css from './cssTokenizer';\n\nexport class InvalidSelectorError extends Error {\n}\n\nexport function isInvalidSelectorError(error: Error) {\n  return error instanceof InvalidSelectorError;\n}\n\n// Note: '>=' is used internally for text engine to preserve backwards compatibility.\ntype ClauseCombinator = '' | '>' | '+' | '~' | '>=';\n// TODO: consider\n//   - key=value\n//   - operators like `=`, `|=`, `~=`, `*=`, `/`\n//   - <empty>~=value\n//   - argument modes: \"parse all\", \"parse commas\", \"just a string\"\nexport type CSSFunctionArgument = CSSComplexSelector | number | string;\nexport type CSSFunction = { name: string, args: CSSFunctionArgument[] };\nexport type CSSSimpleSelector = { css?: string, functions: CSSFunction[] };\nexport type CSSComplexSelector = { simples: { selector: CSSSimpleSelector, combinator: ClauseCombinator }[] };\nexport type CSSComplexSelectorList = CSSComplexSelector[];\n\nexport function parseCSS(selector: string, customNames: Set<string>): { selector: CSSComplexSelectorList, names: string[] } {\n  let tokens: css.CSSTokenInterface[];\n  try {\n    tokens = css.tokenize(selector);\n    if (!(tokens[tokens.length - 1] instanceof css.EOFToken))\n      tokens.push(new css.EOFToken());\n  } catch (e) {\n    const newMessage = e.message + ` while parsing selector \"${selector}\"`;\n    const index = (e.stack || '').indexOf(e.message);\n    if (index !== -1)\n      e.stack = e.stack.substring(0, index) + newMessage + e.stack.substring(index + e.message.length);\n    e.message = newMessage;\n    throw e;\n  }\n  const unsupportedToken = tokens.find(token => {\n    return (token instanceof css.AtKeywordToken) ||\n      (token instanceof css.BadStringToken) ||\n      (token instanceof css.BadURLToken) ||\n      (token instanceof css.ColumnToken) ||\n      (token instanceof css.CDOToken) ||\n      (token instanceof css.CDCToken) ||\n      (token instanceof css.SemicolonToken) ||\n      // TODO: Consider using these for something, e.g. to escape complex strings.\n      // For example :xpath{ (//div/bar[@attr=\"foo\"])[2]/baz }\n      // Or this way :xpath( {complex-xpath-goes-here(\"hello\")} )\n      (token instanceof css.OpenCurlyToken) ||\n      (token instanceof css.CloseCurlyToken) ||\n      // TODO: Consider treating these as strings?\n      (token instanceof css.URLToken) ||\n      (token instanceof css.PercentageToken);\n  });\n  if (unsupportedToken)\n    throw new InvalidSelectorError(`Unsupported token \"${unsupportedToken.toSource()}\" while parsing selector \"${selector}\"`);\n\n  let pos = 0;\n  const names = new Set<string>();\n\n  function unexpected() {\n    return new InvalidSelectorError(`Unexpected token \"${tokens[pos].toSource()}\" while parsing selector \"${selector}\"`);\n  }\n\n  function skipWhitespace() {\n    while (tokens[pos] instanceof css.WhitespaceToken)\n      pos++;\n  }\n\n  function isIdent(p = pos) {\n    return tokens[p] instanceof css.IdentToken;\n  }\n\n  function isString(p = pos) {\n    return tokens[p] instanceof css.StringToken;\n  }\n\n  function isNumber(p = pos) {\n    return tokens[p] instanceof css.NumberToken;\n  }\n\n  function isComma(p = pos) {\n    return tokens[p] instanceof css.CommaToken;\n  }\n\n  function isOpenParen(p = pos) {\n    return tokens[p] instanceof css.OpenParenToken;\n  }\n\n  function isCloseParen(p = pos) {\n    return tokens[p] instanceof css.CloseParenToken;\n  }\n\n  function isFunction(p = pos) {\n    return tokens[p] instanceof css.FunctionToken;\n  }\n\n  function isStar(p = pos) {\n    return (tokens[p] instanceof css.DelimToken) && tokens[p].value === '*';\n  }\n\n  function isEOF(p = pos) {\n    return tokens[p] instanceof css.EOFToken;\n  }\n\n  function isClauseCombinator(p = pos) {\n    return (tokens[p] instanceof css.DelimToken) && (['>', '+', '~'].includes(tokens[p].value as string));\n  }\n\n  function isSelectorClauseEnd(p = pos) {\n    return isComma(p) || isCloseParen(p) || isEOF(p) || isClauseCombinator(p) || (tokens[p] instanceof css.WhitespaceToken);\n  }\n\n  function consumeFunctionArguments(): CSSFunctionArgument[] {\n    const result = [consumeArgument()];\n    while (true) {\n      skipWhitespace();\n      if (!isComma())\n        break;\n      pos++;\n      result.push(consumeArgument());\n    }\n    return result;\n  }\n\n  function consumeArgument(): CSSFunctionArgument {\n    skipWhitespace();\n    if (isNumber())\n      return tokens[pos++].value!;\n    if (isString())\n      return tokens[pos++].value!;\n    return consumeComplexSelector();\n  }\n\n  function consumeComplexSelector(): CSSComplexSelector {\n    const result: CSSComplexSelector = { simples: [] };\n    skipWhitespace();\n    if (isClauseCombinator()) {\n      // Put implicit \":scope\" at the start. https://drafts.csswg.org/selectors-4/#relative\n      result.simples.push({ selector: { functions: [{ name: 'scope', args: [] }] }, combinator: '' });\n    } else {\n      result.simples.push({ selector: consumeSimpleSelector(), combinator: '' });\n    }\n    while (true) {\n      skipWhitespace();\n      if (isClauseCombinator()) {\n        result.simples[result.simples.length - 1].combinator = tokens[pos++].value as ClauseCombinator;\n        skipWhitespace();\n      } else if (isSelectorClauseEnd()) {\n        break;\n      }\n      result.simples.push({ combinator: '', selector: consumeSimpleSelector() });\n    }\n    return result;\n  }\n\n  function consumeSimpleSelector(): CSSSimpleSelector {\n    let rawCSSString = '';\n    const functions: CSSFunction[] = [];\n\n    while (!isSelectorClauseEnd()) {\n      if (isIdent() || isStar()) {\n        rawCSSString += tokens[pos++].toSource();\n      } else if (tokens[pos] instanceof css.HashToken) {\n        rawCSSString += tokens[pos++].toSource();\n      } else if ((tokens[pos] instanceof css.DelimToken) && tokens[pos].value === '.') {\n        pos++;\n        if (isIdent())\n          rawCSSString += '.' + tokens[pos++].toSource();\n        else\n          throw unexpected();\n      } else if (tokens[pos] instanceof css.ColonToken) {\n        pos++;\n        if (isIdent()) {\n          if (!customNames.has((tokens[pos].value as string).toLowerCase())) {\n            rawCSSString += ':' + tokens[pos++].toSource();\n          } else {\n            const name = (tokens[pos++].value as string).toLowerCase();\n            functions.push({ name, args: [] });\n            names.add(name);\n          }\n        } else if (isFunction()) {\n          const name = (tokens[pos++].value as string).toLowerCase();\n          if (!customNames.has(name)) {\n            rawCSSString += `:${name}(${consumeBuiltinFunctionArguments()})`;\n          } else {\n            functions.push({ name, args: consumeFunctionArguments() });\n            names.add(name);\n          }\n          skipWhitespace();\n          if (!isCloseParen())\n            throw unexpected();\n          pos++;\n        } else {\n          throw unexpected();\n        }\n      } else if (tokens[pos] instanceof css.OpenSquareToken) {\n        rawCSSString += '[';\n        pos++;\n        while (!(tokens[pos] instanceof css.CloseSquareToken) && !isEOF())\n          rawCSSString += tokens[pos++].toSource();\n        if (!(tokens[pos] instanceof css.CloseSquareToken))\n          throw unexpected();\n        rawCSSString += ']';\n        pos++;\n      } else {\n        throw unexpected();\n      }\n    }\n    if (!rawCSSString && !functions.length)\n      throw unexpected();\n    return { css: rawCSSString || undefined, functions };\n  }\n\n  function consumeBuiltinFunctionArguments(): string {\n    let s = '';\n    let balance = 1;  // First open paren is a part of a function token.\n    while (!isEOF()) {\n      if (isOpenParen() || isFunction())\n        balance++;\n      if (isCloseParen())\n        balance--;\n      if (!balance)\n        break;\n      s += tokens[pos++].toSource();\n    }\n    return s;\n  }\n\n  const result = consumeFunctionArguments();\n  if (!isEOF())\n    throw unexpected();\n  if (result.some(arg => typeof arg !== 'object' || !('simples' in arg)))\n    throw new InvalidSelectorError(`Error while parsing selector \"${selector}\"`);\n  return { selector: result as CSSComplexSelector[], names: Array.from(names) };\n}\n\nexport function serializeSelector(args: CSSFunctionArgument[]) {\n  return args.map(arg => {\n    if (typeof arg === 'string')\n      return `\"${arg}\"`;\n    if (typeof arg === 'number')\n      return String(arg);\n    return arg.simples.map(({ selector, combinator }) => {\n      let s = selector.css || '';\n      s = s + selector.functions.map(func => `:${func.name}(${serializeSelector(func.args)})`).join('');\n      if (combinator)\n        s += ' ' + combinator;\n      return s;\n    }).join(' ');\n  }).join(', ');\n}\n"],"mappings":"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"}